###############################################################################
#                                                                             #
# IAR C/C++ Compiler V7.51A/W32 for 8051                06/Jan/2013  15:04:33 #
# Copyright 2004-2009 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  C:\Texas Instruments\ZStack-CC2530-2.3.0-1.4.0\Pro #
#                          jects\zstack\Samples\three_SerialApp\Source\Serial #
#                          App.c                                              #
#    Command line       =  -f "C:\Texas Instruments\ZStack-CC2530-2.3.0-1.4.0 #
#                          \Projects\zstack\Samples\three_SerialApp\CC2530DB\ #
#                          ..\..\..\Tools\CC2530DB\f8wCoord.cfg" (-DCPU32MHZ  #
#                          -DROOT=__near_func -DMAC_CFG_APP_PENDING_QUEUE=TRU #
#                          E -DZDO_COORDINATOR -DBLINK_LEDS) -f "C:\Texas     #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Samples\three_SerialApp\CC2530DB\..\..\..\Tool #
#                          s\CC2530DB\f8wConfig.cfg" (-DSECURE=0              #
#                          -DZG_SECURE_DYNAMIC=0 -DREFLECTOR                  #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0x1234                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116 "-DCONST=const __code"    #
#                          -DGENERIC=__generic -DRFD_RCVC_ALWAYS_ON=FALSE     #
#                          -DPOLL_RATE=1000 -DQUEUED_POLL_RATE=100            #
#                          -DRESPONSE_POLL_RATE=100) -DREJOIN_POLL_RATE=440   #
#                          "C:\Texas Instruments\ZStack-CC2530-2.3.0-1.4.0\Pr #
#                          ojects\zstack\Samples\three_SerialApp\Source\Seria #
#                          lApp.c" -D HAL_UART=TRUE -D SERIAL_APP_PORT=0 -D   #
#                          LCD_SUPPORTED -lC "C:\Texas                        #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Samples\three_SerialApp\CC2530DB\CoordinatorEB #
#                          \List\" -lA "C:\Texas Instruments\ZStack-CC2530-2. #
#                          3.0-1.4.0\Projects\zstack\Samples\three_SerialApp\ #
#                          CC2530DB\CoordinatorEB\List\" --diag_suppress      #
#                          Pe001,Pa010 -o "C:\Texas                           #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Samples\three_SerialApp\CC2530DB\CoordinatorEB #
#                          \Obj\" -e --require_prototypes --debug             #
#                          --core=plain --dptr=16,1 --data_model=large        #
#                          --code_model=banked --calling_convention=xdata_ree #
#                          ntrant --place_constants=data_rom                  #
#                          --nr_virtual_regs 16 -I "C:\Texas                  #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Samples\three_SerialApp\CC2530DB\" -I          #
#                          "C:\Texas Instruments\ZStack-CC2530-2.3.0-1.4.0\Pr #
#                          ojects\zstack\Samples\three_SerialApp\CC2530DB\..\ #
#                          SOURCE\" -I "C:\Texas Instruments\ZStack-CC2530-2. #
#                          3.0-1.4.0\Projects\zstack\Samples\three_SerialApp\ #
#                          CC2530DB\..\..\..\ZMAIN\TI2530DB\" -I "C:\Texas    #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Samples\three_SerialApp\CC2530DB\..\..\..\..\. #
#                          .\COMPONENTS\MT\" -I "C:\Texas                     #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Samples\three_SerialApp\CC2530DB\..\..\..\..\. #
#                          .\COMPONENTS\HAL\INCLUDE\" -I "C:\Texas            #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Samples\three_SerialApp\CC2530DB\..\..\..\..\. #
#                          .\COMPONENTS\HAL\TARGET\CC2530EB\" -I "C:\Texas    #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Samples\three_SerialApp\CC2530DB\..\..\..\..\. #
#                          .\COMPONENTS\OSAL\MCU\CCSOC\" -I "C:\Texas         #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Samples\three_SerialApp\CC2530DB\..\..\..\..\. #
#                          .\COMPONENTS\OSAL\INCLUDE\" -I "C:\Texas           #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Samples\three_SerialApp\CC2530DB\..\..\..\..\. #
#                          .\COMPONENTS\STACK\AF\" -I "C:\Texas               #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Samples\three_SerialApp\CC2530DB\..\..\..\..\. #
#                          .\COMPONENTS\STACK\NWK\" -I "C:\Texas              #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Samples\three_SerialApp\CC2530DB\..\..\..\..\. #
#                          .\COMPONENTS\STACK\SEC\" -I "C:\Texas              #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Samples\three_SerialApp\CC2530DB\..\..\..\..\. #
#                          .\COMPONENTS\STACK\SAPI\" -I "C:\Texas             #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Samples\three_SerialApp\CC2530DB\..\..\..\..\. #
#                          .\COMPONENTS\STACK\SYS\" -I "C:\Texas              #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Samples\three_SerialApp\CC2530DB\..\..\..\..\. #
#                          .\COMPONENTS\STACK\ZDO\" -I "C:\Texas              #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Samples\three_SerialApp\CC2530DB\..\..\..\..\. #
#                          .\COMPONENTS\ZMAC\F8W\" -I "C:\Texas               #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Samples\three_SerialApp\CC2530DB\..\..\..\..\. #
#                          .\COMPONENTS\ZMAC\" -I "C:\Texas                   #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Samples\three_SerialApp\CC2530DB\..\..\..\..\. #
#                          .\COMPONENTS\SERVICES\SADDR\" -I "C:\Texas         #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Samples\three_SerialApp\CC2530DB\..\..\..\..\. #
#                          .\COMPONENTS\SERVICES\SDATA\" -I "C:\Texas         #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Samples\three_SerialApp\CC2530DB\..\..\..\..\. #
#                          .\COMPONENTS\MAC\INCLUDE\" -I "C:\Texas            #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Samples\three_SerialApp\CC2530DB\..\..\..\..\. #
#                          .\COMPONENTS\MAC\HIGH_LEVEL\" -I "C:\Texas         #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Samples\three_SerialApp\CC2530DB\..\..\..\..\. #
#                          .\COMPONENTS\MAC\LOW_LEVEL\srf04\" -I "C:\Texas    #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Samples\three_SerialApp\CC2530DB\..\..\..\..\. #
#                          .\COMPONENTS\MAC\LOW_LEVEL\srf04\SINGLE_CHIP\" -I  #
#                          "C:\Program Files\IAR Systems\Embedded Workbench   #
#                          5.3\8051\INC\" -I "C:\Program Files\IAR            #
#                          Systems\Embedded Workbench 5.3\8051\INC\CLIB\"     #
#                          -Ohz                                               #
#    List file          =  C:\Texas Instruments\ZStack-CC2530-2.3.0-1.4.0\Pro #
#                          jects\zstack\Samples\three_SerialApp\CC2530DB\Coor #
#                          dinatorEB\List\SerialApp.lst                       #
#    Object file        =  C:\Texas Instruments\ZStack-CC2530-2.3.0-1.4.0\Pro #
#                          jects\zstack\Samples\three_SerialApp\CC2530DB\Coor #
#                          dinatorEB\Obj\SerialApp.r51                        #
#                                                                             #
#                                                                             #
###############################################################################

C:\Texas Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zstack\Samples\three_SerialApp\Source\SerialApp.c
      1          /**************************************************************************************************
      2            Filename:       SerialApp.c
      3            Revised:        $Date: 2009-03-29 10:51:47 -0700 (Sun, 29 Mar 2009) $
      4            Revision:       $Revision: 19585 $
      5          
      6            Description -   Serial Transfer Application (no Profile).
      7          
      8          
      9            Copyright 2004-2009 Texas Instruments Incorporated. All rights reserved.
     10          
     11            IMPORTANT: Your use of this Software is limited to those specific rights
     12            granted under the terms of a software license agreement between the user
     13            who downloaded the software, his/her employer (which must be your employer)
     14            and Texas Instruments Incorporated (the "License").  You may not use this
     15            Software unless you agree to abide by the terms of the License. The License
     16            limits your use, and you acknowledge, that the Software may not be modified,
     17            copied or distributed unless embedded on a Texas Instruments microcontroller
     18            or used solely and exclusively in conjunction with a Texas Instruments radio
     19            frequency transceiver, which is integrated into your product.  Other than for
     20            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     21            works of, modify, distribute, perform, display or sell this Software and/or
     22            its documentation for any purpose.
     23          
     24            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     25            PROVIDED “AS IS?WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED, 
     26            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE, 
     27            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     28            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     29            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     30            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     31            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     32            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     33            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     34            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     35          
     36            Should you have any questions regarding your right to use this Software,
     37            contact Texas Instruments Incorporated at www.TI.com. 
     38          **************************************************************************************************/
     39          
     40          /*********************************************************************
     41            This sample application is basically a cable replacement
     42            and it should be customized for your application. A PC
     43            (or other device) sends data via the serial port to this
     44            application's device.  This device transmits the message
     45            to another device with the same application running. The
     46            other device receives the over-the-air message and sends
     47            it to a PC (or other device) connected to its serial port.
     48          				
     49            This application doesn't have a profile, so it handles everything directly.
     50          
     51            Key control:
     52              SW1:
     53              SW2:  initiates end device binding
     54              SW3:
     55              SW4:  initiates a match description request
     56          *********************************************************************/
     57          
     58          /*********************************************************************
     59           * INCLUDES
     60           */
     61          
     62          #include "AF.h"
     63          #include "OnBoard.h"
     64          #include "OSAL_Tasks.h"
     65          #include "SerialApp.h"
     66          #include "ZDApp.h"
     67          #include "ZDObject.h"
     68          #include "ZDProfile.h"
     69          
     70          #include "hal_drivers.h"
     71          #include "hal_key.h"
     72          #if defined ( LCD_SUPPORTED )
     73            #include "hal_lcd.h"
     74          #endif
     75          #include "hal_led.h"
     76          #include "hal_uart.h"
     77          
     78          /*********************************************************************
     79           * MACROS
     80           */
     81          
     82          /*********************************************************************
     83           * CONSTANTS
     84           */
     85          
     86          #if !defined( SERIAL_APP_PORT )
     87          #define SERIAL_APP_PORT  0
     88          #endif
     89          
     90          #if !defined( SERIAL_APP_BAUD )
     91          #define SERIAL_APP_BAUD  HAL_UART_BR_38400
     92          //#define SERIAL_APP_BAUD  HAL_UART_BR_115200
     93          #endif
     94          
     95          // When the Rx buf space is less than this threshold, invoke the Rx callback.
     96          #if !defined( SERIAL_APP_THRESH )
     97          #define SERIAL_APP_THRESH  64
     98          #endif
     99          
    100          #if !defined( SERIAL_APP_RX_SZ )
    101          #define SERIAL_APP_RX_SZ  128
    102          #endif
    103          
    104          #if !defined( SERIAL_APP_TX_SZ )
    105          #define SERIAL_APP_TX_SZ  128
    106          #endif
    107          
    108          // Millisecs of idle time after a byte is received before invoking Rx callback.
    109          #if !defined( SERIAL_APP_IDLE )
    110          #define SERIAL_APP_IDLE  6
    111          #endif
    112          
    113          // Loopback Rx bytes to Tx for throughput testing.
    114          #if !defined( SERIAL_APP_LOOPBACK )
    115          #define SERIAL_APP_LOOPBACK  FALSE
    116          #endif
    117          
    118          // This is the max byte count per OTA message.
    119          #if !defined( SERIAL_APP_TX_MAX )
    120          #define SERIAL_APP_TX_MAX  80
    121          #endif
    122          
    123          #define SERIAL_APP_RSP_CNT  4
    124          
    125          // This list should be filled with Application specific Cluster IDs.

   \                                 In  segment XDATA_ROM_C, align 1
    126          const cId_t SerialApp_ClusterList[SERIALAPP_MAX_CLUSTERS] =
   \                     SerialApp_ClusterList:
   \   000000   01000200     DW 1, 2
    127          {
    128            SERIALAPP_CLUSTERID1,
    129            SERIALAPP_CLUSTERID2
    130          };
    131          

   \                                 In  segment XDATA_ROM_C, align 1
    132          const SimpleDescriptionFormat_t SerialApp_SimpleDesc =
   \                     SerialApp_SimpleDesc:
   \   000000   0B           DB 11
   \   000001   050F0100     DW 3845, 1
   \   000005   0002         DB 0, 2
   \   000007   ....         DW SerialApp_ClusterList
   \   000009   02           DB 2
   \   00000A   ....         DW SerialApp_ClusterList
    133          {
    134            SERIALAPP_ENDPOINT,              //  int   Endpoint;
    135            SERIALAPP_PROFID,                //  uint16 AppProfId[2];
    136            SERIALAPP_DEVICEID,              //  uint16 AppDeviceId[2];
    137            SERIALAPP_DEVICE_VERSION,        //  int   AppDevVer:4;
    138            SERIALAPP_FLAGS,                 //  int   AppFlags:4;
    139            SERIALAPP_MAX_CLUSTERS,          //  byte  AppNumInClusters;
    140            (cId_t *)SerialApp_ClusterList,  //  byte *pAppInClusterList;
    141            SERIALAPP_MAX_CLUSTERS,          //  byte  AppNumOutClusters;
    142            (cId_t *)SerialApp_ClusterList   //  byte *pAppOutClusterList;
    143          };
    144          

   \                                 In  segment XDATA_ROM_C, align 1
    145          const endPointDesc_t SerialApp_epDesc =
   \                     SerialApp_epDesc:
   \   000000   0B           DB 11
   \   000001   ........     DW SerialApp_TaskID, SerialApp_SimpleDesc
   \   000005   00           DB 0
    146          {
    147            SERIALAPP_ENDPOINT,
    148           &SerialApp_TaskID,
    149            (SimpleDescriptionFormat_t *)&SerialApp_SimpleDesc,
    150            noLatencyReqs
    151          };
    152          
    153          /*********************************************************************
    154           * TYPEDEFS
    155           */
    156          
    157          /*********************************************************************
    158           * GLOBAL VARIABLES
    159           */
    160          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    161          uint8 SerialApp_TaskID;    // Task ID for internal task/event processing.
   \                     SerialApp_TaskID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    162          
    163          /*********************************************************************
    164           * EXTERNAL VARIABLES
    165           */
    166          
    167          /*********************************************************************
    168           * EXTERNAL FUNCTIONS
    169           */
    170          
    171          /*********************************************************************
    172           * LOCAL VARIABLES
    173           */
    174          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    175          static uint8 SerialApp_MsgID;
   \                     SerialApp_MsgID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    176          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    177          static afAddrType_t SerialApp_TxAddr;
   \                     SerialApp_TxAddr:
   \   000000                DS 12
   \   00000C                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    178          static uint8 SerialApp_TxSeq;
   \                     SerialApp_TxSeq:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    179          static uint8 SerialApp_TxBuf[SERIAL_APP_TX_MAX+1];
   \                     SerialApp_TxBuf:
   \   000000                DS 81
   \   000051                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    180          static uint8 SerialApp_TxLen;
   \                     SerialApp_TxLen:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    181          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    182          static afAddrType_t SerialApp_RxAddr;
   \                     SerialApp_RxAddr:
   \   000000                DS 12
   \   00000C                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    183          static uint8 SerialApp_RxSeq;
   \                     SerialApp_RxSeq:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    184          static uint8 SerialApp_RspBuf[SERIAL_APP_RSP_CNT];
   \                     SerialApp_RspBuf:
   \   000000                DS 4
   \   000004                REQUIRE __INIT_XDATA_Z
    185          
    186          /*********************************************************************
    187           * LOCAL FUNCTIONS
    188           */
    189          
    190          static void SerialApp_ProcessZDOMsgs( zdoIncomingMsg_t *inMsg );
    191          static void SerialApp_HandleKeys( uint8 shift, uint8 keys );
    192          static void SerialApp_ProcessMSGCmd( afIncomingMSGPacket_t *pkt );
    193          static void SerialApp_Send(void);
    194          static void SerialApp_Resp(void);
    195          static void SerialApp_CallBack(uint8 port, uint8 event);
    196          
    197          /*********************************************************************
    198           * @fn      SerialApp_Init
    199           *
    200           * @brief   This is called during OSAL tasks' initialization.
    201           *
    202           * @param   task_id - the Task ID assigned by OSAL.
    203           *
    204           * @return  none
    205           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    206          void SerialApp_Init( uint8 task_id )
   \                     SerialApp_Init:
    207          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 29
   \   000005   74E3         MOV     A,#-0x1d
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   E9           MOV     A,R1
   \   00000B   FE           MOV     R6,A
    208            halUARTCfg_t uartConfig;
    209            //zAddrType_t txAddr;
    210            SerialApp_TaskID = task_id;
   \   00000C   90....       MOV     DPTR,#SerialApp_TaskID
   \   00000F   F0           MOVX    @DPTR,A
    211            SerialApp_RxSeq = 0xC3;
   \   000010   74C3         MOV     A,#-0x3d
   \   000012   90....       MOV     DPTR,#SerialApp_RxSeq
   \   000015   F0           MOVX    @DPTR,A
    212          
    213            afRegister( (endPointDesc_t *)&SerialApp_epDesc );
   \   000016                ; Setup parameters for call to function afRegister
   \   000016   7A..         MOV     R2,#(SerialApp_epDesc & 0xff)
   \   000018   7B..         MOV     R3,#((SerialApp_epDesc >> 8) & 0xff)
   \   00001A   12....       LCALL   ??afRegister?relay
    214          
    215            RegisterForKeys( task_id );
   \   00001D                ; Setup parameters for call to function RegisterForKeys
   \   00001D   EE           MOV     A,R6
   \   00001E   F9           MOV     R1,A
   \   00001F   12....       LCALL   ??RegisterForKeys?relay
    216          
    217            uartConfig.configured           = TRUE;              // 2x30 don't care - see uart driver.
   \   000022   7401         MOV     A,#0x1
   \   000024   85..82       MOV     DPL,?XSP + 0
   \   000027   85..83       MOV     DPH,?XSP + 1
   \   00002A   F0           MOVX    @DPTR,A
    218            uartConfig.baudRate             = HAL_UART_BR_115200;
   \   00002B   12....       LCALL   ?XSTACK_DISP0_8
   \   00002E   7404         MOV     A,#0x4
   \   000030   F0           MOVX    @DPTR,A
    219            uartConfig.flowControl          = FALSE;
   \   000031   7402         MOV     A,#0x2
   \   000033   12....       LCALL   ?XSTACK_DISP0_8
   \   000036   E4           CLR     A
   \   000037   F0           MOVX    @DPTR,A
    220            uartConfig.flowControlThreshold = SERIAL_APP_THRESH; // 2x30 don't care - see uart driver.
   \   000038   7403         MOV     A,#0x3
   \   00003A   12....       LCALL   ?XSTACK_DISP0_8
   \   00003D   7440         MOV     A,#0x40
   \   00003F   F0           MOVX    @DPTR,A
   \   000040   A3           INC     DPTR
   \   000041   E4           CLR     A
   \   000042   F0           MOVX    @DPTR,A
    221            uartConfig.rx.maxBufSize        = SERIAL_APP_RX_SZ;  // 2x30 don't care - see uart driver.
   \   000043   740A         MOV     A,#0xa
   \   000045   12....       LCALL   ?XSTACK_DISP0_8
   \   000048   7480         MOV     A,#-0x80
   \   00004A   F0           MOVX    @DPTR,A
   \   00004B   A3           INC     DPTR
   \   00004C   E4           CLR     A
   \   00004D   F0           MOVX    @DPTR,A
    222            uartConfig.tx.maxBufSize        = SERIAL_APP_TX_SZ;  // 2x30 don't care - see uart driver.
   \   00004E   7412         MOV     A,#0x12
   \   000050   12....       LCALL   ?XSTACK_DISP0_8
   \   000053   7480         MOV     A,#-0x80
   \   000055   F0           MOVX    @DPTR,A
   \   000056   A3           INC     DPTR
   \   000057   E4           CLR     A
   \   000058   F0           MOVX    @DPTR,A
    223            uartConfig.idleTimeout          = SERIAL_APP_IDLE;   // 2x30 don't care - see uart driver.
   \   000059   7405         MOV     A,#0x5
   \   00005B   12....       LCALL   ?XSTACK_DISP0_8
   \   00005E   7406         MOV     A,#0x6
   \   000060   F0           MOVX    @DPTR,A
    224            uartConfig.intEnable            = TRUE;              // 2x30 don't care - see uart driver.
   \   000061   7416         MOV     A,#0x16
   \   000063   12....       LCALL   ?XSTACK_DISP0_8
   \   000066   7401         MOV     A,#0x1
   \   000068   F0           MOVX    @DPTR,A
    225            uartConfig.callBackFunc         = SerialApp_CallBack;
   \   000069   741B         MOV     A,#0x1b
   \   00006B   12....       LCALL   ?XSTACK_DISP0_8
   \   00006E   74..         MOV     A,#(??SerialApp_CallBack?relay & 0xff)
   \   000070   F0           MOVX    @DPTR,A
   \   000071   A3           INC     DPTR
   \   000072   74..         MOV     A,#((??SerialApp_CallBack?relay >> 8) & 0xff)
   \   000074   12....       LCALL   ?Subroutine0 & 0xFFFF
    226            HalUARTOpen (SERIAL_APP_PORT, &uartConfig);
   \                     ??CrossCallReturnLabel_0:
   \   000077   AA82         MOV     R2,DPL
   \   000079   AB83         MOV     R3,DPH
   \   00007B   7900         MOV     R1,#0x0
   \   00007D   12....       LCALL   ??HalUARTOpen?relay
    227          
    228          #if defined ( LCD_SUPPORTED )
    229            HalLcdWriteString( "SerialApp", HAL_LCD_LINE_2 );
   \   000080                ; Setup parameters for call to function HalLcdWriteString
   \   000080   7902         MOV     R1,#0x2
   \   000082   7A..         MOV     R2,#(`?<Constant "SerialApp">` & 0xff)
   \   000084   7B..         MOV     R3,#((`?<Constant "SerialApp">` >> 8) & 0xff)
   \   000086   12....       LCALL   ??HalLcdWriteString?relay
    230          #endif
    231            
    232            ZDO_RegisterForZDOMsg( SerialApp_TaskID, End_Device_Bind_rsp );
   \   000089                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000089   7A20         MOV     R2,#0x20
   \   00008B   7B80         MOV     R3,#-0x80
   \   00008D   90....       MOV     DPTR,#SerialApp_TaskID
   \   000090   E0           MOVX    A,@DPTR
   \   000091   F9           MOV     R1,A
   \   000092   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay
    233            ZDO_RegisterForZDOMsg( SerialApp_TaskID, Match_Desc_rsp );
   \   000095                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000095   7A06         MOV     R2,#0x6
   \   000097   7B80         MOV     R3,#-0x80
   \   000099   90....       MOV     DPTR,#SerialApp_TaskID
   \   00009C   E0           MOVX    A,@DPTR
   \   00009D   F9           MOV     R1,A
   \   00009E   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay
    234            osal_start_timerEx( SerialApp_TaskID, 0xaa, 5000);
   \   0000A1                ; Setup parameters for call to function osal_start_timerEx
   \   0000A1   7C88         MOV     R4,#-0x78
   \   0000A3   7D13         MOV     R5,#0x13
   \   0000A5   7AAA         MOV     R2,#-0x56
   \   0000A7   7B00         MOV     R3,#0x0
   \   0000A9   90....       MOV     DPTR,#SerialApp_TaskID
   \   0000AC   E0           MOVX    A,@DPTR
   \   0000AD   F9           MOV     R1,A
   \   0000AE   12....       LCALL   ??osal_start_timerEx?relay
    235          /****************************************************************************/
    236           /*    HalLedSet ( HAL_LED_4, HAL_LED_MODE_OFF ); 
    237                txAddr.addrMode = Addr16Bit;
    238                txAddr.addr.shortAddr = 0x0000; // Coordinator
    239                ZDP_EndDeviceBindReq( &txAddr, NLME_GetShortAddr(), 
    240                                      SerialApp_epDesc.endPoint,
    241                                      SERIALAPP_PROFID,
    242                                      SERIALAPP_MAX_CLUSTERS, (cId_t *)SerialApp_ClusterList,
    243                                      SERIALAPP_MAX_CLUSTERS, (cId_t *)SerialApp_ClusterList,
    244                                      FALSE );
    245            
    246          */
    247            
    248            
    249            
    250            
    251            
    252            
    253          }
   \   0000B1   741D         MOV     A,#0x1d
   \   0000B3   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000B6   7F01         MOV     R7,#0x1
   \   0000B8   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   F0           MOVX    @DPTR,A
   \   000001                ; Setup parameters for call to function HalUARTOpen
   \   000001   85..82       MOV     DPL,?XSP + 0
   \   000004   85..83       MOV     DPH,?XSP + 1
   \   000007   22           RET
    254          
    255          /*********************************************************************
    256           * @fn      SerialApp_ProcessEvent
    257           *
    258           * @brief   Generic Application Task event processor.
    259           *
    260           * @param   task_id  - The OSAL assigned task ID.
    261           * @param   events   - Bit map of events to process.
    262           *
    263           * @return  Event flags of all unprocessed events.
    264           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    265          UINT16 SerialApp_ProcessEvent( uint8 task_id, UINT16 events )
   \                     SerialApp_ProcessEvent:
    266          {
   \   000000   74F0         MOV     A,#-0x10
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 18
   \   000005   74EE         MOV     A,#-0x12
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   8A..         MOV     ?V0 + 0,R2
   \   00000C   8B..         MOV     ?V0 + 1,R3
    267            (void)task_id;  // Intentionally unreferenced parameter
    268            zAddrType_t txAddr;
    269            if ( events & SYS_EVENT_MSG )
   \   00000E   75....       MOV     ?V0 + 4,#(SerialApp_ClusterList & 0xff)
   \   000011   75....       MOV     ?V0 + 5,#((SerialApp_ClusterList >> 8) & 0xff)
   \   000014   7480         MOV     A,#-0x80
   \   000016   55..         ANL     A,?V0 + 1
   \   000018   F9           MOV     R1,A
   \   000019   E4           CLR     A
   \   00001A   7001         JNZ     ??SerialApp_ProcessEvent_0
   \   00001C   E9           MOV     A,R1
   \                     ??SerialApp_ProcessEvent_0:
   \   00001D   701F         JNZ     ??SerialApp_ProcessEvent_1
    270            {
    271              afIncomingMSGPacket_t *MSGpkt;
    272          
    273              while ( (MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( SerialApp_TaskID )) )
    274              {
    275                switch ( MSGpkt->hdr.event )
    276                {
    277                case ZDO_CB_MSG:
    278                  SerialApp_ProcessZDOMsgs( (zdoIncomingMsg_t *)MSGpkt );
    279                  break;
    280                    
    281                case KEY_CHANGE:
    282                  SerialApp_HandleKeys( ((keyChange_t *)MSGpkt)->state, ((keyChange_t *)MSGpkt)->keys );
    283                  break;
    284          
    285                case AF_INCOMING_MSG_CMD:
    286                  SerialApp_ProcessMSGCmd( MSGpkt );
    287                  break;
    288          
    289                default:
    290                  break;
    291                }
    292          
    293                osal_msg_deallocate( (uint8 *)MSGpkt );
    294              }
    295          
    296              return ( events ^ SYS_EVENT_MSG );
    297            }
    298          
    299            if ( events & SERIALAPP_SEND_EVT )
   \   00001F   EA           MOV     A,R2
   \   000020   A2E0         MOV     C,0xE0 /* A   */.0
   \   000022   4003         JC      $+5
   \   000024   02....       LJMP    ??SerialApp_ProcessEvent_2 & 0xFFFF
    300            {
    301              SerialApp_Send();
   \   000027                ; Setup parameters for call to function SerialApp_Send
   \   000027   12....       LCALL   ??SerialApp_Send?relay
    302              return ( events ^ SERIALAPP_SEND_EVT );
   \   00002A   7401         MOV     A,#0x1
   \                     ??SerialApp_ProcessEvent_3:
   \   00002C   65..         XRL     A,?V0 + 0
   \   00002E   FA           MOV     R2,A
   \   00002F   AB..         MOV     R3,?V0 + 1
   \   000031   02....       LJMP    ??SerialApp_ProcessEvent_4 & 0xFFFF
    303            }
   \                     ??SerialApp_ProcessEvent_5:
   \   000034                ; Setup parameters for call to function SerialApp_ProcessMSGCmd
   \   000034   12....       LCALL   ??SerialApp_ProcessMSGCmd?relay
   \                     ??SerialApp_ProcessEvent_6:
   \   000037                ; Setup parameters for call to function osal_msg_deallocate
   \   000037   AA..         MOV     R2,?V0 + 2
   \   000039   AB..         MOV     R3,?V0 + 3
   \   00003B   12....       LCALL   ??osal_msg_deallocate?relay
   \                     ??SerialApp_ProcessEvent_1:
   \   00003E                ; Setup parameters for call to function osal_msg_receive
   \   00003E   90....       MOV     DPTR,#SerialApp_TaskID
   \   000041   E0           MOVX    A,@DPTR
   \   000042   F9           MOV     R1,A
   \   000043   12....       LCALL   ??osal_msg_receive?relay
   \   000046   8A..         MOV     ?V0 + 2,R2
   \   000048   8B..         MOV     ?V0 + 3,R3
   \   00004A   EA           MOV     A,R2
   \   00004B   7001         JNZ     ??SerialApp_ProcessEvent_7
   \   00004D   EB           MOV     A,R3
   \                     ??SerialApp_ProcessEvent_7:
   \   00004E   7003         JNZ     $+5
   \   000050   02....       LJMP    ??SerialApp_ProcessEvent_8 & 0xFFFF
   \   000053   8A82         MOV     DPL,R2
   \   000055   8B83         MOV     DPH,R3
   \   000057   E0           MOVX    A,@DPTR
   \   000058   12....       LCALL   ?UC_SWITCH_SPARSE
   \                     `?<Jumptable for SerialApp_ProcessEvent>_0`:
   \   00005B   00           DB        0
   \   00005C   03           DB        3
   \   00005D   1A           DB        26
   \   00005E   ....         DW        ??SerialApp_ProcessEvent_5
   \   000060   C0           DB        192
   \   000061   ....         DW        ??SerialApp_ProcessEvent_9
   \   000063   D3           DB        211
   \   000064   ....         DW        ??SerialApp_ProcessEvent_10
   \   000066   ....         DW        ??SerialApp_ProcessEvent_6
   \                     ??SerialApp_ProcessEvent_10:
   \   000068   EA           MOV     A,R2
   \   000069   240C         ADD     A,#0xc
   \   00006B   F582         MOV     DPL,A
   \   00006D   EB           MOV     A,R3
   \   00006E   3400         ADDC    A,#0x0
   \   000070   F583         MOV     DPH,A
   \   000072   E0           MOVX    A,@DPTR
   \   000073   F5..         MOV     ?V0 + 6,A
   \   000075   A3           INC     DPTR
   \   000076   E0           MOVX    A,@DPTR
   \   000077   F5..         MOV     ?V0 + 7,A
   \   000079   78..         MOV     R0,#?V0 + 6
   \   00007B   12....       LCALL   ?US_SWITCH_SPARSE
   \                     `?<Jumptable for SerialApp_ProcessEvent>_1`:
   \   00007E   0000         DW        0
   \   000080   0200         DW        2
   \   000082   0680         DW        32774
   \   000084   ....         DW        ??SerialApp_ProcessEvent_11
   \   000086   2080         DW        32800
   \   000088   ....         DW        ??SerialApp_ProcessEvent_12
   \   00008A   ....         DW        ??SerialApp_ProcessEvent_6
   \                     ??SerialApp_ProcessEvent_12:
   \   00008C   EA           MOV     A,R2
   \   00008D   2413         ADD     A,#0x13
   \   00008F   F582         MOV     DPL,A
   \   000091   EB           MOV     A,R3
   \   000092   3400         ADDC    A,#0x0
   \   000094   F583         MOV     DPH,A
   \   000096   E0           MOVX    A,@DPTR
   \   000097   F8           MOV     R0,A
   \   000098   A3           INC     DPTR
   \   000099   E0           MOVX    A,@DPTR
   \   00009A   F583         MOV     DPH,A
   \   00009C   8882         MOV     DPL,R0
   \   00009E   E0           MOVX    A,@DPTR
   \   00009F   7009         JNZ     ??SerialApp_ProcessEvent_13
   \   0000A1                ; Setup parameters for call to function HalLedSet
   \   0000A1   7A01         MOV     R2,#0x1
   \                     ??SerialApp_ProcessEvent_14:
   \   0000A3   7908         MOV     R1,#0x8
   \   0000A5   12....       LCALL   ??HalLedSet?relay
   \   0000A8   808D         SJMP    ??SerialApp_ProcessEvent_6
   \                     ??SerialApp_ProcessEvent_13:
   \   0000AA                ; Setup parameters for call to function HalLedSet
   \   0000AA   7A04         MOV     R2,#0x4
   \   0000AC   80F5         SJMP    ??SerialApp_ProcessEvent_14
   \                     ??SerialApp_ProcessEvent_11:
   \   0000AE                ; Setup parameters for call to function ZDO_ParseEPListRsp
   \   0000AE   12....       LCALL   ??ZDO_ParseEPListRsp?relay
   \   0000B1   8A..         MOV     ?V0 + 6,R2
   \   0000B3   8B..         MOV     ?V0 + 7,R3
   \   0000B5   AE..         MOV     R6,?V0 + 6
   \   0000B7   AF..         MOV     R7,?V0 + 7
   \   0000B9   EE           MOV     A,R6
   \   0000BA   7001         JNZ     ??SerialApp_ProcessEvent_15
   \   0000BC   EF           MOV     A,R7
   \                     ??SerialApp_ProcessEvent_15:
   \   0000BD   7003         JNZ     $+5
   \   0000BF   02....       LJMP    ??SerialApp_ProcessEvent_6 & 0xFFFF
   \   0000C2   8E82         MOV     DPL,R6
   \   0000C4   8F83         MOV     DPH,R7
   \   0000C6   E0           MOVX    A,@DPTR
   \   0000C7   7032         JNZ     ??SerialApp_ProcessEvent_16
   \   0000C9   A3           INC     DPTR
   \   0000CA   A3           INC     DPTR
   \   0000CB   A3           INC     DPTR
   \   0000CC   E0           MOVX    A,@DPTR
   \   0000CD   602C         JZ      ??SerialApp_ProcessEvent_16
   \   0000CF   7402         MOV     A,#0x2
   \   0000D1   90....       MOV     DPTR,#(SerialApp_TxAddr + 8)
   \   0000D4   F0           MOVX    @DPTR,A
   \   0000D5   8E82         MOV     DPL,R6
   \   0000D7   8F83         MOV     DPH,R7
   \   0000D9   A3           INC     DPTR
   \   0000DA   E0           MOVX    A,@DPTR
   \   0000DB   F8           MOV     R0,A
   \   0000DC   A3           INC     DPTR
   \   0000DD   E0           MOVX    A,@DPTR
   \   0000DE   F9           MOV     R1,A
   \   0000DF   90....       MOV     DPTR,#SerialApp_TxAddr
   \   0000E2   E8           MOV     A,R0
   \   0000E3   F0           MOVX    @DPTR,A
   \   0000E4   A3           INC     DPTR
   \   0000E5   E9           MOV     A,R1
   \   0000E6   F0           MOVX    @DPTR,A
   \   0000E7   8E82         MOV     DPL,R6
   \   0000E9   8F83         MOV     DPH,R7
   \   0000EB   A3           INC     DPTR
   \   0000EC   A3           INC     DPTR
   \   0000ED   A3           INC     DPTR
   \   0000EE   A3           INC     DPTR
   \   0000EF   E0           MOVX    A,@DPTR
   \   0000F0   90....       MOV     DPTR,#(SerialApp_TxAddr + 9)
   \   0000F3   F0           MOVX    @DPTR,A
   \   0000F4                ; Setup parameters for call to function HalLedSet
   \   0000F4   7A01         MOV     R2,#0x1
   \   0000F6   7908         MOV     R1,#0x8
   \   0000F8   12....       LCALL   ??HalLedSet?relay
   \                     ??SerialApp_ProcessEvent_16:
   \   0000FB                ; Setup parameters for call to function osal_mem_free
   \   0000FB   EE           MOV     A,R6
   \   0000FC   FA           MOV     R2,A
   \   0000FD   EF           MOV     A,R7
   \   0000FE   FB           MOV     R3,A
   \   0000FF   12....       LCALL   ??osal_mem_free?relay
   \   000102   02....       LJMP    ??SerialApp_ProcessEvent_6 & 0xFFFF
   \                     ??SerialApp_ProcessEvent_9:
   \   000105   8A82         MOV     DPL,R2
   \   000107   8B83         MOV     DPH,R3
   \   000109   A3           INC     DPTR
   \   00010A   A3           INC     DPTR
   \   00010B   A3           INC     DPTR
   \   00010C   E0           MOVX    A,@DPTR
   \   00010D   FF           MOV     R7,A
   \   00010E   8A82         MOV     DPL,R2
   \   000110   8B83         MOV     DPH,R3
   \   000112   A3           INC     DPTR
   \   000113   A3           INC     DPTR
   \   000114   E0           MOVX    A,@DPTR
   \   000115   6003         JZ      $+5
   \   000117   02....       LJMP    ??SerialApp_ProcessEvent_6 & 0xFFFF
   \   00011A   EF           MOV     A,R7
   \   00011B   A2E1         MOV     C,0xE0 /* A   */.1
   \   00011D   5052         JNC     ??SerialApp_ProcessEvent_17
   \   00011F                ; Setup parameters for call to function HalLedSet
   \   00011F   7A00         MOV     R2,#0x0
   \   000121   7908         MOV     R1,#0x8
   \   000123   12....       LCALL   ??HalLedSet?relay
   \   000126   7408         MOV     A,#0x8
   \   000128   12....       LCALL   ?XSTACK_DISP0_8
   \   00012B   7402         MOV     A,#0x2
   \   00012D   12....       LCALL   ?Subroutine0 & 0xFFFF
   \                     ??CrossCallReturnLabel_1:
   \   000130   E4           CLR     A
   \   000131   F0           MOVX    @DPTR,A
   \   000132   A3           INC     DPTR
   \   000133   F0           MOVX    @DPTR,A
   \   000134                ; Setup parameters for call to function ZDP_EndDeviceBindReq
   \   000134   F5..         MOV     ?V0 + 6,A
   \   000136   78..         MOV     R0,#?V0 + 6
   \   000138   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   00013B   78..         MOV     R0,#?V0 + 4
   \   00013D   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000140   75..02       MOV     ?V0 + 6,#0x2
   \   000143   78..         MOV     R0,#?V0 + 6
   \   000145   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000148   78..         MOV     R0,#?V0 + 4
   \   00014A   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00014D   78..         MOV     R0,#?V0 + 6
   \   00014F   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000152   75..05       MOV     ?V0 + 6,#0x5
   \   000155   75..0F       MOV     ?V0 + 7,#0xf
   \   000158   78..         MOV     R0,#?V0 + 6
   \   00015A   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00015D                ; Setup parameters for call to function NLME_GetShortAddr
   \   00015D   12....       LCALL   ?Subroutine2 & 0xFFFF
   \                     ??CrossCallReturnLabel_6:
   \   000160   7409         MOV     A,#0x9
   \   000162   12....       LCALL   ?XSTACK_DISP0_8
   \   000165   AA82         MOV     R2,DPL
   \   000167   AB83         MOV     R3,DPH
   \   000169   12....       LCALL   ??ZDP_EndDeviceBindReq?relay
   \   00016C   7409         MOV     A,#0x9
   \   00016E   12....       LCALL   ?DEALLOC_XSTACK8
   \                     ??SerialApp_ProcessEvent_17:
   \   000171   EF           MOV     A,R7
   \   000172   A2E3         MOV     C,0xE0 /* A   */.3
   \   000174   4003         JC      $+5
   \   000176   02....       LJMP    ??SerialApp_ProcessEvent_6 & 0xFFFF
   \   000179                ; Setup parameters for call to function HalLedSet
   \   000179   7A00         MOV     R2,#0x0
   \   00017B   7908         MOV     R1,#0x8
   \   00017D   12....       LCALL   ??HalLedSet?relay
   \   000180   7408         MOV     A,#0x8
   \   000182   12....       LCALL   ?XSTACK_DISP0_8
   \   000185   740F         MOV     A,#0xf
   \   000187   12....       LCALL   ?Subroutine0 & 0xFFFF
   \                     ??CrossCallReturnLabel_2:
   \   00018A   74FF         MOV     A,#-0x1
   \   00018C   F0           MOVX    @DPTR,A
   \   00018D   A3           INC     DPTR
   \   00018E   F0           MOVX    @DPTR,A
   \   00018F                ; Setup parameters for call to function ZDP_MatchDescReq
   \   00018F   75..00       MOV     ?V0 + 6,#0x0
   \   000192   78..         MOV     R0,#?V0 + 6
   \   000194   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000197   78..         MOV     R0,#?V0 + 4
   \   000199   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00019C   75..02       MOV     ?V0 + 6,#0x2
   \   00019F   78..         MOV     R0,#?V0 + 6
   \   0001A1   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   0001A4   78..         MOV     R0,#?V0 + 4
   \   0001A6   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0001A9   75..05       MOV     ?V0 + 6,#0x5
   \   0001AC   75..0F       MOV     ?V0 + 7,#0xf
   \   0001AF   78..         MOV     R0,#?V0 + 6
   \   0001B1   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0001B4   7902         MOV     R1,#0x2
   \   0001B6   7CFF         MOV     R4,#-0x1
   \   0001B8   7DFF         MOV     R5,#-0x1
   \   0001BA   7408         MOV     A,#0x8
   \   0001BC   12....       LCALL   ?XSTACK_DISP0_8
   \   0001BF   AA82         MOV     R2,DPL
   \   0001C1   AB83         MOV     R3,DPH
   \   0001C3   12....       LCALL   ??ZDP_MatchDescReq?relay
   \   0001C6   7408         MOV     A,#0x8
   \   0001C8   12....       LCALL   ?DEALLOC_XSTACK8
   \   0001CB   02....       LJMP    ??SerialApp_ProcessEvent_6 & 0xFFFF
   \                     ??SerialApp_ProcessEvent_8:
   \   0001CE   AA..         MOV     R2,?V0 + 0
   \   0001D0   7480         MOV     A,#-0x80
   \   0001D2   65..         XRL     A,?V0 + 1
   \   0001D4   FB           MOV     R3,A
   \   0001D5   02....       LJMP    ??SerialApp_ProcessEvent_4 & 0xFFFF
    304          
    305            if ( events & SERIALAPP_RESP_EVT )
   \                     ??SerialApp_ProcessEvent_2:
   \   0001D8   5402         ANL     A,#0x2
   \   0001DA   6050         JZ      ??SerialApp_ProcessEvent_18
    306            {
    307              SerialApp_Resp();
   \   0001DC                ; Setup parameters for call to function AF_DataRequest
   \   0001DC   75..1E       MOV     ?V0 + 2,#0x1e
   \   0001DF   78..         MOV     R0,#?V0 + 2
   \   0001E1   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   0001E4   75....       MOV     ?V0 + 2,#(SerialApp_MsgID & 0xff)
   \   0001E7   75....       MOV     ?V0 + 3,#((SerialApp_MsgID >> 8) & 0xff)
   \   0001EA   78..         MOV     R0,#?V0 + 2
   \   0001EC   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0001EF   75....       MOV     ?V0 + 2,#(SerialApp_RspBuf & 0xff)
   \   0001F2   75....       MOV     ?V0 + 3,#((SerialApp_RspBuf >> 8) & 0xff)
   \   0001F5   78..         MOV     R0,#?V0 + 2
   \   0001F7   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0001FA   75..04       MOV     ?V0 + 2,#0x4
   \   0001FD   75..00       MOV     ?V0 + 3,#0x0
   \   000200   78..         MOV     R0,#?V0 + 2
   \   000202   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000205   75..02       MOV     ?V0 + 2,#0x2
   \   000208   78..         MOV     R0,#?V0 + 2
   \   00020A   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00020D   7900         MOV     R1,#0x0
   \   00020F   7C..         MOV     R4,#(SerialApp_epDesc & 0xff)
   \   000211   7D..         MOV     R5,#((SerialApp_epDesc >> 8) & 0xff)
   \   000213   7A..         MOV     R2,#(SerialApp_RxAddr & 0xff)
   \   000215   7B..         MOV     R3,#((SerialApp_RxAddr >> 8) & 0xff)
   \   000217   12....       LCALL   ??AF_DataRequest?relay
   \   00021A   7409         MOV     A,#0x9
   \   00021C   12....       LCALL   ?DEALLOC_XSTACK8
   \   00021F   E9           MOV     A,R1
   \   000220   6005         JZ      ??CrossCallReturnLabel_7
   \   000222                ; Setup parameters for call to function osal_set_event
   \   000222   7A02         MOV     R2,#0x2
   \   000224   12....       LCALL   ?Subroutine3 & 0xFFFF
    308              return ( events ^ SERIALAPP_RESP_EVT );
   \                     ??CrossCallReturnLabel_7:
   \   000227   7402         MOV     A,#0x2
   \   000229   02....       LJMP    ??SerialApp_ProcessEvent_3 & 0xFFFF
    309            }
    310            if(events & 0xaa)
   \                     ??SerialApp_ProcessEvent_18:
   \   00022C   EA           MOV     A,R2
   \   00022D   54AA         ANL     A,#0xaa
   \   00022F   6061         JZ      ??SerialApp_ProcessEvent_19
    311            {
    312                HalLedSet ( HAL_LED_4, HAL_LED_MODE_OFF ); 
   \   000231                ; Setup parameters for call to function HalLedSet
   \   000231   7A00         MOV     R2,#0x0
   \   000233   7908         MOV     R1,#0x8
   \   000235   12....       LCALL   ??HalLedSet?relay
    313                txAddr.addrMode = Addr16Bit;
   \   000238   7411         MOV     A,#0x11
   \   00023A   12....       LCALL   ?XSTACK_DISP0_8
   \   00023D   7402         MOV     A,#0x2
   \   00023F   F0           MOVX    @DPTR,A
    314                txAddr.addr.shortAddr = 0x0000; // Coordinator
   \   000240   7409         MOV     A,#0x9
   \   000242   12....       LCALL   ?XSTACK_DISP0_8
   \   000245   E4           CLR     A
   \   000246   F0           MOVX    @DPTR,A
   \   000247   A3           INC     DPTR
   \   000248   F0           MOVX    @DPTR,A
    315                ZDP_EndDeviceBindReq( &txAddr, NLME_GetShortAddr(), 
    316                                      SerialApp_epDesc.endPoint,
    317                                      SERIALAPP_PROFID,
    318                                      SERIALAPP_MAX_CLUSTERS, (cId_t *)SerialApp_ClusterList,
    319                                      SERIALAPP_MAX_CLUSTERS, (cId_t *)SerialApp_ClusterList,
    320                                      FALSE );
   \   000249                ; Setup parameters for call to function ZDP_EndDeviceBindReq
   \   000249   F5..         MOV     ?V0 + 0,A
   \   00024B   78..         MOV     R0,#?V0 + 0
   \   00024D   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000250   78..         MOV     R0,#?V0 + 4
   \   000252   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000255   75..02       MOV     ?V0 + 0,#0x2
   \   000258   78..         MOV     R0,#?V0 + 0
   \   00025A   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   00025D   78..         MOV     R0,#?V0 + 4
   \   00025F   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000262   78..         MOV     R0,#?V0 + 0
   \   000264   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000267   75..05       MOV     ?V0 + 0,#0x5
   \   00026A   75..0F       MOV     ?V0 + 1,#0xf
   \   00026D   78..         MOV     R0,#?V0 + 0
   \   00026F   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000272                ; Setup parameters for call to function NLME_GetShortAddr
   \   000272   12....       LCALL   ?Subroutine2 & 0xFFFF
   \                     ??CrossCallReturnLabel_5:
   \   000275   7412         MOV     A,#0x12
   \   000277   12....       LCALL   ?XSTACK_DISP0_8
   \   00027A   AA82         MOV     R2,DPL
   \   00027C   AB83         MOV     R3,DPH
   \   00027E   12....       LCALL   ??ZDP_EndDeviceBindReq?relay
   \   000281   7409         MOV     A,#0x9
   \   000283   12....       LCALL   ?DEALLOC_XSTACK8
    321              osal_stop_timerEx( SerialApp_TaskID,0x55 );  
   \   000286                ; Setup parameters for call to function osal_stop_timerEx
   \   000286   7A55         MOV     R2,#0x55
   \   000288   7B00         MOV     R3,#0x0
   \   00028A   90....       MOV     DPTR,#SerialApp_TaskID
   \   00028D   E0           MOVX    A,@DPTR
   \   00028E   F9           MOV     R1,A
   \   00028F   12....       LCALL   ??osal_stop_timerEx?relay
    322             return 0;
    323            }
    324            return ( 0 );  // Discard unknown events.
   \                     ??SerialApp_ProcessEvent_19:
   \   000292   7A00         MOV     R2,#0x0
   \   000294   7B00         MOV     R3,#0x0
   \                     ??SerialApp_ProcessEvent_4:
   \   000296   7412         MOV     A,#0x12
   \   000298   12....       LCALL   ?DEALLOC_XSTACK8
   \   00029B   7F08         MOV     R7,#0x8
   \   00029D   02....       LJMP    ?BANKED_LEAVE_XDATA
    325          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   12....       LCALL   ??NLME_GetShortAddr?relay
   \   000003   EA           MOV     A,R2
   \   000004   FC           MOV     R4,A
   \   000005   EB           MOV     A,R3
   \   000006   FD           MOV     R5,A
   \   000007   790B         MOV     R1,#0xb
   \   000009   22           RET
    326          
    327          /*********************************************************************
    328           * @fn      SerialApp_ProcessZDOMsgs()
    329           *
    330           * @brief   Process response messages
    331           *
    332           * @param   none
    333           *
    334           * @return  none
    335           */
    336          static void SerialApp_ProcessZDOMsgs( zdoIncomingMsg_t *inMsg )
    337          {
    338            switch ( inMsg->clusterID )
    339            {
    340              case End_Device_Bind_rsp:
    341                if ( ZDO_ParseBindRsp( inMsg ) == ZSuccess )
    342                {
    343                  // Light LED
    344                  HalLedSet( HAL_LED_4, HAL_LED_MODE_ON );
    345                }
    346          #if defined(BLINK_LEDS)
    347                else
    348                {
    349                  // Flash LED to show failure
    350                  HalLedSet ( HAL_LED_4, HAL_LED_MODE_FLASH );
    351                }
    352          #endif
    353                break;
    354                
    355              case Match_Desc_rsp:
    356                {
    357                  ZDO_ActiveEndpointRsp_t *pRsp = ZDO_ParseEPListRsp( inMsg );
    358                  if ( pRsp )
    359                  {
    360                    if ( pRsp->status == ZSuccess && pRsp->cnt )
    361                    {
    362                      SerialApp_TxAddr.addrMode = (afAddrMode_t)Addr16Bit;
    363                      SerialApp_TxAddr.addr.shortAddr = pRsp->nwkAddr;
    364                      // Take the first endpoint, Can be changed to search through endpoints
    365                      SerialApp_TxAddr.endPoint = pRsp->epList[0];
    366                      
    367                      // Light LED
    368                      HalLedSet( HAL_LED_4, HAL_LED_MODE_ON );
    369                    }
    370                    osal_mem_free( pRsp );
    371                  }
    372                }
    373                break;
    374            }
    375          }
    376          
    377          /*********************************************************************
    378           * @fn      SerialApp_HandleKeys
    379           *
    380           * @brief   Handles all key events for this device.
    381           *
    382           * @param   shift - true if in shift/alt.
    383           * @param   keys  - bit field for key events.
    384           *
    385           * @return  none
    386           */
    387          void SerialApp_HandleKeys( uint8 shift, uint8 keys )
    388          {
    389            zAddrType_t txAddr;
    390            
    391            if ( shift )
    392            {
    393              if ( keys & HAL_KEY_SW_1 )
    394              {
    395              }
    396              if ( keys & HAL_KEY_SW_2 )
    397              {
    398              }
    399              if ( keys & HAL_KEY_SW_3 )
    400              {
    401              }
    402              if ( keys & HAL_KEY_SW_4 )
    403              {
    404              }
    405            }
    406            else
    407            {
    408              if ( keys & HAL_KEY_SW_1 )
    409              {
    410              }
    411          
    412              if ( keys & HAL_KEY_SW_2 )
    413              {
    414                HalLedSet ( HAL_LED_4, HAL_LED_MODE_OFF );
    415                
    416                // Initiate an End Device Bind Request for the mandatory endpoint
    417                txAddr.addrMode = Addr16Bit;
    418                txAddr.addr.shortAddr = 0x0000; // Coordinator
    419                ZDP_EndDeviceBindReq( &txAddr, NLME_GetShortAddr(), 
    420                                      SerialApp_epDesc.endPoint,
    421                                      SERIALAPP_PROFID,
    422                                      SERIALAPP_MAX_CLUSTERS, (cId_t *)SerialApp_ClusterList,
    423                                      SERIALAPP_MAX_CLUSTERS, (cId_t *)SerialApp_ClusterList,
    424                                      FALSE );
    425              }
    426          
    427              if ( keys & HAL_KEY_SW_3 )
    428              {
    429              }
    430          
    431              if ( keys & HAL_KEY_SW_4 )
    432              {
    433                HalLedSet ( HAL_LED_4, HAL_LED_MODE_OFF );
    434                
    435                // Initiate a Match Description Request (Service Discovery)
    436                txAddr.addrMode = AddrBroadcast;
    437                txAddr.addr.shortAddr = NWK_BROADCAST_SHORTADDR;
    438                ZDP_MatchDescReq( &txAddr, NWK_BROADCAST_SHORTADDR,
    439                                  SERIALAPP_PROFID,
    440                                  SERIALAPP_MAX_CLUSTERS, (cId_t *)SerialApp_ClusterList,
    441                                  SERIALAPP_MAX_CLUSTERS, (cId_t *)SerialApp_ClusterList,
    442                                  FALSE );
    443              }
    444            }
    445          }
    446          
    447          /*********************************************************************
    448           * @fn      SerialApp_ProcessMSGCmd
    449           *
    450           * @brief   Data message processor callback. This function processes
    451           *          any incoming data - probably from other devices. Based
    452           *          on the cluster ID, perform the intended action.
    453           *
    454           * @param   pkt - pointer to the incoming message packet
    455           *
    456           * @return  TRUE if the 'pkt' parameter is being used and will be freed later,
    457           *          FALSE otherwise.
    458           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine4_0:
   \   000000   90....       MOV     DPTR,#SerialApp_TaskID
   \   000003   E0           MOVX    A,@DPTR
   \   000004   F9           MOV     R1,A
   \   000005   12....       LCALL   ??osal_set_event?relay
   \   000008   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    459          void SerialApp_ProcessMSGCmd( afIncomingMSGPacket_t *pkt )
   \                     SerialApp_ProcessMSGCmd:
    460          {
   \   000000   74F1         MOV     A,#-0xf
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 15
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    461            uint8 stat;
    462            uint8 seqnb;
    463            uint8 delay;
    464          
    465            switch ( pkt->clusterId )
   \   000009   EE           MOV     A,R6
   \   00000A   2421         ADD     A,#0x21
   \   00000C   F8           MOV     R0,A
   \   00000D   EF           MOV     A,R7
   \   00000E   3400         ADDC    A,#0x0
   \   000010   F9           MOV     R1,A
   \   000011   88..         MOV     ?V0 + 0,R0
   \   000013   89..         MOV     ?V0 + 1,R1
   \   000015   8E82         MOV     DPL,R6
   \   000017   8F83         MOV     DPH,R7
   \   000019   A3           INC     DPTR
   \   00001A   A3           INC     DPTR
   \   00001B   A3           INC     DPTR
   \   00001C   A3           INC     DPTR
   \   00001D   E0           MOVX    A,@DPTR
   \   00001E   F5..         MOV     ?V0 + 2,A
   \   000020   A3           INC     DPTR
   \   000021   E0           MOVX    A,@DPTR
   \   000022   F5..         MOV     ?V0 + 3,A
   \   000024   78..         MOV     R0,#?V0 + 2
   \   000026   12....       LCALL   ?US_SWITCH_DENSE
   \                     `?<Jumptable for SerialApp_ProcessMSGCmd>_0`:
   \   000029   0100         DW        1
   \   00002B   01           DB        1
   \   00002C   ....         DW        ??SerialApp_ProcessMSGCmd_0
   \   00002E   ....         DW        ??SerialApp_ProcessMSGCmd_1
   \   000030   ....         DW        ??SerialApp_ProcessMSGCmd_2
    466            {
    467            // A message with a serial data block to be transmitted on the serial port.
    468            case SERIALAPP_CLUSTERID1:
    469              // Store the address for sending and retrying.
    470              osal_memcpy(&SerialApp_RxAddr, &(pkt->srcAddr), sizeof( afAddrType_t ));
   \                     ??SerialApp_ProcessMSGCmd_1:
   \   000032                ; Setup parameters for call to function osal_memcpy
   \   000032   EE           MOV     A,R6
   \   000033   2406         ADD     A,#0x6
   \   000035   F5..         MOV     ?V0 + 4,A
   \   000037   EF           MOV     A,R7
   \   000038   3400         ADDC    A,#0x0
   \   00003A   F5..         MOV     ?V0 + 5,A
   \   00003C   75..00       MOV     ?V0 + 6,#0x0
   \   00003F   78..         MOV     R0,#?V0 + 4
   \   000041   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   000044   7C0C         MOV     R4,#0xc
   \   000046   7D00         MOV     R5,#0x0
   \   000048   7A..         MOV     R2,#(SerialApp_RxAddr & 0xff)
   \   00004A   7B..         MOV     R3,#((SerialApp_RxAddr >> 8) & 0xff)
   \   00004C   12....       LCALL   ??osal_memcpy?relay
   \   00004F   7403         MOV     A,#0x3
   \   000051   12....       LCALL   ?DEALLOC_XSTACK8
    471          
    472              seqnb = pkt->cmd.Data[0];
   \   000054   85..82       MOV     DPL,?V0 + 0
   \   000057   85..83       MOV     DPH,?V0 + 1
   \   00005A   12....       LCALL   ?Subroutine1 & 0xFFFF
   \                     ??CrossCallReturnLabel_3:
   \   00005D   E0           MOVX    A,@DPTR
   \   00005E   F5..         MOV     ?V0 + 0,A
    473          
    474              // Keep message if not a repeat packet
    475              if ( (seqnb > SerialApp_RxSeq) ||                    // Normal
    476                  ((seqnb < 0x80 ) && ( SerialApp_RxSeq > 0x80)) ) // Wrap-around
   \   000060   90....       MOV     DPTR,#SerialApp_RxSeq
   \   000063   E0           MOVX    A,@DPTR
   \   000064   C3           CLR     C
   \   000065   95..         SUBB    A,?V0 + 0
   \   000067   400D         JC      ??SerialApp_ProcessMSGCmd_3
   \   000069   E5..         MOV     A,?V0 + 0
   \   00006B   C3           CLR     C
   \   00006C   9480         SUBB    A,#-0x80
   \   00006E   503D         JNC     ??SerialApp_ProcessMSGCmd_4
   \   000070   E0           MOVX    A,@DPTR
   \   000071   C3           CLR     C
   \   000072   9481         SUBB    A,#-0x7f
   \   000074   4037         JC      ??SerialApp_ProcessMSGCmd_4
    477              {
    478                // Transmit the data on the serial port.
    479                if ( HalUARTWrite( SERIAL_APP_PORT, pkt->cmd.Data+1, (pkt->cmd.DataLength-1) ) )
   \                     ??SerialApp_ProcessMSGCmd_3:
   \   000076                ; Setup parameters for call to function HalUARTWrite
   \   000076   EE           MOV     A,R6
   \   000077   241F         ADD     A,#0x1f
   \   000079   F582         MOV     DPL,A
   \   00007B   EF           MOV     A,R7
   \   00007C   3400         ADDC    A,#0x0
   \   00007E   F583         MOV     DPH,A
   \   000080   E0           MOVX    A,@DPTR
   \   000081   24FF         ADD     A,#-0x1
   \   000083   FC           MOV     R4,A
   \   000084   A3           INC     DPTR
   \   000085   E0           MOVX    A,@DPTR
   \   000086   34FF         ADDC    A,#-0x1
   \   000088   FD           MOV     R5,A
   \   000089   8882         MOV     DPL,R0
   \   00008B   8983         MOV     DPH,R1
   \   00008D   A3           INC     DPTR
   \   00008E   AA82         MOV     R2,DPL
   \   000090   AB83         MOV     R3,DPH
   \   000092   7900         MOV     R1,#0x0
   \   000094   12....       LCALL   ??HalUARTWrite?relay
   \   000097   EA           MOV     A,R2
   \   000098   7001         JNZ     ??SerialApp_ProcessMSGCmd_5
   \   00009A   EB           MOV     A,R3
   \                     ??SerialApp_ProcessMSGCmd_5:
   \   00009B   600A         JZ      ??SerialApp_ProcessMSGCmd_6
    480                {
    481                  // Save for next incoming message
    482                  SerialApp_RxSeq = seqnb;
   \   00009D   E5..         MOV     A,?V0 + 0
   \   00009F   90....       MOV     DPTR,#SerialApp_RxSeq
   \   0000A2   F0           MOVX    @DPTR,A
    483                  stat = OTA_SUCCESS;
   \   0000A3   7A00         MOV     R2,#0x0
   \   0000A5   8008         SJMP    ??SerialApp_ProcessMSGCmd_7
    484                }
    485                else
    486                {
    487                  stat = OTA_SER_BUSY;
   \                     ??SerialApp_ProcessMSGCmd_6:
   \   0000A7   7A02         MOV     R2,#0x2
   \   0000A9   7B10         MOV     R3,#0x10
   \   0000AB   8004         SJMP    ??SerialApp_ProcessMSGCmd_8
    488                }
    489              }
    490              else
    491              {
    492                stat = OTA_DUP_MSG;
   \                     ??SerialApp_ProcessMSGCmd_4:
   \   0000AD   7A01         MOV     R2,#0x1
   \                     ??SerialApp_ProcessMSGCmd_7:
   \   0000AF   7B01         MOV     R3,#0x1
    493              }
    494          
    495              // Select approproiate OTA flow-control delay.
    496              delay = (stat == OTA_SER_BUSY) ? SERIALAPP_NAK_DELAY : SERIALAPP_ACK_DELAY;
    497          
    498              // Build & send OTA response message.
    499              SerialApp_RspBuf[0] = stat;
   \                     ??SerialApp_ProcessMSGCmd_8:
   \   0000B1   EA           MOV     A,R2
   \   0000B2   90....       MOV     DPTR,#SerialApp_RspBuf
   \   0000B5   F0           MOVX    @DPTR,A
    500              SerialApp_RspBuf[1] = seqnb;
   \   0000B6   E5..         MOV     A,?V0 + 0
   \   0000B8   90....       MOV     DPTR,#(SerialApp_RspBuf + 1)
   \   0000BB   F0           MOVX    @DPTR,A
    501              SerialApp_RspBuf[2] = LO_UINT16( delay );
   \   0000BC   EB           MOV     A,R3
   \   0000BD   90....       MOV     DPTR,#(SerialApp_RspBuf + 2)
   \   0000C0   F0           MOVX    @DPTR,A
    502              SerialApp_RspBuf[3] = HI_UINT16( delay );
   \   0000C1   E4           CLR     A
   \   0000C2   90....       MOV     DPTR,#(SerialApp_RspBuf + 3)
   \   0000C5   F0           MOVX    @DPTR,A
    503              osal_set_event( SerialApp_TaskID, SERIALAPP_RESP_EVT );
   \   0000C6                ; Setup parameters for call to function osal_set_event
   \   0000C6   7A02         MOV     R2,#0x2
   \   0000C8   FB           MOV     R3,A
   \   0000C9   12....       LCALL   ??Subroutine4_0 & 0xFFFF
    504              osal_stop_timerEx(SerialApp_TaskID, SERIALAPP_RESP_EVT);
   \                     ??CrossCallReturnLabel_9:
   \   0000CC                ; Setup parameters for call to function osal_stop_timerEx
   \   0000CC   7A02         MOV     R2,#0x2
   \   0000CE   7B00         MOV     R3,#0x0
   \                     ??SerialApp_ProcessMSGCmd_9:
   \   0000D0   90....       MOV     DPTR,#SerialApp_TaskID
   \   0000D3   E0           MOVX    A,@DPTR
   \   0000D4   F9           MOV     R1,A
   \   0000D5   12....       LCALL   ??osal_stop_timerEx?relay
   \   0000D8   803D         SJMP    ??SerialApp_ProcessMSGCmd_0
    505              break;
    506          
    507            // A response to a received serial data block.
    508            case SERIALAPP_CLUSTERID2:
    509              if ((pkt->cmd.Data[1] == SerialApp_TxSeq) &&
    510                 ((pkt->cmd.Data[0] == OTA_SUCCESS) || (pkt->cmd.Data[0] == OTA_DUP_MSG)))
   \                     ??SerialApp_ProcessMSGCmd_2:
   \   0000DA   85..82       MOV     DPL,?V0 + 0
   \   0000DD   8983         MOV     DPH,R1
   \   0000DF   12....       LCALL   ?Subroutine1 & 0xFFFF
   \                     ??CrossCallReturnLabel_4:
   \   0000E2   A3           INC     DPTR
   \   0000E3   E0           MOVX    A,@DPTR
   \   0000E4   FA           MOV     R2,A
   \   0000E5   90....       MOV     DPTR,#SerialApp_TxSeq
   \   0000E8   E0           MOVX    A,@DPTR
   \   0000E9   6A           XRL     A,R2
   \   0000EA   7015         JNZ     ??SerialApp_ProcessMSGCmd_10
   \   0000EC   8882         MOV     DPL,R0
   \   0000EE   8983         MOV     DPH,R1
   \   0000F0   E0           MOVX    A,@DPTR
   \   0000F1   6004         JZ      ??SerialApp_ProcessMSGCmd_11
   \   0000F3   6401         XRL     A,#0x1
   \   0000F5   700A         JNZ     ??SerialApp_ProcessMSGCmd_10
    511              {
    512                SerialApp_TxLen = 0;
   \                     ??SerialApp_ProcessMSGCmd_11:
   \   0000F7   E4           CLR     A
   \   0000F8   90....       MOV     DPTR,#SerialApp_TxLen
   \   0000FB   F0           MOVX    @DPTR,A
    513                osal_stop_timerEx(SerialApp_TaskID, SERIALAPP_SEND_EVT);
   \   0000FC                ; Setup parameters for call to function osal_stop_timerEx
   \   0000FC   7A01         MOV     R2,#0x1
   \   0000FE   FB           MOV     R3,A
   \   0000FF   80CF         SJMP    ??SerialApp_ProcessMSGCmd_9
    514              }
    515              else
    516              {
    517                // Re-start timeout according to delay sent from other device.
    518                delay = BUILD_UINT16( pkt->cmd.Data[2], pkt->cmd.Data[3] );
    519                osal_start_timerEx( SerialApp_TaskID, SERIALAPP_SEND_EVT, delay );
   \                     ??SerialApp_ProcessMSGCmd_10:
   \   000101                ; Setup parameters for call to function osal_start_timerEx
   \   000101   8882         MOV     DPL,R0
   \   000103   8983         MOV     DPH,R1
   \   000105   A3           INC     DPTR
   \   000106   A3           INC     DPTR
   \   000107   E0           MOVX    A,@DPTR
   \   000108   FC           MOV     R4,A
   \   000109   7D00         MOV     R5,#0x0
   \   00010B   7A01         MOV     R2,#0x1
   \   00010D   7B00         MOV     R3,#0x0
   \   00010F   90....       MOV     DPTR,#SerialApp_TaskID
   \   000112   E0           MOVX    A,@DPTR
   \   000113   F9           MOV     R1,A
   \   000114   12....       LCALL   ??osal_start_timerEx?relay
    520              }
    521              break;
    522          
    523              default:
    524                break;
    525            }
    526          }
   \                     ??SerialApp_ProcessMSGCmd_0:
   \   000117   7F07         MOV     R7,#0x7
   \   000119   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   E0           MOVX    A,@DPTR
   \   000001   F8           MOV     R0,A
   \   000002   A3           INC     DPTR
   \   000003   E0           MOVX    A,@DPTR
   \   000004   F9           MOV     R1,A
   \   000005   8882         MOV     DPL,R0
   \   000007   8983         MOV     DPH,R1
   \   000009   22           RET
    527          
    528          /*********************************************************************
    529           * @fn      SerialApp_Send
    530           *
    531           * @brief   Send data OTA.
    532           *
    533           * @param   none
    534           *
    535           * @return  none
    536           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine3:
   \   000000   7B00         MOV     R3,#0x0
   \   000002                REQUIRE ??Subroutine4_0
   \   000002                ; // Fall through to label ??Subroutine4_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    537          static void SerialApp_Send(void)
   \                     SerialApp_Send:
    538          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
    539          #if SERIAL_APP_LOOPBACK
    540            if (SerialApp_TxLen < SERIAL_APP_TX_MAX)
    541            {
    542              SerialApp_TxLen += HalUARTRead(SERIAL_APP_PORT, SerialApp_TxBuf+SerialApp_TxLen+1,
    543                                                              SERIAL_APP_TX_MAX-SerialApp_TxLen);
    544            }
    545          
    546            if (SerialApp_TxLen)
    547            {
    548              (void)SerialApp_TxAddr;
    549              if (HalUARTWrite(SERIAL_APP_PORT, SerialApp_TxBuf+1, SerialApp_TxLen))
    550              {
    551                SerialApp_TxLen = 0;
    552              }
    553              else
    554              {
    555                osal_set_event(SerialApp_TaskID, SERIALAPP_SEND_EVT);
    556              }
    557            }
    558          #else
    559            //zAddrType_t txAddr;
    560            if (!SerialApp_TxLen && 
    561                (SerialApp_TxLen = HalUARTRead(SERIAL_APP_PORT, SerialApp_TxBuf+1, SERIAL_APP_TX_MAX)))
   \   000005   90....       MOV     DPTR,#SerialApp_TxLen
   \   000008   E0           MOVX    A,@DPTR
   \   000009   701E         JNZ     ??SerialApp_Send_0
   \   00000B                ; Setup parameters for call to function HalUARTRead
   \   00000B   7C50         MOV     R4,#0x50
   \   00000D   7D00         MOV     R5,#0x0
   \   00000F   7A..         MOV     R2,#((SerialApp_TxBuf + 1) & 0xff)
   \   000011   7B..         MOV     R3,#(((SerialApp_TxBuf + 1) >> 8) & 0xff)
   \   000013   7900         MOV     R1,#0x0
   \   000015   12....       LCALL   ??HalUARTRead?relay
   \   000018   EA           MOV     A,R2
   \   000019   90....       MOV     DPTR,#SerialApp_TxLen
   \   00001C   F0           MOVX    @DPTR,A
   \   00001D   6061         JZ      ??CrossCallReturnLabel_8
    562            {
    563              // Pre-pend sequence number to the Tx message.
    564              SerialApp_TxBuf[0] = ++SerialApp_TxSeq;
   \   00001F   90....       MOV     DPTR,#SerialApp_TxSeq
   \   000022   E0           MOVX    A,@DPTR
   \   000023   04           INC     A
   \   000024   F0           MOVX    @DPTR,A
   \   000025   90....       MOV     DPTR,#SerialApp_TxBuf
   \   000028   F0           MOVX    @DPTR,A
    565            }
    566          
    567            
    568            
    569            
    570            if (SerialApp_TxLen)
    571            {
    572              if (afStatus_SUCCESS != AF_DataRequest(&SerialApp_TxAddr,
    573                                                     (endPointDesc_t *)&SerialApp_epDesc,
    574                                                      SERIALAPP_CLUSTERID1,
    575                                                      SerialApp_TxLen+1, SerialApp_TxBuf,
    576                                                      &SerialApp_MsgID, 0, AF_DEFAULT_RADIUS))
   \                     ??SerialApp_Send_0:
   \   000029                ; Setup parameters for call to function AF_DataRequest
   \   000029   75..1E       MOV     ?V0 + 0,#0x1e
   \   00002C   78..         MOV     R0,#?V0 + 0
   \   00002E   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000031   75....       MOV     ?V0 + 0,#(SerialApp_MsgID & 0xff)
   \   000034   75....       MOV     ?V0 + 1,#((SerialApp_MsgID >> 8) & 0xff)
   \   000037   78..         MOV     R0,#?V0 + 0
   \   000039   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00003C   75....       MOV     ?V0 + 0,#(SerialApp_TxBuf & 0xff)
   \   00003F   75....       MOV     ?V0 + 1,#((SerialApp_TxBuf >> 8) & 0xff)
   \   000042   78..         MOV     R0,#?V0 + 0
   \   000044   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000047   90....       MOV     DPTR,#SerialApp_TxLen
   \   00004A   E0           MOVX    A,@DPTR
   \   00004B   F8           MOV     R0,A
   \   00004C   7401         MOV     A,#0x1
   \   00004E   28           ADD     A,R0
   \   00004F   F5..         MOV     ?V0 + 0,A
   \   000051   E4           CLR     A
   \   000052   3400         ADDC    A,#0x0
   \   000054   F5..         MOV     ?V0 + 1,A
   \   000056   78..         MOV     R0,#?V0 + 0
   \   000058   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00005B   75..01       MOV     ?V0 + 0,#0x1
   \   00005E   75..00       MOV     ?V0 + 1,#0x0
   \   000061   78..         MOV     R0,#?V0 + 0
   \   000063   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000066   7900         MOV     R1,#0x0
   \   000068   7C..         MOV     R4,#(SerialApp_epDesc & 0xff)
   \   00006A   7D..         MOV     R5,#((SerialApp_epDesc >> 8) & 0xff)
   \   00006C   7A..         MOV     R2,#(SerialApp_TxAddr & 0xff)
   \   00006E   7B..         MOV     R3,#((SerialApp_TxAddr >> 8) & 0xff)
   \   000070   12....       LCALL   ??AF_DataRequest?relay
   \   000073   7409         MOV     A,#0x9
   \   000075   12....       LCALL   ?DEALLOC_XSTACK8
   \   000078   E9           MOV     A,R1
   \   000079   6005         JZ      ??CrossCallReturnLabel_8
    577              {
    578                osal_set_event(SerialApp_TaskID, SERIALAPP_SEND_EVT);
   \   00007B                ; Setup parameters for call to function osal_set_event
   \   00007B   7A01         MOV     R2,#0x1
   \   00007D   12....       LCALL   ?Subroutine3 & 0xFFFF
    579              }
    580            }
    581          #endif
    582          }
   \                     ??CrossCallReturnLabel_8:
   \   000080   7F02         MOV     R7,#0x2
   \   000082   02....       LJMP    ?BANKED_LEAVE_XDATA
    583          
    584          /*********************************************************************
    585           * @fn      SerialApp_Resp
    586           *
    587           * @brief   Send data OTA.
    588           *
    589           * @param   none
    590           *
    591           * @return  none
    592           */
    593          static void SerialApp_Resp(void)
    594          {
    595            if (afStatus_SUCCESS != AF_DataRequest(&SerialApp_RxAddr,
    596                                                   (endPointDesc_t *)&SerialApp_epDesc,
    597                                                    SERIALAPP_CLUSTERID2,
    598                                                    SERIAL_APP_RSP_CNT, SerialApp_RspBuf,
    599                                                   &SerialApp_MsgID, 0, AF_DEFAULT_RADIUS))
    600            {
    601              osal_set_event(SerialApp_TaskID, SERIALAPP_RESP_EVT);
    602            }
    603          }
    604          
    605          /*********************************************************************
    606           * @fn      SerialApp_CallBack
    607           *
    608           * @brief   Send data OTA.
    609           *
    610           * @param   port - UART port.
    611           * @param   event - the UART port event flag.
    612           *
    613           * @return  none
    614           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    615          static void SerialApp_CallBack(uint8 port, uint8 event)
   \                     SerialApp_CallBack:
    616          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    617            (void)port;
    618          
    619            if ((event & (HAL_UART_RX_FULL | HAL_UART_RX_ABOUT_FULL | HAL_UART_RX_TIMEOUT)) &&
    620          #if SERIAL_APP_LOOPBACK
    621                (SerialApp_TxLen < SERIAL_APP_TX_MAX))
    622          #else
    623                !SerialApp_TxLen)
   \   000004   7407         MOV     A,#0x7
   \   000006   5A           ANL     A,R2
   \   000007   6009         JZ      ??SerialApp_CallBack_0
   \   000009   90....       MOV     DPTR,#SerialApp_TxLen
   \   00000C   E0           MOVX    A,@DPTR
   \   00000D   7003         JNZ     ??SerialApp_CallBack_0
    624          #endif
    625            {
    626              SerialApp_Send();
   \   00000F                ; Setup parameters for call to function SerialApp_Send
   \   00000F   12....       LCALL   ??SerialApp_Send?relay
    627            }
    628          }
   \                     ??SerialApp_CallBack_0:
   \   000012   D083         POP     DPH
   \   000014   D082         POP     DPL
   \   000016   02....       LJMP    ?BRET

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SerialApp_Init?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SerialApp_Init

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SerialApp_ProcessEvent?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SerialApp_ProcessEvent

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SerialApp_ProcessMSGCmd?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SerialApp_ProcessMSGCmd

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SerialApp_Send?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SerialApp_Send

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SerialApp_CallBack?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SerialApp_CallBack

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "SerialApp">`:
   \   000000   53657269     DB "SerialApp"
   \            616C4170
   \            7000    
    629          
    630          /*********************************************************************
    631          *********************************************************************/

   Maximum stack usage in bytes:

     Function                     ISTACK PSTACK XSTACK
     --------                     ------ ------ ------
     SerialApp_CallBack               2      0      0
       -> SerialApp_Send              4      0      0
     SerialApp_Init                   1      0     38
       -> afRegister                  0      0     76
       -> RegisterForKeys             0      0     76
       -> HalUARTOpen                 0      0     76
       -> HalLcdWriteString           0      0     76
       -> ZDO_RegisterForZDOMsg       0      0     76
       -> ZDO_RegisterForZDOMsg       0      0     76
       -> osal_start_timerEx          0      0     76
     SerialApp_ProcessEvent           1      0     43
       -> SerialApp_Send              0      0     68
       -> SerialApp_ProcessMSGCmd     0      0     68
       -> osal_msg_deallocate         0      0     68
       -> osal_msg_receive            0      0     68
       -> HalLedSet                   0      0     68
       -> HalLedSet                   0      0     68
       -> ZDO_ParseEPListRsp          0      0     68
       -> HalLedSet                   0      0     68
       -> osal_mem_free               0      0     68
       -> HalLedSet                   0      0     68
       -> NLME_GetShortAddr           0      0     86
       -> ZDP_EndDeviceBindReq        0      0     86
       -> HalLedSet                   0      0     68
       -> ZDP_MatchDescReq            0      0     84
       -> AF_DataRequest              0      0     86
       -> osal_set_event              0      0     68
       -> HalLedSet                   0      0     68
       -> NLME_GetShortAddr           0      0     86
       -> ZDP_EndDeviceBindReq        0      0     86
       -> osal_stop_timerEx           0      0     68
     SerialApp_ProcessMSGCmd          0      0     52
       -> osal_memcpy                 0      0     36
       -> HalUARTWrite                0      0     30
       -> osal_set_event              0      0     30
       -> osal_stop_timerEx           0      0     30
       -> osal_stop_timerEx           0      0     30
       -> osal_start_timerEx          0      0     30
     SerialApp_Send                   0      0     53
       -> HalUARTRead                 0      0     20
       -> AF_DataRequest              0      0     38
       -> osal_set_event              0      0     20


   Segment part sizes:

     Function/Label                  Bytes
     --------------                  -----
     SerialApp_ClusterList              4
     SerialApp_SimpleDesc              12
     SerialApp_epDesc                   6
     SerialApp_TaskID                   1
     SerialApp_MsgID                    1
     SerialApp_TxAddr                  12
     SerialApp_TxSeq                    1
     SerialApp_TxBuf                   81
     SerialApp_TxLen                    1
     SerialApp_RxAddr                  12
     SerialApp_RxSeq                    1
     SerialApp_RspBuf                   4
     SerialApp_Init                   187
     ?Subroutine0                       8
     SerialApp_ProcessEvent           672
     ?Subroutine2                      10
     ??Subroutine4_0                    9
     SerialApp_ProcessMSGCmd          284
     ?Subroutine1                      10
     ?Subroutine3                       2
     SerialApp_Send                   133
     SerialApp_CallBack                25
     ??SerialApp_Init?relay             6
     ??SerialApp_ProcessEvent?relay     6
     ??SerialApp_ProcessMSGCmd?relay    6
     ??SerialApp_Send?relay             6
     ??SerialApp_CallBack?relay         6
     ?<Constant "SerialApp">           10

 
 1 340 bytes in segment BANKED_CODE
    30 bytes in segment BANK_RELAYS
    32 bytes in segment XDATA_ROM_C
   114 bytes in segment XDATA_Z
 
 1 370 bytes of CODE  memory
    32 bytes of CONST memory
   114 bytes of XDATA memory

Errors: none
Warnings: none
