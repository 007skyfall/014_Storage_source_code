###############################################################################
#                                                                             #
# IAR C/C++ Compiler V7.51A/W32 for 8051                13/Dec/2012  10:23:11 #
# Copyright 2004-2009 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  C:\Texas Instruments\ZStack-CC2530-2.3.0-1.4.0\Pro #
#                          jects\zstack\Utilities\SerialApp\Source\SerialApp. #
#                          c                                                  #
#    Command line       =  -f "C:\Texas Instruments\ZStack-CC2530-2.3.0-1.4.0 #
#                          \Projects\zstack\Utilities\SerialApp\CC2530DB\..\. #
#                          .\..\Tools\CC2530DB\f8wRouter.cfg" (-DCPU32MHZ     #
#                          -DROOT=__near_func -DMAC_CFG_APP_PENDING_QUEUE=TRU #
#                          E -DRTR_NWK -DBLINK_LEDS) -f "C:\Texas             #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Utilities\SerialApp\CC2530DB\..\..\..\Tools\CC #
#                          2530DB\f8wConfig.cfg" (-DSECURE=0                  #
#                          -DZG_SECURE_DYNAMIC=0 -DREFLECTOR                  #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFFF                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116 "-DCONST=const __code"    #
#                          -DGENERIC=__generic -DRFD_RCVC_ALWAYS_ON=FALSE     #
#                          -DPOLL_RATE=1000 -DQUEUED_POLL_RATE=100            #
#                          -DRESPONSE_POLL_RATE=100) -DREJOIN_POLL_RATE=440   #
#                          "C:\Texas Instruments\ZStack-CC2530-2.3.0-1.4.0\Pr #
#                          ojects\zstack\Utilities\SerialApp\Source\SerialApp #
#                          .c" -D ZIGBEEPRO -D HAL_UART=TRUE -D               #
#                          SERIAL_APP_PORT=0 -D LCD_SUPPORTED -lC "C:\Texas   #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Utilities\SerialApp\CC2530DB\RouterEB-Pro\List #
#                          \" -lA "C:\Texas Instruments\ZStack-CC2530-2.3.0-1 #
#                          .4.0\Projects\zstack\Utilities\SerialApp\CC2530DB\ #
#                          RouterEB-Pro\List\" --diag_suppress Pe001,Pa010    #
#                          -o "C:\Texas Instruments\ZStack-CC2530-2.3.0-1.4.0 #
#                          \Projects\zstack\Utilities\SerialApp\CC2530DB\Rout #
#                          erEB-Pro\Obj\" -e --require_prototypes --debug     #
#                          --core=plain --dptr=16,1 --data_model=large        #
#                          --code_model=banked --calling_convention=xdata_ree #
#                          ntrant --place_constants=data_rom                  #
#                          --nr_virtual_regs 16 -I "C:\Texas                  #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Utilities\SerialApp\CC2530DB\" -I "C:\Texas    #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Utilities\SerialApp\CC2530DB\..\SOURCE\" -I    #
#                          "C:\Texas Instruments\ZStack-CC2530-2.3.0-1.4.0\Pr #
#                          ojects\zstack\Utilities\SerialApp\CC2530DB\..\..\. #
#                          .\ZMAIN\TI2530DB\" -I "C:\Texas                    #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Utilities\SerialApp\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\MT\" -I "C:\Texas                         #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Utilities\SerialApp\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\HAL\INCLUDE\" -I "C:\Texas                #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Utilities\SerialApp\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\HAL\TARGET\CC2530EB\" -I "C:\Texas        #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Utilities\SerialApp\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\OSAL\MCU\CCSOC\" -I "C:\Texas             #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Utilities\SerialApp\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\OSAL\INCLUDE\" -I "C:\Texas               #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Utilities\SerialApp\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\STACK\AF\" -I "C:\Texas                   #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Utilities\SerialApp\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\STACK\NWK\" -I "C:\Texas                  #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Utilities\SerialApp\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\STACK\SEC\" -I "C:\Texas                  #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Utilities\SerialApp\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\STACK\SAPI\" -I "C:\Texas                 #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Utilities\SerialApp\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\STACK\SYS\" -I "C:\Texas                  #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Utilities\SerialApp\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\STACK\ZDO\" -I "C:\Texas                  #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Utilities\SerialApp\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\ZMAC\F8W\" -I "C:\Texas                   #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Utilities\SerialApp\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\ZMAC\" -I "C:\Texas                       #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Utilities\SerialApp\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\SERVICES\SADDR\" -I "C:\Texas             #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Utilities\SerialApp\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\SERVICES\SDATA\" -I "C:\Texas             #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Utilities\SerialApp\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\MAC\INCLUDE\" -I "C:\Texas                #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Utilities\SerialApp\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\MAC\HIGH_LEVEL\" -I "C:\Texas             #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Utilities\SerialApp\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\MAC\LOW_LEVEL\srf04\" -I "C:\Texas        #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Utilities\SerialApp\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\MAC\LOW_LEVEL\srf04\SINGLE_CHIP\" -I      #
#                          "C:\Program Files\IAR Systems\Embedded Workbench   #
#                          5.3\8051\INC\" -I "C:\Program Files\IAR            #
#                          Systems\Embedded Workbench 5.3\8051\INC\CLIB\"     #
#                          -Ohz                                               #
#    List file          =  C:\Texas Instruments\ZStack-CC2530-2.3.0-1.4.0\Pro #
#                          jects\zstack\Utilities\SerialApp\CC2530DB\RouterEB #
#                          -Pro\List\SerialApp.lst                            #
#    Object file        =  C:\Texas Instruments\ZStack-CC2530-2.3.0-1.4.0\Pro #
#                          jects\zstack\Utilities\SerialApp\CC2530DB\RouterEB #
#                          -Pro\Obj\SerialApp.r51                             #
#                                                                             #
#                                                                             #
###############################################################################

C:\Texas Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zstack\Utilities\SerialApp\Source\SerialApp.c
      1          /**************************************************************************************************
      2            Filename:       SerialApp.c
      3            Revised:        $Date: 2009-03-29 10:51:47 -0700 (Sun, 29 Mar 2009) $
      4            Revision:       $Revision: 19585 $
      5          
      6            Description -   Serial Transfer Application (no Profile).
      7          
      8          
      9            Copyright 2004-2009 Texas Instruments Incorporated. All rights reserved.
     10          
     11            IMPORTANT: Your use of this Software is limited to those specific rights
     12            granted under the terms of a software license agreement between the user
     13            who downloaded the software, his/her employer (which must be your employer)
     14            and Texas Instruments Incorporated (the "License").  You may not use this
     15            Software unless you agree to abide by the terms of the License. The License
     16            limits your use, and you acknowledge, that the Software may not be modified,
     17            copied or distributed unless embedded on a Texas Instruments microcontroller
     18            or used solely and exclusively in conjunction with a Texas Instruments radio
     19            frequency transceiver, which is integrated into your product.  Other than for
     20            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     21            works of, modify, distribute, perform, display or sell this Software and/or
     22            its documentation for any purpose.
     23          
     24            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     25            PROVIDED “AS IS?WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED, 
     26            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE, 
     27            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     28            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     29            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     30            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     31            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     32            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     33            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     34            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     35          
     36            Should you have any questions regarding your right to use this Software,
     37            contact Texas Instruments Incorporated at www.TI.com. 
     38          **************************************************************************************************/
     39          
     40          /*********************************************************************
     41            This sample application is basically a cable replacement
     42            and it should be customized for your application. A PC
     43            (or other device) sends data via the serial port to this
     44            application's device.  This device transmits the message
     45            to another device with the same application running. The
     46            other device receives the over-the-air message and sends
     47            it to a PC (or other device) connected to its serial port.
     48          				
     49            This application doesn't have a profile, so it handles everything directly.
     50          
     51            Key control:
     52              SW1:
     53              SW2:  initiates end device binding
     54              SW3:
     55              SW4:  initiates a match description request
     56          *********************************************************************/
     57          
     58          /*********************************************************************
     59           * INCLUDES
     60           */
     61          #include "ZComDef.h"
     62          #include "AddrMgr.h"
     63          #include "OSAL.h"
     64          #include "OSAL_Nv.h"
     65          #include "MT.h"
     66          #include "MT_SAPI.h"
     67          #include "MT_UART.h"
     68          #include "AF.h"
     69          #include "OnBoard.h"
     70          #include "OSAL_Tasks.h"
     71          #include "SerialApp.h"
     72          #include "ZDApp.h"
     73          #include "ZDObject.h"
     74          #include "ZDProfile.h"
     75          
     76          #include "hal_drivers.h"
     77          #include "hal_key.h"
     78          #if defined ( LCD_SUPPORTED )
     79            #include "hal_lcd.h"
     80          #endif
     81          #include "hal_led.h"
     82          #include "hal_uart.h"
     83          
     84          /*********************************************************************
     85           * MACROS
     86           */
     87          
     88          /*********************************************************************
     89           * CONSTANTS
     90           */
     91          #if !defined( SERIAL_APP_PORT )
     92          #define SERIAL_APP_PORT  0
     93          #endif
     94          
     95          #if !defined( SERIAL_APP_BAUD )
     96          #define SERIAL_APP_BAUD  HAL_UART_BR_38400
     97          //#define SERIAL_APP_BAUD  HAL_UART_BR_115200
     98          #endif
     99          
    100          // When the Rx buf space is less than this threshold, invoke the Rx callback.
    101          #if !defined( SERIAL_APP_THRESH )
    102          #define SERIAL_APP_THRESH  64
    103          #endif
    104          
    105          #if !defined( SERIAL_APP_RX_SZ )
    106          #define SERIAL_APP_RX_SZ  128
    107          #endif
    108          
    109          #if !defined( SERIAL_APP_TX_SZ )
    110          #define SERIAL_APP_TX_SZ  128
    111          #endif
    112          
    113          // Millisecs of idle time after a byte is received before invoking Rx callback.
    114          #if !defined( SERIAL_APP_IDLE )
    115          #define SERIAL_APP_IDLE  6
    116          #endif
    117          
    118          // Loopback Rx bytes to Tx for throughput testing.
    119          #if !defined( SERIAL_APP_LOOPBACK )
    120          #define SERIAL_APP_LOOPBACK  FALSE
    121          #endif
    122          
    123          // This is the max byte count per OTA message.
    124          #if !defined( SERIAL_APP_TX_MAX )
    125          #define SERIAL_APP_TX_MAX  80
    126          #endif
    127          
    128          #define SERIAL_APP_RSP_CNT  4
    129          
    130          
    131          #define KEY2_PRESS_EVENT 0x1111
    132          

   \                                 In  segment XDATA_I, align 1, keep-with-next
    133          uint8 *time_ok = "time start ok";
   \                     time_ok:
   \   000000                DS 2
   \   000002                REQUIRE `?<Initializer for time_ok>`
   \   000002                REQUIRE __INIT_XDATA_I

   \                                 In  segment XDATA_I, align 1, keep-with-next
    134          uint8 *time_err = "time not start";
   \                     time_err:
   \   000000                DS 2
   \   000002                REQUIRE `?<Initializer for time_err>`
   \   000002                REQUIRE __INIT_XDATA_I
    135          void prcess_key2(void);
    136          
    137          // This list should be filled with Application specific Cluster IDs.

   \                                 In  segment XDATA_ROM_C, align 1
    138          const cId_t SerialApp_ClusterList[SERIALAPP_MAX_CLUSTERS] =
   \                     SerialApp_ClusterList:
   \   000000   01000200     DW 1, 2
    139          {
    140            SERIALAPP_CLUSTERID1,
    141            SERIALAPP_CLUSTERID2
    142          };
    143          

   \                                 In  segment XDATA_ROM_C, align 1
    144          const SimpleDescriptionFormat_t SerialApp_SimpleDesc =
   \                     SerialApp_SimpleDesc:
   \   000000   0B           DB 11
   \   000001   050F0100     DW 3845, 1
   \   000005   0002         DB 0, 2
   \   000007   ....         DW SerialApp_ClusterList
   \   000009   02           DB 2
   \   00000A   ....         DW SerialApp_ClusterList
    145          {
    146            SERIALAPP_ENDPOINT,              //  int   Endpoint;
    147            SERIALAPP_PROFID,                //  uint16 AppProfId[2];
    148            SERIALAPP_DEVICEID,              //  uint16 AppDeviceId[2];
    149            SERIALAPP_DEVICE_VERSION,        //  int   AppDevVer:4;
    150            SERIALAPP_FLAGS,                 //  int   AppFlags:4;
    151            SERIALAPP_MAX_CLUSTERS,          //  byte  AppNumInClusters;
    152            (cId_t *)SerialApp_ClusterList,  //  byte *pAppInClusterList;
    153            SERIALAPP_MAX_CLUSTERS,          //  byte  AppNumOutClusters;
    154            (cId_t *)SerialApp_ClusterList   //  byte *pAppOutClusterList;
    155          };
    156          

   \                                 In  segment XDATA_ROM_C, align 1
    157          const endPointDesc_t SerialApp_epDesc =
   \                     SerialApp_epDesc:
   \   000000   0B           DB 11
   \   000001   ........     DW SerialApp_TaskID, SerialApp_SimpleDesc
   \   000005   00           DB 0
    158          {
    159            SERIALAPP_ENDPOINT,
    160            &SerialApp_TaskID,
    161            (SimpleDescriptionFormat_t *)&SerialApp_SimpleDesc,
    162            noLatencyReqs
    163          };
    164          
    165          /*********************************************************************
    166           * TYPEDEFS
    167           */
    168          
    169          /*********************************************************************
    170           * GLOBAL VARIABLES
    171           */

   \                                 In  segment XDATA_I, align 1, keep-with-next
    172          uint8 bind_cfg_flag = 1;
   \                     bind_cfg_flag:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for bind_cfg_flag>`
   \   000001                REQUIRE __INIT_XDATA_I
    173          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    174          uint8 flag = 0;
   \                     flag:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    175          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    176          uint8 SerialApp_TaskID;    // Task ID for internal task/event processing.
   \                     SerialApp_TaskID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    177          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    178          uint8 Led_TaskID;
   \                     Led_TaskID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    179          
    180          /*********************************************************************
    181           * EXTERNAL VARIABLES
    182           */
    183          
    184          /*********************************************************************
    185           * EXTERNAL FUNCTIONS
    186           */
    187          
    188          /*********************************************************************
    189           * LOCAL VARIABLES
    190           */
    191          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    192          static uint8 SerialApp_MsgID;
   \                     SerialApp_MsgID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    193          static afAddrType_t SerialApp_TxAddr;
   \                     SerialApp_TxAddr:
   \   000000                DS 12
   \   00000C                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    194          static uint8 SerialApp_TxSeq;
   \                     SerialApp_TxSeq:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    195          static uint8 SerialApp_TxBuf[SERIAL_APP_TX_MAX+1];
   \                     SerialApp_TxBuf:
   \   000000                DS 81
   \   000051                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    196          static uint8 SerialApp_TxLen;
   \                     SerialApp_TxLen:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    197          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    198          static afAddrType_t SerialApp_RxAddr;
   \                     SerialApp_RxAddr:
   \   000000                DS 12
   \   00000C                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    199          static uint8 SerialApp_RxSeq;
   \                     SerialApp_RxSeq:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    200          static uint8 SerialApp_RspBuf[SERIAL_APP_RSP_CNT];
   \                     SerialApp_RspBuf:
   \   000000                DS 4
   \   000004                REQUIRE __INIT_XDATA_Z
    201          
    202          /*********************************************************************
    203           * LOCAL FUNCTIONS
    204           */
    205          
    206          static void SerialApp_ProcessZDOMsgs( zdoIncomingMsg_t *inMsg );
    207          static void SerialApp_HandleKeys( uint8 shift, uint8 keys );
    208          static void SerialApp_ProcessMSGCmd( afIncomingMSGPacket_t *pkt );
    209          static void SerialApp_Send(void);
    210          static void SerialApp_Resp(void);
    211          static void SerialApp_CallBack(uint8 port, uint8 event);
    212          
    213          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    214          void Timer_led_Init(uint8 task_id)
   \                     Timer_led_Init:
    215          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    216            byte ledTimer;
    217            Led_TaskID = task_id;
   \   000004   E9           MOV     A,R1
   \   000005   90....       MOV     DPTR,#Led_TaskID
   \   000008   F0           MOVX    @DPTR,A
    218          /*  
    219            Led_t *msgPtr;
    220            registeredLedTaskID = Led_TaskID;
    221          
    222            if ( registeredLedTaskID != 0xFF )
    223            {
    224              // Send the address to the task
    225              msgPtr = (Led_t *)osal_msg_allocate( sizeof(Led_t) );
    226              if ( msgPtr )
    227              {
    228                msgPtr->hdr.event = LED_EVENT;
    229                osal_msg_send( registeredLedTaskID, (uint8 *)msgPtr );
    230              }
    231           
    232            }
    233          
    234            */
    235            ledTimer = osal_start_timerEx(Led_TaskID, HAL_LED_BLINK_EVENT, 1000);
    236            if(ledTimer == ZSUCCESS)
   \   000009                ; Setup parameters for call to function osal_start_timerEx
   \   000009   7CE8         MOV     R4,#-0x18
   \   00000B   7D03         MOV     R5,#0x3
   \   00000D   7A02         MOV     R2,#0x2
   \   00000F   7B00         MOV     R3,#0x0
   \   000011   12....       LCALL   ??osal_start_timerEx?relay
   \   000014   E9           MOV     A,R1
   \   000015   7C14         MOV     R4,#0x14
   \   000017   7D00         MOV     R5,#0x0
   \   000019   7005         JNZ     ??Timer_led_Init_0
    237            {
    238              HalUARTWrite(HAL_UART_PORT_0, time_ok, 20);
   \   00001B                ; Setup parameters for call to function HalUARTWrite
   \   00001B   90....       MOV     DPTR,#time_ok
   \   00001E   8003         SJMP    ??Timer_led_Init_1
    239            }
    240            else
    241              HalUARTWrite(HAL_UART_PORT_0, time_err, 20); 
   \                     ??Timer_led_Init_0:
   \   000020                ; Setup parameters for call to function HalUARTWrite
   \   000020   90....       MOV     DPTR,#time_err
   \                     ??Timer_led_Init_1:
   \   000023   E0           MOVX    A,@DPTR
   \   000024   FA           MOV     R2,A
   \   000025   A3           INC     DPTR
   \   000026   E0           MOVX    A,@DPTR
   \   000027   FB           MOV     R3,A
   \   000028   7900         MOV     R1,#0x0
   \   00002A   12....       LCALL   ??HalUARTWrite?relay
    242            /*
    243          #if defined( ZDO_COORDINATOR ) 
    244            
    245            
    246            if(bind_cfg_flag)
    247            {
    248              osal_start_timerEx(Led_TaskID, HAL_LED_BLINK_EVENT, 100);
    249            }
    250            
    251          #endif
    252            */
    253          
    254            
    255          }
   \   00002D                REQUIRE ?Subroutine9
   \   00002D                ; // Fall through to label ?Subroutine9

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine9:
   \   000000   D083         POP     DPH
   \   000002   D082         POP     DPL
   \   000004   02....       LJMP    ?BRET
    256          
    257          /*********************************************************************
    258           * @fn      SerialApp_Init
    259           *
    260           * @brief   This is called during OSAL tasks' initialization.
    261           *
    262           * @param   task_id - the Task ID assigned by OSAL.
    263           *
    264           * @return  none
    265           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    266          void SerialApp_Init( uint8 task_id )
   \                     SerialApp_Init:
    267          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 29
   \   000005   74E3         MOV     A,#-0x1d
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   E9           MOV     A,R1
   \   00000B   FE           MOV     R6,A
    268            halUARTCfg_t uartConfig;
    269          
    270            SerialApp_TaskID = task_id;
   \   00000C   90....       MOV     DPTR,#SerialApp_TaskID
   \   00000F   F0           MOVX    @DPTR,A
    271            SerialApp_RxSeq = 0xC3;
   \   000010   74C3         MOV     A,#-0x3d
   \   000012   90....       MOV     DPTR,#SerialApp_RxSeq
   \   000015   F0           MOVX    @DPTR,A
    272          
    273            afRegister( (endPointDesc_t *)&SerialApp_epDesc );
   \   000016                ; Setup parameters for call to function afRegister
   \   000016   7A..         MOV     R2,#(SerialApp_epDesc & 0xff)
   \   000018   7B..         MOV     R3,#((SerialApp_epDesc >> 8) & 0xff)
   \   00001A   12....       LCALL   ??afRegister?relay
    274          
    275            RegisterForKeys( task_id );
   \   00001D                ; Setup parameters for call to function RegisterForKeys
   \   00001D   EE           MOV     A,R6
   \   00001E   F9           MOV     R1,A
   \   00001F   12....       LCALL   ??RegisterForKeys?relay
    276          
    277            uartConfig.configured           = TRUE;              // 2x30 don't care - see uart driver.
   \   000022   7401         MOV     A,#0x1
   \   000024   85..82       MOV     DPL,?XSP + 0
   \   000027   85..83       MOV     DPH,?XSP + 1
   \   00002A   F0           MOVX    @DPTR,A
    278            uartConfig.baudRate             = SERIAL_APP_BAUD;
   \   00002B   12....       LCALL   ?XSTACK_DISP0_8
   \   00002E   7402         MOV     A,#0x2
   \   000030   F0           MOVX    @DPTR,A
    279            uartConfig.flowControl          = FALSE;
   \   000031   12....       LCALL   ?XSTACK_DISP0_8
   \   000034   E4           CLR     A
   \   000035   F0           MOVX    @DPTR,A
    280            uartConfig.flowControlThreshold = SERIAL_APP_THRESH; // 2x30 don't care - see uart driver.
   \   000036   7403         MOV     A,#0x3
   \   000038   12....       LCALL   ?XSTACK_DISP0_8
   \   00003B   7440         MOV     A,#0x40
   \   00003D   F0           MOVX    @DPTR,A
   \   00003E   A3           INC     DPTR
   \   00003F   E4           CLR     A
   \   000040   F0           MOVX    @DPTR,A
    281            uartConfig.rx.maxBufSize        = SERIAL_APP_RX_SZ;  // 2x30 don't care - see uart driver.
   \   000041   740A         MOV     A,#0xa
   \   000043   12....       LCALL   ?XSTACK_DISP0_8
   \   000046   7480         MOV     A,#-0x80
   \   000048   F0           MOVX    @DPTR,A
   \   000049   A3           INC     DPTR
   \   00004A   E4           CLR     A
   \   00004B   F0           MOVX    @DPTR,A
    282            uartConfig.tx.maxBufSize        = SERIAL_APP_TX_SZ;  // 2x30 don't care - see uart driver.
   \   00004C   7412         MOV     A,#0x12
   \   00004E   12....       LCALL   ?XSTACK_DISP0_8
   \   000051   7480         MOV     A,#-0x80
   \   000053   F0           MOVX    @DPTR,A
   \   000054   A3           INC     DPTR
   \   000055   E4           CLR     A
   \   000056   F0           MOVX    @DPTR,A
    283            uartConfig.idleTimeout          = SERIAL_APP_IDLE;   // 2x30 don't care - see uart driver.
   \   000057   7405         MOV     A,#0x5
   \   000059   12....       LCALL   ?XSTACK_DISP0_8
   \   00005C   7406         MOV     A,#0x6
   \   00005E   F0           MOVX    @DPTR,A
    284            uartConfig.intEnable            = TRUE;              // 2x30 don't care - see uart driver.
   \   00005F   7416         MOV     A,#0x16
   \   000061   12....       LCALL   ?XSTACK_DISP0_8
   \   000064   7401         MOV     A,#0x1
   \   000066   F0           MOVX    @DPTR,A
    285            uartConfig.callBackFunc         = SerialApp_CallBack;
   \   000067   741B         MOV     A,#0x1b
   \   000069   12....       LCALL   ?XSTACK_DISP0_8
   \   00006C   74..         MOV     A,#(??SerialApp_CallBack?relay & 0xff)
   \   00006E   F0           MOVX    @DPTR,A
   \   00006F   A3           INC     DPTR
   \   000070   74..         MOV     A,#((??SerialApp_CallBack?relay >> 8) & 0xff)
   \   000072   12....       LCALL   ?Subroutine8 & 0xFFFF
    286            HalUARTOpen (SERIAL_APP_PORT, &uartConfig);
   \                     ??CrossCallReturnLabel_14:
   \   000075   AA82         MOV     R2,DPL
   \   000077   AB83         MOV     R3,DPH
   \   000079   7900         MOV     R1,#0x0
   \   00007B   12....       LCALL   ??HalUARTOpen?relay
    287            
    288            //HalUARTWrite(SERIAL_APP_PORT, array, 5);
    289          
    290          #if defined ( LCD_SUPPORTED )
    291            HalLcdWriteString( "SerialApp", HAL_LCD_LINE_2 );
   \   00007E                ; Setup parameters for call to function HalLcdWriteString
   \   00007E   7902         MOV     R1,#0x2
   \   000080   7A..         MOV     R2,#(`?<Constant "SerialApp">` & 0xff)
   \   000082   7B..         MOV     R3,#((`?<Constant "SerialApp">` >> 8) & 0xff)
   \   000084   12....       LCALL   ??HalLcdWriteString?relay
    292          #endif
    293            
    294            ZDO_RegisterForZDOMsg( SerialApp_TaskID, End_Device_Bind_rsp );
   \   000087                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000087   7A20         MOV     R2,#0x20
   \   000089   7B80         MOV     R3,#-0x80
   \   00008B   90....       MOV     DPTR,#SerialApp_TaskID
   \   00008E   E0           MOVX    A,@DPTR
   \   00008F   F9           MOV     R1,A
   \   000090   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay
    295            ZDO_RegisterForZDOMsg( SerialApp_TaskID, Match_Desc_rsp );
   \   000093                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000093   7A06         MOV     R2,#0x6
   \   000095   7B80         MOV     R3,#-0x80
   \   000097   90....       MOV     DPTR,#SerialApp_TaskID
   \   00009A   E0           MOVX    A,@DPTR
   \   00009B   F9           MOV     R1,A
   \   00009C   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay
    296            osal_start_timerEx(SerialApp_TaskID, HAL_SLEEP_TIMER_EVENT, 100);
   \   00009F                ; Setup parameters for call to function osal_start_timerEx
   \   00009F   12....       LCALL   ?Subroutine4 & 0xFFFF
    297          }
   \                     ??CrossCallReturnLabel_17:
   \   0000A2   741D         MOV     A,#0x1d
   \   0000A4   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000A7   7F01         MOV     R7,#0x1
   \   0000A9   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine4:
   \   000000   7C64         MOV     R4,#0x64
   \   000002   7D00         MOV     R5,#0x0
   \   000004   7A04         MOV     R2,#0x4
   \   000006                REQUIRE ??Subroutine10_0
   \   000006                ; // Fall through to label ??Subroutine10_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine10_0:
   \   000000   7B00         MOV     R3,#0x0
   \   000002   90....       MOV     DPTR,#SerialApp_TaskID
   \   000005   E0           MOVX    A,@DPTR
   \   000006   F9           MOV     R1,A
   \   000007   12....       LCALL   ??osal_start_timerEx?relay
   \   00000A   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine8:
   \   000000   F0           MOVX    @DPTR,A
   \   000001                ; Setup parameters for call to function HalUARTOpen
   \   000001   85..82       MOV     DPL,?XSP + 0
   \   000004   85..83       MOV     DPH,?XSP + 1
   \   000007   22           RET
    298          
    299          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    300          UINT16 Timer_ledProcess(uint8 task_id, UINT16 events)
   \                     Timer_ledProcess:
    301          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
    302          
    303            (void)task_id;  // Intentionally unreferenced parameter
    304            
    305            
    306            
    307          #if defined( ZDO_COORDINATOR )
    308           //afSetMatch(epList->epDesc->simpleDesc->EndPoint, TRUE);
    309            afSetMatch(SerialApp_epDesc.simpleDesc->EndPoint, TRUE);
    310            
    311            /*
    312            if(bind_cfg_flag)
    313            {
    314              HAL_TOGGLE_LED3();
    315              prcess_key2();
    316              osal_start_timerEx(Led_TaskID, HAL_LED_BLINK_EVENT, 100);
    317            }
    318            */
    319            
    320          #endif
    321          
    322           return 0;
   \   000000   7A00         MOV     R2,#0x0
   \   000002   7B00         MOV     R3,#0x0
   \   000004   02....       LJMP    ?BRET
    323          }
    324          
    325          /*********************************************************************
    326           * @fn      SerialApp_ProcessEvent
    327           *
    328           * @brief   Generic Application Task event processor.
    329           *
    330           * @param   task_id  - The OSAL assigned task ID.
    331           * @param   events   - Bit map of events to process.
    332           *
    333           * @return  Event flags of all unprocessed events.
    334           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    335          UINT16 SerialApp_ProcessEvent( uint8 task_id, UINT16 events )
   \                     SerialApp_ProcessEvent:
    336          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 0
   \   000005   8A..         MOV     ?V0 + 0,R2
   \   000007   8B..         MOV     ?V0 + 1,R3
    337            (void)task_id;  // Intentionally unreferenced parameter
    338            
    339            if ( events & SYS_EVENT_MSG )
   \   000009   7480         MOV     A,#-0x80
   \   00000B   55..         ANL     A,?V0 + 1
   \   00000D   F9           MOV     R1,A
   \   00000E   E4           CLR     A
   \   00000F   7001         JNZ     ??SerialApp_ProcessEvent_0
   \   000011   E9           MOV     A,R1
   \                     ??SerialApp_ProcessEvent_0:
   \   000012   701F         JNZ     ??SerialApp_ProcessEvent_1
    340            {
    341              afIncomingMSGPacket_t *MSGpkt;
    342          
    343              while ( (MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( SerialApp_TaskID )) )
    344              {
    345                switch ( MSGpkt->hdr.event )
    346                {
    347                case ZDO_CB_MSG:
    348                  SerialApp_ProcessZDOMsgs( (zdoIncomingMsg_t *)MSGpkt );
    349                  break;
    350                    
    351                case KEY_CHANGE:
    352                  SerialApp_HandleKeys( ((keyChange_t *)MSGpkt)->state, ((keyChange_t *)MSGpkt)->keys );
    353                  break;
    354          
    355                case AF_INCOMING_MSG_CMD:
    356                  SerialApp_ProcessMSGCmd( MSGpkt );
    357                  break;
    358          
    359          
    360                default:
    361                  break;
    362                }
    363          
    364                osal_msg_deallocate( (uint8 *)MSGpkt );
    365              }
    366          
    367              return ( events ^ SYS_EVENT_MSG );
    368            }
    369          
    370            if ( events & SERIALAPP_SEND_EVT )
   \   000014   EA           MOV     A,R2
   \   000015   A2E0         MOV     C,0xE0 /* A   */.0
   \   000017   4003         JC      $+5
   \   000019   02....       LJMP    ??SerialApp_ProcessEvent_2 & 0xFFFF
    371            {
    372              SerialApp_Send();
   \   00001C                ; Setup parameters for call to function SerialApp_Send
   \   00001C   12....       LCALL   ??SerialApp_Send?relay
    373              return ( events ^ SERIALAPP_SEND_EVT );
   \   00001F   7401         MOV     A,#0x1
   \                     ??SerialApp_ProcessEvent_3:
   \   000021   65..         XRL     A,?V0 + 0
   \   000023   FA           MOV     R2,A
   \   000024   AB..         MOV     R3,?V0 + 1
   \   000026   02....       LJMP    ??SerialApp_ProcessEvent_4 & 0xFFFF
    374            }
   \                     ??SerialApp_ProcessEvent_5:
   \   000029                ; Setup parameters for call to function SerialApp_ProcessMSGCmd
   \   000029   12....       LCALL   ??SerialApp_ProcessMSGCmd?relay
   \                     ??SerialApp_ProcessEvent_6:
   \   00002C                ; Setup parameters for call to function osal_msg_deallocate
   \   00002C   EE           MOV     A,R6
   \   00002D   FA           MOV     R2,A
   \   00002E   EF           MOV     A,R7
   \   00002F   FB           MOV     R3,A
   \   000030   12....       LCALL   ??osal_msg_deallocate?relay
   \                     ??SerialApp_ProcessEvent_1:
   \   000033                ; Setup parameters for call to function osal_msg_receive
   \   000033   90....       MOV     DPTR,#SerialApp_TaskID
   \   000036   E0           MOVX    A,@DPTR
   \   000037   F9           MOV     R1,A
   \   000038   12....       LCALL   ??osal_msg_receive?relay
   \   00003B   8A..         MOV     ?V0 + 2,R2
   \   00003D   8B..         MOV     ?V0 + 3,R3
   \   00003F   AE..         MOV     R6,?V0 + 2
   \   000041   AF..         MOV     R7,?V0 + 3
   \   000043   EE           MOV     A,R6
   \   000044   7001         JNZ     ??SerialApp_ProcessEvent_7
   \   000046   EF           MOV     A,R7
   \                     ??SerialApp_ProcessEvent_7:
   \   000047   7003         JNZ     $+5
   \   000049   02....       LJMP    ??SerialApp_ProcessEvent_8 & 0xFFFF
   \   00004C   8E82         MOV     DPL,R6
   \   00004E   8F83         MOV     DPH,R7
   \   000050   E0           MOVX    A,@DPTR
   \   000051   12....       LCALL   ?UC_SWITCH_SPARSE
   \                     `?<Jumptable for SerialApp_ProcessEvent>_0`:
   \   000054   00           DB        0
   \   000055   03           DB        3
   \   000056   1A           DB        26
   \   000057   ....         DW        ??SerialApp_ProcessEvent_5
   \   000059   C0           DB        192
   \   00005A   ....         DW        ??SerialApp_ProcessEvent_9
   \   00005C   D3           DB        211
   \   00005D   ....         DW        ??SerialApp_ProcessEvent_10
   \   00005F   ....         DW        ??SerialApp_ProcessEvent_6
   \                     ??SerialApp_ProcessEvent_10:
   \   000061   EE           MOV     A,R6
   \   000062   240C         ADD     A,#0xc
   \   000064   F582         MOV     DPL,A
   \   000066   EF           MOV     A,R7
   \   000067   3400         ADDC    A,#0x0
   \   000069   F583         MOV     DPH,A
   \   00006B   12....       LCALL   ?Subroutine2 & 0xFFFF
   \                     ??CrossCallReturnLabel_4:
   \   00006E   12....       LCALL   ?US_SWITCH_SPARSE
   \                     `?<Jumptable for SerialApp_ProcessEvent>_1`:
   \   000071   0000         DW        0
   \   000073   0200         DW        2
   \   000075   0680         DW        32774
   \   000077   ....         DW        ??SerialApp_ProcessEvent_11
   \   000079   2080         DW        32800
   \   00007B   ....         DW        ??SerialApp_ProcessEvent_12
   \   00007D   ....         DW        ??SerialApp_ProcessEvent_6
   \                     ??SerialApp_ProcessEvent_12:
   \   00007F   EE           MOV     A,R6
   \   000080   2413         ADD     A,#0x13
   \   000082   F582         MOV     DPL,A
   \   000084   EF           MOV     A,R7
   \   000085   3400         ADDC    A,#0x0
   \   000087   F583         MOV     DPH,A
   \   000089   E0           MOVX    A,@DPTR
   \   00008A   F8           MOV     R0,A
   \   00008B   A3           INC     DPTR
   \   00008C   E0           MOVX    A,@DPTR
   \   00008D   F583         MOV     DPH,A
   \   00008F   8882         MOV     DPL,R0
   \   000091   E0           MOVX    A,@DPTR
   \   000092   7009         JNZ     ??SerialApp_ProcessEvent_13
   \   000094                ; Setup parameters for call to function HalLedSet
   \   000094   7A01         MOV     R2,#0x1
   \                     ??SerialApp_ProcessEvent_14:
   \   000096   7908         MOV     R1,#0x8
   \   000098   12....       LCALL   ??HalLedSet?relay
   \   00009B   808F         SJMP    ??SerialApp_ProcessEvent_6
   \                     ??SerialApp_ProcessEvent_13:
   \   00009D                ; Setup parameters for call to function HalLedSet
   \   00009D   7A04         MOV     R2,#0x4
   \   00009F   80F5         SJMP    ??SerialApp_ProcessEvent_14
   \                     ??SerialApp_ProcessEvent_11:
   \   0000A1                ; Setup parameters for call to function ZDO_ParseEPListRsp
   \   0000A1   12....       LCALL   ??ZDO_ParseEPListRsp?relay
   \   0000A4   8A..         MOV     ?V0 + 2,R2
   \   0000A6   8B..         MOV     ?V0 + 3,R3
   \   0000A8   EA           MOV     A,R2
   \   0000A9   7001         JNZ     ??SerialApp_ProcessEvent_15
   \   0000AB   EB           MOV     A,R3
   \                     ??SerialApp_ProcessEvent_15:
   \   0000AC   7003         JNZ     $+5
   \   0000AE   02....       LJMP    ??SerialApp_ProcessEvent_6 & 0xFFFF
   \   0000B1   8A82         MOV     DPL,R2
   \   0000B3   8B83         MOV     DPH,R3
   \   0000B5   E0           MOVX    A,@DPTR
   \   0000B6   7032         JNZ     ??SerialApp_ProcessEvent_16
   \   0000B8   A3           INC     DPTR
   \   0000B9   A3           INC     DPTR
   \   0000BA   A3           INC     DPTR
   \   0000BB   E0           MOVX    A,@DPTR
   \   0000BC   602C         JZ      ??SerialApp_ProcessEvent_16
   \   0000BE   7402         MOV     A,#0x2
   \   0000C0   90....       MOV     DPTR,#(SerialApp_TxAddr + 8)
   \   0000C3   F0           MOVX    @DPTR,A
   \   0000C4   8A82         MOV     DPL,R2
   \   0000C6   8B83         MOV     DPH,R3
   \   0000C8   A3           INC     DPTR
   \   0000C9   E0           MOVX    A,@DPTR
   \   0000CA   F8           MOV     R0,A
   \   0000CB   A3           INC     DPTR
   \   0000CC   E0           MOVX    A,@DPTR
   \   0000CD   F9           MOV     R1,A
   \   0000CE   90....       MOV     DPTR,#SerialApp_TxAddr
   \   0000D1   E8           MOV     A,R0
   \   0000D2   F0           MOVX    @DPTR,A
   \   0000D3   A3           INC     DPTR
   \   0000D4   E9           MOV     A,R1
   \   0000D5   F0           MOVX    @DPTR,A
   \   0000D6   8A82         MOV     DPL,R2
   \   0000D8   8B83         MOV     DPH,R3
   \   0000DA   A3           INC     DPTR
   \   0000DB   A3           INC     DPTR
   \   0000DC   A3           INC     DPTR
   \   0000DD   A3           INC     DPTR
   \   0000DE   E0           MOVX    A,@DPTR
   \   0000DF   90....       MOV     DPTR,#(SerialApp_TxAddr + 9)
   \   0000E2   F0           MOVX    @DPTR,A
   \   0000E3                ; Setup parameters for call to function HalLedSet
   \   0000E3   7A01         MOV     R2,#0x1
   \   0000E5   7908         MOV     R1,#0x8
   \   0000E7   12....       LCALL   ??HalLedSet?relay
   \                     ??SerialApp_ProcessEvent_16:
   \   0000EA                ; Setup parameters for call to function osal_mem_free
   \   0000EA   AA..         MOV     R2,?V0 + 2
   \   0000EC   AB..         MOV     R3,?V0 + 3
   \   0000EE   12....       LCALL   ??osal_mem_free?relay
   \   0000F1   02....       LJMP    ??SerialApp_ProcessEvent_6 & 0xFFFF
   \                     ??SerialApp_ProcessEvent_9:
   \   0000F4                ; Setup parameters for call to function SerialApp_HandleKeys
   \   0000F4   8E82         MOV     DPL,R6
   \   0000F6   8F83         MOV     DPH,R7
   \   0000F8   A3           INC     DPTR
   \   0000F9   A3           INC     DPTR
   \   0000FA   A3           INC     DPTR
   \   0000FB   E0           MOVX    A,@DPTR
   \   0000FC   FA           MOV     R2,A
   \   0000FD   8E82         MOV     DPL,R6
   \   0000FF   8F83         MOV     DPH,R7
   \   000101   A3           INC     DPTR
   \   000102   A3           INC     DPTR
   \   000103   E0           MOVX    A,@DPTR
   \   000104   F9           MOV     R1,A
   \   000105   12....       LCALL   ??SerialApp_HandleKeys?relay
   \   000108   02....       LJMP    ??SerialApp_ProcessEvent_6 & 0xFFFF
   \                     ??SerialApp_ProcessEvent_8:
   \   00010B   AA..         MOV     R2,?V0 + 0
   \   00010D   7480         MOV     A,#-0x80
   \   00010F   65..         XRL     A,?V0 + 1
   \   000111   FB           MOV     R3,A
   \   000112   805B         SJMP    ??SerialApp_ProcessEvent_4
    375          
    376            if ( events & SERIALAPP_RESP_EVT )
   \                     ??SerialApp_ProcessEvent_2:
   \   000114   5402         ANL     A,#0x2
   \   000116   6050         JZ      ??SerialApp_ProcessEvent_17
    377            {
    378              SerialApp_Resp();
   \   000118                ; Setup parameters for call to function AF_DataRequest
   \   000118   75..1E       MOV     ?V0 + 2,#0x1e
   \   00011B   78..         MOV     R0,#?V0 + 2
   \   00011D   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000120   75....       MOV     ?V0 + 2,#(SerialApp_MsgID & 0xff)
   \   000123   75....       MOV     ?V0 + 3,#((SerialApp_MsgID >> 8) & 0xff)
   \   000126   78..         MOV     R0,#?V0 + 2
   \   000128   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00012B   75....       MOV     ?V0 + 2,#(SerialApp_RspBuf & 0xff)
   \   00012E   75....       MOV     ?V0 + 3,#((SerialApp_RspBuf >> 8) & 0xff)
   \   000131   78..         MOV     R0,#?V0 + 2
   \   000133   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000136   75..04       MOV     ?V0 + 2,#0x4
   \   000139   75..00       MOV     ?V0 + 3,#0x0
   \   00013C   78..         MOV     R0,#?V0 + 2
   \   00013E   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000141   75..02       MOV     ?V0 + 2,#0x2
   \   000144   78..         MOV     R0,#?V0 + 2
   \   000146   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000149   7900         MOV     R1,#0x0
   \   00014B   7C..         MOV     R4,#(SerialApp_epDesc & 0xff)
   \   00014D   7D..         MOV     R5,#((SerialApp_epDesc >> 8) & 0xff)
   \   00014F   7A..         MOV     R2,#(SerialApp_RxAddr & 0xff)
   \   000151   7B..         MOV     R3,#((SerialApp_RxAddr >> 8) & 0xff)
   \   000153   12....       LCALL   ??AF_DataRequest?relay
   \   000156   7409         MOV     A,#0x9
   \   000158   12....       LCALL   ?DEALLOC_XSTACK8
   \   00015B   E9           MOV     A,R1
   \   00015C   6005         JZ      ??CrossCallReturnLabel_20
   \   00015E                ; Setup parameters for call to function osal_set_event
   \   00015E   7A02         MOV     R2,#0x2
   \   000160   12....       LCALL   ?Subroutine5 & 0xFFFF
    379              return ( events ^ SERIALAPP_RESP_EVT );
   \                     ??CrossCallReturnLabel_20:
   \   000163   7402         MOV     A,#0x2
   \   000165   02....       LJMP    ??SerialApp_ProcessEvent_3 & 0xFFFF
    380            }
    381            osal_start_timerEx(SerialApp_TaskID, HAL_SLEEP_TIMER_EVENT, 100);
   \                     ??SerialApp_ProcessEvent_17:
   \   000168                ; Setup parameters for call to function osal_start_timerEx
   \   000168   12....       LCALL   ?Subroutine4 & 0xFFFF
    382            return ( 0 );  // Discard unknown events.
   \                     ??CrossCallReturnLabel_18:
   \   00016B   7A00         MOV     R2,#0x0
   \   00016D   7B00         MOV     R3,#0x0
   \                     ??SerialApp_ProcessEvent_4:
   \   00016F   7F06         MOV     R7,#0x6
   \   000171   02....       LJMP    ?BANKED_LEAVE_XDATA
    383          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   E0           MOVX    A,@DPTR
   \   000001   F5..         MOV     ?V0 + 2,A
   \   000003   A3           INC     DPTR
   \   000004   E0           MOVX    A,@DPTR
   \   000005   F5..         MOV     ?V0 + 3,A
   \   000007   78..         MOV     R0,#?V0 + 2
   \   000009   22           RET
    384          
    385          
    386          /*********************************************************************
    387           * @fn      SerialApp_ProcessZDOMsgs()
    388           *
    389           * @brief   Process response messages
    390           *
    391           * @param   none
    392           *
    393           * @return  none
    394           */
    395          static void SerialApp_ProcessZDOMsgs( zdoIncomingMsg_t *inMsg )
    396          {
    397            switch ( inMsg->clusterID )
    398            {
    399              case End_Device_Bind_rsp:
    400                if ( ZDO_ParseBindRsp( inMsg ) == ZSuccess )
    401                {
    402                  HalLedSet( HAL_LED_4, HAL_LED_MODE_ON );
    403                  // Light LED
    404                  /*
    405          #if defined( ZDO_COORDINATOR )
    406                  bind_cfg_flag = 0;
    407                  osal_stop_timerEx(Led_TaskID, HAL_LED_BLINK_EVENT);
    408                  HalLedSet( HAL_LED_4, HAL_LED_MODE_ON );
    409          #endif
    410                  */
    411                }
    412          #if defined(BLINK_LEDS)
    413                else
    414                {
    415                  // Flash LED to show failure
    416                  HalLedSet ( HAL_LED_4, HAL_LED_MODE_FLASH );
    417                }
    418          #endif
    419                break;
    420                
    421              case Match_Desc_rsp:
    422                {
    423                  ZDO_ActiveEndpointRsp_t *pRsp = ZDO_ParseEPListRsp( inMsg );
    424                  if ( pRsp )
    425                  {
    426                    if ( pRsp->status == ZSuccess && pRsp->cnt )
    427                    {
    428                      SerialApp_TxAddr.addrMode = (afAddrMode_t)Addr16Bit;
    429                      SerialApp_TxAddr.addr.shortAddr = pRsp->nwkAddr;
    430                      // Take the first endpoint, Can be changed to search through endpoints
    431                      SerialApp_TxAddr.endPoint = pRsp->epList[0];    
    432                      // Light LED
    433                      HalLedSet( HAL_LED_4, HAL_LED_MODE_ON );
    434                    }
    435                    osal_mem_free( pRsp );
    436                  }
    437                }
    438                break;
    439            }
    440          }
    441          
    442          
    443          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    444          void prcess_key2(void)
   \                     prcess_key2:
    445          {
   \   000000   74F5         MOV     A,#-0xb
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 11
   \   000005                ; Auto size: 9
   \   000005   74F7         MOV     A,#-0x9
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
    446            zAddrType_t txAddr;
    447              HalLedSet ( HAL_LED_4, HAL_LED_MODE_OFF );
   \   00000A                ; Setup parameters for call to function HalLedSet
   \   00000A   12....       LCALL   ?Subroutine7 & 0xFFFF
    448                
    449                // Initiate an End Device Bind Request for the mandatory endpoint
    450                txAddr.addrMode = Addr16Bit;
   \                     ??CrossCallReturnLabel_10:
   \   00000D   12....       LCALL   ?XSTACK_DISP0_8
   \   000010   12....       LCALL   ?Subroutine1 & 0xFFFF
    451                txAddr.addr.shortAddr = 0x0000; // Coordinator
    452                ZDP_EndDeviceBindReq( &txAddr, NLME_GetShortAddr(), 
    453                                      SerialApp_epDesc.endPoint,
    454                                      SERIALAPP_PROFID,
    455                                      SERIALAPP_MAX_CLUSTERS, (cId_t *)SerialApp_ClusterList,
    456                                      SERIALAPP_MAX_CLUSTERS, (cId_t *)SerialApp_ClusterList,
    457                                      FALSE );
   \                     ??CrossCallReturnLabel_2:
   \   000013   75....       MOV     ?V0 + 0,#(SerialApp_ClusterList & 0xff)
   \   000016   75....       MOV     ?V0 + 1,#((SerialApp_ClusterList >> 8) & 0xff)
   \   000019                ; Setup parameters for call to function ZDP_EndDeviceBindReq
   \   000019   F5..         MOV     ?V0 + 2,A
   \   00001B   78..         MOV     R0,#?V0 + 2
   \   00001D   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000020   78..         MOV     R0,#?V0 + 0
   \   000022   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000025   75..02       MOV     ?V0 + 2,#0x2
   \   000028   78..         MOV     R0,#?V0 + 2
   \   00002A   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   00002D   78..         MOV     R0,#?V0 + 0
   \   00002F   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000032   75..02       MOV     ?V0 + 0,#0x2
   \   000035   78..         MOV     R0,#?V0 + 0
   \   000037   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   00003A   75..05       MOV     ?V0 + 0,#0x5
   \   00003D   75..0F       MOV     ?V0 + 1,#0xf
   \   000040   78..         MOV     R0,#?V0 + 0
   \   000042   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000045                ; Setup parameters for call to function NLME_GetShortAddr
   \   000045   12....       LCALL   ?Subroutine6 & 0xFFFF
   \                     ??CrossCallReturnLabel_8:
   \   000048   12....       LCALL   ?XSTACK_DISP0_8
   \   00004B   AA82         MOV     R2,DPL
   \   00004D   AB83         MOV     R3,DPH
   \   00004F   12....       LCALL   ??ZDP_EndDeviceBindReq?relay
   \   000052   7409         MOV     A,#0x9
   \   000054   12....       LCALL   ?DEALLOC_XSTACK8
    458          }
   \   000057   7409         MOV     A,#0x9
   \   000059   12....       LCALL   ?DEALLOC_XSTACK8
   \   00005C   7F03         MOV     R7,#0x3
   \   00005E   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine7:
   \   000000   7A00         MOV     R2,#0x0
   \   000002   7908         MOV     R1,#0x8
   \   000004   12....       LCALL   ??HalLedSet?relay
   \   000007   7408         MOV     A,#0x8
   \   000009   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine6:
   \   000000   12....       LCALL   ??NLME_GetShortAddr?relay
   \   000003   EA           MOV     A,R2
   \   000004   FC           MOV     R4,A
   \   000005   EB           MOV     A,R3
   \   000006   FD           MOV     R5,A
   \   000007   790B         MOV     R1,#0xb
   \   000009   7409         MOV     A,#0x9
   \   00000B   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   7402         MOV     A,#0x2
   \   000002   12....       LCALL   ?Subroutine8 & 0xFFFF
   \                     ??CrossCallReturnLabel_15:
   \   000005   E4           CLR     A
   \   000006   F0           MOVX    @DPTR,A
   \   000007   A3           INC     DPTR
   \   000008   F0           MOVX    @DPTR,A
   \   000009   22           RET
    459          
    460          /*********************************************************************
    461           * @fn      SerialApp_HandleKeys
    462           *
    463           * @brief   Handles all key events for this device.
    464           *
    465           * @param   shift - true if in shift/alt.
    466           * @param   keys  - bit field for key events.
    467           *
    468           * @return  none
    469           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    470          void SerialApp_HandleKeys( uint8 shift, uint8 keys )
   \                     SerialApp_HandleKeys:
    471          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 9
   \   000005   74F7         MOV     A,#-0x9
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   E9           MOV     A,R1
   \   00000B   FE           MOV     R6,A
   \   00000C   EA           MOV     A,R2
   \   00000D   FF           MOV     R7,A
    472            zAddrType_t txAddr;
    473            
    474            if(keys & HAL_KEY2_SELECT)
   \   00000E   75....       MOV     ?V0 + 0,#(SerialApp_ClusterList & 0xff)
   \   000011   75....       MOV     ?V0 + 1,#((SerialApp_ClusterList >> 8) & 0xff)
   \   000014   A2E7         MOV     C,0xE0 /* A   */.7
   \   000016   5040         JNC     ??SerialApp_HandleKeys_0
    475            {
    476              
    477              /*
    478              HalLedSet ( HAL_LED_4, HAL_LED_MODE_OFF );
    479                
    480                // Initiate an End Device Bind Request for the mandatory endpoint
    481                txAddr.addrMode = Addr16Bit;
    482                txAddr.addr.shortAddr = 0x0000; // Coordinator
    483                ZDP_EndDeviceBindReq( &txAddr, NLME_GetShortAddr(), 
    484                                      SerialApp_epDesc.endPoint,
    485                                      SERIALAPP_PROFID,
    486                                      SERIALAPP_MAX_CLUSTERS, (cId_t *)SerialApp_ClusterList,
    487                                      SERIALAPP_MAX_CLUSTERS, (cId_t *)SerialApp_ClusterList,
    488                                      FALSE );
    489              */
    490              HalLedSet ( HAL_LED_4, HAL_LED_MODE_OFF );
   \   000018                ; Setup parameters for call to function HalLedSet
   \   000018   12....       LCALL   ?Subroutine7 & 0xFFFF
    491                
    492                // Initiate a Match Description Request (Service Discovery)
    493                txAddr.addrMode = AddrBroadcast;
    494                txAddr.addr.shortAddr = NWK_BROADCAST_SHORTADDR;
    495                ZDP_MatchDescReq( &txAddr, NWK_BROADCAST_SHORTADDR,
    496                                  SERIALAPP_PROFID,
    497                                  SERIALAPP_MAX_CLUSTERS, (cId_t *)SerialApp_ClusterList,
    498                                  SERIALAPP_MAX_CLUSTERS, (cId_t *)SerialApp_ClusterList,
    499                                  FALSE );
    500            }
   \                     ??CrossCallReturnLabel_11:
   \   00001B   12....       LCALL   ?XSTACK_DISP0_8
   \   00001E   12....       LCALL   ?Subroutine0 & 0xFFFF
   \                     ??CrossCallReturnLabel_0:
   \   000021   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000024   78..         MOV     R0,#?V0 + 0
   \   000026   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000029   75..02       MOV     ?V0 + 2,#0x2
   \   00002C   78..         MOV     R0,#?V0 + 2
   \   00002E   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000031   78..         MOV     R0,#?V0 + 0
   \   000033   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000036   75..05       MOV     ?V0 + 2,#0x5
   \   000039   75..0F       MOV     ?V0 + 3,#0xf
   \   00003C   78..         MOV     R0,#?V0 + 2
   \   00003E   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000041   7902         MOV     R1,#0x2
   \   000043   7CFF         MOV     R4,#-0x1
   \   000045   7DFF         MOV     R5,#-0x1
   \   000047   7408         MOV     A,#0x8
   \   000049   12....       LCALL   ?XSTACK_DISP0_8
   \   00004C   AA82         MOV     R2,DPL
   \   00004E   AB83         MOV     R3,DPH
   \   000050   12....       LCALL   ??ZDP_MatchDescReq?relay
   \   000053   7408         MOV     A,#0x8
   \   000055   12....       LCALL   ?DEALLOC_XSTACK8
    501            
    502            if ( shift )
   \                     ??SerialApp_HandleKeys_0:
   \   000058   EE           MOV     A,R6
   \   000059   6003         JZ      $+5
   \   00005B   02....       LJMP    ??SerialApp_HandleKeys_1 & 0xFFFF
    503            {
    504              if ( keys & HAL_KEY_SW_1 )
    505              {
    506              }
    507              if ( keys & HAL_KEY_SW_2 )
    508              {
    509              }
    510              if ( keys & HAL_KEY_SW_3 )
    511              {
    512              }
    513              if ( keys & HAL_KEY_SW_4 )
    514              {
    515              }
    516            }
    517            else
    518            {
    519              if ( keys & HAL_KEY_SW_1 )
    520              {
    521              }
    522          
    523              if ( keys & HAL_KEY_SW_2 )
   \   00005E   EF           MOV     A,R7
   \   00005F   A2E1         MOV     C,0xE0 /* A   */.1
   \   000061   5044         JNC     ??SerialApp_HandleKeys_2
    524              {
    525                HalLedSet ( HAL_LED_4, HAL_LED_MODE_OFF );
   \   000063                ; Setup parameters for call to function HalLedSet
   \   000063   12....       LCALL   ?Subroutine7 & 0xFFFF
    526                
    527                // Initiate an End Device Bind Request for the mandatory endpoint
    528                txAddr.addrMode = Addr16Bit;
   \                     ??CrossCallReturnLabel_12:
   \   000066   12....       LCALL   ?XSTACK_DISP0_8
   \   000069   12....       LCALL   ?Subroutine1 & 0xFFFF
    529                txAddr.addr.shortAddr = 0x0000; // Coordinator
    530                ZDP_EndDeviceBindReq( &txAddr, NLME_GetShortAddr(), 
    531                                      SerialApp_epDesc.endPoint,
    532                                      SERIALAPP_PROFID,
    533                                      SERIALAPP_MAX_CLUSTERS, (cId_t *)SerialApp_ClusterList,
    534                                      SERIALAPP_MAX_CLUSTERS, (cId_t *)SerialApp_ClusterList,
    535                                      FALSE );
   \                     ??CrossCallReturnLabel_3:
   \   00006C                ; Setup parameters for call to function ZDP_EndDeviceBindReq
   \   00006C   F5..         MOV     ?V0 + 2,A
   \   00006E   78..         MOV     R0,#?V0 + 2
   \   000070   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000073   78..         MOV     R0,#?V0 + 0
   \   000075   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000078   75..02       MOV     ?V0 + 2,#0x2
   \   00007B   78..         MOV     R0,#?V0 + 2
   \   00007D   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000080   78..         MOV     R0,#?V0 + 0
   \   000082   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000085   78..         MOV     R0,#?V0 + 2
   \   000087   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   00008A   75..05       MOV     ?V0 + 2,#0x5
   \   00008D   75..0F       MOV     ?V0 + 3,#0xf
   \   000090   78..         MOV     R0,#?V0 + 2
   \   000092   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000095                ; Setup parameters for call to function NLME_GetShortAddr
   \   000095   12....       LCALL   ?Subroutine6 & 0xFFFF
    536              }
   \                     ??CrossCallReturnLabel_9:
   \   000098   12....       LCALL   ?XSTACK_DISP0_8
   \   00009B   AA82         MOV     R2,DPL
   \   00009D   AB83         MOV     R3,DPH
   \   00009F   12....       LCALL   ??ZDP_EndDeviceBindReq?relay
   \   0000A2   7409         MOV     A,#0x9
   \   0000A4   12....       LCALL   ?DEALLOC_XSTACK8
    537          
    538              if ( keys & HAL_KEY_SW_3 )
    539              {
    540              }
    541          
    542              if ( keys & HAL_KEY_SW_4 )
   \                     ??SerialApp_HandleKeys_2:
   \   0000A7   EF           MOV     A,R7
   \   0000A8   A2E3         MOV     C,0xE0 /* A   */.3
   \   0000AA   5040         JNC     ??SerialApp_HandleKeys_1
    543              {
    544                HalLedSet ( HAL_LED_4, HAL_LED_MODE_OFF );
   \   0000AC                ; Setup parameters for call to function HalLedSet
   \   0000AC   12....       LCALL   ?Subroutine7 & 0xFFFF
    545                
    546                // Initiate a Match Description Request (Service Discovery)
    547                txAddr.addrMode = AddrBroadcast;
    548                txAddr.addr.shortAddr = NWK_BROADCAST_SHORTADDR;
    549                ZDP_MatchDescReq( &txAddr, NWK_BROADCAST_SHORTADDR,
    550                                  SERIALAPP_PROFID,
    551                                  SERIALAPP_MAX_CLUSTERS, (cId_t *)SerialApp_ClusterList,
    552                                  SERIALAPP_MAX_CLUSTERS, (cId_t *)SerialApp_ClusterList,
    553                                  FALSE );
    554              }
    555            }
   \                     ??CrossCallReturnLabel_13:
   \   0000AF   12....       LCALL   ?XSTACK_DISP0_8
   \   0000B2   12....       LCALL   ?Subroutine0 & 0xFFFF
   \                     ??CrossCallReturnLabel_1:
   \   0000B5   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   0000B8   78..         MOV     R0,#?V0 + 0
   \   0000BA   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000BD   75..02       MOV     ?V0 + 2,#0x2
   \   0000C0   78..         MOV     R0,#?V0 + 2
   \   0000C2   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   0000C5   78..         MOV     R0,#?V0 + 0
   \   0000C7   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000CA   75..05       MOV     ?V0 + 0,#0x5
   \   0000CD   75..0F       MOV     ?V0 + 1,#0xf
   \   0000D0   78..         MOV     R0,#?V0 + 0
   \   0000D2   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000D5   7902         MOV     R1,#0x2
   \   0000D7   7CFF         MOV     R4,#-0x1
   \   0000D9   7DFF         MOV     R5,#-0x1
   \   0000DB   7408         MOV     A,#0x8
   \   0000DD   12....       LCALL   ?XSTACK_DISP0_8
   \   0000E0   AA82         MOV     R2,DPL
   \   0000E2   AB83         MOV     R3,DPH
   \   0000E4   12....       LCALL   ??ZDP_MatchDescReq?relay
   \   0000E7   7408         MOV     A,#0x8
   \   0000E9   12....       LCALL   ?DEALLOC_XSTACK8
    556          }
   \                     ??SerialApp_HandleKeys_1:
   \   0000EC   7409         MOV     A,#0x9
   \   0000EE   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000F1   7F04         MOV     R7,#0x4
   \   0000F3   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   740F         MOV     A,#0xf
   \   000002   12....       LCALL   ?Subroutine8 & 0xFFFF
   \                     ??CrossCallReturnLabel_16:
   \   000005   74FF         MOV     A,#-0x1
   \   000007   F0           MOVX    @DPTR,A
   \   000008   A3           INC     DPTR
   \   000009   F0           MOVX    @DPTR,A
   \   00000A                ; Setup parameters for call to function ZDP_MatchDescReq
   \   00000A                ; Setup parameters for call to function ZDP_MatchDescReq
   \   00000A   75..00       MOV     ?V0 + 2,#0x0
   \   00000D   78..         MOV     R0,#?V0 + 2
   \   00000F   22           RET
    557          
    558          /*********************************************************************
    559           * @fn      SerialApp_ProcessMSGCmd
    560           *
    561           * @brief   Data message processor callback. This function processes
    562           *          any incoming data - probably from other devices. Based
    563           *          on the cluster ID, perform the intended action.
    564           *
    565           * @param   pkt - pointer to the incoming message packet
    566           *
    567           * @return  TRUE if the 'pkt' parameter is being used and will be freed later,
    568           *          FALSE otherwise.
    569           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine11_0:
   \   000000   90....       MOV     DPTR,#SerialApp_TaskID
   \   000003   E0           MOVX    A,@DPTR
   \   000004   F9           MOV     R1,A
   \   000005   12....       LCALL   ??osal_set_event?relay
   \   000008   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    570          void SerialApp_ProcessMSGCmd( afIncomingMSGPacket_t *pkt )
   \                     SerialApp_ProcessMSGCmd:
    571          {
   \   000000   74F1         MOV     A,#-0xf
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 15
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    572            uint8 stat;
    573            uint8 seqnb;
    574            uint8 delay;
    575          
    576            switch ( pkt->clusterId )
   \   000009   EE           MOV     A,R6
   \   00000A   2421         ADD     A,#0x21
   \   00000C   F8           MOV     R0,A
   \   00000D   EF           MOV     A,R7
   \   00000E   3400         ADDC    A,#0x0
   \   000010   F9           MOV     R1,A
   \   000011   88..         MOV     ?V0 + 0,R0
   \   000013   89..         MOV     ?V0 + 1,R1
   \   000015   8E82         MOV     DPL,R6
   \   000017   8F83         MOV     DPH,R7
   \   000019   A3           INC     DPTR
   \   00001A   A3           INC     DPTR
   \   00001B   A3           INC     DPTR
   \   00001C   A3           INC     DPTR
   \   00001D   12....       LCALL   ?Subroutine2 & 0xFFFF
   \                     ??CrossCallReturnLabel_5:
   \   000020   12....       LCALL   ?US_SWITCH_DENSE
   \                     `?<Jumptable for SerialApp_ProcessMSGCmd>_0`:
   \   000023   0100         DW        1
   \   000025   01           DB        1
   \   000026   ....         DW        ??CrossCallReturnLabel_19
   \   000028   ....         DW        ??SerialApp_ProcessMSGCmd_0
   \   00002A   ....         DW        ??SerialApp_ProcessMSGCmd_1
    577            {
    578            // A message with a serial data block to be transmitted on the serial port.
    579            case SERIALAPP_CLUSTERID1:
    580              // Store the address for sending and retrying.
    581              osal_memcpy(&SerialApp_RxAddr, &(pkt->srcAddr), sizeof( afAddrType_t ));
   \                     ??SerialApp_ProcessMSGCmd_0:
   \   00002C                ; Setup parameters for call to function osal_memcpy
   \   00002C   EE           MOV     A,R6
   \   00002D   2406         ADD     A,#0x6
   \   00002F   F5..         MOV     ?V0 + 4,A
   \   000031   EF           MOV     A,R7
   \   000032   3400         ADDC    A,#0x0
   \   000034   F5..         MOV     ?V0 + 5,A
   \   000036   75..00       MOV     ?V0 + 6,#0x0
   \   000039   78..         MOV     R0,#?V0 + 4
   \   00003B   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   00003E   7C0C         MOV     R4,#0xc
   \   000040   7D00         MOV     R5,#0x0
   \   000042   7A..         MOV     R2,#(SerialApp_RxAddr & 0xff)
   \   000044   7B..         MOV     R3,#((SerialApp_RxAddr >> 8) & 0xff)
   \   000046   12....       LCALL   ??osal_memcpy?relay
   \   000049   7403         MOV     A,#0x3
   \   00004B   12....       LCALL   ?DEALLOC_XSTACK8
    582          
    583              seqnb = pkt->cmd.Data[0];
   \   00004E   85..82       MOV     DPL,?V0 + 0
   \   000051   85..83       MOV     DPH,?V0 + 1
   \   000054   12....       LCALL   ?Subroutine3 & 0xFFFF
   \                     ??CrossCallReturnLabel_6:
   \   000057   E0           MOVX    A,@DPTR
   \   000058   F5..         MOV     ?V0 + 0,A
    584          
    585              // Keep message if not a repeat packet
    586              if ( (seqnb > SerialApp_RxSeq) ||                    // Normal
    587                  ((seqnb < 0x80 ) && ( SerialApp_RxSeq > 0x80)) ) // Wrap-around
   \   00005A   90....       MOV     DPTR,#SerialApp_RxSeq
   \   00005D   E0           MOVX    A,@DPTR
   \   00005E   C3           CLR     C
   \   00005F   95..         SUBB    A,?V0 + 0
   \   000061   400D         JC      ??SerialApp_ProcessMSGCmd_2
   \   000063   E5..         MOV     A,?V0 + 0
   \   000065   C3           CLR     C
   \   000066   9480         SUBB    A,#-0x80
   \   000068   503D         JNC     ??SerialApp_ProcessMSGCmd_3
   \   00006A   E0           MOVX    A,@DPTR
   \   00006B   C3           CLR     C
   \   00006C   9481         SUBB    A,#-0x7f
   \   00006E   4037         JC      ??SerialApp_ProcessMSGCmd_3
    588              {
    589                // Transmit the data on the serial port.
    590                if ( HalUARTWrite( SERIAL_APP_PORT, pkt->cmd.Data+1, (pkt->cmd.DataLength-1) ) )
   \                     ??SerialApp_ProcessMSGCmd_2:
   \   000070                ; Setup parameters for call to function HalUARTWrite
   \   000070   EE           MOV     A,R6
   \   000071   241F         ADD     A,#0x1f
   \   000073   F582         MOV     DPL,A
   \   000075   EF           MOV     A,R7
   \   000076   3400         ADDC    A,#0x0
   \   000078   F583         MOV     DPH,A
   \   00007A   E0           MOVX    A,@DPTR
   \   00007B   24FF         ADD     A,#-0x1
   \   00007D   FC           MOV     R4,A
   \   00007E   A3           INC     DPTR
   \   00007F   E0           MOVX    A,@DPTR
   \   000080   34FF         ADDC    A,#-0x1
   \   000082   FD           MOV     R5,A
   \   000083   8882         MOV     DPL,R0
   \   000085   8983         MOV     DPH,R1
   \   000087   A3           INC     DPTR
   \   000088   AA82         MOV     R2,DPL
   \   00008A   AB83         MOV     R3,DPH
   \   00008C   7900         MOV     R1,#0x0
   \   00008E   12....       LCALL   ??HalUARTWrite?relay
   \   000091   EA           MOV     A,R2
   \   000092   7001         JNZ     ??SerialApp_ProcessMSGCmd_4
   \   000094   EB           MOV     A,R3
   \                     ??SerialApp_ProcessMSGCmd_4:
   \   000095   600A         JZ      ??SerialApp_ProcessMSGCmd_5
    591                {
    592                  // Save for next incoming message
    593                  SerialApp_RxSeq = seqnb;
   \   000097   E5..         MOV     A,?V0 + 0
   \   000099   90....       MOV     DPTR,#SerialApp_RxSeq
   \   00009C   F0           MOVX    @DPTR,A
    594                  stat = OTA_SUCCESS;
   \   00009D   7A00         MOV     R2,#0x0
   \   00009F   8008         SJMP    ??SerialApp_ProcessMSGCmd_6
    595                }
    596                else
    597                {
    598                  stat = OTA_SER_BUSY;
   \                     ??SerialApp_ProcessMSGCmd_5:
   \   0000A1   7A02         MOV     R2,#0x2
   \   0000A3   7B10         MOV     R3,#0x10
   \   0000A5   8004         SJMP    ??SerialApp_ProcessMSGCmd_7
    599                }
    600              }
    601              else
    602              {
    603                stat = OTA_DUP_MSG;
   \                     ??SerialApp_ProcessMSGCmd_3:
   \   0000A7   7A01         MOV     R2,#0x1
   \                     ??SerialApp_ProcessMSGCmd_6:
   \   0000A9   7B01         MOV     R3,#0x1
    604              }
    605          
    606              // Select approproiate OTA flow-control delay.
    607              delay = (stat == OTA_SER_BUSY) ? SERIALAPP_NAK_DELAY : SERIALAPP_ACK_DELAY;
    608          
    609              // Build & send OTA response message.
    610              SerialApp_RspBuf[0] = stat;
   \                     ??SerialApp_ProcessMSGCmd_7:
   \   0000AB   EA           MOV     A,R2
   \   0000AC   90....       MOV     DPTR,#SerialApp_RspBuf
   \   0000AF   F0           MOVX    @DPTR,A
    611              SerialApp_RspBuf[1] = seqnb;
   \   0000B0   E5..         MOV     A,?V0 + 0
   \   0000B2   90....       MOV     DPTR,#(SerialApp_RspBuf + 1)
   \   0000B5   F0           MOVX    @DPTR,A
    612              SerialApp_RspBuf[2] = LO_UINT16( delay );
   \   0000B6   EB           MOV     A,R3
   \   0000B7   90....       MOV     DPTR,#(SerialApp_RspBuf + 2)
   \   0000BA   F0           MOVX    @DPTR,A
    613              SerialApp_RspBuf[3] = HI_UINT16( delay );
   \   0000BB   E4           CLR     A
   \   0000BC   90....       MOV     DPTR,#(SerialApp_RspBuf + 3)
   \   0000BF   F0           MOVX    @DPTR,A
    614              osal_set_event( SerialApp_TaskID, SERIALAPP_RESP_EVT );
   \   0000C0                ; Setup parameters for call to function osal_set_event
   \   0000C0   7A02         MOV     R2,#0x2
   \   0000C2   FB           MOV     R3,A
   \   0000C3   12....       LCALL   ??Subroutine11_0 & 0xFFFF
    615              osal_stop_timerEx(SerialApp_TaskID, SERIALAPP_RESP_EVT);
   \                     ??CrossCallReturnLabel_22:
   \   0000C6                ; Setup parameters for call to function osal_stop_timerEx
   \   0000C6   7A02         MOV     R2,#0x2
   \   0000C8   7B00         MOV     R3,#0x0
   \                     ??SerialApp_ProcessMSGCmd_8:
   \   0000CA   90....       MOV     DPTR,#SerialApp_TaskID
   \   0000CD   E0           MOVX    A,@DPTR
   \   0000CE   F9           MOV     R1,A
   \   0000CF   12....       LCALL   ??osal_stop_timerEx?relay
   \   0000D2   8036         SJMP    ??CrossCallReturnLabel_19
    616              break;
    617          
    618            // A response to a received serial data block.
    619            case SERIALAPP_CLUSTERID2:
    620              if ((pkt->cmd.Data[1] == SerialApp_TxSeq) &&
    621                 ((pkt->cmd.Data[0] == OTA_SUCCESS) || (pkt->cmd.Data[0] == OTA_DUP_MSG)))
   \                     ??SerialApp_ProcessMSGCmd_1:
   \   0000D4   85..82       MOV     DPL,?V0 + 0
   \   0000D7   8983         MOV     DPH,R1
   \   0000D9   12....       LCALL   ?Subroutine3 & 0xFFFF
   \                     ??CrossCallReturnLabel_7:
   \   0000DC   A3           INC     DPTR
   \   0000DD   E0           MOVX    A,@DPTR
   \   0000DE   FA           MOV     R2,A
   \   0000DF   90....       MOV     DPTR,#SerialApp_TxSeq
   \   0000E2   E0           MOVX    A,@DPTR
   \   0000E3   6A           XRL     A,R2
   \   0000E4   7015         JNZ     ??SerialApp_ProcessMSGCmd_9
   \   0000E6   8882         MOV     DPL,R0
   \   0000E8   8983         MOV     DPH,R1
   \   0000EA   E0           MOVX    A,@DPTR
   \   0000EB   6004         JZ      ??SerialApp_ProcessMSGCmd_10
   \   0000ED   6401         XRL     A,#0x1
   \   0000EF   700A         JNZ     ??SerialApp_ProcessMSGCmd_9
    622              {
    623                SerialApp_TxLen = 0;
   \                     ??SerialApp_ProcessMSGCmd_10:
   \   0000F1   E4           CLR     A
   \   0000F2   90....       MOV     DPTR,#SerialApp_TxLen
   \   0000F5   F0           MOVX    @DPTR,A
    624                osal_stop_timerEx(SerialApp_TaskID, SERIALAPP_SEND_EVT);
   \   0000F6                ; Setup parameters for call to function osal_stop_timerEx
   \   0000F6   7A01         MOV     R2,#0x1
   \   0000F8   FB           MOV     R3,A
   \   0000F9   80CF         SJMP    ??SerialApp_ProcessMSGCmd_8
    625              }
    626              else
    627              {
    628                // Re-start timeout according to delay sent from other device.
    629                delay = BUILD_UINT16( pkt->cmd.Data[2], pkt->cmd.Data[3] );
    630                osal_start_timerEx( SerialApp_TaskID, SERIALAPP_SEND_EVT, delay );
   \                     ??SerialApp_ProcessMSGCmd_9:
   \   0000FB                ; Setup parameters for call to function osal_start_timerEx
   \   0000FB   8882         MOV     DPL,R0
   \   0000FD   8983         MOV     DPH,R1
   \   0000FF   A3           INC     DPTR
   \   000100   A3           INC     DPTR
   \   000101   E0           MOVX    A,@DPTR
   \   000102   FC           MOV     R4,A
   \   000103   7D00         MOV     R5,#0x0
   \   000105   7A01         MOV     R2,#0x1
   \   000107   12....       LCALL   ??Subroutine10_0 & 0xFFFF
    631              }
    632              break;
    633          
    634              default:
    635                break;
    636            }
    637          }
   \                     ??CrossCallReturnLabel_19:
   \   00010A   7F07         MOV     R7,#0x7
   \   00010C   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine3:
   \   000000   E0           MOVX    A,@DPTR
   \   000001   F8           MOV     R0,A
   \   000002   A3           INC     DPTR
   \   000003   E0           MOVX    A,@DPTR
   \   000004   F9           MOV     R1,A
   \   000005   8882         MOV     DPL,R0
   \   000007   8983         MOV     DPH,R1
   \   000009   22           RET
    638          
    639          /*********************************************************************
    640           * @fn      SerialApp_Send
    641           *
    642           * @brief   Send data OTA.
    643           *
    644           * @param   none
    645           *
    646           * @return  none
    647           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine5:
   \   000000   7B00         MOV     R3,#0x0
   \   000002                REQUIRE ??Subroutine11_0
   \   000002                ; // Fall through to label ??Subroutine11_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    648          static void SerialApp_Send(void)
   \                     SerialApp_Send:
    649          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
    650          #if SERIAL_APP_LOOPBACK
    651            if (SerialApp_TxLen < SERIAL_APP_TX_MAX)
    652            {
    653              SerialApp_TxLen += HalUARTRead(SERIAL_APP_PORT, SerialApp_TxBuf+SerialApp_TxLen+1,
    654                                                              SERIAL_APP_TX_MAX-SerialApp_TxLen);
    655            }
    656          
    657            if (SerialApp_TxLen)
    658            {
    659              (void)SerialApp_TxAddr;
    660              if (HalUARTWrite(SERIAL_APP_PORT, SerialApp_TxBuf+1, SerialApp_TxLen))
    661              {
    662                SerialApp_TxLen = 0;
    663              }
    664              else
    665              {
    666                osal_set_event(SerialApp_TaskID, SERIALAPP_SEND_EVT);
    667              }
    668            }
    669          #else
    670            if (!SerialApp_TxLen && 
    671                (SerialApp_TxLen = HalUARTRead(SERIAL_APP_PORT, SerialApp_TxBuf+1, SERIAL_APP_TX_MAX)))
   \   000005   90....       MOV     DPTR,#SerialApp_TxLen
   \   000008   E0           MOVX    A,@DPTR
   \   000009   701E         JNZ     ??SerialApp_Send_0
   \   00000B                ; Setup parameters for call to function HalUARTRead
   \   00000B   7C50         MOV     R4,#0x50
   \   00000D   7D00         MOV     R5,#0x0
   \   00000F   7A..         MOV     R2,#((SerialApp_TxBuf + 1) & 0xff)
   \   000011   7B..         MOV     R3,#(((SerialApp_TxBuf + 1) >> 8) & 0xff)
   \   000013   7900         MOV     R1,#0x0
   \   000015   12....       LCALL   ??HalUARTRead?relay
   \   000018   EA           MOV     A,R2
   \   000019   90....       MOV     DPTR,#SerialApp_TxLen
   \   00001C   F0           MOVX    @DPTR,A
   \   00001D   6061         JZ      ??CrossCallReturnLabel_21
    672            {
    673              // Pre-pend sequence number to the Tx message.
    674              SerialApp_TxBuf[0] = ++SerialApp_TxSeq;
   \   00001F   90....       MOV     DPTR,#SerialApp_TxSeq
   \   000022   E0           MOVX    A,@DPTR
   \   000023   04           INC     A
   \   000024   F0           MOVX    @DPTR,A
   \   000025   90....       MOV     DPTR,#SerialApp_TxBuf
   \   000028   F0           MOVX    @DPTR,A
    675            }
    676          
    677            if (SerialApp_TxLen)
    678            {
    679              if (afStatus_SUCCESS != AF_DataRequest(&SerialApp_TxAddr,
    680                                                     (endPointDesc_t *)&SerialApp_epDesc,
    681                                                      SERIALAPP_CLUSTERID1,
    682                                                      SerialApp_TxLen+1, SerialApp_TxBuf,
    683                                                      &SerialApp_MsgID, 0, AF_DEFAULT_RADIUS))
   \                     ??SerialApp_Send_0:
   \   000029                ; Setup parameters for call to function AF_DataRequest
   \   000029   75..1E       MOV     ?V0 + 0,#0x1e
   \   00002C   78..         MOV     R0,#?V0 + 0
   \   00002E   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000031   75....       MOV     ?V0 + 0,#(SerialApp_MsgID & 0xff)
   \   000034   75....       MOV     ?V0 + 1,#((SerialApp_MsgID >> 8) & 0xff)
   \   000037   78..         MOV     R0,#?V0 + 0
   \   000039   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00003C   75....       MOV     ?V0 + 0,#(SerialApp_TxBuf & 0xff)
   \   00003F   75....       MOV     ?V0 + 1,#((SerialApp_TxBuf >> 8) & 0xff)
   \   000042   78..         MOV     R0,#?V0 + 0
   \   000044   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000047   90....       MOV     DPTR,#SerialApp_TxLen
   \   00004A   E0           MOVX    A,@DPTR
   \   00004B   F8           MOV     R0,A
   \   00004C   7401         MOV     A,#0x1
   \   00004E   28           ADD     A,R0
   \   00004F   F5..         MOV     ?V0 + 0,A
   \   000051   E4           CLR     A
   \   000052   3400         ADDC    A,#0x0
   \   000054   F5..         MOV     ?V0 + 1,A
   \   000056   78..         MOV     R0,#?V0 + 0
   \   000058   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00005B   75..01       MOV     ?V0 + 0,#0x1
   \   00005E   75..00       MOV     ?V0 + 1,#0x0
   \   000061   78..         MOV     R0,#?V0 + 0
   \   000063   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000066   7900         MOV     R1,#0x0
   \   000068   7C..         MOV     R4,#(SerialApp_epDesc & 0xff)
   \   00006A   7D..         MOV     R5,#((SerialApp_epDesc >> 8) & 0xff)
   \   00006C   7A..         MOV     R2,#(SerialApp_TxAddr & 0xff)
   \   00006E   7B..         MOV     R3,#((SerialApp_TxAddr >> 8) & 0xff)
   \   000070   12....       LCALL   ??AF_DataRequest?relay
   \   000073   7409         MOV     A,#0x9
   \   000075   12....       LCALL   ?DEALLOC_XSTACK8
   \   000078   E9           MOV     A,R1
   \   000079   6005         JZ      ??CrossCallReturnLabel_21
    684              {
    685                osal_set_event(SerialApp_TaskID, SERIALAPP_SEND_EVT);
   \   00007B                ; Setup parameters for call to function osal_set_event
   \   00007B   7A01         MOV     R2,#0x1
   \   00007D   12....       LCALL   ?Subroutine5 & 0xFFFF
    686              }
    687            }
    688          #endif
    689          }
   \                     ??CrossCallReturnLabel_21:
   \   000080   7F02         MOV     R7,#0x2
   \   000082   02....       LJMP    ?BANKED_LEAVE_XDATA
    690          
    691          /*********************************************************************
    692           * @fn      SerialApp_Resp
    693           *
    694           * @brief   Send data OTA.
    695           *
    696           * @param   none
    697           *
    698           * @return  none
    699           */
    700          static void SerialApp_Resp(void)
    701          {
    702            if (afStatus_SUCCESS != AF_DataRequest(&SerialApp_RxAddr,
    703                                                   (endPointDesc_t *)&SerialApp_epDesc,
    704                                                    SERIALAPP_CLUSTERID2,
    705                                                    SERIAL_APP_RSP_CNT, SerialApp_RspBuf,
    706                                                   &SerialApp_MsgID, 0, AF_DEFAULT_RADIUS))
    707            {
    708              osal_set_event(SerialApp_TaskID, SERIALAPP_RESP_EVT);
    709            }
    710          }
    711          
    712          /*********************************************************************
    713           * @fn      SerialApp_CallBack
    714           *
    715           * @brief   Send data OTA.
    716           *
    717           * @param   port - UART port.
    718           * @param   event - the UART port event flag.
    719           *
    720           * @return  none
    721           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    722          static void SerialApp_CallBack(uint8 port, uint8 event)
   \                     SerialApp_CallBack:
    723          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    724            (void)port;
    725          
    726            if ((event & (HAL_UART_RX_FULL | HAL_UART_RX_ABOUT_FULL | HAL_UART_RX_TIMEOUT)) &&
    727          #if SERIAL_APP_LOOPBACK
    728                (SerialApp_TxLen < SERIAL_APP_TX_MAX))
    729          #else
    730                !SerialApp_TxLen)
   \   000004   7407         MOV     A,#0x7
   \   000006   5A           ANL     A,R2
   \   000007   6009         JZ      ??SerialApp_CallBack_0
   \   000009   90....       MOV     DPTR,#SerialApp_TxLen
   \   00000C   E0           MOVX    A,@DPTR
   \   00000D   7003         JNZ     ??SerialApp_CallBack_0
    731          #endif
    732            {
    733              SerialApp_Send();
   \   00000F                ; Setup parameters for call to function SerialApp_Send
   \   00000F   12....       LCALL   ??SerialApp_Send?relay
    734            }
    735          }
   \                     ??SerialApp_CallBack_0:
   \   000012   02....       LJMP    ?Subroutine9 & 0xFFFF

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for time_ok>`:
   \   000000   ....         DW `?<Constant "time start ok">`

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for time_err>`:
   \   000000   ....         DW `?<Constant "time not start">`

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for bind_cfg_flag>`:
   \   000000   01           DB 1

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??Timer_led_Init?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    Timer_led_Init

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SerialApp_Init?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SerialApp_Init

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??Timer_ledProcess?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    Timer_ledProcess

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SerialApp_ProcessEvent?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SerialApp_ProcessEvent

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??prcess_key2?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    prcess_key2

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SerialApp_HandleKeys?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SerialApp_HandleKeys

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SerialApp_ProcessMSGCmd?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SerialApp_ProcessMSGCmd

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SerialApp_Send?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SerialApp_Send

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SerialApp_CallBack?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SerialApp_CallBack

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "time start ok">`:
   \   000000   74696D65     DB "time start ok"
   \            20737461
   \            7274206F
   \            6B00    

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "time not start">`:
   \   000000   74696D65     DB "time not start"
   \            206E6F74
   \            20737461
   \            727400  

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "SerialApp">`:
   \   000000   53657269     DB "SerialApp"
   \            616C4170
   \            7000    
    736          
    737          /*********************************************************************
    738          *********************************************************************/

   Maximum stack usage in bytes:

     Function                     ISTACK PSTACK XSTACK
     --------                     ------ ------ ------
     SerialApp_CallBack               2      0      0
       -> SerialApp_Send              4      0      0
     SerialApp_HandleKeys             1      0     44
       -> HalLedSet                   0      0     42
       -> ZDP_MatchDescReq            0      0     58
       -> HalLedSet                   0      0     42
       -> NLME_GetShortAddr           0      0     60
       -> ZDP_EndDeviceBindReq        0      0     60
       -> HalLedSet                   0      0     42
       -> ZDP_MatchDescReq            0      0     58
     SerialApp_Init                   1      0     38
       -> afRegister                  0      0     76
       -> RegisterForKeys             0      0     76
       -> HalUARTOpen                 0      0     76
       -> HalLcdWriteString           0      0     76
       -> ZDO_RegisterForZDOMsg       0      0     76
       -> ZDO_RegisterForZDOMsg       0      0     76
       -> osal_start_timerEx          0      0     76
     SerialApp_ProcessEvent           0      0     23
       -> SerialApp_Send              0      0     28
       -> SerialApp_ProcessMSGCmd     0      0     28
       -> osal_msg_deallocate         0      0     28
       -> osal_msg_receive            0      0     28
       -> HalLedSet                   0      0     28
       -> HalLedSet                   0      0     28
       -> ZDO_ParseEPListRsp          0      0     28
       -> HalLedSet                   0      0     28
       -> osal_mem_free               0      0     28
       -> SerialApp_HandleKeys        0      0     28
       -> AF_DataRequest              0      0     46
       -> osal_set_event              0      0     28
       -> osal_start_timerEx          0      0     28
     SerialApp_ProcessMSGCmd          0      0     32
       -> osal_memcpy                 0      0     36
       -> HalUARTWrite                0      0     30
       -> osal_set_event              0      0     30
       -> osal_stop_timerEx           0      0     30
       -> osal_stop_timerEx           0      0     30
       -> osal_start_timerEx          0      0     30
     SerialApp_Send                   0      0     33
       -> HalUARTRead                 0      0     20
       -> AF_DataRequest              0      0     38
       -> osal_set_event              0      0     20
     Timer_ledProcess                 0      0      0
     Timer_led_Init                   2      0      0
       -> osal_start_timerEx          4      0      0
       -> HalUARTWrite                4      0      0
       -> HalUARTWrite                4      0      0
     prcess_key2                      1      0     29
       -> HalLedSet                   0      0     40
       -> NLME_GetShortAddr           0      0     58
       -> ZDP_EndDeviceBindReq        0      0     58


   Segment part sizes:

     Function/Label                   Bytes
     --------------                   -----
     time_ok                             2
     time_err                            2
     SerialApp_ClusterList               4
     SerialApp_SimpleDesc               12
     SerialApp_epDesc                    6
     bind_cfg_flag                       1
     flag                                1
     SerialApp_TaskID                    1
     Led_TaskID                          1
     SerialApp_MsgID                     1
     SerialApp_TxAddr                   12
     SerialApp_TxSeq                     1
     SerialApp_TxBuf                    81
     SerialApp_TxLen                     1
     SerialApp_RxAddr                   12
     SerialApp_RxSeq                     1
     SerialApp_RspBuf                    4
     Timer_led_Init                     45
     ?Subroutine9                        7
     SerialApp_Init                    172
     ?Subroutine4                        6
     ??Subroutine10_0                   11
     ?Subroutine8                        8
     Timer_ledProcess                    7
     SerialApp_ProcessEvent            372
     ?Subroutine2                       10
     prcess_key2                        97
     ?Subroutine7                       10
     ?Subroutine6                       12
     ?Subroutine1                       10
     SerialApp_HandleKeys              246
     ?Subroutine0                       16
     ??Subroutine11_0                    9
     SerialApp_ProcessMSGCmd           271
     ?Subroutine3                       10
     ?Subroutine5                        2
     SerialApp_Send                    133
     SerialApp_CallBack                 21
     ?<Initializer for time_ok>          2
     ?<Initializer for time_err>         2
     ?<Initializer for bind_cfg_flag>    1
     ??Timer_led_Init?relay              6
     ??SerialApp_Init?relay              6
     ??Timer_ledProcess?relay            6
     ??SerialApp_ProcessEvent?relay      6
     ??prcess_key2?relay                 6
     ??SerialApp_HandleKeys?relay        6
     ??SerialApp_ProcessMSGCmd?relay     6
     ??SerialApp_Send?relay              6
     ??SerialApp_CallBack?relay          6
     ?<Constant "time start ok">        14
     ?<Constant "time not start">       15
     ?<Constant "SerialApp">            10

 
 1 475 bytes in segment BANKED_CODE
    54 bytes in segment BANK_RELAYS
     5 bytes in segment XDATA_I
     5 bytes in segment XDATA_ID
    61 bytes in segment XDATA_ROM_C
   116 bytes in segment XDATA_Z
 
 1 534 bytes of CODE  memory
    61 bytes of CONST memory
   121 bytes of XDATA memory

Errors: none
Warnings: none
