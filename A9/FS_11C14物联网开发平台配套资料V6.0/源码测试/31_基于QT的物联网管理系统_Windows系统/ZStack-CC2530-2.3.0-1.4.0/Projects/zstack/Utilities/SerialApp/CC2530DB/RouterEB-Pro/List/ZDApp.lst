###############################################################################
#                                                                             #
# IAR C/C++ Compiler V7.51A/W32 for 8051                13/Dec/2012  10:23:12 #
# Copyright 2004-2009 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  C:\Texas Instruments\ZStack-CC2530-2.3.0-1.4.0\Com #
#                          ponents\stack\zdo\ZDApp.c                          #
#    Command line       =  -f "C:\Texas Instruments\ZStack-CC2530-2.3.0-1.4.0 #
#                          \Projects\zstack\Utilities\SerialApp\CC2530DB\..\. #
#                          .\..\Tools\CC2530DB\f8wRouter.cfg" (-DCPU32MHZ     #
#                          -DROOT=__near_func -DMAC_CFG_APP_PENDING_QUEUE=TRU #
#                          E -DRTR_NWK -DBLINK_LEDS) -f "C:\Texas             #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Utilities\SerialApp\CC2530DB\..\..\..\Tools\CC #
#                          2530DB\f8wConfig.cfg" (-DSECURE=0                  #
#                          -DZG_SECURE_DYNAMIC=0 -DREFLECTOR                  #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFFF                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116 "-DCONST=const __code"    #
#                          -DGENERIC=__generic -DRFD_RCVC_ALWAYS_ON=FALSE     #
#                          -DPOLL_RATE=1000 -DQUEUED_POLL_RATE=100            #
#                          -DRESPONSE_POLL_RATE=100) -DREJOIN_POLL_RATE=440   #
#                          "C:\Texas Instruments\ZStack-CC2530-2.3.0-1.4.0\Co #
#                          mponents\stack\zdo\ZDApp.c" -D ZIGBEEPRO -D        #
#                          HAL_UART=TRUE -D SERIAL_APP_PORT=0 -D              #
#                          LCD_SUPPORTED -lC "C:\Texas                        #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Utilities\SerialApp\CC2530DB\RouterEB-Pro\List #
#                          \" -lA "C:\Texas Instruments\ZStack-CC2530-2.3.0-1 #
#                          .4.0\Projects\zstack\Utilities\SerialApp\CC2530DB\ #
#                          RouterEB-Pro\List\" --diag_suppress Pe001,Pa010    #
#                          -o "C:\Texas Instruments\ZStack-CC2530-2.3.0-1.4.0 #
#                          \Projects\zstack\Utilities\SerialApp\CC2530DB\Rout #
#                          erEB-Pro\Obj\" -e --require_prototypes --debug     #
#                          --core=plain --dptr=16,1 --data_model=large        #
#                          --code_model=banked --calling_convention=xdata_ree #
#                          ntrant --place_constants=data_rom                  #
#                          --nr_virtual_regs 16 -I "C:\Texas                  #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Utilities\SerialApp\CC2530DB\" -I "C:\Texas    #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Utilities\SerialApp\CC2530DB\..\SOURCE\" -I    #
#                          "C:\Texas Instruments\ZStack-CC2530-2.3.0-1.4.0\Pr #
#                          ojects\zstack\Utilities\SerialApp\CC2530DB\..\..\. #
#                          .\ZMAIN\TI2530DB\" -I "C:\Texas                    #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Utilities\SerialApp\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\MT\" -I "C:\Texas                         #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Utilities\SerialApp\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\HAL\INCLUDE\" -I "C:\Texas                #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Utilities\SerialApp\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\HAL\TARGET\CC2530EB\" -I "C:\Texas        #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Utilities\SerialApp\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\OSAL\MCU\CCSOC\" -I "C:\Texas             #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Utilities\SerialApp\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\OSAL\INCLUDE\" -I "C:\Texas               #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Utilities\SerialApp\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\STACK\AF\" -I "C:\Texas                   #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Utilities\SerialApp\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\STACK\NWK\" -I "C:\Texas                  #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Utilities\SerialApp\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\STACK\SEC\" -I "C:\Texas                  #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Utilities\SerialApp\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\STACK\SAPI\" -I "C:\Texas                 #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Utilities\SerialApp\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\STACK\SYS\" -I "C:\Texas                  #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Utilities\SerialApp\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\STACK\ZDO\" -I "C:\Texas                  #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Utilities\SerialApp\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\ZMAC\F8W\" -I "C:\Texas                   #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Utilities\SerialApp\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\ZMAC\" -I "C:\Texas                       #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Utilities\SerialApp\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\SERVICES\SADDR\" -I "C:\Texas             #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Utilities\SerialApp\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\SERVICES\SDATA\" -I "C:\Texas             #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Utilities\SerialApp\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\MAC\INCLUDE\" -I "C:\Texas                #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Utilities\SerialApp\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\MAC\HIGH_LEVEL\" -I "C:\Texas             #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Utilities\SerialApp\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\MAC\LOW_LEVEL\srf04\" -I "C:\Texas        #
#                          Instruments\ZStack-CC2530-2.3.0-1.4.0\Projects\zst #
#                          ack\Utilities\SerialApp\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\MAC\LOW_LEVEL\srf04\SINGLE_CHIP\" -I      #
#                          "C:\Program Files\IAR Systems\Embedded Workbench   #
#                          5.3\8051\INC\" -I "C:\Program Files\IAR            #
#                          Systems\Embedded Workbench 5.3\8051\INC\CLIB\"     #
#                          -Ohz                                               #
#    List file          =  C:\Texas Instruments\ZStack-CC2530-2.3.0-1.4.0\Pro #
#                          jects\zstack\Utilities\SerialApp\CC2530DB\RouterEB #
#                          -Pro\List\ZDApp.lst                                #
#    Object file        =  C:\Texas Instruments\ZStack-CC2530-2.3.0-1.4.0\Pro #
#                          jects\zstack\Utilities\SerialApp\CC2530DB\RouterEB #
#                          -Pro\Obj\ZDApp.r51                                 #
#                                                                             #
#                                                                             #
###############################################################################

C:\Texas Instruments\ZStack-CC2530-2.3.0-1.4.0\Components\stack\zdo\ZDApp.c
      1          /**************************************************************************************************
      2            Filename:       ZDApp.c
      3            Revised:        $Date: 2010-01-04 12:16:55 -0800 (Mon, 04 Jan 2010) $
      4            Revision:       $Revision: 21428 $
      5          
      6            Description:    This file contains the interface to the Zigbee Device Application. This is the
      7                            Application part that the use can change. This also contains the Task functions.
      8          
      9          
     10            Copyright 2004-2009 Texas Instruments Incorporated. All rights reserved.
     11          
     12            IMPORTANT: Your use of this Software is limited to those specific rights
     13            granted under the terms of a software license agreement between the user
     14            who downloaded the software, his/her employer (which must be your employer)
     15            and Texas Instruments Incorporated (the "License").  You may not use this
     16            Software unless you agree to abide by the terms of the License. The License
     17            limits your use, and you acknowledge, that the Software may not be modified,
     18            copied or distributed unless embedded on a Texas Instruments microcontroller
     19            or used solely and exclusively in conjunction with a Texas Instruments radio
     20            frequency transceiver, which is integrated into your product.  Other than for
     21            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     22            works of, modify, distribute, perform, display or sell this Software and/or
     23            its documentation for any purpose.
     24          
     25            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     26            PROVIDED “AS IS?WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     27            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE, 
     28            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     29            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     30            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     31            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     32            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     33            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     34            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     35            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     36          
     37            Should you have any questions regarding your right to use this Software,
     38            contact Texas Instruments Incorporated at www.TI.com. 
     39          **************************************************************************************************/
     40          
     41          /*********************************************************************
     42           * INCLUDES
     43           */
     44          #include "ZComDef.h"
     45          #include "ZMac.h"
     46          #include "OSAL.h"
     47          #include "OSAL_Tasks.h"
     48          #include "OSAL_PwrMgr.h"
     49          #include "OSAL_Nv.h"
     50          #include "AF.h"
     51          #include "APSMEDE.h"
     52          #include "NLMEDE.h"
     53          #include "AddrMgr.h"
     54          #include "ZDProfile.h"
     55          #include "ZDObject.h"
     56          #include "ZDConfig.h"
     57          #include "ZDSecMgr.h"
     58          #include "ZDApp.h"
     59          #include "DebugTrace.h"
     60          #include "nwk_util.h"
     61          #include "OnBoard.h"

   \                                 In  segment SFR_AN, at 0xa8
   \   union <unnamed> volatile __sfr _A_IEN0
   \                     _A_IEN0:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xc9
   \   unsigned char volatile __sfr WDCTL
   \                     WDCTL:
   \   000000                DS 1
     62          #include "ZGlobals.h"
     63          #include "ZDNwkMgr.h"
     64          #include "rtg.h"
     65          
     66          #include "ssp.h"
     67          
     68          /* HAL */
     69          #include "hal_led.h"
     70          #include "hal_lcd.h"
     71          #include "hal_key.h"
     72          
     73          #if defined( MT_MAC_FUNC ) || defined( MT_MAC_CB_FUNC )
     74            #error "ERROR! MT_MAC functionalities should be disabled on ZDO devices"
     75          #endif
     76          /*********************************************************************
     77           * MACROS
     78           */
     79          
     80          /*********************************************************************
     81           * CONSTANTS
     82           */
     83          #if !defined( NWK_START_DELAY )
     84            #define NWK_START_DELAY             100   // in milliseconds
     85          #endif
     86          
     87          #if !defined( EXTENDED_JOINING_RANDOM_MASK )
     88            #define EXTENDED_JOINING_RANDOM_MASK 0x007F
     89          #endif
     90          
     91          #if !defined( BEACON_REQUEST_DELAY )
     92            #define BEACON_REQUEST_DELAY        100   // in milliseconds
     93          #endif
     94          
     95          #if !defined( BEACON_REQ_DELAY_MASK )
     96            #define BEACON_REQ_DELAY_MASK       0x007F
     97          #endif
     98          
     99          #define MAX_RESUME_RETRY            3
    100          
    101          #define MAX_DEVICE_UNAUTH_TIMEOUT   5000  // 5 seconds
    102          
    103          // Beacon Order Settings (see NLMEDE.h)
    104          #define DEFAULT_BEACON_ORDER        BEACON_ORDER_NO_BEACONS
    105          #define DEFAULT_SUPERFRAME_ORDER    DEFAULT_BEACON_ORDER
    106          
    107          #if !defined( MAX_NWK_FRAMECOUNTER_CHANGES )
    108            // The number of times the frame counter can change before
    109            // saving to NV
    110            #define MAX_NWK_FRAMECOUNTER_CHANGES    1000
    111          #endif
    112          
    113          // Leave control bits
    114          #define ZDAPP_LEAVE_CTRL_INIT 0
    115          #define ZDAPP_LEAVE_CTRL_SET  1
    116          #define ZDAPP_LEAVE_CTRL_RA   2
    117          
    118          // Standard time to update NWK NV data
    119          #define ZDAPP_UPDATE_NWK_NV_TIME 700
    120          
    121          // Address Manager Stub Implementation
    122          #define ZDApp_NwkWriteNVRequest AddrMgrWriteNVRequest
    123          
    124          // Size of the ZDO callback function table zdoCBFunc[]
    125          #define MAX_ZDO_CB_FUNC 1
    126          
    127          
    128          /*********************************************************************
    129           * GLOBAL VARIABLES
    130           */
    131          
    132          #if defined( LCD_SUPPORTED )

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    133            uint8 MatchRsps = 0;
   \                     MatchRsps:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    134          #endif
    135          

   \                                 In  segment XDATA_I, align 1, keep-with-next
    136          uint8 zdoDiscCounter = 1;
   \                     zdoDiscCounter:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for zdoDiscCounter>`
   \   000001                REQUIRE __INIT_XDATA_I
    137          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    138          zAddrType_t ZDAppNwkAddr;
   \                     ZDAppNwkAddr:
   \   000000                DS 9
   \   000009                REQUIRE __INIT_XDATA_Z
    139          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    140          uint8 zdappMgmtNwkDiscRspTransSeq;
   \                     zdappMgmtNwkDiscRspTransSeq:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    141          uint8 zdappMgmtNwkDiscReqInProgress = FALSE;
   \                     zdappMgmtNwkDiscReqInProgress:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    142          zAddrType_t zdappMgmtNwkDiscRspAddr;
   \                     zdappMgmtNwkDiscRspAddr:
   \   000000                DS 9
   \   000009                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    143          uint8 zdappMgmtNwkDiscStartIndex;
   \                     zdappMgmtNwkDiscStartIndex:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    144          uint8 zdappMgmtSavedNwkState;
   \                     zdappMgmtSavedNwkState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    145          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    146          uint16 nwkFrameCounterChanges = 0;
   \                     nwkFrameCounterChanges:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_I, align 1, keep-with-next
    147          uint8 continueJoining = TRUE;
   \                     continueJoining:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for continueJoining>`
   \   000001                REQUIRE __INIT_XDATA_I
    148          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    149          uint8  _tmpRejoinState;
   \                     _tmpRejoinState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    150          
    151          // The extended PanID used in ZDO layer for rejoin.

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    152          uint8 ZDO_UseExtendedPANID[Z_EXTADDR_LEN];
   \                     ZDO_UseExtendedPANID:
   \   000000                DS 8
   \   000008                REQUIRE __INIT_XDATA_Z
    153          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    154          pfnZdoCb zdoCBFunc[MAX_ZDO_CB_FUNC];
   \                     zdoCBFunc:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z
    155          
    156          /*********************************************************************
    157           * EXTERNAL VARIABLES
    158           */
    159          
    160          /*********************************************************************
    161           * EXTERNAL FUNCTIONS
    162           */
    163          
    164          /*********************************************************************
    165           * LOCAL FUNCTIONS
    166           */
    167          
    168          void ZDApp_NetworkStartEvt( void );
    169          void ZDApp_DeviceAuthEvt( void );
    170          void ZDApp_SaveNetworkStateEvt( void );
    171          
    172          uint8 ZDApp_ReadNetworkRestoreState( void );
    173          uint8 ZDApp_RestoreNetworkState( void );
    174          void ZDAppDetermineDeviceType( void );
    175          void ZDApp_InitUserDesc( void );
    176          void ZDAppCheckForHoldKey( void );
    177          void ZDApp_ProcessOSALMsg( osal_event_hdr_t *msgPtr );
    178          void ZDApp_ProcessNetworkJoin( void );
    179          void ZDApp_SetCoordAddress( uint8 endPoint, uint8 dstEP );
    180          void ZDApp_SaveNwkKey( void );
    181          uint8 ZDApp_RestoreNwkKey( void );
    182            
    183          void ZDApp_SecInit( uint8 state );
    184          UINT16 ZDApp_ProcessSecEvent( uint8 task_id, UINT16 events );
    185          void ZDApp_ProcessSecMsg( osal_event_hdr_t *msgPtr );
    186          
    187          void ZDApp_SendMsg( uint8 taskID, uint8 cmd, uint8 len, uint8 *buf );
    188          
    189          void ZDApp_ResetTimerStart( uint16 delay );
    190          void ZDApp_ResetTimerCancel( void );
    191          void ZDApp_LeaveCtrlInit( void );
    192          void ZDApp_LeaveCtrlSet( uint8 ra );
    193          uint8 ZDApp_LeaveCtrlBypass( void );
    194          void ZDApp_LeaveCtrlStartup( devStates_t* state, uint16* startDelay );
    195          void ZDApp_LeaveReset( uint8 ra );
    196          void ZDApp_LeaveUpdate( uint16 nwkAddr, uint8* extAddr,
    197                                  uint8 removeChildren );
    198          void ZDApp_NodeProfileSync( ZDO_NetworkDiscoveryCfm_t* cfm );
    199          void ZDApp_ProcessMsgCBs( zdoIncomingMsg_t *inMsg );
    200          void ZDApp_RegisterCBs( void );
    201          
    202          /*********************************************************************
    203           * LOCAL VARIABLES
    204           */
    205          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    206          uint8 ZDAppTaskID;
   \                     ZDAppTaskID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    207          uint8 nwkStatus;
   \                     nwkStatus:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    208          endPointDesc_t *ZDApp_AutoFindMode_epDesc = (endPointDesc_t *)NULL;
   \                     ZDApp_AutoFindMode_epDesc:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    209          uint8 ZDApp_LeaveCtrl;
   \                     ZDApp_LeaveCtrl:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    210          
    211          #if defined( HOLD_AUTO_START )
    212            devStates_t devState = DEV_HOLD;
    213          #else

   \                                 In  segment XDATA_I, align 1, keep-with-next
    214            devStates_t devState = DEV_INIT;
   \                     devState:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for devState>`
   \   000001                REQUIRE __INIT_XDATA_I
    215          #endif
    216          
    217          #if ( ZG_BUILD_RTRONLY_TYPE ) || ( ZG_BUILD_ENDDEVICE_TYPE )

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    218            devStartModes_t devStartMode = MODE_JOIN;     // Assume joining
   \                     devStartMode:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    219            //devStartModes_t devStartMode = MODE_RESUME; // if already "directly joined"
    220                                  // to parent. Set to make the device do an Orphan scan.
    221          #else
    222            // Set the default to coodinator
    223            devStartModes_t devStartMode = MODE_HARD;
    224          #endif
    225          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    226          uint8 retryCnt;
   \                     retryCnt:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    227          

   \                                 In  segment XDATA_I, align 1, keep-with-next
    228          endPointDesc_t ZDApp_epDesc =
   \                     ZDApp_epDesc:
   \   000000                DS 6
   \   000006                REQUIRE `?<Initializer for ZDApp_epDesc>`
   \   000006                REQUIRE __INIT_XDATA_I
    229          {
    230            ZDO_EP,
    231            &ZDAppTaskID,
    232            (SimpleDescriptionFormat_t *)NULL,  // No Simple description for ZDO
    233            (afNetworkLatencyReq_t)0            // No Network Latency req
    234          };
    235          

   \                                 In  segment XDATA_I, align 1, keep-with-next
    236          uint16 ZDApp_SavedPollRate = POLL_RATE;
   \                     ZDApp_SavedPollRate:
   \   000000                DS 2
   \   000002                REQUIRE `?<Initializer for ZDApp_SavedPollRate>`
   \   000002                REQUIRE __INIT_XDATA_I
    237          
    238          /*********************************************************************
    239           * @fn      ZDApp_Init
    240           *
    241           * @brief   ZDApp Initialization function.
    242           *
    243           * @param   task_id - ZDApp Task ID
    244           *
    245           * @return  None
    246           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    247          void ZDApp_Init( uint8 task_id )
   \                     ZDApp_Init:
    248          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    249            // Save the task ID
    250            ZDAppTaskID = task_id;
   \   000004   E9           MOV     A,R1
   \   000005   90....       MOV     DPTR,#ZDAppTaskID
   \   000008   F0           MOVX    @DPTR,A
    251          
    252            // Initialize the ZDO global device short address storage
    253            ZDAppNwkAddr.addrMode = Addr16Bit;
   \   000009   7402         MOV     A,#0x2
   \   00000B   90....       MOV     DPTR,#(ZDAppNwkAddr + 8)
   \   00000E   F0           MOVX    @DPTR,A
    254            ZDAppNwkAddr.addr.shortAddr = INVALID_NODE_ADDR;
   \   00000F   90....       MOV     DPTR,#ZDAppNwkAddr
   \   000012   74FE         MOV     A,#-0x2
   \   000014   F0           MOVX    @DPTR,A
   \   000015   A3           INC     DPTR
   \   000016   74FF         MOV     A,#-0x1
   \   000018   F0           MOVX    @DPTR,A
    255            (void)NLME_GetExtAddr();  // Load the saveExtAddr pointer.
   \   000019                ; Setup parameters for call to function NLME_GetExtAddr
   \   000019   12....       LCALL   ??NLME_GetExtAddr?relay
    256          
    257            // Check for manual "Hold Auto Start"
    258            ZDAppCheckForHoldKey();
   \   00001C                ; Setup parameters for call to function ZDAppCheckForHoldKey
   \   00001C   12....       LCALL   ??ZDAppCheckForHoldKey?relay
    259          
    260            // Initialize ZDO items and setup the device - type of device to create.
    261            ZDO_Init();
   \   00001F                ; Setup parameters for call to function ZDO_Init
   \   00001F   12....       LCALL   ??ZDO_Init?relay
    262          
    263            // Register the endpoint description with the AF
    264            // This task doesn't have a Simple description, but we still need
    265            // to register the endpoint.
    266            afRegister( (endPointDesc_t *)&ZDApp_epDesc );
   \   000022                ; Setup parameters for call to function afRegister
   \   000022   7A..         MOV     R2,#(ZDApp_epDesc & 0xff)
   \   000024   7B..         MOV     R3,#((ZDApp_epDesc >> 8) & 0xff)
   \   000026   12....       LCALL   ??afRegister?relay
    267          
    268          #if defined( ZDO_USERDESC_RESPONSE )
    269            ZDApp_InitUserDesc();
    270          #endif // ZDO_USERDESC_RESPONSE
    271          
    272            // Start the device?
    273            if ( devState != DEV_HOLD )
   \   000029   90....       MOV     DPTR,#devState
   \   00002C   E0           MOVX    A,@DPTR
   \   00002D   6009         JZ      ??ZDApp_Init_0
    274            {
    275              ZDOInitDevice( 0 );
   \   00002F                ; Setup parameters for call to function ZDOInitDevice
   \   00002F   7A00         MOV     R2,#0x0
   \   000031   7B00         MOV     R3,#0x0
   \   000033   12....       LCALL   ??ZDOInitDevice?relay
   \   000036   800D         SJMP    ??ZDApp_Init_1
    276            }
    277            else
    278            {
    279              // Blink LED to indicate HOLD_START
    280              HalLedBlink ( HAL_LED_4, 0, 50, 500 );
   \                     ??ZDApp_Init_0:
   \   000038                ; Setup parameters for call to function HalLedBlink
   \   000038   7CF4         MOV     R4,#-0xc
   \   00003A   7D01         MOV     R5,#0x1
   \   00003C   7B32         MOV     R3,#0x32
   \   00003E   7A00         MOV     R2,#0x0
   \   000040   7908         MOV     R1,#0x8
   \   000042   12....       LCALL   ??HalLedBlink?relay
    281            }
    282            
    283            ZDApp_RegisterCBs();
   \                     ??ZDApp_Init_1:
   \   000045                ; Setup parameters for call to function ZDApp_RegisterCBs
   \   000045   12....       LCALL   ??ZDApp_RegisterCBs?relay
    284          } /* ZDApp_Init() */
   \   000048   02....       LJMP    ??Subroutine31_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine31_0:
   \   000000   D083         POP     DPH
   \   000002   D082         POP     DPL
   \   000004   02....       LJMP    ?BRET
    285          
    286          /*********************************************************************
    287           * @fn          ZDApp_SecInit
    288           *
    289           * @brief       ZDApp initialize security.
    290           *
    291           * @param       state - device initialization state
    292           *
    293           * @return      none
    294           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    295          void ZDApp_SecInit( uint8 state )
   \                     ZDApp_SecInit:
    296          {  
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    297            if ( ZG_SECURE_ENABLED && ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE )
    298            {
    299              // Set the Trust Center bit
    300              ZDO_Config_Node_Descriptor.ServerMask |= PRIM_TRUST_CENTER;
    301            }
    302          
    303            if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
    304            {
    305              ZDO_Config_Node_Descriptor.CapabilityFlags |= CAPINFO_SECURITY_CAPABLE;
    306            }
    307              
    308            // Initialize ZigBee Device Security Manager
    309            ZDSecMgrInit(state);
   \   000004                ; Setup parameters for call to function ZDSecMgrInit
   \   000004   12....       LCALL   ??ZDSecMgrInit?relay
    310          
    311            if ( ZG_SECURE_ENABLED )
    312            {
    313              if ( state != ZDO_INITDEV_RESTORED_NETWORK_STATE )
    314              {
    315                nwkFrameCounter = 0;
    316            
    317                if( _NIB.nwkKeyLoaded == FALSE )
    318                {
    319                  if ( ( ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE          ) ||
    320                       ( ( zgSecurityMode == ZG_SECURITY_RESIDENTIAL ) && zgPreConfigKeys )    )
    321                  {
    322                      SSP_UpdateNwkKey( (byte*)zgPreConfigKey, 0);
    323                      SSP_SwitchNwkKey( 0 );
    324                  }
    325                }
    326              }
    327            }    
    328          }
   \   000007   02....       LJMP    ??Subroutine31_0 & 0xFFFF
    329          
    330          /*********************************************************************
    331           * @fn      ZDApp_event_loop()
    332           *
    333           * @brief   Main event loop for Zigbee device objects task. This function
    334           *          should be called at periodic intervals.
    335           *
    336           * @param   task_id - Task ID
    337           * @param   events  - Bitmap of events
    338           *
    339           * @return  none
    340           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    341          UINT16 ZDApp_event_loop( uint8 task_id, UINT16 events )
   \                     ZDApp_event_loop:
    342          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    343            uint8 *msg_ptr;
    344          
    345            if ( events & SYS_EVENT_MSG )
   \   000009   7480         MOV     A,#-0x80
   \   00000B   5F           ANL     A,R7
   \   00000C   F9           MOV     R1,A
   \   00000D   E4           CLR     A
   \   00000E   7001         JNZ     ??ZDApp_event_loop_0
   \   000010   E9           MOV     A,R1
   \                     ??ZDApp_event_loop_0:
   \   000011   7031         JNZ     ??ZDApp_event_loop_1
    346            {
    347              while ( (msg_ptr = osal_msg_receive( ZDAppTaskID )) )
    348              {
    349                ZDApp_ProcessOSALMsg( (osal_event_hdr_t *)msg_ptr );
    350          
    351                // Release the memory
    352                
    353                osal_msg_deallocate( msg_ptr );
    354              }
    355          
    356              // Return unprocessed events
    357              return (events ^ SYS_EVENT_MSG);
    358            }
    359          
    360            if ( events & ZDO_NETWORK_INIT )
   \   000013   EE           MOV     A,R6
   \   000014   A2E0         MOV     C,0xE0 /* A   */.0
   \   000016   5045         JNC     ??ZDApp_event_loop_2
    361            {
    362              // Initialize apps and start the network
    363              devState = DEV_INIT;
   \   000018   7401         MOV     A,#0x1
   \   00001A   90....       MOV     DPTR,#devState
   \   00001D   F0           MOVX    @DPTR,A
    364              
    365              ZDO_StartDevice( (uint8)ZDO_Config_Node_Descriptor.LogicalType, devStartMode,
    366                               DEFAULT_BEACON_ORDER, DEFAULT_SUPERFRAME_ORDER );
   \   00001E                ; Setup parameters for call to function ZDO_StartDevice
   \   00001E   7C0F         MOV     R4,#0xf
   \   000020   7B0F         MOV     R3,#0xf
   \   000022   90....       MOV     DPTR,#devStartMode
   \   000025   E0           MOVX    A,@DPTR
   \   000026   FA           MOV     R2,A
   \   000027   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   00002A   E0           MOVX    A,@DPTR
   \   00002B   5407         ANL     A,#0x7
   \   00002D   F9           MOV     R1,A
   \   00002E   12....       LCALL   ??ZDO_StartDevice?relay
    367          
    368              // Return unprocessed events
    369              return (events ^ ZDO_NETWORK_INIT);
   \   000031   7401         MOV     A,#0x1
   \                     ??ZDApp_event_loop_3:
   \   000033   6E           XRL     A,R6
   \   000034   FA           MOV     R2,A
   \   000035   EF           MOV     A,R7
   \                     ??ZDApp_event_loop_4:
   \   000036   FB           MOV     R3,A
   \   000037   02....       LJMP    ??ZDApp_event_loop_5 & 0xFFFF
    370            }
   \                     ??ZDApp_event_loop_6:
   \   00003A                ; Setup parameters for call to function ZDApp_ProcessOSALMsg
   \   00003A   12....       LCALL   ??ZDApp_ProcessOSALMsg?relay
   \   00003D                ; Setup parameters for call to function osal_msg_deallocate
   \   00003D   AA..         MOV     R2,?V0 + 0
   \   00003F   AB..         MOV     R3,?V0 + 1
   \   000041   12....       LCALL   ??osal_msg_deallocate?relay
   \                     ??ZDApp_event_loop_1:
   \   000044                ; Setup parameters for call to function osal_msg_receive
   \   000044   90....       MOV     DPTR,#ZDAppTaskID
   \   000047   E0           MOVX    A,@DPTR
   \   000048   F9           MOV     R1,A
   \   000049   12....       LCALL   ??osal_msg_receive?relay
   \   00004C   8A..         MOV     ?V0 + 0,R2
   \   00004E   8B..         MOV     ?V0 + 1,R3
   \   000050   EA           MOV     A,R2
   \   000051   7001         JNZ     ??ZDApp_event_loop_7
   \   000053   EB           MOV     A,R3
   \                     ??ZDApp_event_loop_7:
   \   000054   70E4         JNZ     ??ZDApp_event_loop_6
   \   000056   EE           MOV     A,R6
   \   000057   FA           MOV     R2,A
   \   000058   7480         MOV     A,#-0x80
   \                     ??ZDApp_event_loop_8:
   \   00005A   6F           XRL     A,R7
   \   00005B   80D9         SJMP    ??ZDApp_event_loop_4
    371          
    372            if ( ZSTACK_ROUTER_BUILD )
    373            {
    374              if ( events & ZDO_NETWORK_START )
   \                     ??ZDApp_event_loop_2:
   \   00005D   5402         ANL     A,#0x2
   \   00005F   6007         JZ      ??ZDApp_event_loop_9
    375              {
    376                ZDApp_NetworkStartEvt();
   \   000061                ; Setup parameters for call to function ZDApp_NetworkStartEvt
   \   000061   12....       LCALL   ??ZDApp_NetworkStartEvt?relay
    377            
    378                // Return unprocessed events
    379                return (events ^ ZDO_NETWORK_START);
   \   000064   7402         MOV     A,#0x2
   \   000066   80CB         SJMP    ??ZDApp_event_loop_3
    380              }
    381          
    382              if ( events & ZDO_ROUTER_START )
   \                     ??ZDApp_event_loop_9:
   \   000068   EE           MOV     A,R6
   \   000069   5420         ANL     A,#0x20
   \   00006B   601D         JZ      ??ZDApp_event_loop_10
    383              {
    384                if ( nwkStatus == ZSuccess )
   \   00006D   90....       MOV     DPTR,#nwkStatus
   \   000070   E0           MOVX    A,@DPTR
   \   000071   7010         JNZ     ??ZDApp_event_loop_11
    385                {
    386                  if ( devState == DEV_END_DEVICE )
   \   000073   90....       MOV     DPTR,#devState
   \   000076   E0           MOVX    A,@DPTR
   \   000077   6406         XRL     A,#0x6
   \   000079   7003         JNZ     ??ZDApp_event_loop_12
    387                    devState = DEV_ROUTER;
   \   00007B   7407         MOV     A,#0x7
   \   00007D   F0           MOVX    @DPTR,A
    388            
    389                  osal_pwrmgr_device( PWRMGR_ALWAYS_ON );
   \                     ??ZDApp_event_loop_12:
   \   00007E                ; Setup parameters for call to function osal_pwrmgr_device
   \   00007E   7900         MOV     R1,#0x0
   \   000080   12....       LCALL   ??osal_pwrmgr_device?relay
    390                }
    391                else
    392                {
    393                  // remain as end device!!
    394                }
    395                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \                     ??ZDApp_event_loop_11:
   \   000083                ; Setup parameters for call to function osal_set_event
   \   000083   12....       LCALL   ?Subroutine4 & 0xFFFF
    396            
    397                // Return unprocessed events
    398                return (events ^ ZDO_ROUTER_START);
   \                     ??CrossCallReturnLabel_26:
   \   000086   7420         MOV     A,#0x20
   \   000088   80A9         SJMP    ??ZDApp_event_loop_3
    399              }
    400            }
    401            
    402            if ( events & ZDO_STATE_CHANGE_EVT )
   \                     ??ZDApp_event_loop_10:
   \   00008A   EE           MOV     A,R6
   \   00008B   5410         ANL     A,#0x10
   \   00008D   6022         JZ      ??ZDApp_event_loop_13
    403            {
    404              ZDO_UpdateNwkStatus( devState );
   \   00008F                ; Setup parameters for call to function ZDO_UpdateNwkStatus
   \   00008F   90....       MOV     DPTR,#devState
   \   000092   E0           MOVX    A,@DPTR
   \   000093   F9           MOV     R1,A
   \   000094   12....       LCALL   ??ZDO_UpdateNwkStatus?relay
    405              
    406              // At start up, do one MTO route discovery if the device is a concentrator
    407              if ( zgConcentratorEnable == TRUE ) 
   \   000097   90....       MOV     DPTR,#zgConcentratorEnable
   \   00009A   E0           MOVX    A,@DPTR
   \   00009B   6401         XRL     A,#0x1
   \   00009D   700E         JNZ     ??CrossCallReturnLabel_47
    408              {
    409                // Start next event
    410                osal_start_timerEx( NWK_TaskID, NWK_MTO_RTG_REQ_EVT, 100 );
   \   00009F                ; Setup parameters for call to function osal_start_timerEx
   \   00009F   7C64         MOV     R4,#0x64
   \   0000A1   7D00         MOV     R5,#0x0
   \   0000A3   7A00         MOV     R2,#0x0
   \   0000A5   7B08         MOV     R3,#0x8
   \   0000A7   90....       MOV     DPTR,#NWK_TaskID
   \   0000AA   12....       LCALL   ??Subroutine30_0 & 0xFFFF
    411              }
    412              
    413              // Return unprocessed events
    414              return (events ^ ZDO_STATE_CHANGE_EVT);
   \                     ??CrossCallReturnLabel_47:
   \   0000AD   7410         MOV     A,#0x10
   \   0000AF   8082         SJMP    ??ZDApp_event_loop_3
    415            }
    416          
    417            if ( events & ZDO_COMMAND_CNF )
   \                     ??ZDApp_event_loop_13:
   \   0000B1   EE           MOV     A,R6
   \   0000B2   5408         ANL     A,#0x8
   \   0000B4   6006         JZ      ??ZDApp_event_loop_14
    418            {
    419              // User defined logic
    420          
    421              // Return unprocessed events
    422              return (events ^ ZDO_COMMAND_CNF);
   \   0000B6   7408         MOV     A,#0x8
   \   0000B8   6E           XRL     A,R6
   \   0000B9   FA           MOV     R2,A
   \   0000BA   8021         SJMP    ??ZDApp_event_loop_5
    423            }
    424            
    425            if ( events & ZDO_NWK_UPDATE_NV )
   \                     ??ZDApp_event_loop_14:
   \   0000BC   7402         MOV     A,#0x2
   \   0000BE   5F           ANL     A,R7
   \   0000BF   F9           MOV     R1,A
   \   0000C0   E4           CLR     A
   \   0000C1   7001         JNZ     ??ZDApp_event_loop_15
   \   0000C3   E9           MOV     A,R1
   \                     ??ZDApp_event_loop_15:
   \   0000C4   6004         JZ      ??ZDApp_event_loop_16
    426            {
    427              ZDApp_SaveNetworkStateEvt();
    428          
    429              // Return unprocessed events
    430              return (events ^ ZDO_NWK_UPDATE_NV);
   \   0000C6   7402         MOV     A,#0x2
   \   0000C8   8090         SJMP    ??ZDApp_event_loop_8
    431            }
    432          
    433            if ( events & ZDO_DEVICE_RESET )
   \                     ??ZDApp_event_loop_16:
   \   0000CA   EE           MOV     A,R6
   \   0000CB   5404         ANL     A,#0x4
   \   0000CD   600A         JZ      ??ZDApp_event_loop_17
    434            {
    435              // The device has been in the UNAUTH state, so reset
    436              // Note: there will be no return from this call
    437              SystemReset();
   \   0000CF   C2AF         CLR     0xa8.7
   \   0000D1   75C9AB       MOV     0xc9,#-0x55
   \   0000D4   75C95B       MOV     0xc9,#0x5b
   \                     ??ZDApp_event_loop_18:
   \   0000D7   80FE         SJMP    ??ZDApp_event_loop_18
    438            }
    439          
    440            if ( ZG_SECURE_ENABLED )
    441            {
    442              return ( ZDApp_ProcessSecEvent( task_id, events ) );
    443            }
    444            else
    445            {
    446              // Discard or make more handlers
    447              return 0;
   \                     ??ZDApp_event_loop_17:
   \   0000D9   7A00         MOV     R2,#0x0
   \   0000DB   7B00         MOV     R3,#0x0
    448            }
   \                     ??ZDApp_event_loop_5:
   \   0000DD   80..         SJMP    ??Subroutine27_0
   \   0000DF                REQUIRE _A_IEN0
   \   0000DF                REQUIRE WDCTL
    449          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine27_0:
   \   000000   7F02         MOV     R7,#0x2
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine4:
   \   000000   7A10         MOV     R2,#0x10
   \   000002                REQUIRE ?Subroutine21
   \   000002                ; // Fall through to label ?Subroutine21

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine21:
   \   000000   7B00         MOV     R3,#0x0
   \   000002   90....       MOV     DPTR,#ZDAppTaskID
   \   000005   E0           MOVX    A,@DPTR
   \   000006   F9           MOV     R1,A
   \   000007   12....       LCALL   ??osal_set_event?relay
   \   00000A   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine30_0:
   \   000000   E0           MOVX    A,@DPTR
   \   000001   F9           MOV     R1,A
   \   000002   12....       LCALL   ??osal_start_timerEx?relay
   \   000005   22           RET
    450          
    451          /*********************************************************************
    452           * @fn      ZDApp_ProcessSecEvent()
    453           *
    454           * @brief   Process incoming security events.
    455           *
    456           * @param   task_id - Task ID
    457           * @param   events  - Bitmap of events
    458           *
    459           * @return  none
    460           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    461          UINT16 ZDApp_ProcessSecEvent( uint8 task_id, UINT16 events )
   \                     ZDApp_ProcessSecEvent:
    462          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    463            (void)task_id;  // Intentionally unreferenced parameter
    464            
    465            if ( ZSTACK_ROUTER_BUILD )
    466            {
    467              if ( events & ZDO_NEW_DEVICE )
   \   000009   EE           MOV     A,R6
   \   00000A   5440         ANL     A,#0x40
   \   00000C   6019         JZ      ??ZDApp_ProcessSecEvent_0
    468              {
    469                // process the new device event
    470                if ( ZDSecMgrNewDeviceEvent() == TRUE )
   \   00000E                ; Setup parameters for call to function ZDSecMgrNewDeviceEvent
   \   00000E   12....       LCALL   ??ZDSecMgrNewDeviceEvent?relay
   \   000011   E9           MOV     A,R1
   \   000012   6401         XRL     A,#0x1
   \   000014   7009         JNZ     ??CrossCallReturnLabel_44
    471                {
    472                  osal_start_timerEx( ZDAppTaskID, ZDO_NEW_DEVICE, 1000 );
   \   000016                ; Setup parameters for call to function osal_start_timerEx
   \   000016   7CE8         MOV     R4,#-0x18
   \   000018   7D03         MOV     R5,#0x3
   \   00001A   7A40         MOV     R2,#0x40
   \   00001C   12....       LCALL   ?Subroutine6 & 0xFFFF
    473                }
    474          
    475                // Return unprocessed events
    476                return (events ^ ZDO_NEW_DEVICE);
   \                     ??CrossCallReturnLabel_44:
   \   00001F   7440         MOV     A,#0x40
   \                     ??ZDApp_ProcessSecEvent_1:
   \   000021   6E           XRL     A,R6
   \   000022   FA           MOV     R2,A
   \   000023   EF           MOV     A,R7
   \   000024   FB           MOV     R3,A
   \   000025   8043         SJMP    ??ZDApp_ProcessSecEvent_2
    477              }
    478            }
    479          
    480            if ( (ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH) 
    481                || (ZG_CHECK_SECURITY_MODE == ZG_SECURITY_SE_STANDARD) )
    482            {
    483              if ( ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE )
    484              { 
    485                if ( events & ZDO_SECMGR_EVENT )
    486                {
    487                  ZDSecMgrEvent();
    488          
    489                  // Return unprocessed events
    490                  return (events ^ ZDO_SECMGR_EVENT);
    491                }
    492              }
    493            }
    494            
    495            if ( events & ZDO_DEVICE_AUTH )
   \                     ??ZDApp_ProcessSecEvent_0:
   \   000027   EE           MOV     A,R6
   \   000028   5480         ANL     A,#0x80
   \   00002A   6007         JZ      ??ZDApp_ProcessSecEvent_3
    496            {
    497              ZDApp_DeviceAuthEvt();
   \   00002C                ; Setup parameters for call to function ZDApp_DeviceAuthEvt
   \   00002C   12....       LCALL   ??ZDApp_DeviceAuthEvt?relay
    498          
    499              // Return unprocessed events
    500              return (events ^ ZDO_DEVICE_AUTH);
   \   00002F   7480         MOV     A,#-0x80
   \   000031   80EE         SJMP    ??ZDApp_ProcessSecEvent_1
    501            }
    502          
    503            if ( events & ZDO_FRAMECOUNTER_CHANGE )
   \                     ??ZDApp_ProcessSecEvent_3:
   \   000033   7404         MOV     A,#0x4
   \   000035   5F           ANL     A,R7
   \   000036   F9           MOV     R1,A
   \   000037   E4           CLR     A
   \   000038   7001         JNZ     ??ZDApp_ProcessSecEvent_4
   \   00003A   E9           MOV     A,R1
   \                     ??ZDApp_ProcessSecEvent_4:
   \   00003B   6029         JZ      ??ZDApp_ProcessSecEvent_5
    504            {
    505              if ( nwkFrameCounterChanges++ > MAX_NWK_FRAMECOUNTER_CHANGES )
   \   00003D   90....       MOV     DPTR,#nwkFrameCounterChanges
   \   000040   E0           MOVX    A,@DPTR
   \   000041   F8           MOV     R0,A
   \   000042   A3           INC     DPTR
   \   000043   E0           MOVX    A,@DPTR
   \   000044   F9           MOV     R1,A
   \   000045   7401         MOV     A,#0x1
   \   000047   28           ADD     A,R0
   \   000048   FA           MOV     R2,A
   \   000049   E4           CLR     A
   \   00004A   39           ADDC    A,R1
   \   00004B   FB           MOV     R3,A
   \   00004C   90....       MOV     DPTR,#nwkFrameCounterChanges
   \   00004F   12....       LCALL   ??Subroutine33_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_55:
   \   000052   C3           CLR     C
   \   000053   E8           MOV     A,R0
   \   000054   94E9         SUBB    A,#-0x17
   \   000056   E9           MOV     A,R1
   \   000057   9403         SUBB    A,#0x3
   \   000059   4003         JC      ??ZDApp_ProcessSecEvent_6
    506                ZDApp_SaveNwkKey();
   \   00005B                ; Setup parameters for call to function ZDApp_SaveNwkKey
   \   00005B   12....       LCALL   ??ZDApp_SaveNwkKey?relay
    507          
    508              // Return unprocessed events
    509              return (events ^ ZDO_FRAMECOUNTER_CHANGE);
   \                     ??ZDApp_ProcessSecEvent_6:
   \   00005E   EE           MOV     A,R6
   \   00005F   FA           MOV     R2,A
   \   000060   7404         MOV     A,#0x4
   \   000062   6F           XRL     A,R7
   \   000063   FB           MOV     R3,A
   \   000064   8004         SJMP    ??ZDApp_ProcessSecEvent_2
    510            }
    511            
    512            // Discard or make more handlers
    513            return 0;
   \                     ??ZDApp_ProcessSecEvent_5:
   \   000066   7A00         MOV     R2,#0x0
   \   000068   7B00         MOV     R3,#0x0
   \                     ??ZDApp_ProcessSecEvent_2:
   \   00006A                REQUIRE ?Subroutine22
   \   00006A                ; // Fall through to label ?Subroutine22
    514          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine22:
   \   000000   7F01         MOV     R7,#0x1
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine6:
   \   000000   7B00         MOV     R3,#0x0
   \   000002   90....       MOV     DPTR,#ZDAppTaskID
   \   000005                REQUIRE ??Subroutine30_0
   \   000005                ; // Fall through to label ??Subroutine30_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine33_0:
   \   000000   EA           MOV     A,R2
   \   000001   F0           MOVX    @DPTR,A
   \   000002   A3           INC     DPTR
   \   000003   EB           MOV     A,R3
   \   000004   F0           MOVX    @DPTR,A
   \   000005   22           RET
    515          
    516          /*********************************************************************
    517           * Application Functions
    518           */
    519          
    520          /*********************************************************************
    521           * @fn      ZDOInitDevice
    522           *
    523           * @brief   Start the device in the network.  This function will read
    524           *   ZCD_NV_STARTUP_OPTION (NV item) to determine whether or not to
    525           *   restore the network state of the device.
    526           *
    527           * @param   startDelay - timeDelay to start device (in milliseconds).
    528           *      There is a jitter added to this delay:
    529           *              ((NWK_START_DELAY + startDelay)
    530           *              + (osal_rand() & EXTENDED_JOINING_RANDOM_MASK))
    531           *
    532           * NOTE:    If the application would like to force a "new" join, the
    533           *          application should set the ZCD_STARTOPT_DEFAULT_NETWORK_STATE
    534           *          bit in the ZCD_NV_STARTUP_OPTION NV item before calling
    535           *          this function. "new" join means to not restore the network
    536           *          state of the device. Use zgWriteStartupOptions() to set these
    537           *          options.
    538           *
    539           * @return
    540           *    ZDO_INITDEV_RESTORED_NETWORK_STATE  - The device's network state was
    541           *          restored.
    542           *    ZDO_INITDEV_NEW_NETWORK_STATE - The network state was initialized.
    543           *          This could mean that ZCD_NV_STARTUP_OPTION said to not restore, or
    544           *          it could mean that there was no network state to restore.
    545           *    ZDO_INITDEV_LEAVE_NOT_STARTED - Before the reset, a network leave was issued
    546           *          with the rejoin option set to TRUE.  So, the device was not
    547           *          started in the network (one time only).  The next time this
    548           *          function is called it will start.
    549           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine20:
   \   000000   7402         MOV     A,#0x2
   \   000002                REQUIRE ??Subroutine26_0
   \   000002                ; // Fall through to label ??Subroutine26_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine26_0:
   \   000000   12....       LCALL   ?DEALLOC_XSTACK8
   \   000003                REQUIRE ??Subroutine27_0
   \   000003                ; // Fall through to label ??Subroutine27_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    550          uint8 ZDOInitDevice( uint16 startDelay )
   \                     ZDOInitDevice:
    551          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 2
   \   000005   74FE         MOV     A,#-0x2
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   12....       LCALL   ?Subroutine3 & 0xFFFF
    552            uint8 networkStateNV = ZDO_INITDEV_NEW_NETWORK_STATE;
    553            uint16 extendedDelay = 0;
    554          
    555            if ( devState == DEV_HOLD )
   \                     ??CrossCallReturnLabel_59:
   \   00000D   90....       MOV     DPTR,#devState
   \   000010   E0           MOVX    A,@DPTR
   \   000011   7005         JNZ     ??ZDOInitDevice_0
    556            {    
    557              // Initialize the RAM items table, in case an NV item has been updated.
    558              zgInitItems( FALSE );
   \   000013                ; Setup parameters for call to function zgInitItems
   \   000013   7900         MOV     R1,#0x0
   \   000015   12....       LCALL   ??zgInitItems?relay
    559            }
    560          
    561            ZDConfig_InitDescriptors();
   \                     ??ZDOInitDevice_0:
   \   000018                ; Setup parameters for call to function ZDConfig_InitDescriptors
   \   000018   12....       LCALL   ??ZDConfig_InitDescriptors?relay
    562            //devtag.071807.todo - fix this temporary solution
    563            _NIB.CapabilityInfo = ZDO_Config_Node_Descriptor.CapabilityFlags;
   \   00001B   90....       MOV     DPTR,#(ZDO_Config_Node_Descriptor + 2)
   \   00001E   E0           MOVX    A,@DPTR
   \   00001F   90....       MOV     DPTR,#(_NIB + 14)
   \   000022   F0           MOVX    @DPTR,A
    564            
    565            devState = DEV_INIT;    // Remove the Hold state
   \   000023   7401         MOV     A,#0x1
   \   000025   90....       MOV     DPTR,#devState
   \   000028   F0           MOVX    @DPTR,A
    566          
    567            // Initialize leave control logic
    568            ZDApp_LeaveCtrlInit();
   \   000029                ; Setup parameters for call to function ZDApp_LeaveCtrlInit
   \   000029   12....       LCALL   ??ZDApp_LeaveCtrlInit?relay
    569          
    570            // Check leave control reset settings
    571            ZDApp_LeaveCtrlStartup( &devState, &startDelay );
   \   00002C                ; Setup parameters for call to function ZDApp_LeaveCtrlStartup
   \   00002C   85..82       MOV     DPL,?XSP + 0
   \   00002F   85..83       MOV     DPH,?XSP + 1
   \   000032   AC82         MOV     R4,DPL
   \   000034   AD83         MOV     R5,DPH
   \   000036   7A..         MOV     R2,#(devState & 0xff)
   \   000038   7B..         MOV     R3,#((devState >> 8) & 0xff)
   \   00003A   12....       LCALL   ??ZDApp_LeaveCtrlStartup?relay
    572          
    573            // Leave may make the hold state come back
    574            if ( devState == DEV_HOLD )
   \   00003D   90....       MOV     DPTR,#devState
   \   000040   E0           MOVX    A,@DPTR
   \   000041   700E         JNZ     ??ZDOInitDevice_1
    575            {
    576              // Set the NV startup option to force a "new" join.
    577              zgWriteStartupOptions( ZG_STARTUP_SET, ZCD_STARTOPT_DEFAULT_NETWORK_STATE );
   \   000043                ; Setup parameters for call to function zgWriteStartupOptions
   \   000043   7A02         MOV     R2,#0x2
   \   000045   79FF         MOV     R1,#-0x1
   \   000047   12....       LCALL   ??zgWriteStartupOptions?relay
    578          
    579              // Notify the applications 
    580              osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   00004A                ; Setup parameters for call to function osal_set_event
   \   00004A   12....       LCALL   ?Subroutine4 & 0xFFFF
    581              
    582              return ( ZDO_INITDEV_LEAVE_NOT_STARTED );   // Don't join - (one time).
   \                     ??CrossCallReturnLabel_27:
   \   00004D   7902         MOV     R1,#0x2
   \   00004F   8039         SJMP    ??ZDOInitDevice_2
    583            }
    584          
    585          #if defined ( NV_RESTORE )
    586            // Get Keypad directly to see if a reset nv is needed.
    587            // Hold down the SW_BYPASS_NV key (defined in OnBoard.h)
    588            // while booting to skip past NV Restore.
    589            if ( HalKeyRead() == SW_BYPASS_NV )
    590              networkStateNV = ZDO_INITDEV_NEW_NETWORK_STATE;
    591            else
    592            {
    593              // Determine if NV should be restored
    594              networkStateNV = ZDApp_ReadNetworkRestoreState();
    595            }
    596          
    597            if ( networkStateNV == ZDO_INITDEV_RESTORED_NETWORK_STATE )
    598            {
    599              networkStateNV = ZDApp_RestoreNetworkState();
    600            }
    601            else
    602            {
    603              // Wipe out the network state in NV
    604              NLME_InitNV();
    605              NLME_SetDefaultNV();
    606            }
    607          #endif
    608          
    609            if ( networkStateNV == ZDO_INITDEV_NEW_NETWORK_STATE )
    610            {
    611              ZDAppDetermineDeviceType();
   \                     ??ZDOInitDevice_1:
   \   000051                ; Setup parameters for call to function ZDAppDetermineDeviceType
   \   000051   12....       LCALL   ??ZDAppDetermineDeviceType?relay
    612          
    613              // Only delay if joining network - not restoring network state
    614              extendedDelay = (uint16)((NWK_START_DELAY + startDelay)
    615                        + (osal_rand() & EXTENDED_JOINING_RANDOM_MASK));
   \   000054                ; Setup parameters for call to function osal_rand
   \   000054   12....       LCALL   ??osal_rand?relay
   \   000057   8A..         MOV     ?V0 + 0,R2
   \   000059   A8..         MOV     R0,?V0 + 0
   \   00005B   85..82       MOV     DPL,?XSP + 0
   \   00005E   85..83       MOV     DPH,?XSP + 1
   \   000061   747F         MOV     A,#0x7f
   \   000063   58           ANL     A,R0
   \   000064   F8           MOV     R0,A
   \   000065   E0           MOVX    A,@DPTR
   \   000066   28           ADD     A,R0
   \   000067   F8           MOV     R0,A
   \   000068   A3           INC     DPTR
   \   000069   E0           MOVX    A,@DPTR
   \   00006A   3400         ADDC    A,#0x0
   \   00006C   F9           MOV     R1,A
   \   00006D   7464         MOV     A,#0x64
   \   00006F   28           ADD     A,R0
   \   000070   FE           MOV     R6,A
   \   000071   E4           CLR     A
   \   000072   39           ADDC    A,R1
   \   000073   FF           MOV     R7,A
    616            }
    617          
    618            // Initialize the security for type of device
    619            ZDApp_SecInit( networkStateNV );
   \   000074                ; Setup parameters for call to function ZDSecMgrInit
   \   000074   7901         MOV     R1,#0x1
   \   000076   12....       LCALL   ??ZDSecMgrInit?relay
    620            
    621            // Trigger the network start
    622            ZDApp_NetworkInit( extendedDelay );
   \   000079                ; Setup parameters for call to function ZDApp_NetworkInit
   \   000079   EE           MOV     A,R6
   \   00007A   FA           MOV     R2,A
   \   00007B   EF           MOV     A,R7
   \   00007C   FB           MOV     R3,A
   \   00007D   12....       LCALL   ??ZDApp_NetworkInit?relay
    623          
    624            // set broadcast address mask to support broadcast filtering
    625            NLME_SetBroadcastFilter( ZDO_Config_Node_Descriptor.CapabilityFlags );
   \   000080                ; Setup parameters for call to function NLME_SetBroadcastFilter
   \   000080   90....       MOV     DPTR,#(ZDO_Config_Node_Descriptor + 2)
   \   000083   E0           MOVX    A,@DPTR
   \   000084   F9           MOV     R1,A
   \   000085   12....       LCALL   ??NLME_SetBroadcastFilter?relay
    626            
    627            return ( networkStateNV );
   \   000088   7901         MOV     R1,#0x1
   \                     ??ZDOInitDevice_2:
   \   00008A   02....       LJMP    ?Subroutine20 & 0xFFFF
    628          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine3:
   \   000000   85..82       MOV     DPL,?XSP + 0
   \   000003   85..83       MOV     DPH,?XSP + 1
   \   000006                REQUIRE ??Subroutine33_0
   \   000006                ; // Fall through to label ??Subroutine33_0
    629          
    630          /*********************************************************************
    631           * @fn      ZDApp_ReadNetworkRestoreState
    632           *
    633           * @brief   Read the ZCD_NV_STARTUP_OPTION NV Item to state whether
    634           *          or not to restore the network state.
    635           *          If the read value has the ZCD_STARTOPT_DEFAULT_NETWORK_STATE
    636           *          bit set return the ZDO_INITDEV_NEW_NETWORK_STATE.
    637           *
    638           * @param   none
    639           *
    640           * @return  ZDO_INITDEV_NEW_NETWORK_STATE
    641           *          or ZDO_INITDEV_RESTORED_NETWORK_STATE based on whether or
    642           *          not ZCD_STARTOPT_DEFAULT_NETWORK_STATE bit is set in
    643           *          ZCD_NV_STARTUP_OPTION
    644           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    645          uint8 ZDApp_ReadNetworkRestoreState( void )
   \                     ZDApp_ReadNetworkRestoreState:
    646          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    647            uint8 networkStateNV = ZDO_INITDEV_RESTORED_NETWORK_STATE;
   \   000005   7E00         MOV     R6,#0x0
    648          
    649            // Look for the New Network State option.
    650            if ( zgReadStartupOptions() & ZCD_STARTOPT_DEFAULT_NETWORK_STATE )
   \   000007                ; Setup parameters for call to function zgReadStartupOptions
   \   000007   12....       LCALL   ??zgReadStartupOptions?relay
   \   00000A   E9           MOV     A,R1
   \   00000B   A2E1         MOV     C,0xE0 /* A   */.1
   \   00000D   5001         JNC     ??ZDApp_ReadNetworkRestoreState_0
    651            {
    652              networkStateNV = ZDO_INITDEV_NEW_NETWORK_STATE;
   \   00000F   0E           INC     R6
    653            }
    654          
    655            return ( networkStateNV );
   \                     ??ZDApp_ReadNetworkRestoreState_0:
   \   000010   EE           MOV     A,R6
   \   000011   F9           MOV     R1,A
   \   000012   02....       LJMP    ?Subroutine22 & 0xFFFF
    656          }
    657          
    658          /*********************************************************************
    659           * @fn      ZDAppDetermineDeviceType()
    660           *
    661           * @brief   Determines the type of device to start. 
    662           *
    663           *          Looks at zgDeviceLogicalType and determines what type of
    664           *          device to start.  The types are:
    665           *            ZG_DEVICETYPE_COORDINATOR
    666           *            ZG_DEVICETYPE_ROUTER
    667           *            ZG_DEVICETYPE_ENDDEVICE
    668           *
    669           * @param   none
    670           *
    671           * @return  none
    672           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    673          void ZDAppDetermineDeviceType( void )
   \                     ZDAppDetermineDeviceType:
    674          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    675            if ( zgDeviceLogicalType == ZG_DEVICETYPE_COORDINATOR )
   \   000004   90....       MOV     DPTR,#zgDeviceLogicalType
   \   000007   E0           MOVX    A,@DPTR
   \   000008   700E         JNZ     ??ZDAppDetermineDeviceType_0
    676            {
    677              devStartMode = MODE_HARD;     // Start as a coordinator
   \   00000A   7402         MOV     A,#0x2
   \   00000C   90....       MOV     DPTR,#devStartMode
   \   00000F   F0           MOVX    @DPTR,A
    678              ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_COORDINATOR;
   \   000010   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000013   E0           MOVX    A,@DPTR
   \   000014   54F8         ANL     A,#0xf8
   \   000016   802E         SJMP    ??ZDAppDetermineDeviceType_1
    679            }
    680            else
    681            {
    682              if ( zgDeviceLogicalType == ZG_DEVICETYPE_ROUTER  )
   \                     ??ZDAppDetermineDeviceType_0:
   \   000018   6401         XRL     A,#0x1
   \   00001A   700A         JNZ     ??ZDAppDetermineDeviceType_2
    683                ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_ROUTER;
   \   00001C   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   00001F   E0           MOVX    A,@DPTR
   \   000020   54F8         ANL     A,#0xf8
   \   000022   4401         ORL     A,#0x1
   \   000024   800D         SJMP    ??ZDAppDetermineDeviceType_3
    684              else if ( zgDeviceLogicalType == ZG_DEVICETYPE_ENDDEVICE )
   \                     ??ZDAppDetermineDeviceType_2:
   \   000026   E0           MOVX    A,@DPTR
   \   000027   6402         XRL     A,#0x2
   \   000029   7009         JNZ     ??ZDAppDetermineDeviceType_4
    685                ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_DEVICE;
   \   00002B   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   00002E   E0           MOVX    A,@DPTR
   \   00002F   54F8         ANL     A,#0xf8
   \   000031   4402         ORL     A,#0x2
   \                     ??ZDAppDetermineDeviceType_3:
   \   000033   F0           MOVX    @DPTR,A
    686              
    687              // If AIB_apsUseExtendedPANID is set to a non-zero value by commissioning
    688              // The device shall do rejoin the network. Otherwise, do normal join
    689              if ( nwk_ExtPANIDValid( AIB_apsUseExtendedPANID ) == false )
   \                     ??ZDAppDetermineDeviceType_4:
   \   000034                ; Setup parameters for call to function nwk_ExtPANIDValid
   \   000034   7A..         MOV     R2,#(AIB_apsUseExtendedPANID & 0xff)
   \   000036   7B..         MOV     R3,#((AIB_apsUseExtendedPANID >> 8) & 0xff)
   \   000038   12....       LCALL   ??nwk_ExtPANIDValid?relay
   \   00003B   E9           MOV     A,R1
   \   00003C   7003         JNZ     ??ZDAppDetermineDeviceType_5
    690              {
    691                devStartMode = MODE_JOIN;     // Assume joining
   \   00003E   E4           CLR     A
   \   00003F   8002         SJMP    ??ZDAppDetermineDeviceType_6
    692              }
    693              else
    694              {
    695                devStartMode = MODE_REJOIN;  
   \                     ??ZDAppDetermineDeviceType_5:
   \   000041   7403         MOV     A,#0x3
   \                     ??ZDAppDetermineDeviceType_6:
   \   000043   90....       MOV     DPTR,#devStartMode
   \                     ??ZDAppDetermineDeviceType_1:
   \   000046   F0           MOVX    @DPTR,A
    696              }
    697            }
    698          }
   \   000047   02....       LJMP    ??Subroutine31_0 & 0xFFFF
    699          
    700          /*********************************************************************
    701           * @fn      ZDApp_NetworkStartEvt()
    702           *
    703           * @brief   Process the Network Start Event
    704           *
    705           * @param   none
    706           *
    707           * @return  none
    708           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    709          void ZDApp_NetworkStartEvt( void )
   \                     ZDApp_NetworkStartEvt:
    710          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    711            if ( nwkStatus == ZSuccess )
   \   000004   90....       MOV     DPTR,#nwkStatus
   \   000007   E0           MOVX    A,@DPTR
   \   000008   7012         JNZ     ??ZDApp_NetworkStartEvt_0
    712            {
    713              // Successfully started a ZigBee network
    714              if ( devState == DEV_COORD_STARTING )
   \   00000A   90....       MOV     DPTR,#devState
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   6408         XRL     A,#0x8
   \   000010   7003         JNZ     ??ZDApp_NetworkStartEvt_1
    715              {
    716                devState = DEV_ZB_COORD;
   \   000012   7409         MOV     A,#0x9
   \   000014   F0           MOVX    @DPTR,A
    717              }
    718          
    719              osal_pwrmgr_device( PWRMGR_ALWAYS_ON );
   \                     ??ZDApp_NetworkStartEvt_1:
   \   000015                ; Setup parameters for call to function osal_pwrmgr_device
   \   000015   7900         MOV     R1,#0x0
   \   000017   12....       LCALL   ??osal_pwrmgr_device?relay
    720              osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   00001A                ; Setup parameters for call to function osal_set_event
   \   00001A   802D         SJMP    ??ZDApp_NetworkStartEvt_2
    721            }
    722            else
    723            {
    724              // Try again with a higher energy threshold !!
    725              if ( ( NLME_GetEnergyThreshold() + ENERGY_SCAN_INCREMENT ) < 0xff )
   \                     ??ZDApp_NetworkStartEvt_0:
   \   00001C                ; Setup parameters for call to function NLME_GetEnergyThreshold
   \   00001C   12....       LCALL   ??NLME_GetEnergyThreshold?relay
   \   00001F   E9           MOV     A,R1
   \   000020   F8           MOV     R0,A
   \   000021   7410         MOV     A,#0x10
   \   000023   28           ADD     A,R0
   \   000024   F8           MOV     R0,A
   \   000025   E4           CLR     A
   \   000026   3400         ADDC    A,#0x0
   \   000028   F9           MOV     R1,A
   \   000029   E8           MOV     A,R0
   \   00002A   94FF         SUBB    A,#-0x1
   \   00002C   E9           MOV     A,R1
   \   00002D   9400         SUBB    A,#0x0
   \   00002F   C3           CLR     C
   \   000030   65D0         XRL     A,PSW
   \   000032   33           RLC     A
   \   000033   500E         JNC     ??ZDApp_NetworkStartEvt_3
    726              {
    727                NLME_SetEnergyThreshold( (uint8)(NLME_GetEnergyThreshold() + ENERGY_SCAN_INCREMENT) );
   \   000035                ; Setup parameters for call to function NLME_SetEnergyThreshold
   \   000035                ; Setup parameters for call to function NLME_GetEnergyThreshold
   \   000035   12....       LCALL   ??NLME_GetEnergyThreshold?relay
   \   000038   E9           MOV     A,R1
   \   000039   2410         ADD     A,#0x10
   \   00003B   F9           MOV     R1,A
   \   00003C   12....       LCALL   ??NLME_SetEnergyThreshold?relay
    728                osal_set_event( ZDAppTaskID, ZDO_NETWORK_INIT );
   \   00003F                ; Setup parameters for call to function osal_set_event
   \   00003F   7A01         MOV     R2,#0x1
   \   000041   8008         SJMP    ??ZDApp_NetworkStartEvt_4
    729              }
    730              else
    731              {
    732                // Failed to start network. Enter a dormant state (until user intervenes)
    733                devState = DEV_INIT;
   \                     ??ZDApp_NetworkStartEvt_3:
   \   000043   7401         MOV     A,#0x1
   \   000045   90....       MOV     DPTR,#devState
   \   000048   F0           MOVX    @DPTR,A
    734                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   000049                ; Setup parameters for call to function osal_set_event
   \                     ??ZDApp_NetworkStartEvt_2:
   \   000049   7A10         MOV     R2,#0x10
    735              }
    736            }
   \                     ??ZDApp_NetworkStartEvt_4:
   \   00004B   02....       LJMP    ?Subroutine18 & 0xFFFF
    737          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine18:
   \   000000   12....       LCALL   ?Subroutine21 & 0xFFFF
   \                     ??CrossCallReturnLabel_31:
   \   000003                REQUIRE ??Subroutine31_0
   \   000003                ; // Fall through to label ??Subroutine31_0
    738          
    739          /*********************************************************************
    740           * @fn      ZDApp_DeviceAuthEvt()
    741           *
    742           * @brief   Process the Device Authentic Event
    743           *
    744           * @param   none
    745           *
    746           * @return  none
    747           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    748          void ZDApp_DeviceAuthEvt( void )
   \                     ZDApp_DeviceAuthEvt:
    749          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    750            // received authentication from trust center
    751            if ( devState == DEV_END_DEVICE_UNAUTH )
   \   000004   90....       MOV     DPTR,#devState
   \   000007   E0           MOVX    A,@DPTR
   \   000008   6405         XRL     A,#0x5
   \   00000A   702D         JNZ     ??ZDApp_DeviceAuthEvt_0
    752            {
    753              // Stop the reset timer so it doesn't reset
    754              ZDApp_ResetTimerCancel();
   \   00000C                ; Setup parameters for call to function ZDApp_ResetTimerCancel
   \   00000C   12....       LCALL   ??ZDApp_ResetTimerCancel?relay
    755          
    756              devState = DEV_END_DEVICE;
   \   00000F   12....       LCALL   ?Subroutine0 & 0xFFFF
    757              osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
    758          
    759              // Set the Power Manager Device
    760          #if defined ( POWER_SAVING )
    761              osal_pwrmgr_device( PWRMGR_BATTERY );
    762          #endif
    763          
    764              if ( ZSTACK_ROUTER_BUILD )
    765              {
    766                if ( ZDO_Config_Node_Descriptor.LogicalType != NODETYPE_DEVICE )
   \                     ??CrossCallReturnLabel_24:
   \   000012   12....       LCALL   ?Subroutine5 & 0xFFFF
   \                     ??CrossCallReturnLabel_4:
   \   000015   6009         JZ      ??ZDApp_DeviceAuthEvt_1
    767                {
    768                  // NOTE: first two parameters are not used, see NLMEDE.h for details
    769                  NLME_StartRouterRequest( 0, 0, false );
   \   000017                ; Setup parameters for call to function NLME_StartRouterRequest
   \   000017   7B00         MOV     R3,#0x0
   \   000019   7A00         MOV     R2,#0x0
   \   00001B   7900         MOV     R1,#0x0
   \   00001D   12....       LCALL   ??NLME_StartRouterRequest?relay
    770                }
    771              }
    772          
    773              // Notify to save info into NV
    774              ZDApp_NVUpdate();
    775          
    776              // Save off the security
    777              ZDApp_SaveNwkKey();
   \                     ??ZDApp_DeviceAuthEvt_1:
   \   000020                ; Setup parameters for call to function ZDApp_SaveNwkKey
   \   000020   12....       LCALL   ??ZDApp_SaveNwkKey?relay
    778          
    779              ZDApp_AnnounceNewAddress();
   \   000023                ; Setup parameters for call to function ZDApp_AnnounceNewAddress
   \   000023   12....       LCALL   ??ZDApp_AnnounceNewAddress?relay
    780              
    781              if ( (ZDO_Config_Node_Descriptor.CapabilityFlags & CAPINFO_RCVR_ON_IDLE) == 0 )
   \   000026   90....       MOV     DPTR,#(ZDO_Config_Node_Descriptor + 2)
   \   000029   E0           MOVX    A,@DPTR
   \   00002A   A2E3         MOV     C,0xE0 /* A   */.3
   \   00002C   400B         JC      ??ZDApp_DeviceAuthEvt_0
    782              {
    783                NLME_SetPollRate( ZDApp_SavedPollRate );
   \   00002E                ; Setup parameters for call to function NLME_SetPollRate
   \   00002E   90....       MOV     DPTR,#ZDApp_SavedPollRate
   \   000031   E0           MOVX    A,@DPTR
   \   000032   FA           MOV     R2,A
   \   000033   A3           INC     DPTR
   \   000034   E0           MOVX    A,@DPTR
   \   000035   FB           MOV     R3,A
   \   000036   12....       LCALL   ??NLME_SetPollRate?relay
    784              }
    785            }
    786            else
    787            {
    788              ZDApp_NVUpdate();
    789            }
    790          }
   \                     ??ZDApp_DeviceAuthEvt_0:
   \   000039   02....       LJMP    ??Subroutine31_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine5:
   \   000000   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000003   E0           MOVX    A,@DPTR
   \   000004   5407         ANL     A,#0x7
   \   000006   6402         XRL     A,#0x2
   \   000008   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   7406         MOV     A,#0x6
   \   000002   90....       MOV     DPTR,#devState
   \   000005   F0           MOVX    @DPTR,A
   \   000006                ; Setup parameters for call to function osal_set_event
   \   000006                ; Setup parameters for call to function osal_set_event
   \   000006   7A10         MOV     R2,#0x10
   \   000008   02....       LJMP    ?Subroutine21 & 0xFFFF
    791          
    792          /*********************************************************************
    793           * @fn      ZDApp_SaveNetworkStateEvt()
    794           *
    795           * @brief   Process the Save the Network State Event
    796           *
    797           * @param   none
    798           *
    799           * @return  none
    800           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    801          void ZDApp_SaveNetworkStateEvt( void )
   \                     ZDApp_SaveNetworkStateEvt:
    802          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
    803          #if defined ( NV_RESTORE )
    804           #if defined ( NV_TURN_OFF_RADIO )
    805            // Turn off the radio's receiver during an NV update
    806            uint8 RxOnIdle;
    807            uint8 x = false;
    808            ZMacGetReq( ZMacRxOnIdle, &RxOnIdle );
    809            ZMacSetReq( ZMacRxOnIdle, &x );
    810           #endif
    811          
    812            // Update the Network State in NV
    813            NLME_UpdateNV( NWK_NV_NIB_ENABLE        |
    814                           NWK_NV_DEVICELIST_ENABLE |
    815                           NWK_NV_BINDING_ENABLE    |
    816                           NWK_NV_ADDRMGR_ENABLE );
    817          
    818            // Reset the NV startup option to resume from NV by
    819            // clearing the "New" join option.
    820            zgWriteStartupOptions( FALSE, ZCD_STARTOPT_DEFAULT_NETWORK_STATE );
    821          
    822           #if defined ( NV_TURN_OFF_RADIO )
    823            ZMacSetReq( ZMacRxOnIdle, &RxOnIdle );
    824           #endif
    825          #endif  // NV_RESTORE
    826          }
   \   000000   02....       LJMP    ?BRET
    827          
    828          /*********************************************************************
    829           * @fn      ZDApp_RestoreNetworkState()
    830           *
    831           * @brief   This function will restore the network state of the
    832           *          device if the network state is stored in NV.
    833           *
    834           * @param   none
    835           *
    836           * @return
    837           *    ZDO_INITDEV_RESTORED_NETWORK_STATE  - The device's network state was
    838           *          restored.
    839           *    ZDO_INITDEV_NEW_NETWORK_STATE - The network state was not used.
    840           *          This could mean that zgStartupOption said to not restore, or
    841           *          it could mean that there was no network state to restore.
    842           *
    843           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    844          uint8 ZDApp_RestoreNetworkState( void )
   \                     ZDApp_RestoreNetworkState:
    845          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    846            uint8 nvStat;
    847            nwkActiveKeyItems keyItems;
    848          
    849            // Initialize NWK NV items
    850            nvStat = NLME_InitNV();
   \   000005                ; Setup parameters for call to function NLME_InitNV
   \   000005   12....       LCALL   ??NLME_InitNV?relay
   \   000008   E9           MOV     A,R1
   \   000009   FE           MOV     R6,A
    851          
    852            if ( nvStat != NV_OPER_FAILED )
   \   00000A   740A         MOV     A,#0xa
   \   00000C   6E           XRL     A,R6
   \   00000D   602F         JZ      ??ZDApp_RestoreNetworkState_0
    853            {
    854              if ( NLME_RestoreFromNV() )
   \   00000F                ; Setup parameters for call to function NLME_RestoreFromNV
   \   00000F   12....       LCALL   ??NLME_RestoreFromNV?relay
   \   000012   E9           MOV     A,R1
   \   000013   6029         JZ      ??ZDApp_RestoreNetworkState_0
    855              {
    856                // Are we a coordinator
    857                ZDAppNwkAddr.addr.shortAddr = NLME_GetShortAddr();
   \   000015                ; Setup parameters for call to function NLME_GetShortAddr
   \   000015   12....       LCALL   ??NLME_GetShortAddr?relay
   \   000018   90....       MOV     DPTR,#ZDAppNwkAddr
   \   00001B   12....       LCALL   ??Subroutine33_0 & 0xFFFF
    858                if ( ZDAppNwkAddr.addr.shortAddr == 0 )
   \                     ??CrossCallReturnLabel_56:
   \   00001E   90....       MOV     DPTR,#ZDAppNwkAddr
   \   000021   E0           MOVX    A,@DPTR
   \   000022   7002         JNZ     ??ZDApp_RestoreNetworkState_1
   \   000024   A3           INC     DPTR
   \   000025   E0           MOVX    A,@DPTR
   \                     ??ZDApp_RestoreNetworkState_1:
   \   000026   7007         JNZ     ??ZDApp_RestoreNetworkState_2
    859                  ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_COORDINATOR;
   \   000028   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   00002B   E0           MOVX    A,@DPTR
   \   00002C   54F8         ANL     A,#0xf8
   \   00002E   F0           MOVX    @DPTR,A
    860                devStartMode = MODE_RESUME;
   \                     ??ZDApp_RestoreNetworkState_2:
   \   00002F   7401         MOV     A,#0x1
   \   000031   90....       MOV     DPTR,#devStartMode
   \   000034   12....       LCALL   ?Subroutine1 & 0xFFFF
    861                osal_cpyExtAddr( ZDO_UseExtendedPANID, _NIB.extendedPANID );
    862              }
    863              else
    864                nvStat = NV_ITEM_UNINIT;
    865          
    866              if ( ZG_SECURE_ENABLED )
    867              {
    868                nwkFrameCounterChanges = 0;
    869                osal_memset( &keyItems, 0, sizeof( nwkActiveKeyItems ) );
    870                osal_nv_item_init( ZCD_NV_NWKKEY, sizeof(nwkActiveKeyItems), (void *)&keyItems );
    871          
    872                if ( ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE )
    873                {
    874                  ZDApp_RestoreNwkKey();
    875                }
    876              }
    877          
    878              // The default for RxOnWhenIdle is true for Routers and false for end devices
    879              // [setup in the NLME_RestoreFromNV()].  Change it here if you want something
    880              // other than default.
    881            }
    882          
    883            if ( nvStat == ZSUCCESS )
   \                     ??CrossCallReturnLabel_0:
   \   000037   EE           MOV     A,R6
   \   000038   7004         JNZ     ??ZDApp_RestoreNetworkState_0
    884              return ( ZDO_INITDEV_RESTORED_NETWORK_STATE );
   \   00003A   7900         MOV     R1,#0x0
   \   00003C   8002         SJMP    ??ZDApp_RestoreNetworkState_3
    885            else
    886              return ( ZDO_INITDEV_NEW_NETWORK_STATE );
   \                     ??ZDApp_RestoreNetworkState_0:
   \   00003E   7901         MOV     R1,#0x1
   \                     ??ZDApp_RestoreNetworkState_3:
   \   000040   02....       LJMP    ?Subroutine22 & 0xFFFF
    887          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   F0           MOVX    @DPTR,A
   \   000001                ; Setup parameters for call to function sAddrExtCpy
   \   000001                ; Setup parameters for call to function sAddrExtCpy
   \   000001   7C..         MOV     R4,#((_NIB + 53) & 0xff)
   \   000003   7D..         MOV     R5,#(((_NIB + 53) >> 8) & 0xff)
   \   000005   7A..         MOV     R2,#(ZDO_UseExtendedPANID & 0xff)
   \   000007   7B..         MOV     R3,#((ZDO_UseExtendedPANID >> 8) & 0xff)
   \   000009   12....       LCALL   ??sAddrExtCpy?relay
   \   00000C   22           RET
    888          
    889          /*********************************************************************
    890           * @fn      ZDApp_InitUserDesc()
    891           *
    892           * @brief   Initialize the User Descriptor, the descriptor is read from NV
    893           *          when needed.  If you want to initialize the User descriptor to
    894           *          something other than all zero, do it here.
    895           *
    896           * @param   none
    897           *
    898           * @return  none
    899           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    900          void ZDApp_InitUserDesc( void )
   \                     ZDApp_InitUserDesc:
    901          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 17
   \   000005   74EF         MOV     A,#-0x11
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
    902            UserDescriptorFormat_t ZDO_DefaultUserDescriptor;
    903          
    904            // Initialize the User Descriptor, the descriptor is read from NV
    905            // when needed.  If you want to initialize the User descriptor to something
    906            // other than all zero, do it here.
    907            osal_memset( &ZDO_DefaultUserDescriptor, 0, sizeof( UserDescriptorFormat_t ) );
   \   00000A                ; Setup parameters for call to function osal_memset
   \   00000A   7C11         MOV     R4,#0x11
   \   00000C   12....       LCALL   ?Subroutine15 & 0xFFFF
    908            if ( ZSUCCESS == osal_nv_item_init( ZCD_NV_USERDESC,
    909                   sizeof(UserDescriptorFormat_t), (void*)&ZDO_DefaultUserDescriptor ) )
   \                     ??CrossCallReturnLabel_19:
   \   00000F   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000012   7C11         MOV     R4,#0x11
   \   000014   7D00         MOV     R5,#0x0
   \   000016   7A81         MOV     R2,#-0x7f
   \   000018   7B00         MOV     R3,#0x0
   \   00001A   12....       LCALL   ??osal_nv_item_init?relay
   \   00001D   7402         MOV     A,#0x2
   \   00001F   12....       LCALL   ?DEALLOC_XSTACK8
   \   000022   E9           MOV     A,R1
   \   000023   7033         JNZ     ??ZDApp_InitUserDesc_0
    910            {
    911              if ( ZSUCCESS == osal_nv_read( ZCD_NV_USERDESC, 0,
    912                   sizeof(UserDescriptorFormat_t), (void*)&ZDO_DefaultUserDescriptor ) )
   \   000025                ; Setup parameters for call to function osal_nv_read
   \   000025   78..         MOV     R0,#?V0 + 0
   \   000027   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00002A   75..11       MOV     ?V0 + 0,#0x11
   \   00002D   75..00       MOV     ?V0 + 1,#0x0
   \   000030   78..         MOV     R0,#?V0 + 0
   \   000032   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000035   7C00         MOV     R4,#0x0
   \   000037   7D00         MOV     R5,#0x0
   \   000039   7A81         MOV     R2,#-0x7f
   \   00003B   7B00         MOV     R3,#0x0
   \   00003D   12....       LCALL   ??osal_nv_read?relay
   \   000040   7404         MOV     A,#0x4
   \   000042   12....       LCALL   ?DEALLOC_XSTACK8
   \   000045   E9           MOV     A,R1
   \   000046   7010         JNZ     ??ZDApp_InitUserDesc_0
    913              {
    914                if ( ZDO_DefaultUserDescriptor.len != 0 )
   \   000048   85..82       MOV     DPL,?XSP + 0
   \   00004B   85..83       MOV     DPH,?XSP + 1
   \   00004E   E0           MOVX    A,@DPTR
   \   00004F   6007         JZ      ??ZDApp_InitUserDesc_0
    915                {
    916                  ZDO_Config_Node_Descriptor.UserDescAvail = TRUE;
   \   000051   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000054   E0           MOVX    A,@DPTR
   \   000055   D2E4         SETB    0xE0 /* A   */.4
   \   000057   F0           MOVX    @DPTR,A
    917                }
    918              }
    919            }
    920          }
   \                     ??ZDApp_InitUserDesc_0:
   \   000058   7411         MOV     A,#0x11
   \   00005A   02....       LJMP    ??Subroutine26_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine15:
   \   000000   7D00         MOV     R5,#0x0
   \   000002   7900         MOV     R1,#0x0
   \   000004   85..82       MOV     DPL,?XSP + 0
   \   000007   85..83       MOV     DPH,?XSP + 1
   \   00000A   AA82         MOV     R2,DPL
   \   00000C   AB83         MOV     R3,DPH
   \   00000E   12....       LCALL   ??osal_memset?relay
   \   000011                ; Setup parameters for call to function osal_nv_item_init
   \   000011                ; Setup parameters for call to function osal_nv_write
   \   000011   85..82       MOV     DPL,?XSP + 0
   \   000014   85..83       MOV     DPH,?XSP + 1
   \   000017   8582..       MOV     ?V0 + 0,DPL
   \   00001A   8583..       MOV     ?V0 + 1,DPH
   \   00001D   78..         MOV     R0,#?V0 + 0
   \   00001F   22           RET
    921          
    922          /*********************************************************************
    923           * @fn      ZDAppCheckForHoldKey()
    924           *
    925           * @brief   Check for key to set the device into Hold Auto Start
    926           *
    927           * @param   none
    928           *
    929           * @return  none
    930           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    931          void ZDAppCheckForHoldKey( void )
   \                     ZDAppCheckForHoldKey:
    932          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    933          #if (defined HAL_KEY) && (HAL_KEY == TRUE)
    934            // Get Keypad directly to see if a HOLD_START is needed.
    935            // Hold down the SW_BYPASS_START key (see OnBoard.h)
    936            // while booting to avoid starting up the device.
    937            if ( HalKeyRead () == SW_BYPASS_START)
   \   000004                ; Setup parameters for call to function HalKeyRead
   \   000004   12....       LCALL   ??HalKeyRead?relay
   \   000007   E9           MOV     A,R1
   \   000008   6401         XRL     A,#0x1
   \   00000A   7005         JNZ     ??ZDAppCheckForHoldKey_0
    938            {
    939              // Change the device state to HOLD on start up
    940              devState = DEV_HOLD;
   \   00000C   E4           CLR     A
   \   00000D   90....       MOV     DPTR,#devState
   \   000010   F0           MOVX    @DPTR,A
    941            }
    942          #endif // HAL_KEY
    943          }
   \                     ??ZDAppCheckForHoldKey_0:
   \   000011   02....       LJMP    ??Subroutine31_0 & 0xFFFF
    944          
    945          /*********************************************************************
    946           * @fn      ZDApp_ProcessOSALMsg()
    947           *
    948           * @brief   Process the incoming task message.
    949           *
    950           * @param   msgPtr - message to process
    951           *
    952           * @return  none
    953           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    954          void ZDApp_ProcessOSALMsg( osal_event_hdr_t *msgPtr )
   \                     ZDApp_ProcessOSALMsg:
    955          {
   \   000000   74F1         MOV     A,#-0xf
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 15
   \   000005                ; Auto size: 1
   \   000005   74FF         MOV     A,#-0x1
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
    956            // Data Confirmation message fields
    957            uint8 sentEP;       // This should always be 0
    958            uint8 sentStatus;
    959            afDataConfirm_t *afDataConfirm;
    960            uint8 tmp;
    961          
    962            switch ( msgPtr->event )
   \   00000E   8E82         MOV     DPL,R6
   \   000010   8F83         MOV     DPH,R7
   \   000012   E0           MOVX    A,@DPTR
   \   000013   12....       LCALL   ?UC_SWITCH_SPARSE
   \                     `?<Jumptable for ZDApp_ProcessOSALMsg>_0`:
   \   000016   00           DB        0
   \   000017   06           DB        6
   \   000018   01           DB        1
   \   000019   ....         DW        ??ZDApp_ProcessOSALMsg_0
   \   00001B   02           DB        2
   \   00001C   ....         DW        ??ZDApp_ProcessOSALMsg_1
   \   00001E   03           DB        3
   \   00001F   ....         DW        ??ZDApp_ProcessOSALMsg_2
   \   000021   1A           DB        26
   \   000022   ....         DW        ??ZDApp_ProcessOSALMsg_3
   \   000024   D3           DB        211
   \   000025   ....         DW        ??ZDApp_ProcessOSALMsg_4
   \   000027   FD           DB        253
   \   000028   ....         DW        ??ZDApp_ProcessOSALMsg_5
   \   00002A   ....         DW        ??ZDApp_ProcessOSALMsg_6
    963            {
    964              // Incoming ZDO Message
    965              case AF_INCOMING_MSG_CMD:
    966                ZDP_IncomingData( (afIncomingMSGPacket_t *)msgPtr );
   \                     ??ZDApp_ProcessOSALMsg_3:
   \   00002C                ; Setup parameters for call to function ZDP_IncomingData
   \   00002C   12....       LCALL   ??ZDP_IncomingData?relay
   \   00002F   02....       LJMP    ??ZDApp_ProcessOSALMsg_6 & 0xFFFF
    967                break;
    968                
    969              case ZDO_CB_MSG:
    970                ZDApp_ProcessMsgCBs( (zdoIncomingMsg_t *)msgPtr );
   \                     ??ZDApp_ProcessOSALMsg_4:
   \   000032                ; Setup parameters for call to function ZDApp_ProcessMsgCBs
   \   000032   12....       LCALL   ??ZDApp_ProcessMsgCBs?relay
   \   000035   02....       LJMP    ??ZDApp_ProcessOSALMsg_6 & 0xFFFF
    971                break;
    972          
    973              case AF_DATA_CONFIRM_CMD:
    974                // This message is received as a confirmation of a data packet sent.
    975                // The status is of ZStatus_t type [defined in NLMEDE.h]
    976                // The message fields are defined in AF.h
    977                afDataConfirm = (afDataConfirm_t *)msgPtr;
    978                sentEP = afDataConfirm->endpoint;
    979                sentStatus = afDataConfirm->hdr.status;
    980          
    981                // Action taken when confirmation is received.
    982          #if defined ( ZIGBEE_FREQ_AGILITY )
    983                if ( pZDNwkMgr_ProcessDataConfirm )
   \                     ??ZDApp_ProcessOSALMsg_5:
   \   000038   90....       MOV     DPTR,#pZDNwkMgr_ProcessDataConfirm
   \   00003B   E0           MOVX    A,@DPTR
   \   00003C   7002         JNZ     ??ZDApp_ProcessOSALMsg_7
   \   00003E   A3           INC     DPTR
   \   00003F   E0           MOVX    A,@DPTR
   \                     ??ZDApp_ProcessOSALMsg_7:
   \   000040   7003         JNZ     $+5
   \   000042   02....       LJMP    ??ZDApp_ProcessOSALMsg_6 & 0xFFFF
    984                  pZDNwkMgr_ProcessDataConfirm( afDataConfirm );
   \   000045                ; Setup parameters for indirect call
   \   000045   90....       MOV     DPTR,#pZDNwkMgr_ProcessDataConfirm
   \   000048   12....       LCALL   ?Subroutine10 & 0xFFFF
   \                     ??CrossCallReturnLabel_11:
   \   00004B   12....       LCALL   ?CALL_IND
   \   00004E   02....       LJMP    ??ZDApp_ProcessOSALMsg_6 & 0xFFFF
    985          #endif
    986                (void)sentEP;
    987                (void)sentStatus;
    988                break;
    989          
    990              case ZDO_NWK_DISC_CNF:
    991                if (devState != DEV_NWK_DISC)
   \                     ??ZDApp_ProcessOSALMsg_0:
   \   000051   90....       MOV     DPTR,#devState
   \   000054   E0           MOVX    A,@DPTR
   \   000055   6402         XRL     A,#0x2
   \   000057   6003         JZ      $+5
   \   000059   02....       LJMP    ??ZDApp_ProcessOSALMsg_6 & 0xFFFF
    992                  break;
    993                
    994                if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   \   00005C   90....       MOV     DPTR,#zgDeviceLogicalType
   \   00005F   E0           MOVX    A,@DPTR
   \   000060   6401         XRL     A,#0x1
   \   000062   6008         JZ      ??ZDApp_ProcessOSALMsg_8
   \   000064   E0           MOVX    A,@DPTR
   \   000065   6402         XRL     A,#0x2
   \   000067   6003         JZ      $+5
   \   000069   02....       LJMP    ??ZDApp_ProcessOSALMsg_6 & 0xFFFF
    995                {
    996                  if ( (((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->hdr.status == ZDO_SUCCESS) && (zdoDiscCounter > NUM_DISC_ATTEMPTS) )
   \                     ??ZDApp_ProcessOSALMsg_8:
   \   00006C   8E82         MOV     DPL,R6
   \   00006E   8F83         MOV     DPH,R7
   \   000070   A3           INC     DPTR
   \   000071   E0           MOVX    A,@DPTR
   \   000072   6003         JZ      $+5
   \   000074   02....       LJMP    ??ZDApp_ProcessOSALMsg_9 & 0xFFFF
   \   000077   90....       MOV     DPTR,#zdoDiscCounter
   \   00007A   E0           MOVX    A,@DPTR
   \   00007B   C3           CLR     C
   \   00007C   9403         SUBB    A,#0x3
   \   00007E   5003         JNC     $+5
   \   000080   02....       LJMP    ??ZDApp_ProcessOSALMsg_9 & 0xFFFF
    997                  {
    998                    if ( devStartMode == MODE_JOIN )
   \   000083   EE           MOV     A,R6
   \   000084   2404         ADD     A,#0x4
   \   000086   12....       LCALL   ?Subroutine13 & 0xFFFF
   \                     ??CrossCallReturnLabel_15:
   \   000089   2403         ADD     A,#0x3
   \   00008B   18           DEC     R0
   \   00008C   EF           MOV     A,R7
   \   00008D   3400         ADDC    A,#0x0
   \   00008F   F9           MOV     R1,A
   \   000090   88..         MOV     ?V0 + 2,R0
   \   000092   89..         MOV     ?V0 + 3,R1
   \   000094   EE           MOV     A,R6
   \   000095   2402         ADD     A,#0x2
   \   000097   18           DEC     R0
   \   000098   EF           MOV     A,R7
   \   000099   3400         ADDC    A,#0x0
   \   00009B   F9           MOV     R1,A
   \   00009C   88..         MOV     ?V0 + 4,R0
   \   00009E   89..         MOV     ?V0 + 5,R1
   \   0000A0   90....       MOV     DPTR,#devStartMode
   \   0000A3   E0           MOVX    A,@DPTR
   \   0000A4   703E         JNZ     ??ZDApp_ProcessOSALMsg_10
    999                    {
   1000                      devState = DEV_NWK_JOINING;
   \   0000A6   7403         MOV     A,#0x3
   \   0000A8   90....       MOV     DPTR,#devState
   \   0000AB   F0           MOVX    @DPTR,A
   1001            
   1002                      ZDApp_NodeProfileSync((ZDO_NetworkDiscoveryCfm_t *)msgPtr);
   \   0000AC                ; Setup parameters for call to function ZDApp_NodeProfileSync
   \   0000AC   12....       LCALL   ??ZDApp_NodeProfileSync?relay
   1003            
   1004                      if ( NLME_JoinRequest( ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->extendedPANID,
   1005                           BUILD_UINT16( ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->panIdLSB, ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->panIdMSB ),
   1006                           ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->logicalChannel,
   1007                           ZDO_Config_Node_Descriptor.CapabilityFlags ) != ZSuccess )
   \   0000AF                ; Setup parameters for call to function NLME_JoinRequest
   \   0000AF   90....       MOV     DPTR,#(ZDO_Config_Node_Descriptor + 2)
   \   0000B2   E0           MOVX    A,@DPTR
   \   0000B3   F5..         MOV     ?V0 + 6,A
   \   0000B5   78..         MOV     R0,#?V0 + 6
   \   0000B7   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   0000BA   85..82       MOV     DPL,?V0 + 0
   \   0000BD   85..83       MOV     DPH,?V0 + 1
   \   0000C0   E0           MOVX    A,@DPTR
   \   0000C1   F9           MOV     R1,A
   \   0000C2   85..82       MOV     DPL,?V0 + 4
   \   0000C5   85..83       MOV     DPH,?V0 + 5
   \   0000C8   E0           MOVX    A,@DPTR
   \   0000C9   FC           MOV     R4,A
   \   0000CA   85..82       MOV     DPL,?V0 + 2
   \   0000CD   85..83       MOV     DPH,?V0 + 3
   \   0000D0   E0           MOVX    A,@DPTR
   \   0000D1   FD           MOV     R5,A
   \   0000D2   EE           MOV     A,R6
   \   0000D3   2406         ADD     A,#0x6
   \   0000D5   FA           MOV     R2,A
   \   0000D6   EF           MOV     A,R7
   \   0000D7   3400         ADDC    A,#0x0
   \   0000D9   FB           MOV     R3,A
   \   0000DA   12....       LCALL   ??NLME_JoinRequest?relay
   \   0000DD   7401         MOV     A,#0x1
   \   0000DF   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000E2   807A         SJMP    ??ZDApp_ProcessOSALMsg_11
   1008                      {
   1009                        ZDApp_NetworkInit( (uint16)(NWK_START_DELAY
   1010                            + ((uint16)(osal_rand()& EXTENDED_JOINING_RANDOM_MASK))) );
   1011                      }
   1012                    }
   1013                    else if ( devStartMode == MODE_REJOIN )
   \                     ??ZDApp_ProcessOSALMsg_10:
   \   0000E4   6403         XRL     A,#0x3
   \   0000E6   707C         JNZ     ??CrossCallReturnLabel_13
   1014                    {
   1015                      devState = DEV_NWK_REJOIN;
   \   0000E8   7404         MOV     A,#0x4
   \   0000EA   90....       MOV     DPTR,#devState
   \   0000ED   F0           MOVX    @DPTR,A
   1016          
   1017                      // Before trying to do rejoin, check if the device has a valid short address
   1018                      // If not, generate a random short address for itself
   1019                      if ( _NIB.nwkDevAddress == INVALID_NODE_ADDR )
   \   0000EE   90....       MOV     DPTR,#(_NIB + 20)
   \   0000F1   E0           MOVX    A,@DPTR
   \   0000F2   64FE         XRL     A,#0xfe
   \   0000F4   7004         JNZ     ??ZDApp_ProcessOSALMsg_12
   \   0000F6   A3           INC     DPTR
   \   0000F7   E0           MOVX    A,@DPTR
   \   0000F8   64FF         XRL     A,#0xff
   \                     ??ZDApp_ProcessOSALMsg_12:
   \   0000FA   7012         JNZ     ??ZDApp_ProcessOSALMsg_13
   1020                      {
   1021                        _NIB.nwkDevAddress = osal_rand();
   \   0000FC                ; Setup parameters for call to function osal_rand
   \   0000FC   12....       LCALL   ??osal_rand?relay
   \   0000FF   90....       MOV     DPTR,#(_NIB + 20)
   \   000102   12....       LCALL   ??Subroutine33_0 & 0xFFFF
   1022                        ZMacSetReq( ZMacShortAddress, (byte*)&_NIB.nwkDevAddress );
   \                     ??CrossCallReturnLabel_57:
   \   000105                ; Setup parameters for call to function ZMacSetReq
   \   000105   7A..         MOV     R2,#((_NIB + 20) & 0xff)
   \   000107   7B..         MOV     R3,#(((_NIB + 20) >> 8) & 0xff)
   \   000109   7953         MOV     R1,#0x53
   \   00010B   12....       LCALL   ??ZMacSetReq?relay
   1023                      }
   1024          
   1025                      if ( ZG_SECURE_ENABLED )
   1026                      {
   1027                        ZDApp_RestoreNwkKey();
   1028                      }
   1029                      
   1030                      // Check if the device has a valid PanID, if not, set it to the discovered Pan
   1031                      if ( _NIB.nwkPanId == INVALID_PAN_ID )
   \                     ??ZDApp_ProcessOSALMsg_13:
   \   00010E   90....       MOV     DPTR,#(_NIB + 33)
   \   000111   E0           MOVX    A,@DPTR
   \   000112   64FE         XRL     A,#0xfe
   \   000114   7004         JNZ     ??ZDApp_ProcessOSALMsg_14
   \   000116   A3           INC     DPTR
   \   000117   E0           MOVX    A,@DPTR
   \   000118   64FF         XRL     A,#0xff
   \                     ??ZDApp_ProcessOSALMsg_14:
   \   00011A   7021         JNZ     ??ZDApp_ProcessOSALMsg_15
   1032                      {
   1033                        _NIB.nwkPanId = BUILD_UINT16( ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->panIdLSB, ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->panIdMSB );
   \   00011C   85..82       MOV     DPL,?V0 + 4
   \   00011F   85..83       MOV     DPH,?V0 + 5
   \   000122   E0           MOVX    A,@DPTR
   \   000123   FA           MOV     R2,A
   \   000124   85..82       MOV     DPL,?V0 + 2
   \   000127   85..83       MOV     DPH,?V0 + 3
   \   00012A   E0           MOVX    A,@DPTR
   \   00012B   F9           MOV     R1,A
   \   00012C   EA           MOV     A,R2
   \   00012D   90....       MOV     DPTR,#(_NIB + 33)
   \   000130   F0           MOVX    @DPTR,A
   \   000131   A3           INC     DPTR
   \   000132   E9           MOV     A,R1
   \   000133   F0           MOVX    @DPTR,A
   1034                        ZMacSetReq( ZMacPanId, (byte*)&(_NIB.nwkPanId) );
   \   000134                ; Setup parameters for call to function ZMacSetReq
   \   000134   7A..         MOV     R2,#((_NIB + 33) & 0xff)
   \   000136   7B..         MOV     R3,#(((_NIB + 33) >> 8) & 0xff)
   \   000138   7950         MOV     R1,#0x50
   \   00013A   12....       LCALL   ??ZMacSetReq?relay
   1035                      }
   1036          
   1037                      tmp = true;
   \                     ??ZDApp_ProcessOSALMsg_15:
   \   00013D   7401         MOV     A,#0x1
   \   00013F   85..82       MOV     DPL,?XSP + 0
   \   000142   85..83       MOV     DPH,?XSP + 1
   \   000145   F0           MOVX    @DPTR,A
   1038                      ZMacSetReq( ZMacRxOnIdle, &tmp ); // Set receiver always on during rejoin 
   \   000146                ; Setup parameters for call to function ZMacSetReq
   \   000146   AA82         MOV     R2,DPL
   \   000148   AB83         MOV     R3,DPH
   \   00014A   7952         MOV     R1,#0x52
   \   00014C   12....       LCALL   ??ZMacSetReq?relay
   1039                      if ( NLME_ReJoinRequest( ZDO_UseExtendedPANID, ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->logicalChannel) != ZSuccess )
   \   00014F                ; Setup parameters for call to function NLME_ReJoinRequest
   \   00014F   85..82       MOV     DPL,?V0 + 0
   \   000152   85..83       MOV     DPH,?V0 + 1
   \   000155   E0           MOVX    A,@DPTR
   \   000156   F9           MOV     R1,A
   \   000157   7A..         MOV     R2,#(ZDO_UseExtendedPANID & 0xff)
   \   000159   7B..         MOV     R3,#((ZDO_UseExtendedPANID >> 8) & 0xff)
   \   00015B   12....       LCALL   ??NLME_ReJoinRequest?relay
   \                     ??ZDApp_ProcessOSALMsg_11:
   \   00015E   E9           MOV     A,R1
   \   00015F   6003         JZ      ??CrossCallReturnLabel_13
   1040                      {
   1041                        ZDApp_NetworkInit( (uint16)(NWK_START_DELAY
   1042                            + ((uint16)(osal_rand()& EXTENDED_JOINING_RANDOM_MASK))) );
   \   000161                ; Setup parameters for call to function ZDApp_NetworkInit
   \   000161                ; Setup parameters for call to function osal_rand
   \   000161   12....       LCALL   ?Subroutine11 & 0xFFFF
   1043                      }
   1044                    }
   1045            
   1046                    if ( ZDO_Config_Node_Descriptor.CapabilityFlags & CAPINFO_RCVR_ON_IDLE )
   \                     ??CrossCallReturnLabel_13:
   \   000164   90....       MOV     DPTR,#(ZDO_Config_Node_Descriptor + 2)
   \   000167   E0           MOVX    A,@DPTR
   \   000168   A2E3         MOV     C,0xE0 /* A   */.3
   \   00016A   5062         JNC     ??ZDApp_ProcessOSALMsg_6
   1047                    {
   1048                      // The receiver is on, turn network layer polling off.
   1049                      NLME_SetPollRate( 0 );
   \   00016C                ; Setup parameters for call to function NLME_SetPollRate
   \   00016C   12....       LCALL   ?Subroutine14 & 0xFFFF
   1050                      NLME_SetQueuedPollRate( 0 );
   1051                      NLME_SetResponseRate( 0 );
   1052                    }
   1053                    else
   1054                    {
   1055                      if ( (ZG_SECURE_ENABLED) && (devStartMode == MODE_JOIN) )
   1056                      {
   1057                        ZDApp_SavedPollRate = zgPollRate;
   1058                        NLME_SetPollRate( zgRejoinPollRate );
   1059                      }
   1060                    }
   1061                  }
   \                     ??CrossCallReturnLabel_17:
   \   00016F   805D         SJMP    ??ZDApp_ProcessOSALMsg_6
   1062                  else
   1063                  {
   1064                    if ( continueJoining )
   \                     ??ZDApp_ProcessOSALMsg_9:
   \   000171   90....       MOV     DPTR,#continueJoining
   \   000174   E0           MOVX    A,@DPTR
   \   000175   6057         JZ      ??ZDApp_ProcessOSALMsg_6
   1065                    {
   1066              #if defined ( MANAGED_SCAN )
   1067                      ZDApp_NetworkInit( MANAGEDSCAN_DELAY_BETWEEN_SCANS );
   1068              #else
   1069                      zdoDiscCounter++;
   \   000177   90....       MOV     DPTR,#zdoDiscCounter
   \   00017A   E0           MOVX    A,@DPTR
   \   00017B   04           INC     A
   \   00017C   F0           MOVX    @DPTR,A
   1070                      ZDApp_NetworkInit( (uint16)(BEACON_REQUEST_DELAY
   1071                            + ((uint16)(osal_rand()& BEACON_REQ_DELAY_MASK))) );
   \   00017D                ; Setup parameters for call to function ZDApp_NetworkInit
   \   00017D                ; Setup parameters for call to function osal_rand
   \   00017D   12....       LCALL   ??osal_rand?relay
   \   000180   8A..         MOV     ?V0 + 0,R2
   \   000182   74FF         MOV     A,#-0x1
   \   000184   55..         ANL     A,?V0 + 0
   \   000186   F8           MOV     R0,A
   \   000187   7464         MOV     A,#0x64
   \   000189   28           ADD     A,R0
   \   00018A   FA           MOV     R2,A
   \   00018B   E4           CLR     A
   \   00018C   3400         ADDC    A,#0x0
   \   00018E   FB           MOV     R3,A
   \   00018F   803A         SJMP    ??ZDApp_ProcessOSALMsg_16
   1072              #endif
   1073                    }
   1074                  }
   1075                }
   1076                break;
   1077          
   1078              case ZDO_NWK_JOIN_IND:
   1079                if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   \                     ??ZDApp_ProcessOSALMsg_1:
   \   000191   90....       MOV     DPTR,#zgDeviceLogicalType
   \   000194   E0           MOVX    A,@DPTR
   \   000195   6401         XRL     A,#0x1
   \   000197   6005         JZ      ??ZDApp_ProcessOSALMsg_17
   \   000199   E0           MOVX    A,@DPTR
   \   00019A   6402         XRL     A,#0x2
   \   00019C   7030         JNZ     ??ZDApp_ProcessOSALMsg_6
   1080                {
   1081                  ZDApp_ProcessNetworkJoin();
   \                     ??ZDApp_ProcessOSALMsg_17:
   \   00019E                ; Setup parameters for call to function ZDApp_ProcessNetworkJoin
   \   00019E   12....       LCALL   ??ZDApp_ProcessNetworkJoin?relay
   \   0001A1   802B         SJMP    ??ZDApp_ProcessOSALMsg_6
   1082                }
   1083                break;
   1084          
   1085              case ZDO_NWK_JOIN_REQ:
   1086                if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   \                     ??ZDApp_ProcessOSALMsg_2:
   \   0001A3   90....       MOV     DPTR,#zgDeviceLogicalType
   \   0001A6   E0           MOVX    A,@DPTR
   \   0001A7   6401         XRL     A,#0x1
   \   0001A9   6005         JZ      ??ZDApp_ProcessOSALMsg_18
   \   0001AB   E0           MOVX    A,@DPTR
   \   0001AC   6402         XRL     A,#0x2
   \   0001AE   701E         JNZ     ??ZDApp_ProcessOSALMsg_6
   1087                {
   1088                  retryCnt = 0;
   \                     ??ZDApp_ProcessOSALMsg_18:
   \   0001B0   E4           CLR     A
   \   0001B1   90....       MOV     DPTR,#retryCnt
   \   0001B4   F0           MOVX    @DPTR,A
   1089                  devStartMode = MODE_RESUME;
   \   0001B5   7401         MOV     A,#0x1
   \   0001B7   90....       MOV     DPTR,#devStartMode
   \   0001BA   F0           MOVX    @DPTR,A
   1090                  _tmpRejoinState = true;
   \   0001BB   90....       MOV     DPTR,#_tmpRejoinState
   \   0001BE   12....       LCALL   ?Subroutine1 & 0xFFFF
   1091                  osal_cpyExtAddr( ZDO_UseExtendedPANID, _NIB.extendedPANID );
   1092                  zgDefaultStartingScanDuration = BEACON_ORDER_60_MSEC;
   \                     ??CrossCallReturnLabel_1:
   \   0001C1   7402         MOV     A,#0x2
   \   0001C3   90....       MOV     DPTR,#zgDefaultStartingScanDuration
   \   0001C6   F0           MOVX    @DPTR,A
   1093                  ZDApp_NetworkInit( 0 );
   \   0001C7                ; Setup parameters for call to function ZDApp_NetworkInit
   \   0001C7   7A00         MOV     R2,#0x0
   \   0001C9   7B00         MOV     R3,#0x0
   \                     ??ZDApp_ProcessOSALMsg_16:
   \   0001CB   12....       LCALL   ??ZDApp_NetworkInit?relay
   1094                }
   1095                break;
   1096          
   1097              default:
   1098                if ( ZG_SECURE_ENABLED )
   1099                  ZDApp_ProcessSecMsg( msgPtr );
   1100                break;
   1101            }
   1102          
   1103          }
   \                     ??ZDApp_ProcessOSALMsg_6:
   \   0001CE   7401         MOV     A,#0x1
   \   0001D0   12....       LCALL   ?DEALLOC_XSTACK8
   \   0001D3   7F07         MOV     R7,#0x7
   \   0001D5   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine14:
   \   000000   7A00         MOV     R2,#0x0
   \   000002   7B00         MOV     R3,#0x0
   \   000004   12....       LCALL   ??NLME_SetPollRate?relay
   \   000007                ; Setup parameters for call to function NLME_SetQueuedPollRate
   \   000007                ; Setup parameters for call to function NLME_SetQueuedPollRate
   \   000007   7A00         MOV     R2,#0x0
   \   000009   7B00         MOV     R3,#0x0
   \   00000B   12....       LCALL   ??NLME_SetQueuedPollRate?relay
   \   00000E                ; Setup parameters for call to function NLME_SetResponseRate
   \   00000E                ; Setup parameters for call to function NLME_SetResponseRate
   \   00000E   7A00         MOV     R2,#0x0
   \   000010   7B00         MOV     R3,#0x0
   \   000012   12....       LCALL   ??NLME_SetResponseRate?relay
   \   000015   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine11:
   \   000000   12....       LCALL   ??osal_rand?relay
   \   000003   8A..         MOV     ?V0 + 0,R2
   \   000005   747F         MOV     A,#0x7f
   \   000007   55..         ANL     A,?V0 + 0
   \   000009   F8           MOV     R0,A
   \   00000A   7464         MOV     A,#0x64
   \   00000C   28           ADD     A,R0
   \   00000D   FA           MOV     R2,A
   \   00000E   7B00         MOV     R3,#0x0
   \   000010   12....       LCALL   ??ZDApp_NetworkInit?relay
   \   000013   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine13:
   \   000000   F8           MOV     R0,A
   \   000001   EF           MOV     A,R7
   \   000002   3400         ADDC    A,#0x0
   \   000004   F9           MOV     R1,A
   \   000005   88..         MOV     ?V0 + 0,R0
   \   000007   89..         MOV     ?V0 + 1,R1
   \   000009   EE           MOV     A,R6
   \   00000A   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine10:
   \   000000   E0           MOVX    A,@DPTR
   \   000001   F8           MOV     R0,A
   \   000002   A3           INC     DPTR
   \   000003   E0           MOVX    A,@DPTR
   \   000004   F583         MOV     DPH,A
   \   000006   8882         MOV     DPL,R0
   \   000008   22           RET
   1104          
   1105          /*********************************************************************
   1106           * @fn      ZDApp_ProcessMsgCBs()
   1107           *
   1108           * @brief   Process response messages
   1109           *
   1110           * @param   none
   1111           *
   1112           * @return  none
   1113           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1114          void ZDApp_ProcessMsgCBs( zdoIncomingMsg_t *inMsg )
   \                     ZDApp_ProcessMsgCBs:
   1115          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 21
   \   000005   74EB         MOV     A,#-0x15
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   12....       LCALL   ?Subroutine12 & 0xFFFF
   1116            switch ( inMsg->clusterID )
   \                     ??CrossCallReturnLabel_48:
   \   00000D   F5..         MOV     ?V0 + 0,A
   \   00000F   A3           INC     DPTR
   \   000010   E0           MOVX    A,@DPTR
   \   000011   F5..         MOV     ?V0 + 1,A
   \   000013   78..         MOV     R0,#?V0 + 0
   \   000015   12....       LCALL   ?US_SWITCH_SPARSE
   \                     `?<Jumptable for ZDApp_ProcessMsgCBs>_0`:
   \   000018   0200         DW        2
   \   00001A   2100         DW        33
   \   00001C   2200         DW        34
   \   00001E   ....         DW        ??ZDApp_ProcessMsgCBs_0
   \   000020   0080         DW        32768
   \   000022   0180         DW        32769
   \   000024   ....         DW        ??ZDApp_ProcessMsgCBs_1
   \   000026   0000         DW        0
   \   000028   ....         DW        ??ZDApp_ProcessMsgCBs_2
   1117            {
   1118          #if defined ( ZDO_NWKADDR_REQUEST ) || defined ( ZDO_IEEEADDR_REQUEST ) || defined ( REFLECTOR )
   1119              case NWK_addr_rsp:
   1120              case IEEE_addr_rsp:
   1121                {
   1122                  ZDO_NwkIEEEAddrResp_t *pAddrRsp;
   1123                  pAddrRsp = ZDO_ParseAddrRsp( inMsg );
   \                     ??ZDApp_ProcessMsgCBs_1:
   \   00002A                ; Setup parameters for call to function ZDO_ParseAddrRsp
   \   00002A   12....       LCALL   ??ZDO_ParseAddrRsp?relay
   \   00002D   8A..         MOV     ?V0 + 0,R2
   \   00002F   8B..         MOV     ?V0 + 1,R3
   \   000031   AE..         MOV     R6,?V0 + 0
   \   000033   AF..         MOV     R7,?V0 + 1
   1124                  if ( pAddrRsp )
   \   000035   EE           MOV     A,R6
   \   000036   7001         JNZ     ??ZDApp_ProcessMsgCBs_3
   \   000038   EF           MOV     A,R7
   \                     ??ZDApp_ProcessMsgCBs_3:
   \   000039   603F         JZ      ??ZDApp_ProcessMsgCBs_2
   1125                  {
   1126                    if ( pAddrRsp->status == ZSuccess )
   \   00003B   8E82         MOV     DPL,R6
   \   00003D   8F83         MOV     DPH,R7
   \   00003F   E0           MOVX    A,@DPTR
   \   000040   7011         JNZ     ??ZDApp_ProcessMsgCBs_4
   1127                    {
   1128                      ZDO_UpdateAddrManager( pAddrRsp->nwkAddr, pAddrRsp->extAddr );
   \   000042                ; Setup parameters for call to function ZDO_UpdateAddrManager
   \   000042   EE           MOV     A,R6
   \   000043   2403         ADD     A,#0x3
   \   000045   FC           MOV     R4,A
   \   000046   EF           MOV     A,R7
   \   000047   3400         ADDC    A,#0x0
   \   000049   FD           MOV     R5,A
   \   00004A   A3           INC     DPTR
   \   00004B   E0           MOVX    A,@DPTR
   \   00004C   FA           MOV     R2,A
   \   00004D   A3           INC     DPTR
   \   00004E   E0           MOVX    A,@DPTR
   \   00004F   FB           MOV     R3,A
   \   000050   12....       LCALL   ??ZDO_UpdateAddrManager?relay
   1129                    }
   1130                    osal_mem_free( pAddrRsp );
   \                     ??ZDApp_ProcessMsgCBs_4:
   \   000053                ; Setup parameters for call to function osal_mem_free
   \   000053   EE           MOV     A,R6
   \   000054   FA           MOV     R2,A
   \   000055   EF           MOV     A,R7
   \   000056   FB           MOV     R3,A
   \   000057   12....       LCALL   ??osal_mem_free?relay
   \   00005A   801E         SJMP    ??ZDApp_ProcessMsgCBs_2
   1131                  }
   1132                }
   1133                break;
   1134          #endif
   1135                
   1136          #if defined ( REFLECTOR )
   1137              case Bind_req:
   1138              case Unbind_req:
   1139                {
   1140                  ZDO_BindUnbindReq_t bindReq;
   1141                  ZDO_ParseBindUnbindReq( inMsg, &bindReq );
   \                     ??ZDApp_ProcessMsgCBs_0:
   \   00005C                ; Setup parameters for call to function ZDO_ParseBindUnbindReq
   \   00005C   85..82       MOV     DPL,?XSP + 0
   \   00005F   85..83       MOV     DPH,?XSP + 1
   \   000062   AC82         MOV     R4,DPL
   \   000064   AD83         MOV     R5,DPH
   \   000066   12....       LCALL   ??ZDO_ParseBindUnbindReq?relay
   1142                  ZDO_ProcessBindUnbindReq( inMsg, &bindReq );
   \   000069                ; Setup parameters for call to function ZDO_ProcessBindUnbindReq
   \   000069   85..82       MOV     DPL,?XSP + 0
   \   00006C   85..83       MOV     DPH,?XSP + 1
   \   00006F   AC82         MOV     R4,DPL
   \   000071   AD83         MOV     R5,DPH
   \   000073   EE           MOV     A,R6
   \   000074   FA           MOV     R2,A
   \   000075   EF           MOV     A,R7
   \   000076   FB           MOV     R3,A
   \   000077   12....       LCALL   ??ZDO_ProcessBindUnbindReq?relay
   1143                }
   1144                break;
   1145          #endif      
   1146          
   1147          #if ( ZG_BUILD_COORDINATOR_TYPE )
   1148              case Bind_rsp:
   1149              case Unbind_rsp:
   1150                if (ZG_DEVICE_COORDINATOR_TYPE && matchED)
   1151                {
   1152                  ZDMatchSendState(
   1153                       (uint8)((inMsg->clusterID == Bind_rsp) ? ZDMATCH_REASON_BIND_RSP : ZDMATCH_REASON_UNBIND_RSP),
   1154                       ZDO_ParseBindRsp(inMsg), inMsg->TransSeq );
   1155                }
   1156                break;
   1157                
   1158              case End_Device_Bind_req:
   1159                if (ZG_DEVICE_COORDINATOR_TYPE)
   1160                {
   1161                  ZDEndDeviceBind_t bindReq;
   1162                  ZDO_ParseEndDeviceBindReq( inMsg, &bindReq );
   1163                  ZDO_MatchEndDeviceBind( &bindReq );
   1164                  
   1165                  // Freeing the cluster lists - if allocated.
   1166                  if ( bindReq.numInClusters )
   1167                    osal_mem_free( bindReq.inClusters );
   1168                  if ( bindReq.numOutClusters )
   1169                    osal_mem_free( bindReq.outClusters );
   1170                }
   1171                break;
   1172          #endif
   1173            }
   1174          }
   \                     ??ZDApp_ProcessMsgCBs_2:
   \   00007A                REQUIRE ?Subroutine25
   \   00007A                ; // Fall through to label ?Subroutine25

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine25:
   \   000000   7415         MOV     A,#0x15
   \   000002   02....       LJMP    ??Subroutine26_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine12:
   \   000000   EA           MOV     A,R2
   \   000001   FE           MOV     R6,A
   \   000002   EB           MOV     A,R3
   \   000003   FF           MOV     R7,A
   \   000004   EE           MOV     A,R6
   \   000005   240C         ADD     A,#0xc
   \   000007                REQUIRE ??Subroutine32_0
   \   000007                ; // Fall through to label ??Subroutine32_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine32_0:
   \   000000   F582         MOV     DPL,A
   \   000002   EF           MOV     A,R7
   \   000003   3400         ADDC    A,#0x0
   \   000005   F583         MOV     DPH,A
   \   000007   E0           MOVX    A,@DPTR
   \   000008   22           RET
   1175          
   1176          /*********************************************************************
   1177           * @fn      ZDApp_RegisterCBs()
   1178           *
   1179           * @brief   Process response messages
   1180           *
   1181           * @param   none
   1182           *
   1183           * @return  none
   1184           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1185          void ZDApp_RegisterCBs( void )
   \                     ZDApp_RegisterCBs:
   1186          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1187          #if defined ( ZDO_IEEEADDR_REQUEST ) || defined ( REFLECTOR )
   1188            ZDO_RegisterForZDOMsg( ZDAppTaskID, IEEE_addr_rsp );
   \   000004                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000004   7A01         MOV     R2,#0x1
   \   000006   12....       LCALL   ?Subroutine7 & 0xFFFF
   1189          #endif
   1190          #if defined ( ZDO_NWKADDR_REQUEST ) || defined ( REFLECTOR )
   1191            ZDO_RegisterForZDOMsg( ZDAppTaskID, NWK_addr_rsp );
   \                     ??CrossCallReturnLabel_36:
   \   000009                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000009   7A00         MOV     R2,#0x0
   \   00000B   12....       LCALL   ?Subroutine7 & 0xFFFF
   1192          #endif  
   1193          #if ZG_BUILD_COORDINATOR_TYPE
   1194            ZDO_RegisterForZDOMsg( ZDAppTaskID, Bind_rsp );
   1195            ZDO_RegisterForZDOMsg( ZDAppTaskID, Unbind_rsp );
   1196            ZDO_RegisterForZDOMsg( ZDAppTaskID, End_Device_Bind_req );
   1197          #endif
   1198          #if defined ( REFLECTOR )
   1199            ZDO_RegisterForZDOMsg( ZDAppTaskID, Bind_req );
   \                     ??CrossCallReturnLabel_37:
   \   00000E                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   00000E   7A21         MOV     R2,#0x21
   \   000010   7B00         MOV     R3,#0x0
   \   000012   12....       LCALL   ??Subroutine28_0 & 0xFFFF
   1200            ZDO_RegisterForZDOMsg( ZDAppTaskID, Unbind_req );
   \                     ??CrossCallReturnLabel_38:
   \   000015                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000015   7A22         MOV     R2,#0x22
   \   000017   7B00         MOV     R3,#0x0
   \   000019   12....       LCALL   ??Subroutine28_0 & 0xFFFF
   1201          #endif  
   1202          }
   \                     ??CrossCallReturnLabel_39:
   \   00001C   02....       LJMP    ??Subroutine31_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine7:
   \   000000   7B80         MOV     R3,#-0x80
   \   000002                REQUIRE ??Subroutine28_0
   \   000002                ; // Fall through to label ??Subroutine28_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine28_0:
   \   000000   90....       MOV     DPTR,#ZDAppTaskID
   \   000003   E0           MOVX    A,@DPTR
   \   000004   F9           MOV     R1,A
   \   000005   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay
   \   000008   22           RET
   1203          
   1204          /*********************************************************************
   1205           * @fn      ZDApp_ProcessSecMsg()
   1206           *
   1207           * @brief   Process the incoming security message.
   1208           *
   1209           * @param   msgPtr - message to process
   1210           *
   1211           * @return  none
   1212           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1213          void ZDApp_ProcessSecMsg( osal_event_hdr_t *msgPtr )
   \                     ZDApp_ProcessSecMsg:
   1214          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1215            switch ( msgPtr->event )
   \   000004   8A82         MOV     DPL,R2
   \   000006   8B83         MOV     DPH,R3
   \   000008   E0           MOVX    A,@DPTR
   \   000009   12....       LCALL   ?UC_SWITCH_SPARSE
   \                     `?<Jumptable for ZDApp_ProcessSecMsg>_0`:
   \   00000C   00           DB        0
   \   00000D   03           DB        3
   \   00000E   06           DB        6
   \   00000F   ....         DW        ??ZDApp_ProcessSecMsg_0
   \   000011   08           DB        8
   \   000012   ....         DW        ??ZDApp_ProcessSecMsg_1
   \   000014   0A           DB        10
   \   000015   ....         DW        ??ZDApp_ProcessSecMsg_2
   \   000017   ....         DW        ??ZDApp_ProcessSecMsg_3
   1216            {
   1217              case ZDO_ESTABLISH_KEY_CFM:
   1218                if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
   1219                {
   1220                  ZDSecMgrEstablishKeyCfm( (ZDO_EstablishKeyCfm_t*)msgPtr );
   1221                }
   1222                break;
   1223          
   1224              case ZDO_ESTABLISH_KEY_IND:
   1225                if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
   1226                {
   1227                  if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   1228                  {
   1229                    ZDSecMgrEstablishKeyInd( (ZDO_EstablishKeyInd_t*)msgPtr );
   1230                  }
   1231                }
   1232                break;
   1233          
   1234              case ZDO_TRANSPORT_KEY_IND:
   1235                if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   \                     ??ZDApp_ProcessSecMsg_0:
   \   000019   90....       MOV     DPTR,#zgDeviceLogicalType
   \   00001C   E0           MOVX    A,@DPTR
   \   00001D   6401         XRL     A,#0x1
   \   00001F   6005         JZ      ??ZDApp_ProcessSecMsg_4
   \   000021   E0           MOVX    A,@DPTR
   \   000022   6402         XRL     A,#0x2
   \   000024   7022         JNZ     ??ZDApp_ProcessSecMsg_3
   1236                {
   1237                  ZDSecMgrTransportKeyInd( (ZDO_TransportKeyInd_t*)msgPtr );
   \                     ??ZDApp_ProcessSecMsg_4:
   \   000026                ; Setup parameters for call to function ZDSecMgrTransportKeyInd
   \   000026   12....       LCALL   ??ZDSecMgrTransportKeyInd?relay
   \   000029   801D         SJMP    ??ZDApp_ProcessSecMsg_3
   1238                }
   1239                break;
   1240          
   1241              case ZDO_UPDATE_DEVICE_IND:
   1242                if ( ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE )
   1243                {
   1244                  ZDSecMgrUpdateDeviceInd( (ZDO_UpdateDeviceInd_t*)msgPtr );
   1245                }
   1246                break;
   1247          
   1248              case ZDO_REMOVE_DEVICE_IND:
   1249                if ( ZG_BUILD_RTRONLY_TYPE && ( zgDeviceLogicalType == ZG_DEVICETYPE_ROUTER ) )
   \                     ??ZDApp_ProcessSecMsg_1:
   \   00002B   90....       MOV     DPTR,#zgDeviceLogicalType
   \   00002E   E0           MOVX    A,@DPTR
   \   00002F   6401         XRL     A,#0x1
   \   000031   7015         JNZ     ??ZDApp_ProcessSecMsg_3
   1250                {
   1251                  ZDSecMgrRemoveDeviceInd( (ZDO_RemoveDeviceInd_t*)msgPtr );
   \   000033                ; Setup parameters for call to function ZDSecMgrRemoveDeviceInd
   \   000033   12....       LCALL   ??ZDSecMgrRemoveDeviceInd?relay
   \   000036   8010         SJMP    ??ZDApp_ProcessSecMsg_3
   1252                }
   1253                break;
   1254          
   1255              case ZDO_REQUEST_KEY_IND:
   1256                if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
   1257                {
   1258                  if ( ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE )
   1259                  {
   1260                    ZDSecMgrRequestKeyInd( (ZDO_RequestKeyInd_t*)msgPtr );
   1261                  }
   1262                }
   1263                break;
   1264          
   1265              case ZDO_SWITCH_KEY_IND:
   1266                if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   \                     ??ZDApp_ProcessSecMsg_2:
   \   000038   90....       MOV     DPTR,#zgDeviceLogicalType
   \   00003B   E0           MOVX    A,@DPTR
   \   00003C   6401         XRL     A,#0x1
   \   00003E   6005         JZ      ??ZDApp_ProcessSecMsg_5
   \   000040   E0           MOVX    A,@DPTR
   \   000041   6402         XRL     A,#0x2
   \   000043   7003         JNZ     ??ZDApp_ProcessSecMsg_3
   1267                {
   1268                  ZDSecMgrSwitchKeyInd( (ZDO_SwitchKeyInd_t*)msgPtr );
   \                     ??ZDApp_ProcessSecMsg_5:
   \   000045                ; Setup parameters for call to function ZDSecMgrSwitchKeyInd
   \   000045   12....       LCALL   ??ZDSecMgrSwitchKeyInd?relay
   1269                }
   1270                break;
   1271              
   1272              case ZDO_AUTHENTICATE_IND:
   1273                if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
   1274                {
   1275                  ZDSecMgrAuthenticateInd( (ZDO_AuthenticateInd_t*)msgPtr );
   1276                }
   1277                break;
   1278          
   1279              case ZDO_AUTHENTICATE_CFM:
   1280                if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
   1281                {
   1282                  ZDSecMgrAuthenticateCfm( (ZDO_AuthenticateCfm_t*)msgPtr );
   1283                }
   1284                break;
   1285          
   1286              default:
   1287                // Unsupported messages
   1288                break;
   1289            }
   1290          }
   \                     ??ZDApp_ProcessSecMsg_3:
   \   000048   02....       LJMP    ??Subroutine31_0 & 0xFFFF
   1291          
   1292          /*********************************************************************
   1293           * @fn      ZDApp_ProcessNetworkJoin()
   1294           *
   1295           * @brief
   1296           *
   1297           *   Save off the Network key information.
   1298           *
   1299           * @param   none
   1300           *
   1301           * @return  none
   1302           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1303          void ZDApp_ProcessNetworkJoin( void )
   \                     ZDApp_ProcessNetworkJoin:
   1304          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 2
   \   000005   74FE         MOV     A,#-0x2
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   1305            if ( (devState == DEV_NWK_JOINING) ||
   1306                ((devState == DEV_NWK_ORPHAN)  &&
   1307                 (ZDO_Config_Node_Descriptor.LogicalType == NODETYPE_ROUTER)) )
   \   00000A   90....       MOV     DPTR,#devState
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   6403         XRL     A,#0x3
   \   000010   6015         JZ      ??ZDApp_ProcessNetworkJoin_0
   \   000012   E0           MOVX    A,@DPTR
   \   000013   640A         XRL     A,#0xa
   \   000015   6003         JZ      $+5
   \   000017   02....       LJMP    ??ZDApp_ProcessNetworkJoin_1 & 0xFFFF
   \   00001A   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   00001D   E0           MOVX    A,@DPTR
   \   00001E   5407         ANL     A,#0x7
   \   000020   6401         XRL     A,#0x1
   \   000022   6003         JZ      $+5
   \   000024   02....       LJMP    ??ZDApp_ProcessNetworkJoin_2 & 0xFFFF
   1308            {
   1309              // Result of a Join attempt by this device.
   1310              if ( nwkStatus == ZSuccess )
   \                     ??ZDApp_ProcessNetworkJoin_0:
   \   000027   90....       MOV     DPTR,#nwkStatus
   \   00002A   E0           MOVX    A,@DPTR
   \   00002B   703A         JNZ     ??ZDApp_ProcessNetworkJoin_3
   1311              {
   1312                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   00002D                ; Setup parameters for call to function osal_set_event
   \   00002D   12....       LCALL   ?Subroutine4 & 0xFFFF
   1313          
   1314          #if defined ( POWER_SAVING )
   1315                osal_pwrmgr_device( PWRMGR_BATTERY );
   1316          #endif
   1317          
   1318                if ( ZG_SECURE_ENABLED && ( ZDApp_RestoreNwkKey() == false ) )
   1319                {
   1320                  // wait for auth from trust center!!
   1321                  devState = DEV_END_DEVICE_UNAUTH;
   1322          
   1323                  // Start the reset timer for MAX UNAUTH time
   1324                  ZDApp_ResetTimerStart( 10000 );//MAX_DEVICE_UNAUTH_TIMEOUT );
   1325                }
   1326                else
   1327                {
   1328                  if ( ZSTACK_ROUTER_BUILD )
   1329                  {
   1330                    if ( devState == DEV_NWK_ORPHAN 
   1331                      && ZDO_Config_Node_Descriptor.LogicalType != NODETYPE_DEVICE )
   \                     ??CrossCallReturnLabel_28:
   \   000030   90....       MOV     DPTR,#devState
   \   000033   E0           MOVX    A,@DPTR
   \   000034   640A         XRL     A,#0xa
   \   000036   700D         JNZ     ??ZDApp_ProcessNetworkJoin_4
   \   000038   12....       LCALL   ?Subroutine5 & 0xFFFF
   \                     ??CrossCallReturnLabel_5:
   \   00003B   6010         JZ      ??ZDApp_ProcessNetworkJoin_5
   1332                    {
   1333                      // Change NIB state to router for restore
   1334                      _NIB.nwkState = NWK_ROUTER;
   \   00003D   7408         MOV     A,#0x8
   \   00003F   90....       MOV     DPTR,#(_NIB + 35)
   \   000042   F0           MOVX    @DPTR,A
   \   000043   8008         SJMP    ??ZDApp_ProcessNetworkJoin_5
   1335                    }
   1336                  }
   1337                          
   1338                  if ( devState == DEV_NWK_JOINING )
   \                     ??ZDApp_ProcessNetworkJoin_4:
   \   000045   E0           MOVX    A,@DPTR
   \   000046   6403         XRL     A,#0x3
   \   000048   7003         JNZ     ??ZDApp_ProcessNetworkJoin_5
   1339                  {
   1340                    ZDApp_AnnounceNewAddress();
   \   00004A                ; Setup parameters for call to function ZDApp_AnnounceNewAddress
   \   00004A   12....       LCALL   ??ZDApp_AnnounceNewAddress?relay
   1341                  }
   1342                  
   1343                  devState = DEV_END_DEVICE;
   \                     ??ZDApp_ProcessNetworkJoin_5:
   \   00004D   7406         MOV     A,#0x6
   \   00004F   90....       MOV     DPTR,#devState
   \   000052   F0           MOVX    @DPTR,A
   1344                  if ( ZSTACK_ROUTER_BUILD )
   1345                  {
   1346                    // NOTE: first two parameters are not used, see NLMEDE.h for details
   1347                    if ( ZDO_Config_Node_Descriptor.LogicalType != NODETYPE_DEVICE )
   \   000053   12....       LCALL   ?Subroutine5 & 0xFFFF
   \                     ??CrossCallReturnLabel_6:
   \   000056   7003         JNZ     $+5
   \   000058   02....       LJMP    ??CrossCallReturnLabel_29 & 0xFFFF
   1348                    {
   1349                      NLME_StartRouterRequest( 0, 0, false );
   \   00005B                ; Setup parameters for call to function NLME_StartRouterRequest
   \   00005B   7B00         MOV     R3,#0x0
   \   00005D   7A00         MOV     R2,#0x0
   \   00005F   7900         MOV     R1,#0x0
   \   000061   12....       LCALL   ??NLME_StartRouterRequest?relay
   \   000064   02....       LJMP    ??CrossCallReturnLabel_29 & 0xFFFF
   1350                    }
   1351                  }
   1352                }
   1353              }
   1354              else
   1355              {
   1356                if ( (devStartMode == MODE_RESUME) && (++retryCnt >= MAX_RESUME_RETRY) )
   \                     ??ZDApp_ProcessNetworkJoin_3:
   \   000067   90....       MOV     DPTR,#devStartMode
   \   00006A   E0           MOVX    A,@DPTR
   \   00006B   6401         XRL     A,#0x1
   \   00006D   7031         JNZ     ??ZDApp_ProcessNetworkJoin_6
   \   00006F   90....       MOV     DPTR,#retryCnt
   \   000072   E0           MOVX    A,@DPTR
   \   000073   04           INC     A
   \   000074   F0           MOVX    @DPTR,A
   \   000075   C3           CLR     C
   \   000076   9403         SUBB    A,#0x3
   \   000078   4026         JC      ??ZDApp_ProcessNetworkJoin_6
   1357                {
   1358                  if ( _NIB.nwkPanId == 0xFFFF || _NIB.nwkPanId == INVALID_PAN_ID )
   \   00007A   12....       LCALL   ?Subroutine9 & 0xFFFF
   \                     ??CrossCallReturnLabel_9:
   \   00007D   7003         JNZ     ??ZDApp_ProcessNetworkJoin_7
   \   00007F   74FF         MOV     A,#-0x1
   \   000081   69           XRL     A,R1
   \                     ??ZDApp_ProcessNetworkJoin_7:
   \   000082   600A         JZ      ??ZDApp_ProcessNetworkJoin_8
   \   000084   74FE         MOV     A,#-0x2
   \   000086   68           XRL     A,R0
   \   000087   7003         JNZ     ??ZDApp_ProcessNetworkJoin_9
   \   000089   74FF         MOV     A,#-0x1
   \   00008B   69           XRL     A,R1
   \                     ??ZDApp_ProcessNetworkJoin_9:
   \   00008C   7006         JNZ     ??ZDApp_ProcessNetworkJoin_10
   1359                    devStartMode = MODE_JOIN;
   \                     ??ZDApp_ProcessNetworkJoin_8:
   \   00008E   E4           CLR     A
   \   00008F   90....       MOV     DPTR,#devStartMode
   \   000092   800B         SJMP    ??ZDApp_ProcessNetworkJoin_11
   1360                  else
   1361                  {
   1362                    devStartMode = MODE_REJOIN;
   \                     ??ZDApp_ProcessNetworkJoin_10:
   \   000094   7403         MOV     A,#0x3
   \   000096   90....       MOV     DPTR,#devStartMode
   \   000099   F0           MOVX    @DPTR,A
   1363                    _tmpRejoinState = true;
   \   00009A   7401         MOV     A,#0x1
   \   00009C   90....       MOV     DPTR,#_tmpRejoinState
   \                     ??ZDApp_ProcessNetworkJoin_11:
   \   00009F   F0           MOVX    @DPTR,A
   1364                  }
   1365                }
   1366          
   1367                if ( (NLME_GetShortAddr() != INVALID_NODE_ADDR) ||
   1368                     (_NIB.nwkDevAddress != INVALID_NODE_ADDR) )
   \                     ??ZDApp_ProcessNetworkJoin_6:
   \   0000A0                ; Setup parameters for call to function NLME_GetShortAddr
   \   0000A0   12....       LCALL   ??NLME_GetShortAddr?relay
   \   0000A3   8A..         MOV     ?V0 + 0,R2
   \   0000A5   8B..         MOV     ?V0 + 1,R3
   \   0000A7   74FE         MOV     A,#-0x2
   \   0000A9   65..         XRL     A,?V0 + 0
   \   0000AB   7004         JNZ     ??ZDApp_ProcessNetworkJoin_12
   \   0000AD   74FF         MOV     A,#-0x1
   \   0000AF   65..         XRL     A,?V0 + 1
   \                     ??ZDApp_ProcessNetworkJoin_12:
   \   0000B1   700E         JNZ     ??ZDApp_ProcessNetworkJoin_13
   \   0000B3   90....       MOV     DPTR,#(_NIB + 20)
   \   0000B6   E0           MOVX    A,@DPTR
   \   0000B7   64FE         XRL     A,#0xfe
   \   0000B9   7004         JNZ     ??ZDApp_ProcessNetworkJoin_14
   \   0000BB   A3           INC     DPTR
   \   0000BC   E0           MOVX    A,@DPTR
   \   0000BD   64FF         XRL     A,#0xff
   \                     ??ZDApp_ProcessNetworkJoin_14:
   \   0000BF   6026         JZ      ??ZDApp_ProcessNetworkJoin_15
   1369                {
   1370                  uint16 addr = INVALID_NODE_ADDR;
   \                     ??ZDApp_ProcessNetworkJoin_13:
   \   0000C1   85..82       MOV     DPL,?XSP + 0
   \   0000C4   85..83       MOV     DPH,?XSP + 1
   \   0000C7   74FE         MOV     A,#-0x2
   \   0000C9   F0           MOVX    @DPTR,A
   \   0000CA   A3           INC     DPTR
   \   0000CB   74FF         MOV     A,#-0x1
   \   0000CD   F0           MOVX    @DPTR,A
   1371                  // Invalidate nwk addr so end device does not use in its data reqs.
   1372                  _NIB.nwkDevAddress = INVALID_NODE_ADDR;
   \   0000CE   90....       MOV     DPTR,#(_NIB + 20)
   \   0000D1   74FE         MOV     A,#-0x2
   \   0000D3   F0           MOVX    @DPTR,A
   \   0000D4   A3           INC     DPTR
   \   0000D5   74FF         MOV     A,#-0x1
   \   0000D7   F0           MOVX    @DPTR,A
   1373                  ZMacSetReq( ZMacShortAddress, (uint8 *)&addr );
   \   0000D8                ; Setup parameters for call to function ZMacSetReq
   \   0000D8   85..82       MOV     DPL,?XSP + 0
   \   0000DB   85..83       MOV     DPH,?XSP + 1
   \   0000DE   AA82         MOV     R2,DPL
   \   0000E0   AB83         MOV     R3,DPH
   \   0000E2   7953         MOV     R1,#0x53
   \   0000E4   12....       LCALL   ??ZMacSetReq?relay
   1374                }
   1375          
   1376                // Clear the neighbor Table and network discovery tables.
   1377                nwkNeighborInitTable();
   \                     ??ZDApp_ProcessNetworkJoin_15:
   \   0000E7                ; Setup parameters for call to function nwkNeighborInitTable
   \   0000E7   12....       LCALL   ??nwkNeighborInitTable?relay
   1378                NLME_NwkDiscTerm();
   \   0000EA                ; Setup parameters for call to function NLME_NwkDiscTerm
   \   0000EA   12....       LCALL   ??NLME_NwkDiscTerm?relay
   1379          
   1380                zdoDiscCounter = 1;
   \   0000ED   7401         MOV     A,#0x1
   \   0000EF   90....       MOV     DPTR,#zdoDiscCounter
   \   0000F2   F0           MOVX    @DPTR,A
   1381          
   1382          //      ZDApp_NetworkInit( (uint16)
   1383          //                         ((NWK_START_DELAY * (osal_rand() & 0x0F)) +
   1384          //                          (NWK_START_DELAY * 5)) );
   1385                ZDApp_NetworkInit( (uint16)(NWK_START_DELAY
   1386                     + ((uint16)(osal_rand()& EXTENDED_JOINING_RANDOM_MASK))) );
   \   0000F3                ; Setup parameters for call to function ZDApp_NetworkInit
   \   0000F3                ; Setup parameters for call to function osal_rand
   1387              }
   1388            }
   \                     ??ZDApp_ProcessNetworkJoin_16:
   \   0000F3   12....       LCALL   ?Subroutine11 & 0xFFFF
   \                     ??CrossCallReturnLabel_14:
   \   0000F6   02....       LJMP    ??CrossCallReturnLabel_29 & 0xFFFF
   1389            else if ( devState == DEV_NWK_ORPHAN || devState == DEV_NWK_REJOIN )
   \                     ??ZDApp_ProcessNetworkJoin_1:
   \   0000F9   E0           MOVX    A,@DPTR
   \   0000FA   6404         XRL     A,#0x4
   \   0000FC   7072         JNZ     ??ZDApp_ProcessNetworkJoin_17
   1390            {
   1391              // results of an orphaning attempt by this device
   1392              if (nwkStatus == ZSuccess)
   \                     ??ZDApp_ProcessNetworkJoin_2:
   \   0000FE   90....       MOV     DPTR,#nwkStatus
   \   000101   E0           MOVX    A,@DPTR
   \   000102   7021         JNZ     ??ZDApp_ProcessNetworkJoin_18
   1393              {
   1394                if ( ZG_SECURE_ENABLED )
   1395                {
   1396                  ZDApp_RestoreNwkKey();
   1397                }
   1398                
   1399                devState = DEV_END_DEVICE;
   \   000104   12....       LCALL   ?Subroutine0 & 0xFFFF
   1400                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   1401                // setup Power Manager Device
   1402          #if defined ( POWER_SAVING )
   1403                osal_pwrmgr_device( PWRMGR_BATTERY );
   1404          #endif
   1405          
   1406                if ( ZDO_Config_Node_Descriptor.CapabilityFlags & CAPINFO_RCVR_ON_IDLE )
   \                     ??CrossCallReturnLabel_25:
   \   000107   90....       MOV     DPTR,#(ZDO_Config_Node_Descriptor + 2)
   \   00010A   E0           MOVX    A,@DPTR
   \   00010B   A2E3         MOV     C,0xE0 /* A   */.3
   \   00010D   5003         JNC     ??CrossCallReturnLabel_18
   1407                {
   1408                  // The receiver is on, turn network layer polling off.
   1409                  NLME_SetPollRate( 0 );
   \   00010F                ; Setup parameters for call to function NLME_SetPollRate
   \   00010F   12....       LCALL   ?Subroutine14 & 0xFFFF
   1410                  NLME_SetQueuedPollRate( 0 );
   1411                  NLME_SetResponseRate( 0 );
   1412                }
   1413          
   1414                if ( ZSTACK_ROUTER_BUILD )
   1415                {
   1416                  // NOTE: first two parameters are not used, see NLMEDE.h for details
   1417                  if ( ZDO_Config_Node_Descriptor.LogicalType != NODETYPE_DEVICE )
   \                     ??CrossCallReturnLabel_18:
   \   000112   12....       LCALL   ?Subroutine5 & 0xFFFF
   \                     ??CrossCallReturnLabel_7:
   \   000115   6009         JZ      ??ZDApp_ProcessNetworkJoin_19
   1418                  {
   1419                    NLME_StartRouterRequest( 0, 0, false );
   \   000117                ; Setup parameters for call to function NLME_StartRouterRequest
   \   000117   7B00         MOV     R3,#0x0
   \   000119   7A00         MOV     R2,#0x0
   \   00011B   7900         MOV     R1,#0x0
   \   00011D   12....       LCALL   ??NLME_StartRouterRequest?relay
   1420                  }
   1421                }
   1422                
   1423                ZDApp_AnnounceNewAddress();
   \                     ??ZDApp_ProcessNetworkJoin_19:
   \   000120                ; Setup parameters for call to function ZDApp_AnnounceNewAddress
   \   000120   12....       LCALL   ??ZDApp_AnnounceNewAddress?relay
   \   000123   8059         SJMP    ??CrossCallReturnLabel_29
   1424              }
   1425              else
   1426              {
   1427                if ( devStartMode == MODE_RESUME )
   \                     ??ZDApp_ProcessNetworkJoin_18:
   \   000125   90....       MOV     DPTR,#devStartMode
   \   000128   E0           MOVX    A,@DPTR
   \   000129   6401         XRL     A,#0x1
   \   00012B   703B         JNZ     ??ZDApp_ProcessNetworkJoin_20
   1428                {
   1429                  if ( ++retryCnt <= MAX_RESUME_RETRY )
   \   00012D   90....       MOV     DPTR,#retryCnt
   \   000130   E0           MOVX    A,@DPTR
   \   000131   04           INC     A
   \   000132   F0           MOVX    @DPTR,A
   \   000133   C3           CLR     C
   \   000134   9404         SUBB    A,#0x4
   \   000136   5028         JNC     ??ZDApp_ProcessNetworkJoin_21
   1430                  {
   1431                    if ( _NIB.nwkPanId == 0xFFFF || _NIB.nwkPanId == INVALID_PAN_ID )
   \   000138   12....       LCALL   ?Subroutine9 & 0xFFFF
   \                     ??CrossCallReturnLabel_10:
   \   00013B   7003         JNZ     ??ZDApp_ProcessNetworkJoin_22
   \   00013D   74FF         MOV     A,#-0x1
   \   00013F   69           XRL     A,R1
   \                     ??ZDApp_ProcessNetworkJoin_22:
   \   000140   600A         JZ      ??ZDApp_ProcessNetworkJoin_23
   \   000142   74FE         MOV     A,#-0x2
   \   000144   68           XRL     A,R0
   \   000145   7003         JNZ     ??ZDApp_ProcessNetworkJoin_24
   \   000147   74FF         MOV     A,#-0x1
   \   000149   69           XRL     A,R1
   \                     ??ZDApp_ProcessNetworkJoin_24:
   \   00014A   7007         JNZ     ??ZDApp_ProcessNetworkJoin_25
   1432                      devStartMode = MODE_JOIN;
   \                     ??ZDApp_ProcessNetworkJoin_23:
   \   00014C   E4           CLR     A
   \   00014D   90....       MOV     DPTR,#devStartMode
   \                     ??ZDApp_ProcessNetworkJoin_26:
   \   000150   F0           MOVX    @DPTR,A
   \   000151   8015         SJMP    ??ZDApp_ProcessNetworkJoin_20
   1433                    else
   1434                    {
   1435                      devStartMode = MODE_REJOIN;
   \                     ??ZDApp_ProcessNetworkJoin_25:
   \   000153   7403         MOV     A,#0x3
   \   000155   90....       MOV     DPTR,#devStartMode
   \   000158   F0           MOVX    @DPTR,A
   1436                      _tmpRejoinState = true;
   \   000159   7401         MOV     A,#0x1
   \   00015B   90....       MOV     DPTR,#_tmpRejoinState
   \   00015E   80F0         SJMP    ??ZDApp_ProcessNetworkJoin_26
   1437                    }
   1438                  }
   1439                  // Do a normal join to the network after certain times of rejoin retries
   1440                  else if( AIB_apsUseInsecureJoin == true )
   \                     ??ZDApp_ProcessNetworkJoin_21:
   \   000160   90....       MOV     DPTR,#AIB_apsUseInsecureJoin
   \   000163   E0           MOVX    A,@DPTR
   \   000164   6401         XRL     A,#0x1
   \   000166   60E4         JZ      ??ZDApp_ProcessNetworkJoin_23
   1441                  {
   1442                    devStartMode = MODE_JOIN;
   1443                  }
   1444                }
   1445          
   1446                // Clear the neighbor Table and network discovery tables.
   1447                nwkNeighborInitTable();
   \                     ??ZDApp_ProcessNetworkJoin_20:
   \   000168                ; Setup parameters for call to function nwkNeighborInitTable
   \   000168   12....       LCALL   ??nwkNeighborInitTable?relay
   1448                NLME_NwkDiscTerm();
   \   00016B                ; Setup parameters for call to function NLME_NwkDiscTerm
   \   00016B   12....       LCALL   ??NLME_NwkDiscTerm?relay
   1449          
   1450                // setup a retry for later...
   1451                ZDApp_NetworkInit( (uint16)(NWK_START_DELAY
   1452                     + (osal_rand()& EXTENDED_JOINING_RANDOM_MASK)) );
   \   00016E                ; Setup parameters for call to function ZDApp_NetworkInit
   \   00016E                ; Setup parameters for call to function osal_rand
   \   00016E   8083         SJMP    ??ZDApp_ProcessNetworkJoin_16
   1453              }
   1454            }
   1455          #if defined ( ZIGBEE_STOCHASTIC_ADDRESSING )
   1456            else
   1457            {
   1458              // Assume from address conflict
   1459              if ( _NIB.nwkAddrAlloc == NWK_ADDRESSING_STOCHASTIC )
   \                     ??ZDApp_ProcessNetworkJoin_17:
   \   000170   90....       MOV     DPTR,#(_NIB + 96)
   \   000173   E0           MOVX    A,@DPTR
   \   000174   6402         XRL     A,#0x2
   \   000176   7006         JNZ     ??CrossCallReturnLabel_29
   1460              {
   1461                // Notify the network
   1462                ZDApp_AnnounceNewAddress();
   \   000178                ; Setup parameters for call to function ZDApp_AnnounceNewAddress
   \   000178   12....       LCALL   ??ZDApp_AnnounceNewAddress?relay
   1463                
   1464                // Notify apps
   1465                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   00017B                ; Setup parameters for call to function osal_set_event
   \   00017B   12....       LCALL   ?Subroutine4 & 0xFFFF
   1466              }
   1467            }
   1468          #endif
   1469          }
   \                     ??CrossCallReturnLabel_29:
   \   00017E   02....       LJMP    ?Subroutine20 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine9:
   \   000000   90....       MOV     DPTR,#(_NIB + 33)
   \   000003   E0           MOVX    A,@DPTR
   \   000004   F8           MOV     R0,A
   \   000005   A3           INC     DPTR
   \   000006   E0           MOVX    A,@DPTR
   \   000007   F9           MOV     R1,A
   \   000008   74FF         MOV     A,#-0x1
   \   00000A   68           XRL     A,R0
   \   00000B   22           RET
   1470          
   1471          /*********************************************************************
   1472           * @fn      ZDApp_SaveNwkKey()
   1473           *
   1474           * @brief   Save off the Network key information.
   1475           *
   1476           * @param   none
   1477           *
   1478           * @return  none
   1479           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1480          void ZDApp_SaveNwkKey( void )
   \                     ZDApp_SaveNwkKey:
   1481          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 21
   \   000005   74EB         MOV     A,#-0x15
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   1482            nwkActiveKeyItems keyItems;
   1483          
   1484            SSP_ReadNwkActiveKey( &keyItems );
   \   00000A                ; Setup parameters for call to function SSP_ReadNwkActiveKey
   \   00000A   85..82       MOV     DPL,?XSP + 0
   \   00000D   85..83       MOV     DPH,?XSP + 1
   \   000010   AA82         MOV     R2,DPL
   \   000012   AB83         MOV     R3,DPH
   \   000014   12....       LCALL   ??SSP_ReadNwkActiveKey?relay
   1485            keyItems.frameCounter++;
   \   000017   90....       MOV     DPTR,#__Constant_1
   \   00001A   78..         MOV     R0,#?V0 + 0
   \   00001C   12....       LCALL   ?L_MOV_X
   \   00001F   7411         MOV     A,#0x11
   \   000021   12....       LCALL   ?XSTACK_DISP0_8
   \   000024   78..         MOV     R0,#?V0 + 0
   \   000026   12....       LCALL   ?L_ADD_TO_X
   1486          
   1487            osal_nv_write( ZCD_NV_NWKKEY, 0, sizeof( nwkActiveKeyItems ),
   1488                          (void *)&keyItems );
   \   000029                ; Setup parameters for call to function osal_nv_write
   \   000029   85..82       MOV     DPL,?XSP + 0
   \   00002C   85..83       MOV     DPH,?XSP + 1
   \   00002F   8582..       MOV     ?V0 + 0,DPL
   \   000032   8583..       MOV     ?V0 + 1,DPH
   \   000035   78..         MOV     R0,#?V0 + 0
   \   000037   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00003A   75..15       MOV     ?V0 + 0,#0x15
   \   00003D   75..00       MOV     ?V0 + 1,#0x0
   \   000040   78..         MOV     R0,#?V0 + 0
   \   000042   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000045   12....       LCALL   ?Subroutine17 & 0xFFFF
   \                     ??CrossCallReturnLabel_40:
   \   000048   12....       LCALL   ?DEALLOC_XSTACK8
   1489          
   1490            nwkFrameCounterChanges = 0;
   \   00004B   90....       MOV     DPTR,#nwkFrameCounterChanges
   \   00004E   E4           CLR     A
   \   00004F   F0           MOVX    @DPTR,A
   \   000050   A3           INC     DPTR
   \   000051   F0           MOVX    @DPTR,A
   1491          }
   \   000052                REQUIRE ?Subroutine23
   \   000052                ; // Fall through to label ?Subroutine23

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine23:
   \   000000   7415         MOV     A,#0x15
   \   000002   12....       LCALL   ?DEALLOC_XSTACK8
   \   000005   7F04         MOV     R7,#0x4
   \   000007   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine17:
   \   000000   7C00         MOV     R4,#0x0
   \   000002   7D00         MOV     R5,#0x0
   \   000004   7A82         MOV     R2,#-0x7e
   \   000006                REQUIRE ??Subroutine29_0
   \   000006                ; // Fall through to label ??Subroutine29_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine29_0:
   \   000000   7B00         MOV     R3,#0x0
   \   000002   12....       LCALL   ??osal_nv_write?relay
   \   000005   7404         MOV     A,#0x4
   \   000007   22           RET
   1492          
   1493          /*********************************************************************
   1494           * @fn      ZDApp_ResetNwkKey()
   1495           *
   1496           * @brief   Reset the Network key information in NV.
   1497           *
   1498           * @param   none
   1499           *
   1500           * @return  none
   1501           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1502          void ZDApp_ResetNwkKey( void )
   \                     ZDApp_ResetNwkKey:
   1503          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 21
   \   000005   74EB         MOV     A,#-0x15
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   1504            nwkActiveKeyItems keyItems;
   1505          
   1506            osal_memset( &keyItems, 0, sizeof( nwkActiveKeyItems ) );
   \   00000A                ; Setup parameters for call to function osal_memset
   \   00000A   7C15         MOV     R4,#0x15
   \   00000C   12....       LCALL   ?Subroutine15 & 0xFFFF
   1507            osal_nv_write( ZCD_NV_NWKKEY, 0, sizeof( nwkActiveKeyItems ),
   1508                          (void *)&keyItems );
   \                     ??CrossCallReturnLabel_20:
   \   00000F   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000012   75..15       MOV     ?V0 + 0,#0x15
   \   000015   75..00       MOV     ?V0 + 1,#0x0
   \   000018   78..         MOV     R0,#?V0 + 0
   \   00001A   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00001D   12....       LCALL   ?Subroutine17 & 0xFFFF
   \                     ??CrossCallReturnLabel_41:
   \   000020   12....       LCALL   ?DEALLOC_XSTACK8
   1509          }
   \   000023   02....       LJMP    ?Subroutine25 & 0xFFFF
   1510          
   1511          /*********************************************************************
   1512           * @fn      ZDApp_RestoreNwkKey()
   1513           *
   1514           * @brief
   1515           *
   1516           *   Save off the Network key information.
   1517           *
   1518           * @param   none
   1519           *
   1520           * @return  true if restored from NV, false if not
   1521           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1522          uint8 ZDApp_RestoreNwkKey( void )
   \                     ZDApp_RestoreNwkKey:
   1523          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 21
   \   000005   74EB         MOV     A,#-0x15
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   1524            nwkActiveKeyItems keyItems;
   1525            uint8 ret = false;
   \   00000A   7E00         MOV     R6,#0x0
   1526          
   1527            if ( osal_nv_read( ZCD_NV_NWKKEY, 0, sizeof(nwkActiveKeyItems), (void*)&keyItems )
   1528                == ZSUCCESS )
   \   00000C                ; Setup parameters for call to function osal_nv_read
   \   00000C   85..82       MOV     DPL,?XSP + 0
   \   00000F   85..83       MOV     DPH,?XSP + 1
   \   000012   8582..       MOV     ?V0 + 0,DPL
   \   000015   8583..       MOV     ?V0 + 1,DPH
   \   000018   78..         MOV     R0,#?V0 + 0
   \   00001A   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00001D   75..15       MOV     ?V0 + 0,#0x15
   \   000020   8E..         MOV     ?V0 + 1,R6
   \   000022   78..         MOV     R0,#?V0 + 0
   \   000024   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000027   7C00         MOV     R4,#0x0
   \   000029   7D00         MOV     R5,#0x0
   \   00002B   7A82         MOV     R2,#-0x7e
   \   00002D   7B00         MOV     R3,#0x0
   \   00002F   12....       LCALL   ??osal_nv_read?relay
   \   000032   7404         MOV     A,#0x4
   \   000034   12....       LCALL   ?DEALLOC_XSTACK8
   \   000037   E9           MOV     A,R1
   \   000038   702F         JNZ     ??ZDApp_RestoreNwkKey_0
   1529            {
   1530              if ( keyItems.frameCounter > 0 )
   \   00003A   7411         MOV     A,#0x11
   \   00003C   12....       LCALL   ?XSTACK_DISP0_8
   \   00003F   78..         MOV     R0,#?V0 + 0
   \   000041   12....       LCALL   ?L_MOV_X
   \   000044   90....       MOV     DPTR,#__Constant_0
   \   000047   78..         MOV     R0,#?V0 + 0
   \   000049   12....       LCALL   ?L_EQ_X
   \   00004C   6011         JZ      ??ZDApp_RestoreNwkKey_1
   1531              {
   1532                // Restore the key information
   1533                keyItems.frameCounter += MAX_NWK_FRAMECOUNTER_CHANGES;
   1534                nwkFrameCounter = keyItems.frameCounter;
   \   00004E   90....       MOV     DPTR,#__Constant_3e8
   \   000051   78..         MOV     R0,#?V0 + 0
   \   000053   12....       LCALL   ?L_ADD_X
   \   000056   90....       MOV     DPTR,#nwkFrameCounter
   \   000059   78..         MOV     R0,#?V0 + 0
   \   00005B   12....       LCALL   ?L_MOV_TO_X
   1535                ret = true;
   \   00005E   0E           INC     R6
   1536              }
   1537          
   1538              // Force a save for the first frame counter increment
   1539              nwkFrameCounterChanges = MAX_NWK_FRAMECOUNTER_CHANGES + 1;
   \                     ??ZDApp_RestoreNwkKey_1:
   \   00005F   90....       MOV     DPTR,#nwkFrameCounterChanges
   \   000062   74E9         MOV     A,#-0x17
   \   000064   F0           MOVX    @DPTR,A
   \   000065   A3           INC     DPTR
   \   000066   7403         MOV     A,#0x3
   \   000068   F0           MOVX    @DPTR,A
   1540            }
   1541            return ( ret );
   \                     ??ZDApp_RestoreNwkKey_0:
   \   000069   EE           MOV     A,R6
   \   00006A   F9           MOV     R1,A
   \   00006B   02....       LJMP    ?Subroutine23 & 0xFFFF
   1542          }
   1543          
   1544          /*********************************************************************
   1545           * @fn      ZDApp_ResetTimerStart
   1546           *
   1547           * @brief   Start the reset timer.
   1548           *
   1549           * @param   delay - delay time(ms) before reset
   1550           *
   1551           * @return  none
   1552           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1553          void ZDApp_ResetTimerStart( uint16 delay )
   \                     ZDApp_ResetTimerStart:
   1554          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1555            // Start the rest timer
   1556            osal_start_timerEx( ZDAppTaskID, ZDO_DEVICE_RESET, delay );
   \   000004                ; Setup parameters for call to function osal_start_timerEx
   \   000004   EA           MOV     A,R2
   \   000005   FC           MOV     R4,A
   \   000006   EB           MOV     A,R3
   \   000007   FD           MOV     R5,A
   \   000008   7A04         MOV     R2,#0x4
   \   00000A   12....       LCALL   ?Subroutine6 & 0xFFFF
   1557          }
   \                     ??CrossCallReturnLabel_45:
   \   00000D   02....       LJMP    ??Subroutine31_0 & 0xFFFF
   1558          
   1559          /*********************************************************************
   1560           * @fn      ZDApp_ResetTimerCancel
   1561           *
   1562           * @brief   Cancel the reset timer.
   1563           *
   1564           * @param   none
   1565           *
   1566           * @return  none
   1567           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1568          void ZDApp_ResetTimerCancel( void )
   \                     ZDApp_ResetTimerCancel:
   1569          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1570            // Cancel the reset timer
   1571            osal_stop_timerEx( ZDAppTaskID, ZDO_DEVICE_RESET );
   \   000004                ; Setup parameters for call to function osal_stop_timerEx
   \   000004   7A04         MOV     R2,#0x4
   \   000006   7B00         MOV     R3,#0x0
   \   000008   90....       MOV     DPTR,#ZDAppTaskID
   \   00000B   E0           MOVX    A,@DPTR
   \   00000C   F9           MOV     R1,A
   \   00000D   12....       LCALL   ??osal_stop_timerEx?relay
   1572          }
   \   000010   02....       LJMP    ??Subroutine31_0 & 0xFFFF
   1573          
   1574          /*********************************************************************
   1575           * @fn      ZDApp_LeaveCtrlInit
   1576           *
   1577           * @brief   Initialize the leave control logic.
   1578           *
   1579           * @param   none
   1580           *
   1581           * @return  none
   1582           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1583          void ZDApp_LeaveCtrlInit( void )
   \                     ZDApp_LeaveCtrlInit:
   1584          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   1585            uint8 status;
   1586          
   1587          
   1588            // Initialize control state
   1589            ZDApp_LeaveCtrl = ZDAPP_LEAVE_CTRL_INIT;
   \   000005   12....       LCALL   ?Subroutine2 & 0xFFFF
   1590          
   1591            status = osal_nv_item_init( ZCD_NV_LEAVE_CTRL,
   1592                                        sizeof(ZDApp_LeaveCtrl),
   1593                                        &ZDApp_LeaveCtrl );
   1594          
   1595            if ( status == ZSUCCESS )
   \                     ??CrossCallReturnLabel_2:
   \   000008   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00000B   7C01         MOV     R4,#0x1
   \   00000D   7D00         MOV     R5,#0x0
   \   00000F   7A85         MOV     R2,#-0x7b
   \   000011   7B00         MOV     R3,#0x0
   \   000013   12....       LCALL   ??osal_nv_item_init?relay
   \   000016   7402         MOV     A,#0x2
   \   000018   12....       LCALL   ?DEALLOC_XSTACK8
   \   00001B   E9           MOV     A,R1
   \   00001C   7020         JNZ     ??ZDApp_LeaveCtrlInit_0
   1596            {
   1597              // Read saved control
   1598              osal_nv_read( ZCD_NV_LEAVE_CTRL,
   1599                            0,
   1600                            sizeof( uint8 ),
   1601                            &ZDApp_LeaveCtrl);
   \   00001E                ; Setup parameters for call to function osal_nv_read
   \   00001E   78..         MOV     R0,#?V0 + 0
   \   000020   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000023   75..01       MOV     ?V0 + 0,#0x1
   \   000026   75..00       MOV     ?V0 + 1,#0x0
   \   000029   78..         MOV     R0,#?V0 + 0
   \   00002B   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00002E   7C00         MOV     R4,#0x0
   \   000030   7D00         MOV     R5,#0x0
   \   000032   7A85         MOV     R2,#-0x7b
   \   000034   7B00         MOV     R3,#0x0
   \   000036   12....       LCALL   ??osal_nv_read?relay
   \   000039   7404         MOV     A,#0x4
   \   00003B   12....       LCALL   ?DEALLOC_XSTACK8
   1602            }
   1603          }
   \                     ??ZDApp_LeaveCtrlInit_0:
   \   00003E   02....       LJMP    ??Subroutine27_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   E4           CLR     A
   \   000001   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   000004   F0           MOVX    @DPTR,A
   \   000005                ; Setup parameters for call to function osal_nv_item_init
   \   000005                ; Setup parameters for call to function osal_nv_write
   \   000005   75....       MOV     ?V0 + 0,#(ZDApp_LeaveCtrl & 0xff)
   \   000008   75....       MOV     ?V0 + 1,#((ZDApp_LeaveCtrl >> 8) & 0xff)
   \   00000B   78..         MOV     R0,#?V0 + 0
   \   00000D   22           RET
   1604          
   1605          /*********************************************************************
   1606           * @fn      ZDApp_LeaveCtrlSet
   1607           *
   1608           * @brief   Set the leave control logic.
   1609           *
   1610           * @param   ra - reassociate flag
   1611           *
   1612           * @return  none
   1613           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1614          void ZDApp_LeaveCtrlSet( uint8 ra )
   \                     ZDApp_LeaveCtrlSet:
   1615          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   1616            ZDApp_LeaveCtrl = ZDAPP_LEAVE_CTRL_SET;
   \   000005   7401         MOV     A,#0x1
   \   000007   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   00000A   F0           MOVX    @DPTR,A
   1617          
   1618            if ( ra == TRUE )
   \   00000B   69           XRL     A,R1
   \   00000C   7003         JNZ     ??ZDApp_LeaveCtrlSet_0
   1619            {
   1620              ZDApp_LeaveCtrl |= ZDAPP_LEAVE_CTRL_RA;
   \   00000E   7403         MOV     A,#0x3
   \   000010   F0           MOVX    @DPTR,A
   1621            }
   1622          
   1623            // Write the leave control
   1624            osal_nv_write( ZCD_NV_LEAVE_CTRL,
   1625                           0,
   1626                           sizeof( uint8 ),
   1627                           &ZDApp_LeaveCtrl);
   \                     ??ZDApp_LeaveCtrlSet_0:
   \   000011                ; Setup parameters for call to function osal_nv_write
   \   000011   75....       MOV     ?V0 + 0,#(ZDApp_LeaveCtrl & 0xff)
   \   000014   75....       MOV     ?V0 + 1,#((ZDApp_LeaveCtrl >> 8) & 0xff)
   \   000017   78..         MOV     R0,#?V0 + 0
   \   000019   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00001C   75..01       MOV     ?V0 + 0,#0x1
   \   00001F   75..00       MOV     ?V0 + 1,#0x0
   \   000022   78..         MOV     R0,#?V0 + 0
   \   000024   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000027   7C00         MOV     R4,#0x0
   \   000029   7D00         MOV     R5,#0x0
   \   00002B   7A85         MOV     R2,#-0x7b
   \   00002D   12....       LCALL   ??Subroutine29_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_42:
   \   000030   02....       LJMP    ??Subroutine26_0 & 0xFFFF
   1628          }
   1629          
   1630          /*********************************************************************
   1631           * @fn      ZDApp_LeaveCtrlBypass
   1632           *
   1633           * @brief   Check if NV restore should be skipped during a leave reset.
   1634           *
   1635           * @param   none
   1636           *
   1637           * @return  uint8 - (TRUE bypass:FALSE do not bypass)
   1638           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1639          uint8 ZDApp_LeaveCtrlBypass( void )
   \                     ZDApp_LeaveCtrlBypass:
   1640          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1641            uint8 bypass;
   1642          
   1643            if ( ZDApp_LeaveCtrl & ZDAPP_LEAVE_CTRL_SET )
   1644            {
   1645              bypass = TRUE;
   1646            }
   1647            else
   1648            {
   1649              bypass = FALSE;
   1650            }
   1651          
   1652            return bypass;
   \   000004   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   000007   E0           MOVX    A,@DPTR
   \   000008   A2E0         MOV     C,0xE0 /* A   */.0
   \   00000A   E4           CLR     A
   \   00000B   92E0         MOV     0xE0 /* A   */.0,C
   \   00000D   F9           MOV     R1,A
   \   00000E   80..         SJMP    ??Subroutine31_0
   1653          }
   1654          
   1655          /*********************************************************************
   1656           * @fn      ZDApp_LeaveCtrlStartup
   1657           *
   1658           * @brief   Check for startup conditions during a leave reset.
   1659           *
   1660           * @param   state      - devState_t determined by leave control logic
   1661           * @param   startDelay - startup delay
   1662           *
   1663           * @return  none
   1664           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1665          void ZDApp_LeaveCtrlStartup( devStates_t* state, uint16* startDelay )
   \                     ZDApp_LeaveCtrlStartup:
   1666          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   1667            *startDelay = 0;
   \   000005   8C82         MOV     DPL,R4
   \   000007   8D83         MOV     DPH,R5
   \   000009   E4           CLR     A
   \   00000A   F0           MOVX    @DPTR,A
   \   00000B   A3           INC     DPTR
   \   00000C   F0           MOVX    @DPTR,A
   1668          
   1669            if ( ZDApp_LeaveCtrl & ZDAPP_LEAVE_CTRL_SET )
   \   00000D   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   000010   E0           MOVX    A,@DPTR
   \   000011   A2E0         MOV     C,0xE0 /* A   */.0
   \   000013   5033         JNC     ??ZDApp_LeaveCtrlStartup_0
   1670            {
   1671              if ( ZDApp_LeaveCtrl & ZDAPP_LEAVE_CTRL_RA )
   \   000015   A2E1         MOV     C,0xE0 /* A   */.1
   \   000017   500C         JNC     ??ZDApp_LeaveCtrlStartup_1
   1672              {
   1673                *startDelay = 5000;
   \   000019   8C82         MOV     DPL,R4
   \   00001B   8D83         MOV     DPH,R5
   \   00001D   7488         MOV     A,#-0x78
   \   00001F   F0           MOVX    @DPTR,A
   \   000020   A3           INC     DPTR
   \   000021   7413         MOV     A,#0x13
   \   000023   8005         SJMP    ??ZDApp_LeaveCtrlStartup_2
   1674              }
   1675              else
   1676              {
   1677                *state = DEV_HOLD;
   \                     ??ZDApp_LeaveCtrlStartup_1:
   \   000025   E4           CLR     A
   \   000026   8A82         MOV     DPL,R2
   \   000028   8B83         MOV     DPH,R3
   \                     ??ZDApp_LeaveCtrlStartup_2:
   \   00002A   F0           MOVX    @DPTR,A
   1678              }
   1679          
   1680              // Set leave control to initialized state
   1681              ZDApp_LeaveCtrl = ZDAPP_LEAVE_CTRL_INIT;
   \   00002B   12....       LCALL   ?Subroutine2 & 0xFFFF
   1682          
   1683              // Write initialized control
   1684              osal_nv_write( ZCD_NV_LEAVE_CTRL,
   1685                            0,
   1686                            sizeof( uint8 ),
   1687                            &ZDApp_LeaveCtrl);
   1688            }
   \                     ??CrossCallReturnLabel_3:
   \   00002E   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000031   75..01       MOV     ?V0 + 0,#0x1
   \   000034   75..00       MOV     ?V0 + 1,#0x0
   \   000037   78..         MOV     R0,#?V0 + 0
   \   000039   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00003C   7C00         MOV     R4,#0x0
   \   00003E   7D00         MOV     R5,#0x0
   \   000040   7A85         MOV     R2,#-0x7b
   \   000042   12....       LCALL   ??Subroutine29_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_43:
   \   000045   12....       LCALL   ?DEALLOC_XSTACK8
   1689          }
   \                     ??ZDApp_LeaveCtrlStartup_0:
   \   000048   02....       LJMP    ??Subroutine27_0 & 0xFFFF
   1690          
   1691          /*********************************************************************
   1692           * @fn      ZDApp_LeaveReset
   1693           *
   1694           * @brief   Setup a device reset due to a leave indication/confirm.
   1695           *
   1696           * @param   ra - reassociate flag
   1697           *
   1698           * @return  none
   1699           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1700          void ZDApp_LeaveReset( uint8 ra )
   \                     ZDApp_LeaveReset:
   1701          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1702            ZDApp_LeaveCtrlSet( ra );
   \   000004                ; Setup parameters for call to function ZDApp_LeaveCtrlSet
   \   000004   12....       LCALL   ??ZDApp_LeaveCtrlSet?relay
   1703          
   1704            ZDApp_ResetTimerStart( 5000 );
   \   000007                ; Setup parameters for call to function ZDApp_ResetTimerStart
   \   000007   7A88         MOV     R2,#-0x78
   \   000009   7B13         MOV     R3,#0x13
   \   00000B   12....       LCALL   ??ZDApp_ResetTimerStart?relay
   1705          }
   \   00000E   80..         SJMP    ??Subroutine31_0
   1706          
   1707          /*********************************************************************
   1708           * @fn      ZDApp_LeaveUpdate
   1709           *
   1710           * @brief   Update local device data related to leaving device.
   1711           *
   1712           * @param   nwkAddr        - NWK address of leaving device
   1713           * @param   extAddr        - EXT address of leaving device
   1714           * @param   removeChildren - remove children of leaving device
   1715           *
   1716           * @return  none
   1717           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1718          void ZDApp_LeaveUpdate( uint16 nwkAddr, uint8* extAddr,
   \                     ZDApp_LeaveUpdate:
   1719                                  uint8 removeChildren )
   1720          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   \   000004   EC           MOV     A,R4
   \   000005   FA           MOV     R2,A
   \   000006   ED           MOV     A,R5
   \   000007   FB           MOV     R3,A
   1721            /*
   1722            AddrMgrEntry_t entry;
   1723            */
   1724            (void)nwkAddr;  // Intentionally unreferenced parameter
   1725          
   1726            // Remove if child
   1727            if ( ZSTACK_ROUTER_BUILD )
   1728            {
   1729              NLME_RemoveChild( extAddr, removeChildren );
   \   000008                ; Setup parameters for call to function NLME_RemoveChild
   \   000008   12....       LCALL   ??NLME_RemoveChild?relay
   1730            }
   1731          
   1732            /*
   1733            // Set NWK address to invalid
   1734            entry.user    = ADDRMGR_USER_DEFAULT;
   1735            entry.nwkAddr = INVALID_NODE_ADDR;
   1736            AddrMgrExtAddrSet( entry.extAddr, extAddr );
   1737            AddrMgrEntryUpdate( &entry );
   1738          
   1739            // Check
   1740            if ( removeChildren == TRUE )
   1741            {
   1742              // Set index to INVALID_NODE_ADDR to start search
   1743              entry.index = INVALID_NODE_ADDR;
   1744          
   1745              // Get first entry
   1746              AddrMgrEntryGetNext( &entry );
   1747          
   1748              // Remove all descendents
   1749              while ( entry.index != INVALID_NODE_ADDR )
   1750              {
   1751                // Check NWK address allocation algorithm
   1752                if ( RTG_ANCESTOR( entry.nwkAddr, thisAddr ) != 0 )
   1753                {
   1754                  // Set NWK address to invalid
   1755                  entry.nwkAddr = INVALID_NODE_ADDR;
   1756                  AddrMgrEntryUpdate( &entry );
   1757                }
   1758          
   1759                // Get next entry
   1760                AddrMgrEntryGetNext( &entry );
   1761              }
   1762            }
   1763            */
   1764          }
   \   00000B   80..         SJMP    ??Subroutine31_0
   1765          
   1766          /*********************************************************************
   1767           * CALLBACK FUNCTIONS
   1768           */
   1769          
   1770          
   1771          /*********************************************************************
   1772           * @fn      ZDApp_SendEventMsg()
   1773           *
   1774           * @brief
   1775           *
   1776           *   Sends a Network Join message
   1777           *
   1778           * @param  cmd - command ID
   1779           * @param  len - length (in bytes) of the buf field
   1780           * @param  buf - buffer for the rest of the message.
   1781           *
   1782           * @return  none
   1783           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1784          void ZDApp_SendEventMsg( uint8 cmd, uint8 len, uint8 *buf )
   \                     ZDApp_SendEventMsg:
   1785          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1786            ZDApp_SendMsg( ZDAppTaskID, cmd, len, buf );
   \   000004                ; Setup parameters for call to function ZDApp_SendMsg
   \   000004   EA           MOV     A,R2
   \   000005   FB           MOV     R3,A
   \   000006   E9           MOV     A,R1
   \   000007   FA           MOV     R2,A
   \   000008                REQUIRE ?Subroutine24
   \   000008                ; // Fall through to label ?Subroutine24
   1787          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine24:
   \   000000   12....       LCALL   ?Subroutine8 & 0xFFFF
   \                     ??CrossCallReturnLabel_33:
   \   000003   80..         SJMP    ??Subroutine31_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine8:
   \   000000   90....       MOV     DPTR,#ZDAppTaskID
   \   000003   E0           MOVX    A,@DPTR
   \   000004   F9           MOV     R1,A
   \   000005   12....       LCALL   ??ZDApp_SendMsg?relay
   \   000008   22           RET
   1788          
   1789          /*********************************************************************
   1790           * @fn      ZDApp_SendMsg()
   1791           *
   1792           * @brief   Sends a OSAL message
   1793           *
   1794           * @param  taskID - Where to send the message
   1795           * @param  cmd - command ID
   1796           * @param  len - length (in bytes) of the buf field
   1797           * @param  buf - buffer for the rest of the message.
   1798           *
   1799           * @return  none
   1800           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1801          void ZDApp_SendMsg( uint8 taskID, uint8 cmd, uint8 len, uint8 *buf )
   \                     ZDApp_SendMsg:
   1802          {
   \   000000   74EC         MOV     A,#-0x14
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 20
   \   000005                ; Auto size: 0
   \   000005   89..         MOV     ?V0 + 7,R1
   \   000007   8A..         MOV     ?V0 + 8,R2
   \   000009   8B..         MOV     ?V0 + 4,R3
   \   00000B   8C..         MOV     ?V0 + 2,R4
   \   00000D   8D..         MOV     ?V0 + 3,R5
   1803            osal_event_hdr_t *msgPtr;
   1804          
   1805            // Send the address to the task
   1806            msgPtr = (osal_event_hdr_t *)osal_msg_allocate( len );
   \   00000F   8B82         MOV     DPL,R3
   \   000011   8582..       MOV     ?V0 + 0,DPL
   \   000014                ; Setup parameters for call to function osal_msg_allocate
   \   000014   AA..         MOV     R2,?V0 + 0
   \   000016   7B00         MOV     R3,#0x0
   \   000018   12....       LCALL   ??osal_msg_allocate?relay
   \   00001B   8A..         MOV     ?V0 + 10,R2
   \   00001D   8B..         MOV     ?V0 + 11,R3
   \   00001F   AE..         MOV     R6,?V0 + 10
   \   000021   AF..         MOV     R7,?V0 + 11
   1807            if ( msgPtr )
   \   000023   EE           MOV     A,R6
   \   000024   7001         JNZ     ??ZDApp_SendMsg_0
   \   000026   EF           MOV     A,R7
   \                     ??ZDApp_SendMsg_0:
   \   000027   6036         JZ      ??ZDApp_SendMsg_1
   1808            {
   1809              if ( (len > 0) && (buf != NULL) )
   \   000029   E5..         MOV     A,?V0 + 4
   \   00002B   6022         JZ      ??ZDApp_SendMsg_2
   \   00002D   E5..         MOV     A,?V0 + 2
   \   00002F   7002         JNZ     ??ZDApp_SendMsg_3
   \   000031   E5..         MOV     A,?V0 + 3
   \                     ??ZDApp_SendMsg_3:
   \   000033   601A         JZ      ??ZDApp_SendMsg_2
   1810                osal_memcpy( msgPtr, buf, len );
   \   000035                ; Setup parameters for call to function osal_memcpy
   \   000035   85....       MOV     ?V0 + 4,?V0 + 2
   \   000038   85....       MOV     ?V0 + 5,?V0 + 3
   \   00003B   75..00       MOV     ?V0 + 6,#0x0
   \   00003E   78..         MOV     R0,#?V0 + 4
   \   000040   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   000043   AC..         MOV     R4,?V0 + 0
   \   000045   7D00         MOV     R5,#0x0
   \   000047   12....       LCALL   ??osal_memcpy?relay
   \   00004A   7403         MOV     A,#0x3
   \   00004C   12....       LCALL   ?DEALLOC_XSTACK8
   1811          
   1812              msgPtr->event = cmd;
   \                     ??ZDApp_SendMsg_2:
   \   00004F   8E82         MOV     DPL,R6
   \   000051   8F83         MOV     DPH,R7
   \   000053   E5..         MOV     A,?V0 + 8
   \   000055   F0           MOVX    @DPTR,A
   1813              osal_msg_send( taskID, (uint8 *)msgPtr );
   \   000056                ; Setup parameters for call to function osal_msg_send
   \   000056   EE           MOV     A,R6
   \   000057   FA           MOV     R2,A
   \   000058   EF           MOV     A,R7
   \   000059   FB           MOV     R3,A
   \   00005A   A9..         MOV     R1,?V0 + 7
   \   00005C   12....       LCALL   ??osal_msg_send?relay
   1814            }
   1815          }
   \                     ??ZDApp_SendMsg_1:
   \   00005F   7F0C         MOV     R7,#0xc
   \   000061   02....       LJMP    ?BANKED_LEAVE_XDATA
   1816          
   1817          /*********************************************************************
   1818           * Call Back Functions from NWK  - API
   1819           */
   1820          
   1821          /*********************************************************************
   1822           * @fn          ZDO_NetworkDiscoveryConfirmCB
   1823           *
   1824           * @brief       This function returns a choice of PAN to join.
   1825           *
   1826           * @param       ResultCount - Number of routers discovered
   1827           * @param               NetworkList - Pointer to list of network descriptors
   1828           *
   1829           * @return      ZStatus_t
   1830           */
   1831          #define STACK_PROFILE_MAX 2

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1832          ZStatus_t ZDO_NetworkDiscoveryConfirmCB( uint8 ResultCount,
   \                     ZDO_NetworkDiscoveryConfirmCB:
   1833                                                   networkDesc_t *NetworkList )
   1834          {
   \   000000   74EE         MOV     A,#-0x12
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 18
   \   000005                ; Auto size: 14
   \   000005   74F2         MOV     A,#-0xe
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   89..         MOV     ?V0 + 7,R1
   \   00000C   8A..         MOV     ?V0 + 4,R2
   \   00000E   8B..         MOV     ?V0 + 5,R3
   1835            networkDesc_t *pNwkDesc = NetworkList;
   1836            ZDO_NetworkDiscoveryCfm_t msg;
   1837            uint8 i = ResultCount;
   1838            uint8 stackProfile;
   1839            uint8 stackProfilePro;
   1840            uint8 selected;
   1841          
   1842          #if defined ( ZDO_MGMT_NWKDISC_RESPONSE )
   1843            if ( zdappMgmtNwkDiscReqInProgress )
   1844            {
   1845              zdappMgmtNwkDiscReqInProgress = false;
   1846              ZDO_FinishProcessingMgmtNwkDiscReq( ResultCount, NetworkList );
   1847              return ( ZSuccess );
   1848            }
   1849          #endif
   1850          
   1851            // process discovery results
   1852            stackProfilePro = FALSE;
   \   000010   75..00       MOV     ?V0 + 8,#0x0
   1853            selected = FALSE;
   1854          
   1855            for ( stackProfile = 0; stackProfile < STACK_PROFILE_MAX; stackProfile++ )
   \   000013   75..00       MOV     ?V0 + 6,#0x0
   1856            {
   1857              pNwkDesc = NetworkList;
   \                     ??ZDO_NetworkDiscoveryConfirmCB_0:
   \   000016   AE..         MOV     R6,?V0 + 4
   \   000018   AF..         MOV     R7,?V0 + 5
   1858              for ( i = 0; i < ResultCount; i++, pNwkDesc = pNwkDesc->nextDesc )
   \   00001A   75..00       MOV     ?V0 + 9,#0x0
   \   00001D   8020         SJMP    ??ZDO_NetworkDiscoveryConfirmCB_1
   1859              {
   1860                if ( zgConfigPANID != 0xFFFF )
   1861                {
   1862                  // PAN Id is preconfigured. check if it matches
   1863                  if ( pNwkDesc->panId != zgConfigPANID )
   1864                    continue;
   1865                }
   1866                
   1867          
   1868                if ( nwk_ExtPANIDValid( ZDO_UseExtendedPANID) == true ) 
   1869                {
   1870                  // If the extended Pan ID is commissioned to a non zero value
   1871                  // Only join the Pan that has match EPID
   1872                  if ( osal_ExtAddrEqual( ZDO_UseExtendedPANID, pNwkDesc->extendedPANID) == false )
   1873                    continue;
   1874                  
   1875                }
   1876          
   1877          
   1878                  // check that network is allowing joining
   1879                  if ( ZSTACK_ROUTER_BUILD )
   1880                  {
   1881                    if ( stackProfilePro == FALSE )
   1882                    {
   1883                      if ( !pNwkDesc->routerCapacity )
   1884                      {
   1885                        continue;
   1886                      }
   1887                    }
   1888                    else
   1889                    {
   1890                      if ( !pNwkDesc->deviceCapacity )
   1891                      {
   1892                        continue;
   1893                      }
   1894                    }
   1895                  }
   1896                  else if ( ZSTACK_END_DEVICE_BUILD )
   1897                  {
   1898                    if ( !pNwkDesc->deviceCapacity )
   1899                    {
   1900                      continue;
   1901                    }
   1902                  }
   1903          
   1904                  // check version of zigbee protocol
   1905                  if ( pNwkDesc->version != _NIB.nwkProtocolVersion )
   1906                    continue;
   1907          
   1908                  // check version of stack profile
   1909                  if ( pNwkDesc->stackProfile != zgStackProfile  )
   1910                  {
   1911                    if ( ((zgStackProfile == HOME_CONTROLS) && (pNwkDesc->stackProfile == ZIGBEEPRO_PROFILE)) 
   1912                        || ((zgStackProfile == ZIGBEEPRO_PROFILE) && (pNwkDesc->stackProfile == HOME_CONTROLS))  )
   \                     ??ZDO_NetworkDiscoveryConfirmCB_2:
   \   00001F   E0           MOVX    A,@DPTR
   \   000020   6402         XRL     A,#0x2
   \   000022   7008         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_3
   \   000024   7401         MOV     A,#0x1
   \   000026   6A           XRL     A,R2
   \   000027   7003         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_3
   1913                      stackProfilePro = TRUE;
   \                     ??ZDO_NetworkDiscoveryConfirmCB_4:
   \   000029   75..01       MOV     ?V0 + 8,#0x1
   1914                    
   1915                    if ( stackProfile == 0 )
   \                     ??ZDO_NetworkDiscoveryConfirmCB_3:
   \   00002C   E5..         MOV     A,?V0 + 6
   \   00002E   6003         JZ      $+5
   \   000030   02....       LJMP    ??ZDO_NetworkDiscoveryConfirmCB_5 & 0xFFFF
   \                     ??ZDO_NetworkDiscoveryConfirmCB_6:
   \   000033   05..         INC     ?V0 + 9
   \   000035   EE           MOV     A,R6
   \   000036   2416         ADD     A,#0x16
   \   000038   12....       LCALL   ??Subroutine32_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_50:
   \   00003B   FE           MOV     R6,A
   \   00003C   A3           INC     DPTR
   \   00003D   E0           MOVX    A,@DPTR
   \   00003E   FF           MOV     R7,A
   \                     ??ZDO_NetworkDiscoveryConfirmCB_1:
   \   00003F   EE           MOV     A,R6
   \   000040   2407         ADD     A,#0x7
   \   000042   F5..         MOV     ?V0 + 0,A
   \   000044   EF           MOV     A,R7
   \   000045   3400         ADDC    A,#0x0
   \   000047   F5..         MOV     ?V0 + 1,A
   \   000049   EE           MOV     A,R6
   \   00004A   240D         ADD     A,#0xd
   \   00004C   F5..         MOV     ?V0 + 2,A
   \   00004E   EF           MOV     A,R7
   \   00004F   3400         ADDC    A,#0x0
   \   000051   F5..         MOV     ?V0 + 3,A
   \   000053   E5..         MOV     A,?V0 + 9
   \   000055   C3           CLR     C
   \   000056   95..         SUBB    A,?V0 + 7
   \   000058   4003         JC      $+5
   \   00005A   02....       LJMP    ??ZDO_NetworkDiscoveryConfirmCB_7 & 0xFFFF
   \   00005D   90....       MOV     DPTR,#zgConfigPANID
   \   000060   E0           MOVX    A,@DPTR
   \   000061   64FF         XRL     A,#0xff
   \   000063   7004         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_8
   \   000065   A3           INC     DPTR
   \   000066   E0           MOVX    A,@DPTR
   \   000067   64FF         XRL     A,#0xff
   \                     ??ZDO_NetworkDiscoveryConfirmCB_8:
   \   000069   6015         JZ      ??ZDO_NetworkDiscoveryConfirmCB_9
   \   00006B   8E82         MOV     DPL,R6
   \   00006D   8F83         MOV     DPH,R7
   \   00006F   E0           MOVX    A,@DPTR
   \   000070   F8           MOV     R0,A
   \   000071   A3           INC     DPTR
   \   000072   E0           MOVX    A,@DPTR
   \   000073   F9           MOV     R1,A
   \   000074   90....       MOV     DPTR,#zgConfigPANID
   \   000077   E0           MOVX    A,@DPTR
   \   000078   68           XRL     A,R0
   \   000079   7003         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_10
   \   00007B   A3           INC     DPTR
   \   00007C   E0           MOVX    A,@DPTR
   \   00007D   69           XRL     A,R1
   \                     ??ZDO_NetworkDiscoveryConfirmCB_10:
   \   00007E   70B3         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_6
   \                     ??ZDO_NetworkDiscoveryConfirmCB_9:
   \   000080                ; Setup parameters for call to function nwk_ExtPANIDValid
   \   000080   7A..         MOV     R2,#(ZDO_UseExtendedPANID & 0xff)
   \   000082   7B..         MOV     R3,#((ZDO_UseExtendedPANID >> 8) & 0xff)
   \   000084   12....       LCALL   ??nwk_ExtPANIDValid?relay
   \   000087   E9           MOV     A,R1
   \   000088   6401         XRL     A,#0x1
   \   00008A   700E         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_11
   \   00008C                ; Setup parameters for call to function sAddrExtCmp
   \   00008C   AC..         MOV     R4,?V0 + 2
   \   00008E   AD..         MOV     R5,?V0 + 3
   \   000090   7A..         MOV     R2,#(ZDO_UseExtendedPANID & 0xff)
   \   000092   7B..         MOV     R3,#((ZDO_UseExtendedPANID >> 8) & 0xff)
   \   000094   12....       LCALL   ??sAddrExtCmp?relay
   \   000097   E9           MOV     A,R1
   \   000098   6099         JZ      ??ZDO_NetworkDiscoveryConfirmCB_6
   \                     ??ZDO_NetworkDiscoveryConfirmCB_11:
   \   00009A   E5..         MOV     A,?V0 + 8
   \   00009C   8E82         MOV     DPL,R6
   \   00009E   8F83         MOV     DPH,R7
   \   0000A0   A3           INC     DPTR
   \   0000A1   A3           INC     DPTR
   \   0000A2   A3           INC     DPTR
   \   0000A3   A3           INC     DPTR
   \   0000A4   A3           INC     DPTR
   \   0000A5   7005         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_12
   \   0000A7   E0           MOVX    A,@DPTR
   \   0000A8   7006         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_13
   \   0000AA   8087         SJMP    ??ZDO_NetworkDiscoveryConfirmCB_6
   \                     ??ZDO_NetworkDiscoveryConfirmCB_12:
   \   0000AC   A3           INC     DPTR
   \   0000AD   E0           MOVX    A,@DPTR
   \   0000AE   6083         JZ      ??ZDO_NetworkDiscoveryConfirmCB_6
   \                     ??ZDO_NetworkDiscoveryConfirmCB_13:
   \   0000B0   85..82       MOV     DPL,?V0 + 0
   \   0000B3   85..83       MOV     DPH,?V0 + 1
   \   0000B6   E0           MOVX    A,@DPTR
   \   0000B7   FA           MOV     R2,A
   \   0000B8   90....       MOV     DPTR,#(_NIB + 17)
   \   0000BB   E0           MOVX    A,@DPTR
   \   0000BC   6A           XRL     A,R2
   \   0000BD   6003         JZ      $+5
   \   0000BF   02....       LJMP    ??ZDO_NetworkDiscoveryConfirmCB_6 & 0xFFFF
   \   0000C2   8E82         MOV     DPL,R6
   \   0000C4   8F83         MOV     DPH,R7
   \   0000C6   A3           INC     DPTR
   \   0000C7   A3           INC     DPTR
   \   0000C8   A3           INC     DPTR
   \   0000C9   A3           INC     DPTR
   \   0000CA   A3           INC     DPTR
   \   0000CB   A3           INC     DPTR
   \   0000CC   A3           INC     DPTR
   \   0000CD   A3           INC     DPTR
   \   0000CE   E0           MOVX    A,@DPTR
   \   0000CF   FA           MOV     R2,A
   \   0000D0   90....       MOV     DPTR,#zgStackProfile
   \   0000D3   E0           MOVX    A,@DPTR
   \   0000D4   6A           XRL     A,R2
   \   0000D5   6033         JZ      ??ZDO_NetworkDiscoveryConfirmCB_5
   \   0000D7   E0           MOVX    A,@DPTR
   \   0000D8   6401         XRL     A,#0x1
   \   0000DA   6003         JZ      $+5
   \   0000DC   02....       LJMP    ??ZDO_NetworkDiscoveryConfirmCB_2 & 0xFFFF
   \   0000DF   7402         MOV     A,#0x2
   \   0000E1   6A           XRL     A,R2
   \   0000E2   6003         JZ      $+5
   \   0000E4   02....       LJMP    ??ZDO_NetworkDiscoveryConfirmCB_3 & 0xFFFF
   \   0000E7   02....       LJMP    ??ZDO_NetworkDiscoveryConfirmCB_4 & 0xFFFF
   1916                    {
   1917                      continue;
   1918                    }
   1919                  }
   1920          
   1921                // check if beacon order is the right value..
   1922                //  if ( pNwkDesc->beaconOrder < ZDO_CONFIG_MAX_BO )
   1923                //    continue;
   1924          
   1925                // choose this pan for joining
   1926                break;
   1927              } 
   1928              if (i < ResultCount)
   1929              {
   1930               selected = TRUE;
   1931                break;
   1932              }
   1933             
   1934              // break if selected or stack profile pro wasn't found
   1935              if ( (selected == TRUE) || (stackProfilePro == FALSE) )
   \                     ??ZDO_NetworkDiscoveryConfirmCB_7:
   \   0000EA   E5..         MOV     A,?V0 + 8
   \   0000EC   600C         JZ      ??ZDO_NetworkDiscoveryConfirmCB_14
   1936              {
   1937                break;
   1938              }
   1939            }
   \   0000EE   05..         INC     ?V0 + 6
   \   0000F0   E5..         MOV     A,?V0 + 6
   \   0000F2   C3           CLR     C
   \   0000F3   9402         SUBB    A,#0x2
   \   0000F5   5003         JNC     $+5
   \   0000F7   02....       LJMP    ??ZDO_NetworkDiscoveryConfirmCB_0 & 0xFFFF
   1940          
   1941            if ( i == ResultCount )
   \                     ??ZDO_NetworkDiscoveryConfirmCB_14:
   \   0000FA   E5..         MOV     A,?V0 + 7
   \   0000FC   65..         XRL     A,?V0 + 9
   \   0000FE   700A         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_5
   1942            {
   1943              msg.hdr.status = ZDO_FAIL;   // couldn't find appropriate PAN to join !
   \   000100   7401         MOV     A,#0x1
   \   000102   12....       LCALL   ?XSTACK_DISP0_8
   \   000105   7401         MOV     A,#0x1
   \   000107   F0           MOVX    @DPTR,A
   \   000108   8058         SJMP    ??ZDO_NetworkDiscoveryConfirmCB_15
   1944            }
   1945            else
   1946            {
   1947              msg.hdr.status = ZDO_SUCCESS;
   \                     ??ZDO_NetworkDiscoveryConfirmCB_5:
   \   00010A   7401         MOV     A,#0x1
   \   00010C   12....       LCALL   ?XSTACK_DISP0_8
   \   00010F   E4           CLR     A
   \   000110   F0           MOVX    @DPTR,A
   1948              msg.panIdLSB = LO_UINT16( pNwkDesc->panId );
   \   000111   8E82         MOV     DPL,R6
   \   000113   8F83         MOV     DPH,R7
   \   000115   E0           MOVX    A,@DPTR
   \   000116   C0E0         PUSH    A
   \   000118   7402         MOV     A,#0x2
   \   00011A   12....       LCALL   ?XSTACK_DISP0_8
   \   00011D   D0E0         POP     A
   \   00011F   F0           MOVX    @DPTR,A
   1949              msg.panIdMSB = HI_UINT16( pNwkDesc->panId );
   \   000120   8E82         MOV     DPL,R6
   \   000122   8F83         MOV     DPH,R7
   \   000124   A3           INC     DPTR
   \   000125   E0           MOVX    A,@DPTR
   \   000126   C0E0         PUSH    A
   \   000128   7403         MOV     A,#0x3
   \   00012A   12....       LCALL   ?XSTACK_DISP0_8
   \   00012D   D0E0         POP     A
   \   00012F   F0           MOVX    @DPTR,A
   1950              msg.logicalChannel = pNwkDesc->logicalChannel;
   \   000130   8E82         MOV     DPL,R6
   \   000132   8F83         MOV     DPH,R7
   \   000134   A3           INC     DPTR
   \   000135   A3           INC     DPTR
   \   000136   E0           MOVX    A,@DPTR
   \   000137   C0E0         PUSH    A
   \   000139   7404         MOV     A,#0x4
   \   00013B   12....       LCALL   ?XSTACK_DISP0_8
   \   00013E   D0E0         POP     A
   \   000140   F0           MOVX    @DPTR,A
   1951              msg.version = pNwkDesc->version;
   \   000141   85..82       MOV     DPL,?V0 + 0
   \   000144   85..83       MOV     DPH,?V0 + 1
   \   000147   E0           MOVX    A,@DPTR
   \   000148   C0E0         PUSH    A
   \   00014A   7405         MOV     A,#0x5
   \   00014C   12....       LCALL   ?XSTACK_DISP0_8
   \   00014F   D0E0         POP     A
   \   000151   F0           MOVX    @DPTR,A
   1952              osal_cpyExtAddr( msg.extendedPANID, pNwkDesc->extendedPANID );
   \   000152                ; Setup parameters for call to function sAddrExtCpy
   \   000152   AC..         MOV     R4,?V0 + 2
   \   000154   AD..         MOV     R5,?V0 + 3
   \   000156   7406         MOV     A,#0x6
   \   000158   12....       LCALL   ?XSTACK_DISP0_8
   \   00015B   AA82         MOV     R2,DPL
   \   00015D   AB83         MOV     R3,DPH
   \   00015F   12....       LCALL   ??sAddrExtCpy?relay
   1953            }
   1954          
   1955            ZDApp_SendMsg( ZDAppTaskID, ZDO_NWK_DISC_CNF, sizeof(ZDO_NetworkDiscoveryCfm_t), (uint8 *)&msg );
   \                     ??ZDO_NetworkDiscoveryConfirmCB_15:
   \   000162                ; Setup parameters for call to function ZDApp_SendMsg
   \   000162   85..82       MOV     DPL,?XSP + 0
   \   000165   85..83       MOV     DPH,?XSP + 1
   \   000168   AC82         MOV     R4,DPL
   \   00016A   AD83         MOV     R5,DPH
   \   00016C   7B0E         MOV     R3,#0xe
   \   00016E   7A01         MOV     R2,#0x1
   \   000170   12....       LCALL   ?Subroutine8 & 0xFFFF
   1956          
   1957            return (ZSuccess);
   \                     ??CrossCallReturnLabel_34:
   \   000173   7900         MOV     R1,#0x0
   \   000175   740E         MOV     A,#0xe
   \   000177   12....       LCALL   ?DEALLOC_XSTACK8
   \   00017A   7F0A         MOV     R7,#0xa
   \   00017C   02....       LJMP    ?BANKED_LEAVE_XDATA
   1958          }  // ZDO_NetworkDiscoveryConfirmCB
   1959          
   1960          /*********************************************************************
   1961           * @fn          ZDO_NetworkFormationConfirmCB
   1962           *
   1963           * @brief       This function reports the results of the request to
   1964           *              initialize a coordinator in a network.
   1965           *
   1966           * @param       Status - Result of NLME_NetworkFormationRequest()
   1967           *
   1968           * @return      none
   1969           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1970          void ZDO_NetworkFormationConfirmCB( ZStatus_t Status )
   \                     ZDO_NetworkFormationConfirmCB:
   1971          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1972            nwkStatus = (byte)Status;
   \   000004   E9           MOV     A,R1
   \   000005   90....       MOV     DPTR,#nwkStatus
   \   000008   F0           MOVX    @DPTR,A
   1973          
   1974            if ( Status == ZSUCCESS )
   \   000009   700A         JNZ     ??ZDO_NetworkFormationConfirmCB_0
   1975            {
   1976              // LED on shows Coordinator started
   1977              HalLedSet ( HAL_LED_3, HAL_LED_MODE_ON );
   \   00000B                ; Setup parameters for call to function HalLedSet
   \   00000B   12....       LCALL   ?Subroutine16 & 0xFFFF
   1978          
   1979              // LED off forgets HOLD_AUTO_START
   1980              HalLedSet (HAL_LED_4, HAL_LED_MODE_OFF);
   1981          
   1982          #if defined ( ZBIT )
   1983              SIM_SetColor(0xd0ffd0);
   1984          #endif
   1985          
   1986              if ( devState == DEV_HOLD )
   \                     ??CrossCallReturnLabel_21:
   \   00000E   700C         JNZ     ??ZDO_NetworkFormationConfirmCB_1
   1987              {
   1988                // Began with HOLD_AUTO_START
   1989                devState = DEV_COORD_STARTING;
   \   000010   7408         MOV     A,#0x8
   \   000012   F0           MOVX    @DPTR,A
   \   000013   8007         SJMP    ??ZDO_NetworkFormationConfirmCB_1
   1990              }
   1991            }
   1992          #if defined(BLINK_LEDS)
   1993            else
   1994              HalLedSet ( HAL_LED_3, HAL_LED_MODE_FLASH );  // Flash LED to show failure
   \                     ??ZDO_NetworkFormationConfirmCB_0:
   \   000015                ; Setup parameters for call to function HalLedSet
   \   000015   7A04         MOV     R2,#0x4
   \   000017   7904         MOV     R1,#0x4
   \   000019   12....       LCALL   ??HalLedSet?relay
   1995          #endif
   1996          
   1997            osal_set_event( ZDAppTaskID, ZDO_NETWORK_START );
   \                     ??ZDO_NetworkFormationConfirmCB_1:
   \   00001C                ; Setup parameters for call to function osal_set_event
   \   00001C   7A02         MOV     R2,#0x2
   \   00001E   02....       LJMP    ?Subroutine18 & 0xFFFF
   1998          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine16:
   \   000000   7A01         MOV     R2,#0x1
   \   000002   7904         MOV     R1,#0x4
   \   000004   12....       LCALL   ??HalLedSet?relay
   \   000007                ; Setup parameters for call to function HalLedSet
   \   000007                ; Setup parameters for call to function HalLedSet
   \   000007                ; Setup parameters for call to function HalLedSet
   \   000007   7A00         MOV     R2,#0x0
   \   000009   7908         MOV     R1,#0x8
   \   00000B   12....       LCALL   ??HalLedSet?relay
   \   00000E   90....       MOV     DPTR,#devState
   \   000011   E0           MOVX    A,@DPTR
   \   000012   22           RET
   1999          
   2000          /*********************************************************************
   2001           * @fn          ZDO_StartRouterConfirmCB
   2002           *
   2003           * @brief       This function reports the results of the request to
   2004           *              start functioning as a router in a network.
   2005           *
   2006           * @param       Status - Result of NLME_StartRouterRequest()
   2007           *
   2008           * @return      none
   2009           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2010          void ZDO_StartRouterConfirmCB( ZStatus_t Status )
   \                     ZDO_StartRouterConfirmCB:
   2011          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2012            nwkStatus = (byte)Status;
   \   000004   E9           MOV     A,R1
   \   000005   90....       MOV     DPTR,#nwkStatus
   \   000008   F0           MOVX    @DPTR,A
   2013          
   2014            if ( Status == ZSUCCESS )
   \   000009   700A         JNZ     ??ZDO_StartRouterConfirmCB_0
   2015            {
   2016              // LED on shows Router started
   2017              HalLedSet ( HAL_LED_3, HAL_LED_MODE_ON );
   \   00000B                ; Setup parameters for call to function HalLedSet
   \   00000B   12....       LCALL   ?Subroutine16 & 0xFFFF
   2018              // LED off forgets HOLD_AUTO_START
   2019              HalLedSet ( HAL_LED_4, HAL_LED_MODE_OFF);
   2020              if ( devState == DEV_HOLD )
   \                     ??CrossCallReturnLabel_22:
   \   00000E   700C         JNZ     ??ZDO_StartRouterConfirmCB_1
   2021              {
   2022                // Began with HOLD_AUTO_START
   2023                devState = DEV_END_DEVICE;
   \   000010   7406         MOV     A,#0x6
   \   000012   F0           MOVX    @DPTR,A
   \   000013   8007         SJMP    ??ZDO_StartRouterConfirmCB_1
   2024              }
   2025            }
   2026          #if defined(BLINK_LEDS)
   2027            else
   2028              HalLedSet( HAL_LED_3, HAL_LED_MODE_FLASH );  // Flash LED to show failure
   \                     ??ZDO_StartRouterConfirmCB_0:
   \   000015                ; Setup parameters for call to function HalLedSet
   \   000015   7A04         MOV     R2,#0x4
   \   000017   7904         MOV     R1,#0x4
   \   000019   12....       LCALL   ??HalLedSet?relay
   2029          #endif
   2030          
   2031            osal_set_event( ZDAppTaskID, ZDO_ROUTER_START );
   \                     ??ZDO_StartRouterConfirmCB_1:
   \   00001C                ; Setup parameters for call to function osal_set_event
   \   00001C   7A20         MOV     R2,#0x20
   \   00001E   02....       LJMP    ?Subroutine18 & 0xFFFF
   2032          }
   2033          
   2034          /*********************************************************************
   2035           * @fn          ZDO_JoinConfirmCB
   2036           *
   2037           * @brief       This function allows the next hight layer to be notified
   2038           *              of the results of its request to join itself or another
   2039           *              device to a network.
   2040           *
   2041           * @param       Status - Result of NLME_JoinRequest()
   2042           *
   2043           * @return      none
   2044           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2045          void ZDO_JoinConfirmCB( uint16 PanId, ZStatus_t Status )
   \                     ZDO_JoinConfirmCB:
   2046          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2047            (void)PanId;  // remove if this parameter is used.
   2048            
   2049            nwkStatus = (byte)Status;
   \   000004   E9           MOV     A,R1
   \   000005   90....       MOV     DPTR,#nwkStatus
   \   000008   F0           MOVX    @DPTR,A
   2050          
   2051            if ( Status == ZSUCCESS )
   \   000009   700A         JNZ     ??ZDO_JoinConfirmCB_0
   2052            {
   2053              // LED on shows device joined
   2054              HalLedSet ( HAL_LED_3, HAL_LED_MODE_ON );
   \   00000B                ; Setup parameters for call to function HalLedSet
   \   00000B   12....       LCALL   ?Subroutine16 & 0xFFFF
   2055              // LED off forgets HOLD_AUTO_START
   2056              HalLedSet ( HAL_LED_4, HAL_LED_MODE_OFF);
   2057              if ( (devState == DEV_HOLD) )
   \                     ??CrossCallReturnLabel_23:
   \   00000E   700C         JNZ     ??ZDO_JoinConfirmCB_1
   2058              {
   2059                // Began with HOLD_AUTO_START
   2060                devState = DEV_NWK_JOINING;
   \   000010   7403         MOV     A,#0x3
   \   000012   F0           MOVX    @DPTR,A
   \   000013   8007         SJMP    ??ZDO_JoinConfirmCB_1
   2061              }
   2062          
   2063              if ( !ZG_SECURE_ENABLED )
   2064              {
   2065                // Notify to save info into NV
   2066                ZDApp_NVUpdate();
   2067              }
   2068            }
   2069            else
   2070            {
   2071          #if defined(BLINK_LEDS)
   2072              HalLedSet ( HAL_LED_3, HAL_LED_MODE_FLASH );  // Flash LED to show failure
   \                     ??ZDO_JoinConfirmCB_0:
   \   000015                ; Setup parameters for call to function HalLedSet
   \   000015   7A04         MOV     R2,#0x4
   \   000017   7904         MOV     R1,#0x4
   \   000019   12....       LCALL   ??HalLedSet?relay
   2073          #endif
   2074            }
   2075          
   2076            // Notify ZDApp
   2077            ZDApp_SendMsg( ZDAppTaskID, ZDO_NWK_JOIN_IND, sizeof(osal_event_hdr_t), (byte*)NULL );
   \                     ??ZDO_JoinConfirmCB_1:
   \   00001C                ; Setup parameters for call to function ZDApp_SendMsg
   \   00001C   7C00         MOV     R4,#0x0
   \   00001E   7D00         MOV     R5,#0x0
   \   000020   7B02         MOV     R3,#0x2
   \   000022   7A02         MOV     R2,#0x2
   \   000024   02....       LJMP    ?Subroutine24 & 0xFFFF
   2078          }
   2079          
   2080          /*********************************************************************
   2081           * @fn          ZDO_AddrChangeIndicationCB
   2082           *
   2083           * @brief       This function notifies the application that this
   2084           *              device's address has changed.  Could happen in 
   2085           *              a network with stochastic addressing (PRO).
   2086           *
   2087           * @param       newAddr - the new address
   2088           *
   2089           * @return      none
   2090           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2091          void ZDO_AddrChangeIndicationCB( uint16 newAddr )
   \                     ZDO_AddrChangeIndicationCB:
   2092          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2093            (void)newAddr;  // remove if this parameter is used
   2094            
   2095            // Notify to save info into NV
   2096            ZDApp_NVUpdate();
   2097          
   2098            // Notify the applications   
   2099            osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   000004                ; Setup parameters for call to function osal_set_event
   \   000004   12....       LCALL   ?Subroutine4 & 0xFFFF
   2100          
   2101            // Send out a device announce
   2102            ZDApp_AnnounceNewAddress();
   \                     ??CrossCallReturnLabel_30:
   \   000007                ; Setup parameters for call to function ZDApp_AnnounceNewAddress
   \   000007   12....       LCALL   ??ZDApp_AnnounceNewAddress?relay
   2103          }
   \   00000A   02....       LJMP    ??Subroutine31_0 & 0xFFFF
   2104          
   2105          /*********************************************************************
   2106           * @fn          ZDO_JoinIndicationCB
   2107           *
   2108           * @brief       This function allows the next higher layer of a
   2109           *              coordinator to be notified of a remote join request.
   2110           *
   2111           * @param       ShortAddress - 16-bit address
   2112           * @param       ExtendedAddress - IEEE (64-bit) address
   2113           * @param       CapabilityInformation - Association Capability Information
   2114           * @param       type - of joining - 
   2115           *                          NWK_ASSOC_JOIN
   2116           *                          NWK_ASSOC_REJOIN_UNSECURE
   2117           *                          NWK_ASSOC_REJOIN_SECURE
   2118           *
   2119           * @return      ZStatus_t
   2120           */
   2121          ZStatus_t ZDO_JoinIndicationCB( uint16 ShortAddress, uint8 *ExtendedAddress,
   \                     ZDO_JoinIndicationCB:
   2122                                          uint8 CapabilityInformation, uint8 type )
   2123          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2124            (void)ShortAddress;
   2125            (void)ExtendedAddress;
   2126            (void)CapabilityInformation;
   2127            
   2128              // Notify to save info into NV
   2129              ZDApp_NVUpdate();
   2130            
   2131              // send notification to TC of new device..
   2132              if ( ZG_SECURE_ENABLED )
   2133              {
   2134                if ( type == NWK_ASSOC_JOIN || type == NWK_ASSOC_REJOIN_UNSECURE )
   2135                {
   2136                  osal_start_timerEx( ZDAppTaskID, ZDO_NEW_DEVICE, 600 );
   2137                }
   2138              }
   2139            
   2140              return ( ZSuccess );
   \   000000                REQUIRE ?Subroutine19
   \   000000                ; // Fall through to label ?Subroutine19

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine19:
   \   000000   7900         MOV     R1,#0x0
   \   000002   02....       LJMP    ?BRET
   2141          }
   2142          
   2143          /*********************************************************************
   2144           * @fn          ZDO_ConcentratorIndicationCB
   2145           *
   2146           * @brief       This function allows the next higher layer of a
   2147           *              device to be notified of existence of the concentrator.
   2148           *
   2149           * @param       nwkAddr - 16-bit NWK address of the concentrator
   2150           *
   2151           * @return      void 
   2152           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2153          void ZDO_ConcentratorIndicationCB( uint16 nwkAddr )
   \                     ZDO_ConcentratorIndicationCB:
   2154          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2155            // Write your code here to do something with the concentrator's
   2156            // address.
   2157            (void)nwkAddr;
   2158          }
   \   000000   02....       LJMP    ?BRET
   2159          
   2160          /*********************************************************************
   2161           * @fn          ZDO_LeaveCnf
   2162           *
   2163           * @brief       This function allows the next higher layer to be
   2164           *              notified of the results of its request for this or
   2165           *              a child device to leave the network.
   2166           *
   2167           * @param       cnf - NLME_LeaveCnf_t
   2168           *
   2169           * @return      none
   2170           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2171          void ZDO_LeaveCnf( NLME_LeaveCnf_t* cnf )
   \                     ZDO_LeaveCnf:
   2172          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   2173            // Check for this device
   2174            if ( osal_ExtAddrEqual( cnf->extAddr,
   2175                                    NLME_GetExtAddr() ) == TRUE )
   \   000009   EE           MOV     A,R6
   \   00000A   2402         ADD     A,#0x2
   \   00000C   F5..         MOV     ?V0 + 0,A
   \   00000E   EF           MOV     A,R7
   \   00000F   3400         ADDC    A,#0x0
   \   000011   F5..         MOV     ?V0 + 1,A
   \   000013                ; Setup parameters for call to function sAddrExtCmp
   \   000013                ; Setup parameters for call to function NLME_GetExtAddr
   \   000013   12....       LCALL   ??NLME_GetExtAddr?relay
   \   000016   EA           MOV     A,R2
   \   000017   FC           MOV     R4,A
   \   000018   EB           MOV     A,R3
   \   000019   FD           MOV     R5,A
   \   00001A   AA..         MOV     R2,?V0 + 0
   \   00001C   AB..         MOV     R3,?V0 + 1
   \   00001E   12....       LCALL   ??sAddrExtCmp?relay
   \   000021   E9           MOV     A,R1
   \   000022   6401         XRL     A,#0x1
   \   000024   700C         JNZ     ??ZDO_LeaveCnf_0
   2176            {
   2177              // Prepare to leave with reset
   2178              ZDApp_LeaveReset( cnf->rejoin );
   \   000026                ; Setup parameters for call to function ZDApp_LeaveReset
   \   000026   EE           MOV     A,R6
   \   000027   240B         ADD     A,#0xb
   \   000029   12....       LCALL   ??Subroutine32_0 & 0xFFFF
   2179            }
   \                     ??CrossCallReturnLabel_51:
   \   00002C   F9           MOV     R1,A
   \   00002D   12....       LCALL   ??ZDApp_LeaveReset?relay
   \   000030   8017         SJMP    ??ZDO_LeaveCnf_1
   2180            else if ( ZSTACK_ROUTER_BUILD )
   2181            {
   2182              // Remove device address(optionally descendents) from data
   2183              ZDApp_LeaveUpdate( cnf->dstAddr,
   2184                                 cnf->extAddr,
   2185                                 cnf->removeChildren );
   \                     ??ZDO_LeaveCnf_0:
   \   000032                ; Setup parameters for call to function NLME_RemoveChild
   \   000032   8E82         MOV     DPL,R6
   \   000034   8F83         MOV     DPH,R7
   \   000036   A3           INC     DPTR
   \   000037   A3           INC     DPTR
   \   000038   A3           INC     DPTR
   \   000039   A3           INC     DPTR
   \   00003A   A3           INC     DPTR
   \   00003B   A3           INC     DPTR
   \   00003C   A3           INC     DPTR
   \   00003D   A3           INC     DPTR
   \   00003E   A3           INC     DPTR
   \   00003F   A3           INC     DPTR
   \   000040   E0           MOVX    A,@DPTR
   \   000041   F9           MOV     R1,A
   \   000042   AA..         MOV     R2,?V0 + 0
   \   000044   AB..         MOV     R3,?V0 + 1
   \   000046   12....       LCALL   ??NLME_RemoveChild?relay
   2186            }
   2187          }
   \                     ??ZDO_LeaveCnf_1:
   \   000049   02....       LJMP    ??Subroutine27_0 & 0xFFFF
   2188          
   2189          /*********************************************************************
   2190           * @fn          ZDO_LeaveInd
   2191           *
   2192           * @brief       This function allows the next higher layer of a
   2193           *              device to be notified of a remote leave request or
   2194           *              indication.
   2195           *
   2196           * @param       ind - NLME_LeaveInd_t
   2197           *
   2198           * @return      none
   2199           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2200          void ZDO_LeaveInd( NLME_LeaveInd_t* ind )
   \                     ZDO_LeaveInd:
   2201          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 2
   \   000005   74FE         MOV     A,#-0x2
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
   2202            uint8 leave;
   2203          
   2204          
   2205            // Parent is requesting the leave - NWK layer filters out illegal
   2206            // requests
   2207            if ( ind->request == TRUE )
   \   00000E   EE           MOV     A,R6
   \   00000F   240C         ADD     A,#0xc
   \   000011   12....       LCALL   ?Subroutine13 & 0xFFFF
   \                     ??CrossCallReturnLabel_16:
   \   000014   240B         ADD     A,#0xb
   \   000016   18           DEC     R0
   \   000017   EF           MOV     A,R7
   \   000018   3400         ADDC    A,#0x0
   \   00001A   F9           MOV     R1,A
   \   00001B   88..         MOV     ?V0 + 2,R0
   \   00001D   89..         MOV     ?V0 + 3,R1
   \   00001F   8E82         MOV     DPL,R6
   \   000021   8F83         MOV     DPH,R7
   \   000023   A3           INC     DPTR
   \   000024   A3           INC     DPTR
   \   000025   A3           INC     DPTR
   \   000026   A3           INC     DPTR
   \   000027   A3           INC     DPTR
   \   000028   A3           INC     DPTR
   \   000029   A3           INC     DPTR
   \   00002A   A3           INC     DPTR
   \   00002B   A3           INC     DPTR
   \   00002C   A3           INC     DPTR
   \   00002D   E0           MOVX    A,@DPTR
   \   00002E   6401         XRL     A,#0x1
   \   000030   7031         JNZ     ??ZDO_LeaveInd_0
   2208            {
   2209              // Notify network of leave
   2210              if ( ZSTACK_ROUTER_BUILD )
   2211              {
   2212                NLME_LeaveRsp_t rsp;
   2213                rsp.rejoin         = ind->rejoin;
   \   000032   85..82       MOV     DPL,?V0 + 0
   \   000035   85..83       MOV     DPH,?V0 + 1
   \   000038   E0           MOVX    A,@DPTR
   \   000039   C0E0         PUSH    A
   \   00003B   7401         MOV     A,#0x1
   \   00003D   12....       LCALL   ?XSTACK_DISP0_8
   \   000040   D0E0         POP     A
   \   000042   F0           MOVX    @DPTR,A
   2214                rsp.removeChildren = ind->removeChildren;
   \   000043   8882         MOV     DPL,R0
   \   000045   8983         MOV     DPH,R1
   \   000047   E0           MOVX    A,@DPTR
   \   000048   85..82       MOV     DPL,?XSP + 0
   \   00004B   85..83       MOV     DPH,?XSP + 1
   \   00004E   F0           MOVX    @DPTR,A
   2215                NLME_LeaveRsp( &rsp );
   \   00004F                ; Setup parameters for call to function NLME_LeaveRsp
   \   00004F   AA82         MOV     R2,DPL
   \   000051   AB83         MOV     R3,DPH
   \   000053   12....       LCALL   ??NLME_LeaveRsp?relay
   2216              }
   2217          
   2218              // Prepare to leave with reset
   2219              ZDApp_LeaveReset( ind->rejoin );
   \   000056                ; Setup parameters for call to function ZDApp_LeaveReset
   \                     ??ZDO_LeaveInd_1:
   \   000056   85..82       MOV     DPL,?V0 + 0
   \   000059   85..83       MOV     DPH,?V0 + 1
   \   00005C   E0           MOVX    A,@DPTR
   \   00005D   F9           MOV     R1,A
   \   00005E   12....       LCALL   ??ZDApp_LeaveReset?relay
   \   000061   802D         SJMP    ??ZDO_LeaveInd_2
   2220            }
   2221            else
   2222            {
   2223              leave = FALSE;
   2224          
   2225              // Check if this device needs to leave as a child or descendent
   2226              if ( ind->srcAddr == NLME_GetCoordShortAddr() )
   \                     ??ZDO_LeaveInd_0:
   \   000063                ; Setup parameters for call to function NLME_GetCoordShortAddr
   \   000063   12....       LCALL   ??NLME_GetCoordShortAddr?relay
   \   000066   85..82       MOV     DPL,?V0 + 2
   \   000069   85..83       MOV     DPH,?V0 + 3
   \   00006C   E0           MOVX    A,@DPTR
   \   00006D   F9           MOV     R1,A
   \   00006E   8E82         MOV     DPL,R6
   \   000070   8F83         MOV     DPH,R7
   \   000072   E0           MOVX    A,@DPTR
   \   000073   6A           XRL     A,R2
   \   000074   7003         JNZ     ??ZDO_LeaveInd_3
   \   000076   A3           INC     DPTR
   \   000077   E0           MOVX    A,@DPTR
   \   000078   6B           XRL     A,R3
   \                     ??ZDO_LeaveInd_3:
   \   000079   700A         JNZ     ??ZDO_LeaveInd_4
   2227              {
   2228                if ( ( ind->removeChildren == TRUE               ) ||
   2229                     ( ZDO_Config_Node_Descriptor.LogicalType ==
   2230                       NODETYPE_DEVICE                           )    )
   \   00007B   7401         MOV     A,#0x1
   \   00007D   69           XRL     A,R1
   \   00007E   60D6         JZ      ??ZDO_LeaveInd_1
   \   000080   12....       LCALL   ?Subroutine5 & 0xFFFF
   \                     ??CrossCallReturnLabel_8:
   \   000083   60D1         JZ      ??ZDO_LeaveInd_1
   2231                {
   2232                  leave = TRUE;
   2233                }
   2234              }
   2235              else if ( ind->removeChildren == TRUE )
   2236              {
   2237                // Check NWK address allocation algorithm
   2238                //leave = RTG_ANCESTOR(nwkAddr,thisAddr);
   2239              }
   2240          
   2241              if ( leave == TRUE )
   2242              {
   2243                // Prepare to leave with reset
   2244                ZDApp_LeaveReset( ind->rejoin );
   \   000085                ; Setup parameters for call to function ZDApp_LeaveReset
   2245              }
   2246              else
   2247              {
   2248                // Remove device address(optionally descendents) from data
   2249                ZDApp_LeaveUpdate( ind->srcAddr,
   2250                                   ind->extAddr,
   2251                                   ind->removeChildren );
   \                     ??ZDO_LeaveInd_4:
   \   000085                ; Setup parameters for call to function NLME_RemoveChild
   \   000085   EE           MOV     A,R6
   \   000086   2402         ADD     A,#0x2
   \   000088   FA           MOV     R2,A
   \   000089   EF           MOV     A,R7
   \   00008A   3400         ADDC    A,#0x0
   \   00008C   FB           MOV     R3,A
   \   00008D   12....       LCALL   ??NLME_RemoveChild?relay
   2252              }
   2253            }
   2254          }
   \                     ??ZDO_LeaveInd_2:
   \   000090   7402         MOV     A,#0x2
   \   000092   12....       LCALL   ?DEALLOC_XSTACK8
   \   000095   7F06         MOV     R7,#0x6
   \   000097   02....       LJMP    ?BANKED_LEAVE_XDATA
   2255          
   2256          /*********************************************************************
   2257           * @fn          ZDO_SyncIndicationCB
   2258           *
   2259           * @brief       This function allows the next higher layer of a
   2260           *              coordinator to be notified of a loss of synchronization
   2261           *                          with the parent/child device.
   2262           *
   2263           * @param       type: 0 - child; 1 - parent
   2264           *
   2265           *
   2266           * @return      none
   2267           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2268          void ZDO_SyncIndicationCB( uint8 type, uint16 shortAddr )
   \                     ZDO_SyncIndicationCB:
   2269          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2270            (void)shortAddr;  // Remove this line if this parameter is used.
   2271            
   2272            if ( ZSTACK_END_DEVICE_BUILD
   2273              || (ZSTACK_ROUTER_BUILD && ((_NIB.CapabilityInfo & ZMAC_ASSOC_CAPINFO_FFD_TYPE) == 0)))
   \   000004   90....       MOV     DPTR,#(_NIB + 14)
   \   000007   E0           MOVX    A,@DPTR
   \   000008   A2E1         MOV     C,0xE0 /* A   */.1
   \   00000A   4013         JC      ??CrossCallReturnLabel_35
   2274            {
   2275              if ( type == 1 )
   \   00000C   7401         MOV     A,#0x1
   \   00000E   69           XRL     A,R1
   \   00000F   700E         JNZ     ??CrossCallReturnLabel_35
   2276              {
   2277                // We lost contact with our parent.  Clear the neighbor Table.
   2278                nwkNeighborInitTable();
   \   000011                ; Setup parameters for call to function nwkNeighborInitTable
   \   000011   12....       LCALL   ??nwkNeighborInitTable?relay
   2279                
   2280                // Start the rejoin process.
   2281                ZDApp_SendMsg( ZDAppTaskID, ZDO_NWK_JOIN_REQ, sizeof(osal_event_hdr_t), NULL );
   \   000014                ; Setup parameters for call to function ZDApp_SendMsg
   \   000014   7C00         MOV     R4,#0x0
   \   000016   7D00         MOV     R5,#0x0
   \   000018   7B02         MOV     R3,#0x2
   \   00001A   7A03         MOV     R2,#0x3
   \   00001C   12....       LCALL   ?Subroutine8 & 0xFFFF
   2282              }
   2283            }
   2284          }
   \                     ??CrossCallReturnLabel_35:
   \   00001F   02....       LJMP    ??Subroutine31_0 & 0xFFFF
   2285          
   2286          /*********************************************************************
   2287           * @fn          ZDO_ManytoOneFailureIndicationCB
   2288           *
   2289           * @brief       This function allows the next higher layer of a
   2290           *              concentrator to be notified of a many-to-one route 
   2291           *              failure. 
   2292           *
   2293           * @param       none
   2294           *
   2295           *
   2296           * @return      none
   2297           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2298          void ZDO_ManytoOneFailureIndicationCB()
   \                     ZDO_ManytoOneFailureIndicationCB:
   2299          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2300            // By default, the concentrator automatically redo many-to-one route 
   2301            // discovery to update all many-to-one routes in the network
   2302            // If you want anything processing other than the default,
   2303            // please replace the following code.
   2304            
   2305            RTG_MTORouteReq();
   \   000004                ; Setup parameters for call to function RTG_MTORouteReq
   \   000004   12....       LCALL   ??RTG_MTORouteReq?relay
   2306          }
   \   000007   02....       LJMP    ??Subroutine31_0 & 0xFFFF
   2307          
   2308          
   2309          /*********************************************************************
   2310           * @fn          ZDO_PollConfirmCB
   2311           *
   2312           * @brief       This function allows the next higher layer to be
   2313           *              notified of a Poll Confirm.
   2314           *
   2315           * @param       none
   2316           *
   2317           * @return      none
   2318           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2319          void ZDO_PollConfirmCB( uint8 status )
   \                     ZDO_PollConfirmCB:
   2320          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2321            (void)status;  // Remove this line if this parameter is used.
   2322            return;
   \   000000   02....       LJMP    ?BRET
   2323          }
   2324          
   2325          /******************************************************************************
   2326           * @fn          ZDApp_NwkWriteNVRequest (stubs AddrMgrWriteNVRequest)
   2327           *
   2328           * @brief       Stub routine implemented by NHLE. NHLE should call
   2329           *              <AddrMgrWriteNV> when appropriate.
   2330           *
   2331           * @param       none
   2332           *
   2333           * @return      none
   2334           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2335          void ZDApp_NwkWriteNVRequest( void )
   \                     AddrMgrWriteNVRequest:
   2336          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2337          #if defined ( NV_RESTORE )  
   2338            if ( !osal_get_timeoutEx( ZDAppTaskID, ZDO_NWK_UPDATE_NV ) )
   2339            {
   2340              // Trigger to save info into NV
   2341              ZDApp_NVUpdate();
   2342            }
   2343          #endif
   2344          }
   \   000000   02....       LJMP    ?BRET
   2345          
   2346          /*********************************************************************
   2347           * Call Back Functions from Security  - API
   2348           */
   2349          
   2350           /*********************************************************************
   2351           * @fn          ZDO_UpdateDeviceIndication
   2352           *
   2353           * @brief       This function notifies the "Trust Center" of a
   2354           *              network when a device joins or leaves the network.
   2355           *
   2356           * @param       extAddr - pointer to 64 bit address of new device
   2357           * @param       status  - 0 if a new device joined securely
   2358           *                      - 1 if a new device joined un-securely
   2359           *                      - 2 if a device left the network
   2360           *
   2361           * @return      true if newly joined device should be allowed to
   2362           *                                              remain on network
   2363           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2364          ZStatus_t ZDO_UpdateDeviceIndication( uint8 *extAddr, uint8 status )
   \                     ZDO_UpdateDeviceIndication:
   2365          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2366            // can implement a network access policy based on the
   2367            // IEEE address of newly joining devices...
   2368            (void)extAddr;
   2369            (void)status;
   2370            
   2371            return ZSuccess;
   \   000000   02....       LJMP    ?Subroutine19 & 0xFFFF
   2372          }
   2373          
   2374          /*********************************************************************
   2375           * @fn          ZDApp_InMsgCB
   2376           *
   2377           * @brief       This function is called to pass up any message that is
   2378           *              not yet supported.  This allows for the developer to
   2379           *              support features themselves..
   2380           *
   2381           * @return      none
   2382           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2383          void ZDApp_InMsgCB( zdoIncomingMsg_t *inMsg )
   \                     ZDApp_InMsgCB:
   2384          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   12....       LCALL   ?Subroutine12 & 0xFFFF
   2385            if ( inMsg->clusterID & ZDO_RESPONSE_BIT )
   \                     ??CrossCallReturnLabel_49:
   \   000008   F8           MOV     R0,A
   \   000009   A3           INC     DPTR
   \   00000A   E0           MOVX    A,@DPTR
   \   00000B   F9           MOV     R1,A
   \   00000C   7480         MOV     A,#-0x80
   \   00000E   59           ANL     A,R1
   \   00000F   FB           MOV     R3,A
   \   000010   E4           CLR     A
   \   000011   7001         JNZ     ??ZDApp_InMsgCB_0
   \   000013   EB           MOV     A,R3
   \                     ??ZDApp_InMsgCB_0:
   \   000014   7049         JNZ     ??ZDApp_InMsgCB_1
   2386            {
   2387              // Handle the response message
   2388            }
   2389            else
   2390            {
   2391              // Handle the request message by sending a generic "not supported".
   2392              // Device Announce doesn't have a response.
   2393              if ( !(inMsg->wasBroadcast) && inMsg->clusterID != Device_annce )
   \   000016   EE           MOV     A,R6
   \   000017   240B         ADD     A,#0xb
   \   000019   12....       LCALL   ??Subroutine32_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_52:
   \   00001C   7041         JNZ     ??ZDApp_InMsgCB_1
   \   00001E   7413         MOV     A,#0x13
   \   000020   68           XRL     A,R0
   \   000021   7001         JNZ     ??ZDApp_InMsgCB_2
   \   000023   E9           MOV     A,R1
   \                     ??ZDApp_InMsgCB_2:
   \   000024   6039         JZ      ??ZDApp_InMsgCB_1
   2394              {
   2395                ZDP_GenericRsp( inMsg->TransSeq, &(inMsg->srcAddr), ZDP_NOT_SUPPORTED, 0,
   2396                                (uint16)(inMsg->clusterID | ZDO_RESPONSE_BIT), inMsg->SecurityUse );
   \   000026                ; Setup parameters for call to function ZDP_GenericRsp
   \   000026   E8           MOV     A,R0
   \   000027   F5..         MOV     ?V0 + 0,A
   \   000029   7480         MOV     A,#-0x80
   \   00002B   49           ORL     A,R1
   \   00002C   F5..         MOV     ?V0 + 1,A
   \   00002E   78..         MOV     R0,#?V0 + 0
   \   000030   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000033   75..00       MOV     ?V0 + 0,#0x0
   \   000036   75..00       MOV     ?V0 + 1,#0x0
   \   000039   78..         MOV     R0,#?V0 + 0
   \   00003B   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00003E   EE           MOV     A,R6
   \   00003F   240E         ADD     A,#0xe
   \   000041   12....       LCALL   ??Subroutine32_0 & 0xFFFF
   2397              }
   2398            }
   \                     ??CrossCallReturnLabel_53:
   \   000044   FD           MOV     R5,A
   \   000045   7C84         MOV     R4,#-0x7c
   \   000047   EE           MOV     A,R6
   \   000048   2402         ADD     A,#0x2
   \   00004A   0A           INC     R2
   \   00004B   0A           INC     R2
   \   00004C   EF           MOV     A,R7
   \   00004D   3400         ADDC    A,#0x0
   \   00004F   FB           MOV     R3,A
   \   000050   EE           MOV     A,R6
   \   000051   240F         ADD     A,#0xf
   \   000053   12....       LCALL   ??Subroutine32_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_54:
   \   000056   F9           MOV     R1,A
   \   000057   12....       LCALL   ??ZDP_GenericRsp?relay
   \   00005A   7404         MOV     A,#0x4
   \   00005C   12....       LCALL   ?DEALLOC_XSTACK8
   2399          }
   \                     ??ZDApp_InMsgCB_1:
   \   00005F   02....       LJMP    ??Subroutine27_0 & 0xFFFF
   2400          
   2401          
   2402          /*********************************************************************
   2403           * @fn      ZDApp_ChangeMatchDescRespPermission()
   2404           *
   2405           * @brief   Changes the Match Descriptor Response permission.
   2406           *
   2407           * @param   endpoint - endpoint to allow responses
   2408           * @param   action - true to allow responses, false to not
   2409           *
   2410           * @return  none
   2411           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2412          void ZDApp_ChangeMatchDescRespPermission( uint8 endpoint, uint8 action )
   \                     ZDApp_ChangeMatchDescRespPermission:
   2413          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2414            // Store the action
   2415            afSetMatch( endpoint, action );
   \   000004                ; Setup parameters for call to function afSetMatch
   \   000004   12....       LCALL   ??afSetMatch?relay
   2416          }
   \   000007   02....       LJMP    ??Subroutine31_0 & 0xFFFF
   2417          
   2418          /*********************************************************************
   2419           * @fn      ZDApp_NetworkInit()
   2420           *
   2421           * @brief   Used to start the network joining process
   2422           *
   2423           * @param   delay - mSec delay to wait before starting
   2424           *
   2425           * @return  none
   2426           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2427          void ZDApp_NetworkInit( uint16 delay )
   \                     ZDApp_NetworkInit:
   2428          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2429            if ( delay )
   \   000004   EA           MOV     A,R2
   \   000005   7001         JNZ     ??ZDApp_NetworkInit_0
   \   000007   EB           MOV     A,R3
   \                     ??ZDApp_NetworkInit_0:
   \   000008   600B         JZ      ??ZDApp_NetworkInit_1
   2430            {
   2431              // Wait awhile before starting the device
   2432              osal_start_timerEx( ZDAppTaskID, ZDO_NETWORK_INIT, delay );
   \   00000A                ; Setup parameters for call to function osal_start_timerEx
   \   00000A   EA           MOV     A,R2
   \   00000B   FC           MOV     R4,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FD           MOV     R5,A
   \   00000E   7A01         MOV     R2,#0x1
   \   000010   12....       LCALL   ?Subroutine6 & 0xFFFF
   2433            }
   \                     ??CrossCallReturnLabel_46:
   \   000013   8005         SJMP    ??CrossCallReturnLabel_32
   2434            else
   2435            {
   2436              osal_set_event( ZDAppTaskID, ZDO_NETWORK_INIT );
   \                     ??ZDApp_NetworkInit_1:
   \   000015                ; Setup parameters for call to function osal_set_event
   \   000015   7A01         MOV     R2,#0x1
   \   000017   12....       LCALL   ?Subroutine21 & 0xFFFF
   2437            }
   2438          }
   \                     ??CrossCallReturnLabel_32:
   \   00001A   02....       LJMP    ??Subroutine31_0 & 0xFFFF
   2439          
   2440          /*********************************************************************
   2441           * @fn      ZDApp_NwkStateUpdateCB()
   2442           *
   2443           * @brief   This function notifies that this device's network 
   2444           *          state info has been changed.
   2445           *
   2446           * @param   none
   2447           *
   2448           * @return  none
   2449           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2450          void ZDApp_NwkStateUpdateCB( void )
   \                     ZDApp_NwkStateUpdateCB:
   2451          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2452            // Notify to save info into NV
   2453            if ( !osal_get_timeoutEx( ZDAppTaskID, ZDO_NWK_UPDATE_NV ) )
   \   000004                ; Setup parameters for call to function osal_get_timeoutEx
   \   000004   7A00         MOV     R2,#0x0
   \   000006   7B02         MOV     R3,#0x2
   \   000008   90....       MOV     DPTR,#ZDAppTaskID
   \   00000B   E0           MOVX    A,@DPTR
   \   00000C   F9           MOV     R1,A
   \   00000D   12....       LCALL   ??osal_get_timeoutEx?relay
   2454            {
   2455              // Trigger to save info into NV
   2456              ZDApp_NVUpdate();
   2457            }
   2458          }
   \   000010   02....       LJMP    ??Subroutine31_0 & 0xFFFF
   2459          
   2460          /*********************************************************************
   2461           * @fn      ZDApp_NodeProfileSync()
   2462           *
   2463           * @brief   Sync node with stack profile.
   2464           *
   2465           * @param   cfm - ZDO_NetworkDiscoveryCfm_t
   2466           *
   2467           * @return  none
   2468           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2469          void ZDApp_NodeProfileSync( ZDO_NetworkDiscoveryCfm_t* cfm )
   \                     ZDApp_NodeProfileSync:
   2470          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   2471            networkDesc_t* desc;
   2472            uint16         panID;
   2473          
   2474            if ( ZDO_Config_Node_Descriptor.CapabilityFlags & CAPINFO_DEVICETYPE_FFD  )
   \   000005   90....       MOV     DPTR,#(ZDO_Config_Node_Descriptor + 2)
   \   000008   E0           MOVX    A,@DPTR
   \   000009   A2E1         MOV     C,0xE0 /* A   */.1
   \   00000B   5058         JNC     ??ZDApp_NodeProfileSync_0
   2475            {
   2476              panID = BUILD_UINT16( cfm->panIdLSB, cfm->panIdMSB );
   2477          
   2478              desc = nwk_getNetworkDesc( cfm->extendedPANID, panID, cfm->logicalChannel );
   \   00000D                ; Setup parameters for call to function nwk_getNetworkDesc
   \   00000D   8A82         MOV     DPL,R2
   \   00000F   8B83         MOV     DPH,R3
   \   000011   A3           INC     DPTR
   \   000012   A3           INC     DPTR
   \   000013   A3           INC     DPTR
   \   000014   A3           INC     DPTR
   \   000015   E0           MOVX    A,@DPTR
   \   000016   F9           MOV     R1,A
   \   000017   8A82         MOV     DPL,R2
   \   000019   8B83         MOV     DPH,R3
   \   00001B   A3           INC     DPTR
   \   00001C   A3           INC     DPTR
   \   00001D   E0           MOVX    A,@DPTR
   \   00001E   FE           MOV     R6,A
   \   00001F   8A82         MOV     DPL,R2
   \   000021   8B83         MOV     DPH,R3
   \   000023   A3           INC     DPTR
   \   000024   A3           INC     DPTR
   \   000025   A3           INC     DPTR
   \   000026   E0           MOVX    A,@DPTR
   \   000027   FD           MOV     R5,A
   \   000028   EE           MOV     A,R6
   \   000029   FC           MOV     R4,A
   \   00002A   EA           MOV     A,R2
   \   00002B   2406         ADD     A,#0x6
   \   00002D   FA           MOV     R2,A
   \   00002E   EB           MOV     A,R3
   \   00002F   3400         ADDC    A,#0x0
   \   000031   FB           MOV     R3,A
   \   000032   12....       LCALL   ??nwk_getNetworkDesc?relay
   \   000035   8A82         MOV     DPL,R2
   \   000037   8B83         MOV     DPH,R3
   2479          
   2480              if (desc != NULL)
   \   000039   E582         MOV     A,DPL
   \   00003B   7002         JNZ     ??ZDApp_NodeProfileSync_1
   \   00003D   E583         MOV     A,DPH
   \                     ??ZDApp_NodeProfileSync_1:
   \   00003F   6024         JZ      ??ZDApp_NodeProfileSync_0
   2481              {
   2482                if ( desc->stackProfile != zgStackProfile )
   \   000041   A3           INC     DPTR
   \   000042   A3           INC     DPTR
   \   000043   A3           INC     DPTR
   \   000044   A3           INC     DPTR
   \   000045   A3           INC     DPTR
   \   000046   A3           INC     DPTR
   \   000047   A3           INC     DPTR
   \   000048   A3           INC     DPTR
   \   000049   E0           MOVX    A,@DPTR
   \   00004A   FA           MOV     R2,A
   \   00004B   90....       MOV     DPTR,#zgStackProfile
   \   00004E   E0           MOVX    A,@DPTR
   \   00004F   6A           XRL     A,R2
   \   000050   6013         JZ      ??ZDApp_NodeProfileSync_0
   2483                {
   2484                  ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_DEVICE;
   \   000052   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000055   E0           MOVX    A,@DPTR
   \   000056   54F8         ANL     A,#0xf8
   \   000058   4402         ORL     A,#0x2
   \   00005A   F0           MOVX    @DPTR,A
   2485                  ZDO_Config_Node_Descriptor.CapabilityFlags = CAPINFO_DEVICETYPE_RFD | CAPINFO_POWER_AC | CAPINFO_RCVR_ON_IDLE;
   \   00005B   740C         MOV     A,#0xc
   \   00005D   90....       MOV     DPTR,#(ZDO_Config_Node_Descriptor + 2)
   \   000060   F0           MOVX    @DPTR,A
   2486                  NLME_SetBroadcastFilter( ZDO_Config_Node_Descriptor.CapabilityFlags );
   \   000061                ; Setup parameters for call to function NLME_SetBroadcastFilter
   \   000061   F9           MOV     R1,A
   \   000062   12....       LCALL   ??NLME_SetBroadcastFilter?relay
   2487                }
   2488              }
   2489            }
   2490          }
   \                     ??ZDApp_NodeProfileSync_0:
   \   000065   02....       LJMP    ??Subroutine27_0 & 0xFFFF
   2491          
   2492          /*********************************************************************
   2493           * @fn      ZDApp_StartJoiningCycle()
   2494           *
   2495           * @brief   Starts the joining cycle of a device.  This will only 
   2496           *          continue an already started (or stopped) joining cycle.
   2497           *
   2498           * @param   none
   2499           *
   2500           * @return  TRUE if joining stopped, FALSE if joining or rejoining
   2501           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2502          uint8 ZDApp_StartJoiningCycle( void )
   \                     ZDApp_StartJoiningCycle:
   2503          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2504            if ( devState == DEV_INIT || devState == DEV_NWK_DISC )
   \   000004   90....       MOV     DPTR,#devState
   \   000007   E0           MOVX    A,@DPTR
   \   000008   6401         XRL     A,#0x1
   \   00000A   6005         JZ      ??ZDApp_StartJoiningCycle_0
   \   00000C   E0           MOVX    A,@DPTR
   \   00000D   6402         XRL     A,#0x2
   \   00000F   7011         JNZ     ??ZDApp_StartJoiningCycle_1
   2505            {
   2506              continueJoining = TRUE;
   \                     ??ZDApp_StartJoiningCycle_0:
   \   000011   7401         MOV     A,#0x1
   \   000013   90....       MOV     DPTR,#continueJoining
   \   000016   F0           MOVX    @DPTR,A
   2507              ZDApp_NetworkInit( 0 );
   \   000017                ; Setup parameters for call to function ZDApp_NetworkInit
   \   000017   7A00         MOV     R2,#0x0
   \   000019   7B00         MOV     R3,#0x0
   \   00001B   12....       LCALL   ??ZDApp_NetworkInit?relay
   2508          
   2509              return ( TRUE );
   \   00001E   7901         MOV     R1,#0x1
   \   000020   8002         SJMP    ??ZDApp_StartJoiningCycle_2
   2510            }
   2511            else
   2512              return ( FALSE );
   \                     ??ZDApp_StartJoiningCycle_1:
   \   000022   7900         MOV     R1,#0x0
   \                     ??ZDApp_StartJoiningCycle_2:
   \   000024   02....       LJMP    ??Subroutine31_0 & 0xFFFF
   2513          }
   2514          
   2515          /*********************************************************************
   2516           * @fn      ZDApp_StopJoiningCycle()
   2517           *
   2518           * @brief   Stops the joining or rejoining process of a device.
   2519           *
   2520           * @param   none
   2521           *
   2522           * @return  TRUE if joining stopped, FALSE if joining or rejoining
   2523           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2524          uint8 ZDApp_StopJoiningCycle( void )
   \                     ZDApp_StopJoiningCycle:
   2525          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2526            if ( devState == DEV_INIT || devState == DEV_NWK_DISC )
   \   000004   90....       MOV     DPTR,#devState
   \   000007   E0           MOVX    A,@DPTR
   \   000008   6401         XRL     A,#0x1
   \   00000A   6005         JZ      ??ZDApp_StopJoiningCycle_0
   \   00000C   E0           MOVX    A,@DPTR
   \   00000D   6402         XRL     A,#0x2
   \   00000F   7009         JNZ     ??ZDApp_StopJoiningCycle_1
   2527            {
   2528              continueJoining = FALSE;
   \                     ??ZDApp_StopJoiningCycle_0:
   \   000011   E4           CLR     A
   \   000012   90....       MOV     DPTR,#continueJoining
   \   000015   F0           MOVX    @DPTR,A
   2529              return ( TRUE );
   \   000016   7901         MOV     R1,#0x1
   \   000018   8002         SJMP    ??ZDApp_StopJoiningCycle_2
   2530            }
   2531            else
   2532              return ( FALSE );
   \                     ??ZDApp_StopJoiningCycle_1:
   \   00001A   7900         MOV     R1,#0x0
   \                     ??ZDApp_StopJoiningCycle_2:
   \   00001C   02....       LJMP    ??Subroutine31_0 & 0xFFFF
   2533          }
   2534          
   2535          /*********************************************************************
   2536           * @fn      ZDApp_AnnounceNewAddress()
   2537           *
   2538           * @brief   Send Device Announce and hold all transmissions for 
   2539           *          new address timeout.
   2540           *
   2541           * @param   none
   2542           *
   2543           * @return  none
   2544           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2545          void ZDApp_AnnounceNewAddress( void )
   \                     ZDApp_AnnounceNewAddress:
   2546          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   2547          #if defined ( ZIGBEE_NWK_UNIQUE_ADDR_CHECK )
   2548            // Turn off data request hold
   2549            APSME_HoldDataRequests( 0 );
   \   000005                ; Setup parameters for call to function APSME_HoldDataRequests
   \   000005   7A00         MOV     R2,#0x0
   \   000007   7B00         MOV     R3,#0x0
   \   000009   12....       LCALL   ??APSME_HoldDataRequests?relay
   2550          #endif
   2551            
   2552            ZDP_DeviceAnnce( NLME_GetShortAddr(), NLME_GetExtAddr(),
   2553                               ZDO_Config_Node_Descriptor.CapabilityFlags, 0 );
   \   00000C                ; Setup parameters for call to function NLME_GetExtAddr
   \   00000C   12....       LCALL   ??NLME_GetExtAddr?relay
   \   00000F   8A..         MOV     ?V0 + 0,R2
   \   000011   8B..         MOV     ?V0 + 1,R3
   \   000013   AE..         MOV     R6,?V0 + 0
   \   000015                ; Setup parameters for call to function NLME_GetShortAddr
   \   000015   12....       LCALL   ??NLME_GetShortAddr?relay
   \   000018                ; Setup parameters for call to function ZDP_DeviceAnnce
   \   000018   75..00       MOV     ?V0 + 0,#0x0
   \   00001B   78..         MOV     R0,#?V0 + 0
   \   00001D   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000020   90....       MOV     DPTR,#(ZDO_Config_Node_Descriptor + 2)
   \   000023   E0           MOVX    A,@DPTR
   \   000024   F9           MOV     R1,A
   \   000025   EE           MOV     A,R6
   \   000026   FC           MOV     R4,A
   \   000027   AD..         MOV     R5,?V0 + 1
   \   000029   12....       LCALL   ??ZDP_DeviceAnnce?relay
   \   00002C   7401         MOV     A,#0x1
   \   00002E   12....       LCALL   ?DEALLOC_XSTACK8
   2554            
   2555          #if defined ( ZIGBEE_NWK_UNIQUE_ADDR_CHECK )
   2556            // Setup the timeout
   2557            APSME_HoldDataRequests( ZDAPP_HOLD_DATA_REQUESTS_TIMEOUT );
   \   000031                ; Setup parameters for call to function APSME_HoldDataRequests
   \   000031   7A00         MOV     R2,#0x0
   \   000033   7B00         MOV     R3,#0x0
   \   000035   12....       LCALL   ??APSME_HoldDataRequests?relay
   2558          #endif  
   2559          }
   \   000038   02....       LJMP    ??Subroutine27_0 & 0xFFFF
   2560          
   2561          /*********************************************************************
   2562           * @fn          ZDApp_NVUpdate
   2563           *
   2564           * @brief       Set the NV Update Timer.
   2565           *
   2566           * @param       none
   2567           *
   2568           * @return      none
   2569           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2570          void ZDApp_NVUpdate( void )
   \                     ZDApp_NVUpdate:
   2571          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2572          #if defined ( NV_RESTORE )
   2573            osal_start_timerEx( ZDAppTaskID, ZDO_NWK_UPDATE_NV, ZDAPP_UPDATE_NWK_NV_TIME );
   2574          #endif
   2575          }
   \   000000   02....       LJMP    ?BRET
   2576          
   2577          /*********************************************************************
   2578           * @fn      ZDApp_CoordStartPANIDConflictCB()
   2579           *
   2580           * @brief   Returns a PAN ID for the network layer to use during
   2581           *          a coordinator start and there is another network with 
   2582           *          the intended PANID.
   2583           *
   2584           * @param   panid - the intended PAN ID
   2585           *
   2586           * @return  PANID to try
   2587           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2588          uint16 ZDApp_CoordStartPANIDConflictCB( uint16 panid )
   \                     ZDApp_CoordStartPANIDConflictCB:
   2589          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2590            return ( panid + 1 );
   \   000000   7401         MOV     A,#0x1
   \   000002   2A           ADD     A,R2
   \   000003   0A           INC     R2
   \   000004   E4           CLR     A
   \   000005   3B           ADDC    A,R3
   \   000006   FB           MOV     R3,A
   \   000007   02....       LJMP    ?BRET
   2591          }
   2592          
   2593          /*********************************************************************
   2594           * @fn          ZDO_SrcRtgIndCB
   2595           *
   2596           * @brief       This function notifies the ZDO available src route record received.
   2597           *
   2598           * @param       srcAddr - source address of the source route
   2599           * @param       relayCnt - number of devices in the relay list
   2600           * @param       relayList - relay list of the source route
   2601           *
   2602           * @return      none
   2603           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2604          void ZDO_SrcRtgIndCB (uint16 srcAddr, uint8 relayCnt, uint16* pRelayList )
   \                     ZDO_SrcRtgIndCB:
   2605          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 5
   \   000004   74FB         MOV     A,#-0x5
   \   000006   12....       LCALL   ?ALLOC_XSTACK8
   2606            zdoSrcRtg_t srcRtg;
   2607            
   2608            srcRtg.srcAddr = srcAddr;
   \   000009   12....       LCALL   ?Subroutine3 & 0xFFFF
   2609            srcRtg.relayCnt = relayCnt;
   \                     ??CrossCallReturnLabel_60:
   \   00000C   7402         MOV     A,#0x2
   \   00000E   12....       LCALL   ?XSTACK_DISP0_8
   \   000011   E9           MOV     A,R1
   \   000012   F0           MOVX    @DPTR,A
   2610            srcRtg.pRelayList = pRelayList;
   \   000013   7403         MOV     A,#0x3
   \   000015   12....       LCALL   ?XSTACK_DISP0_8
   \   000018   EC           MOV     A,R4
   \   000019   F0           MOVX    @DPTR,A
   \   00001A   A3           INC     DPTR
   \   00001B   ED           MOV     A,R5
   \   00001C   F0           MOVX    @DPTR,A
   2611            
   2612            if( zdoCBFunc[ZDO_SRC_RTG_IND_CBID] != NULL )
   \   00001D   90....       MOV     DPTR,#zdoCBFunc
   \   000020   E0           MOVX    A,@DPTR
   \   000021   7002         JNZ     ??ZDO_SrcRtgIndCB_0
   \   000023   A3           INC     DPTR
   \   000024   E0           MOVX    A,@DPTR
   \                     ??ZDO_SrcRtgIndCB_0:
   \   000025   6013         JZ      ??ZDO_SrcRtgIndCB_1
   2613            {
   2614              zdoCBFunc[ZDO_SRC_RTG_IND_CBID]( (void*)&srcRtg );
   \   000027                ; Setup parameters for indirect call
   \   000027   85..82       MOV     DPL,?XSP + 0
   \   00002A   85..83       MOV     DPH,?XSP + 1
   \   00002D   AA82         MOV     R2,DPL
   \   00002F   AB83         MOV     R3,DPH
   \   000031   90....       MOV     DPTR,#zdoCBFunc
   \   000034   12....       LCALL   ?Subroutine10 & 0xFFFF
   2615            }
   \                     ??CrossCallReturnLabel_12:
   \   000037   12....       LCALL   ?CALL_IND
   2616          }
   \                     ??ZDO_SrcRtgIndCB_1:
   \   00003A   7405         MOV     A,#0x5
   \   00003C   12....       LCALL   ?DEALLOC_XSTACK8
   \   00003F   02....       LJMP    ??Subroutine31_0 & 0xFFFF
   2617          
   2618          
   2619          /*********************************************************************
   2620           * @fn          ZDO_RegisterForZdoCB
   2621           *
   2622           * @brief       Call this function to register the higher layer (for 
   2623           *              example, the Application layer or MT layer) with ZDO 
   2624           *              callbacks to get notified of some ZDO indication like
   2625           *              existence of a concentrator or receipt of a source 
   2626           *              route record.
   2627           *
   2628           * @param       indID - ZDO Indication ID
   2629           * @param       pFn   - Callback function pointer
   2630           *
   2631           * @return      ZSuccess - successful, ZInvalidParameter if not
   2632           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2633          ZStatus_t ZDO_RegisterForZdoCB( uint8 indID, pfnZdoCb pFn )
   \                     ZDO_RegisterForZdoCB:
   2634          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2635            // Check the range of the indication ID
   2636            if ( indID < MAX_ZDO_CB_FUNC )
   \   000004   E9           MOV     A,R1
   \   000005   700A         JNZ     ??ZDO_RegisterForZdoCB_0
   2637            {
   2638              zdoCBFunc[indID] = pFn;
   \   000007   90....       MOV     DPTR,#zdoCBFunc
   \   00000A   12....       LCALL   ??Subroutine33_0 & 0xFFFF
   2639              return ZSuccess;
   \                     ??CrossCallReturnLabel_58:
   \   00000D   7900         MOV     R1,#0x0
   \   00000F   8002         SJMP    ??ZDO_RegisterForZdoCB_1
   2640            }
   2641            
   2642            return ZInvalidParameter;
   \                     ??ZDO_RegisterForZdoCB_0:
   \   000011   7902         MOV     R1,#0x2
   \                     ??ZDO_RegisterForZdoCB_1:
   \   000013   02....       LJMP    ??Subroutine31_0 & 0xFFFF
   2643          }

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zdoDiscCounter>`:
   \   000000   01           DB 1

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for continueJoining>`:
   \   000000   01           DB 1

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for devState>`:
   \   000000   01           DB 1

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for ZDApp_epDesc>`:
   \   000000   00           DB 0
   \   000001   ....0000     DW ZDAppTaskID, 0H
   \   000005   00           DB 0

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for ZDApp_SavedPollRate>`:
   \   000000   E803         DW 1000

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_1:
   \   000000   01000000     DD 1

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_0:
   \   000000   00000000     DD 0

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_3e8:
   \   000000   E8030000     DD 1000

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_Init?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_Init

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SecInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SecInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_event_loop?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_event_loop

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessSecEvent?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessSecEvent

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDOInitDevice?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDOInitDevice

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ReadNetworkRestoreState?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ReadNetworkRestoreState

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDAppDetermineDeviceType?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDAppDetermineDeviceType

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NetworkStartEvt?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NetworkStartEvt

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_DeviceAuthEvt?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_DeviceAuthEvt

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SaveNetworkStateEvt?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SaveNetworkStateEvt

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_RestoreNetworkState?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_RestoreNetworkState

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_InitUserDesc?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_InitUserDesc

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDAppCheckForHoldKey?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDAppCheckForHoldKey

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessOSALMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessOSALMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessMsgCBs?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessMsgCBs

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_RegisterCBs?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_RegisterCBs

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessSecMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessSecMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessNetworkJoin?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessNetworkJoin

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SaveNwkKey?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SaveNwkKey

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ResetNwkKey?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ResetNwkKey

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_RestoreNwkKey?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_RestoreNwkKey

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ResetTimerStart?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ResetTimerStart

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ResetTimerCancel?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ResetTimerCancel

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveCtrlInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveCtrlInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveCtrlSet?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveCtrlSet

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveCtrlBypass?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveCtrlBypass

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveCtrlStartup?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveCtrlStartup

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveReset?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveReset

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveUpdate?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveUpdate

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SendEventMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SendEventMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SendMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SendMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_NetworkDiscoveryConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_NetworkDiscoveryConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_NetworkFormationConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_NetworkFormationConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_StartRouterConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_StartRouterConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_JoinConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_JoinConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_AddrChangeIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_AddrChangeIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_JoinIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_JoinIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_ConcentratorIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_ConcentratorIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_LeaveCnf?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_LeaveCnf

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_LeaveInd?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_LeaveInd

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_SyncIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_SyncIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_ManytoOneFailureIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_ManytoOneFailureIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_PollConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_PollConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??AddrMgrWriteNVRequest?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    AddrMgrWriteNVRequest

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_UpdateDeviceIndication?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_UpdateDeviceIndication

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_InMsgCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_InMsgCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ChangeMatchDescRespPermission?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ChangeMatchDescRespPermission

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NetworkInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NetworkInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NwkStateUpdateCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NwkStateUpdateCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NodeProfileSync?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NodeProfileSync

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_StartJoiningCycle?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_StartJoiningCycle

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_StopJoiningCycle?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_StopJoiningCycle

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_AnnounceNewAddress?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_AnnounceNewAddress

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NVUpdate?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NVUpdate

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_CoordStartPANIDConflictCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_CoordStartPANIDConflictCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_SrcRtgIndCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_SrcRtgIndCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_RegisterForZdoCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_RegisterForZdoCB
   2644          
   2645          /*********************************************************************
   2646          *********************************************************************/

   Maximum stack usage in bytes:

     Function                       ISTACK PSTACK XSTACK
     --------                       ------ ------ ------
     AddrMgrWriteNVRequest              0      0      0
     ZDAppCheckForHoldKey               2      0      0
       -> HalKeyRead                    4      0      0
     ZDAppDetermineDeviceType           2      0     12
       -> nwk_ExtPANIDValid             4      0      0
     ZDApp_AnnounceNewAddress           0      0     23
       -> APSME_HoldDataRequests        0      0     20
       -> NLME_GetExtAddr               0      0     20
       -> NLME_GetShortAddr             0      0     20
       -> ZDP_DeviceAnnce               0      0     22
       -> APSME_HoldDataRequests        0      0     20
     ZDApp_ChangeMatchDescRespPermission
                                        2      0      0
       -> afSetMatch                    4      0      0
     ZDApp_CoordStartPANIDConflictCB
                                        0      0      0
     ZDApp_DeviceAuthEvt                2      0      9
       -> ZDApp_ResetTimerCancel        4      0      0
       -> osal_set_event                4      0      0
       -> NLME_StartRouterRequest       4      0      0
       -> ZDApp_SaveNwkKey              4      0      0
       -> ZDApp_AnnounceNewAddress      4      0      0
       -> NLME_SetPollRate              4      0      0
     ZDApp_InMsgCB                      0      0     14
       -> ZDP_GenericRsp                0      0     28
     ZDApp_Init                         2      0      0
       -> NLME_GetExtAddr               4      0      0
       -> ZDAppCheckForHoldKey          4      0      0
       -> ZDO_Init                      4      0      0
       -> afRegister                    4      0      0
       -> ZDOInitDevice                 4      0      0
       -> HalLedBlink                   4      0      0
       -> ZDApp_RegisterCBs             4      0      0
     ZDApp_InitUserDesc                 0      0     31
       -> osal_memset                   0      0     54
       -> osal_nv_item_init             0      0     58
       -> osal_nv_read                  0      0     62
     ZDApp_LeaveCtrlBypass              2      0      0
     ZDApp_LeaveCtrlInit                0      0     26
       -> osal_nv_item_init             0      0     24
       -> osal_nv_read                  0      0     28
     ZDApp_LeaveCtrlSet                 0      0     14
       -> osal_nv_write                 0      0     28
     ZDApp_LeaveCtrlStartup             1      0     26
       -> osal_nv_write                 0      0     28
     ZDApp_LeaveReset                   2      0     16
       -> ZDApp_LeaveCtrlSet            4      0      0
       -> ZDApp_ResetTimerStart         4      0      0
     ZDApp_LeaveUpdate                  2      0      0
       -> NLME_RemoveChild              4      0      0
     ZDApp_NVUpdate                     0      0      0
     ZDApp_NetworkInit                  2      0     16
       -> osal_start_timerEx            4      0      0
       -> osal_set_event                4      0      0
     ZDApp_NetworkStartEvt              2      0     10
       -> osal_pwrmgr_device            4      0      0
       -> osal_set_event                4      0      0
       -> NLME_GetEnergyThreshold       4      0      0
       -> NLME_GetEnergyThreshold       4      0      0
       -> NLME_SetEnergyThreshold       4      0      0
       -> osal_set_event                4      0      0
       -> osal_set_event                4      0      0
     ZDApp_NodeProfileSync              0      0     26
       -> nwk_getNetworkDesc            0      0     20
       -> NLME_SetBroadcastFilter       0      0     20
     ZDApp_NwkStateUpdateCB             2      0      0
       -> osal_get_timeoutEx            4      0      0
     ZDApp_ProcessMsgCBs                0      0     47
       -> ZDO_ParseAddrRsp              0      0     62
       -> ZDO_UpdateAddrManager         0      0     62
       -> osal_mem_free                 0      0     62
       -> ZDO_ParseBindUnbindReq        0      0     62
       -> ZDO_ProcessBindUnbindReq      0      0     62
     ZDApp_ProcessNetworkJoin           0      0     28
       -> osal_set_event                0      0     24
       -> ZDApp_AnnounceNewAddress      0      0     24
       -> NLME_StartRouterRequest       0      0     24
       -> NLME_GetShortAddr             0      0     24
       -> ZMacSetReq                    0      0     24
       -> nwkNeighborInitTable          0      0     24
       -> NLME_NwkDiscTerm              0      0     24
       -> osal_rand                     0      0     24
       -> ZDApp_NetworkInit             0      0     24
       -> osal_set_event                0      0     24
       -> NLME_SetPollRate              0      0     24
       -> NLME_SetQueuedPollRate        0      0     24
       -> NLME_SetResponseRate          0      0     24
       -> NLME_StartRouterRequest       0      0     24
       -> ZDApp_AnnounceNewAddress      0      0     24
       -> nwkNeighborInitTable          0      0     24
       -> NLME_NwkDiscTerm              0      0     24
       -> osal_rand                     0      0     24
       -> ZDApp_NetworkInit             0      0     24
       -> ZDApp_AnnounceNewAddress      0      0     24
       -> osal_set_event                0      0     24
     ZDApp_ProcessOSALMsg               1      0     27
       -> ZDP_IncomingData              0      0     32
       -> ZDApp_ProcessMsgCBs           0      0     32
       -> ZDApp_NodeProfileSync         0      0     32
       -> NLME_JoinRequest              0      0     34
       -> osal_rand                     0      0     32
       -> ZDApp_NetworkInit             0      0     32
       -> osal_rand                     0      0     32
       -> ZMacSetReq                    0      0     32
       -> ZMacSetReq                    0      0     32
       -> ZMacSetReq                    0      0     32
       -> NLME_ReJoinRequest            0      0     32
       -> osal_rand                     0      0     32
       -> ZDApp_NetworkInit             0      0     32
       -> NLME_SetPollRate              0      0     32
       -> NLME_SetQueuedPollRate        0      0     32
       -> NLME_SetResponseRate          0      0     32
       -> osal_rand                     0      0     32
       -> ZDApp_NetworkInit             0      0     32
       -> ZDApp_ProcessNetworkJoin      0      0     32
       -> sAddrExtCpy                   0      0     32
       -> ZDApp_NetworkInit             0      0     32
     ZDApp_ProcessSecEvent              0      0      9
       -> ZDSecMgrNewDeviceEvent        0      0     18
       -> osal_start_timerEx            0      0     18
       -> ZDApp_DeviceAuthEvt           0      0     18
       -> ZDApp_SaveNwkKey              0      0     18
     ZDApp_ProcessSecMsg                2      0      0
       -> ZDSecMgrTransportKeyInd       4      0      0
       -> ZDSecMgrRemoveDeviceInd       4      0      0
       -> ZDSecMgrSwitchKeyInd          4      0      0
     ZDApp_ReadNetworkRestoreState      0      0      9
       -> zgReadStartupOptions          0      0     18
     ZDApp_RegisterCBs                  2      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
     ZDApp_ResetNwkKey                  0      0     35
       -> osal_memset                   0      0     62
       -> osal_nv_write                 0      0     70
     ZDApp_ResetTimerCancel             2      0      0
       -> osal_stop_timerEx             4      0      0
     ZDApp_ResetTimerStart              2      0      0
       -> osal_start_timerEx            4      0      0
     ZDApp_RestoreNetworkState          0      0      9
       -> NLME_InitNV                   0      0     18
       -> NLME_RestoreFromNV            0      0     18
       -> NLME_GetShortAddr             0      0     18
       -> sAddrExtCpy                   0      0     18
     ZDApp_RestoreNwkKey                0      0     37
       -> osal_nv_read                  0      0     74
     ZDApp_SaveNetworkStateEvt          0      0      0
     ZDApp_SaveNwkKey                   0      0     46
       -> SSP_ReadNwkActiveKey          0      0     66
       -> osal_nv_write                 0      0     74
     ZDApp_SecInit                      2      0      0
       -> ZDSecMgrInit                  4      0      0
     ZDApp_SendEventMsg                 2      0      0
       -> ZDApp_SendMsg                 4      0      0
     ZDApp_SendMsg                      1      0     55
       -> osal_msg_allocate             0      0     40
       -> osal_memcpy                   0      0     46
       -> osal_msg_send                 0      0     40
     ZDApp_StartJoiningCycle            2      0      0
       -> ZDApp_NetworkInit             4      0      0
     ZDApp_StopJoiningCycle             2      0      0
     ZDApp_event_loop                   0      0     10
       -> ZDO_StartDevice               0      0     20
       -> ZDApp_ProcessOSALMsg          0      0     20
       -> osal_msg_deallocate           0      0     20
       -> osal_msg_receive              0      0     20
       -> ZDApp_NetworkStartEvt         0      0     20
       -> osal_pwrmgr_device            0      0     20
       -> osal_set_event                0      0     20
       -> ZDO_UpdateNwkStatus           0      0     20
       -> osal_start_timerEx            0      0     20
     ZDOInitDevice                      0      0     12
       -> zgInitItems                   0      0     24
       -> ZDConfig_InitDescriptors      0      0     24
       -> ZDApp_LeaveCtrlInit           0      0     24
       -> ZDApp_LeaveCtrlStartup        0      0     24
       -> zgWriteStartupOptions         0      0     24
       -> osal_set_event                0      0     24
       -> ZDAppDetermineDeviceType      0      0     24
       -> osal_rand                     0      0     24
       -> ZDSecMgrInit                  0      0     24
       -> ZDApp_NetworkInit             0      0     24
       -> NLME_SetBroadcastFilter       0      0     24
     ZDO_AddrChangeIndicationCB         2      0      0
       -> osal_set_event                4      0      0
       -> ZDApp_AnnounceNewAddress      4      0      0
     ZDO_ConcentratorIndicationCB       0      0      0
     ZDO_JoinConfirmCB                  2      0      0
       -> HalLedSet                     4      0      0
       -> HalLedSet                     4      0      0
       -> HalLedSet                     4      0      0
       -> ZDApp_SendMsg                 4      0      0
     ZDO_JoinIndicationCB               0      0      1
     ZDO_LeaveCnf                       0      0     10
       -> NLME_GetExtAddr               0      0     20
       -> sAddrExtCmp                   0      0     20
       -> ZDApp_LeaveReset              0      0     20
       -> NLME_RemoveChild              0      0     20
     ZDO_LeaveInd                       1      0     16
       -> NLME_LeaveRsp                 0      0     32
       -> ZDApp_LeaveReset              0      0     32
       -> NLME_GetCoordShortAddr        0      0     32
       -> ZDApp_LeaveReset              0      0     32
       -> NLME_RemoveChild              0      0     32
     ZDO_ManytoOneFailureIndicationCB
                                        2      0      0
       -> RTG_MTORouteReq               4      0      0
     ZDO_NetworkDiscoveryConfirmCB      1      0     32
       -> nwk_ExtPANIDValid             0      0     64
       -> sAddrExtCmp                   0      0     64
       -> sAddrExtCpy                   0      0     64
       -> ZDApp_SendMsg                 0      0     64
     ZDO_NetworkFormationConfirmCB      2      0      0
       -> HalLedSet                     4      0      0
       -> HalLedSet                     4      0      0
       -> HalLedSet                     4      0      0
       -> osal_set_event                4      0      0
     ZDO_PollConfirmCB                  0      0      0
     ZDO_RegisterForZdoCB               2      0      0
     ZDO_SrcRtgIndCB                    3      0      5
     ZDO_StartRouterConfirmCB           2      0      0
       -> HalLedSet                     4      0      0
       -> HalLedSet                     4      0      0
       -> HalLedSet                     4      0      0
       -> osal_set_event                4      0      0
     ZDO_SyncIndicationCB               2      0      0
       -> nwkNeighborInitTable          4      0      0
       -> ZDApp_SendMsg                 4      0      0
     ZDO_UpdateDeviceIndication         0      0      0


   Segment part sizes:

     Function/Label                              Bytes
     --------------                              -----
     _A_IEN0                                        1
     WDCTL                                          1
     MatchRsps                                      1
     zdoDiscCounter                                 1
     ZDAppNwkAddr                                   9
     zdappMgmtNwkDiscRspTransSeq                    1
     zdappMgmtNwkDiscReqInProgress                  1
     zdappMgmtNwkDiscRspAddr                        9
     zdappMgmtNwkDiscStartIndex                     1
     zdappMgmtSavedNwkState                         1
     nwkFrameCounterChanges                         2
     continueJoining                                1
     _tmpRejoinState                                1
     ZDO_UseExtendedPANID                           8
     zdoCBFunc                                      2
     ZDAppTaskID                                    1
     nwkStatus                                      1
     ZDApp_AutoFindMode_epDesc                      2
     ZDApp_LeaveCtrl                                1
     devState                                       1
     devStartMode                                   1
     retryCnt                                       1
     ZDApp_epDesc                                   6
     ZDApp_SavedPollRate                            2
     ZDApp_Init                                    75
     ??Subroutine31_0                               7
     ZDApp_SecInit                                 10
     ZDApp_event_loop                             223
     ??Subroutine27_0                               5
     ?Subroutine4                                   2
     ?Subroutine21                                 11
     ??Subroutine30_0                               6
     ZDApp_ProcessSecEvent                        106
     ?Subroutine22                                  5
     ?Subroutine6                                   5
     ??Subroutine33_0                               6
     ?Subroutine20                                  2
     ??Subroutine26_0                               3
     ZDOInitDevice                                141
     ?Subroutine3                                   6
     ZDApp_ReadNetworkRestoreState                 21
     ZDAppDetermineDeviceType                      74
     ZDApp_NetworkStartEvt                         78
     ?Subroutine18                                  3
     ZDApp_DeviceAuthEvt                           60
     ?Subroutine5                                   9
     ?Subroutine0                                  11
     ZDApp_SaveNetworkStateEvt                      3
     ZDApp_RestoreNetworkState                     67
     ?Subroutine1                                  13
     ZDApp_InitUserDesc                            93
     ?Subroutine15                                 32
     ZDAppCheckForHoldKey                          20
     ZDApp_ProcessOSALMsg                         472
     ?Subroutine14                                 22
     ?Subroutine11                                 20
     ?Subroutine13                                 11
     ?Subroutine10                                  9
     ZDApp_ProcessMsgCBs                          122
     ?Subroutine25                                  5
     ?Subroutine12                                  7
     ??Subroutine32_0                               9
     ZDApp_RegisterCBs                             31
     ?Subroutine7                                   2
     ??Subroutine28_0                               9
     ZDApp_ProcessSecMsg                           75
     ZDApp_ProcessNetworkJoin                     385
     ?Subroutine9                                  12
     ZDApp_SaveNwkKey                              82
     ?Subroutine23                                 10
     ?Subroutine17                                  6
     ??Subroutine29_0                               8
     ZDApp_ResetNwkKey                             38
     ZDApp_RestoreNwkKey                          110
     ZDApp_ResetTimerStart                         16
     ZDApp_ResetTimerCancel                        19
     ZDApp_LeaveCtrlInit                           65
     ?Subroutine2                                  14
     ZDApp_LeaveCtrlSet                            51
     ZDApp_LeaveCtrlBypass                         16
     ZDApp_LeaveCtrlStartup                        75
     ZDApp_LeaveReset                              16
     ZDApp_LeaveUpdate                             13
     ZDApp_SendEventMsg                             8
     ?Subroutine24                                  5
     ?Subroutine8                                   9
     ZDApp_SendMsg                                100
     ZDO_NetworkDiscoveryConfirmCB                383
     ZDO_NetworkFormationConfirmCB                 33
     ?Subroutine16                                 19
     ZDO_StartRouterConfirmCB                      33
     ZDO_JoinConfirmCB                             39
     ZDO_AddrChangeIndicationCB                    13
     ZDO_JoinIndicationCB                           0
     ?Subroutine19                                  5
     ZDO_ConcentratorIndicationCB                   3
     ZDO_LeaveCnf                                  76
     ZDO_LeaveInd                                 154
     ZDO_SyncIndicationCB                          34
     ZDO_ManytoOneFailureIndicationCB
                                                   10
     ZDO_PollConfirmCB                              3
     AddrMgrWriteNVRequest                          3
     ZDO_UpdateDeviceIndication                     3
     ZDApp_InMsgCB                                 98
     ZDApp_ChangeMatchDescRespPermission
                                                   10
     ZDApp_NetworkInit                             29
     ZDApp_NwkStateUpdateCB                        19
     ZDApp_NodeProfileSync                        104
     ZDApp_StartJoiningCycle                       39
     ZDApp_StopJoiningCycle                        31
     ZDApp_AnnounceNewAddress                      59
     ZDApp_NVUpdate                                 3
     ZDApp_CoordStartPANIDConflictCB
                                                   10
     ZDO_SrcRtgIndCB                               66
     ZDO_RegisterForZdoCB                          22
     ?<Initializer for zdoDiscCounter>              1
     ?<Initializer for continueJoining>             1
     ?<Initializer for devState>                    1
     ?<Initializer for ZDApp_epDesc>                6
     ?<Initializer for ZDApp_SavedPollRate>         2
     __Constant_1                                   4
     __Constant_0                                   4
     __Constant_3e8                                 4
     ??ZDApp_Init?relay                             6
     ??ZDApp_SecInit?relay                          6
     ??ZDApp_event_loop?relay                       6
     ??ZDApp_ProcessSecEvent?relay                  6
     ??ZDOInitDevice?relay                          6
     ??ZDApp_ReadNetworkRestoreState?relay          6
     ??ZDAppDetermineDeviceType?relay               6
     ??ZDApp_NetworkStartEvt?relay                  6
     ??ZDApp_DeviceAuthEvt?relay                    6
     ??ZDApp_SaveNetworkStateEvt?relay              6
     ??ZDApp_RestoreNetworkState?relay              6
     ??ZDApp_InitUserDesc?relay                     6
     ??ZDAppCheckForHoldKey?relay                   6
     ??ZDApp_ProcessOSALMsg?relay                   6
     ??ZDApp_ProcessMsgCBs?relay                    6
     ??ZDApp_RegisterCBs?relay                      6
     ??ZDApp_ProcessSecMsg?relay                    6
     ??ZDApp_ProcessNetworkJoin?relay               6
     ??ZDApp_SaveNwkKey?relay                       6
     ??ZDApp_ResetNwkKey?relay                      6
     ??ZDApp_RestoreNwkKey?relay                    6
     ??ZDApp_ResetTimerStart?relay                  6
     ??ZDApp_ResetTimerCancel?relay                 6
     ??ZDApp_LeaveCtrlInit?relay                    6
     ??ZDApp_LeaveCtrlSet?relay                     6
     ??ZDApp_LeaveCtrlBypass?relay                  6
     ??ZDApp_LeaveCtrlStartup?relay                 6
     ??ZDApp_LeaveReset?relay                       6
     ??ZDApp_LeaveUpdate?relay                      6
     ??ZDApp_SendEventMsg?relay                     6
     ??ZDApp_SendMsg?relay                          6
     ??ZDO_NetworkDiscoveryConfirmCB?relay          6
     ??ZDO_NetworkFormationConfirmCB?relay          6
     ??ZDO_StartRouterConfirmCB?relay               6
     ??ZDO_JoinConfirmCB?relay                      6
     ??ZDO_AddrChangeIndicationCB?relay             6
     ??ZDO_JoinIndicationCB?relay                   6
     ??ZDO_ConcentratorIndicationCB?relay           6
     ??ZDO_LeaveCnf?relay                           6
     ??ZDO_LeaveInd?relay                           6
     ??ZDO_SyncIndicationCB?relay                   6
     ??ZDO_ManytoOneFailureIndicationCB?relay       6
     ??ZDO_PollConfirmCB?relay                      6
     ??AddrMgrWriteNVRequest?relay                  6
     ??ZDO_UpdateDeviceIndication?relay             6
     ??ZDApp_InMsgCB?relay                          6
     ??ZDApp_ChangeMatchDescRespPermission?relay    6
     ??ZDApp_NetworkInit?relay                      6
     ??ZDApp_NwkStateUpdateCB?relay                 6
     ??ZDApp_NodeProfileSync?relay                  6
     ??ZDApp_StartJoiningCycle?relay                6
     ??ZDApp_StopJoiningCycle?relay                 6
     ??ZDApp_AnnounceNewAddress?relay               6
     ??ZDApp_NVUpdate?relay                         6
     ??ZDApp_CoordStartPANIDConflictCB?relay        6
     ??ZDO_SrcRtgIndCB?relay                        6
     ??ZDO_RegisterForZdoCB?relay                   6

 
 4 250 bytes in segment BANKED_CODE
   342 bytes in segment BANK_RELAYS
     2 bytes in segment SFR_AN
    11 bytes in segment XDATA_I
    11 bytes in segment XDATA_ID
    12 bytes in segment XDATA_ROM_C
    43 bytes in segment XDATA_Z
 
 4 603 bytes of CODE  memory
     0 bytes of CONST memory (+ 12 bytes shared)
     0 bytes of DATA  memory (+  2 bytes shared)
    54 bytes of XDATA memory

Errors: none
Warnings: none
